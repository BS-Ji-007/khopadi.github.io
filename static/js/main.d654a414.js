/*! For license information please see main.d654a414.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{e.exports=n(202)},153:(e,t,n)=>{var r=n(43),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,s={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},202:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||g}function y(){}function E(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||g}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var b=E.prototype=new y;b.constructor=E,p(b,v.prototype),b.isPureReactComponent=!0;var S=Array.isArray,T=Object.prototype.hasOwnProperty,k={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,r){var i,s={},a=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)T.call(t,i)&&!x.hasOwnProperty(i)&&(s[i]=t[i]);var l=arguments.length-2;if(1===l)s.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===s[i]&&(s[i]=l[i]);return{$$typeof:n,type:e,key:a,ref:o,props:s,_owner:k.current}}function L(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var A=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,i,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return a=a(l=e),e=""===s?"."+R(l,0):s,S(a)?(i="",null!=e&&(i=e.replace(A,"$&/")+"/"),I(a,t,i,"",function(e){return e})):null!=a&&(L(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,i+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(A,"$&/")+"/")+e)),t.push(a)),1;if(l=0,s=""===s?".":s+":",S(e))for(var c=0;c<e.length;c++){var u=s+R(o=e[c],c);l+=I(o,t,i,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=I(o=o.value,t,i,u=s+R(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function _(e,t,n){if(null==e)return e;var r=[],i=0;return I(e,r,"","",function(e){return t.call(n,e,i++)}),r}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},C={transition:null},O={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:C,ReactCurrentOwner:k};function N(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:_,forEach:function(e,t,n){_(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return _(e,function(){t++}),t},toArray:function(e){return _(e,function(e){return e})||[]},only:function(e){if(!L(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=i,t.Profiler=a,t.PureComponent=E,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.act=N,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=p({},e.props),s=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=k.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)T.call(t,c)&&!x.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:s,ref:a,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=L,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=C.transition;C.transition={};try{e()}finally{C.transition=t}},t.unstable_act=N,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<s(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,n))c<i&&0>s(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<i&&0>s(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,f=3,g=!1,p=!1,m=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,E="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function S(e){if(m=!1,b(e),!p)if(null!==r(c))p=!0,C(T);else{var t=r(u);null!==t&&O(S,t.startTime-e)}}function T(e,n){p=!1,m&&(m=!1,y(L),L=-1),g=!0;var s=f;try{for(b(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!I());){var a=h.callback;if("function"===typeof a){h.callback=null,f=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===r(c)&&i(c),b(n)}else i(c);h=r(c)}if(null!==h)var l=!0;else{var d=r(u);null!==d&&O(S,d.startTime-n),l=!1}return l}finally{h=null,f=s,g=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var k,x=!1,w=null,L=-1,A=5,R=-1;function I(){return!(t.unstable_now()-R<A)}function _(){if(null!==w){var e=t.unstable_now();R=e;var n=!0;try{n=w(!0,e)}finally{n?k():(x=!1,w=null)}}else x=!1}if("function"===typeof E)k=function(){E(_)};else if("undefined"!==typeof MessageChannel){var D=new MessageChannel,P=D.port2;D.port1.onmessage=_,k=function(){P.postMessage(null)}}else k=function(){v(_,0)};function C(e){w=e,x||(x=!0,k())}function O(e,n){L=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){p||g||(p=!0,C(T))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(u,e),null===r(c)&&e===r(u)&&(m?(y(L),L=-1):m=!0,O(S,s-a))):(e.sortIndex=o,n(c,e),p||g||(p=!0,C(T))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},391:(e,t,n)=>{var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},579:(e,t,n)=>{e.exports=n(153)},730:(e,t,n)=>{var r=n(43),i=n(853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},g={};function p(e,t,n,r,i,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){m[e]=new p(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];m[t]=new p(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){m[e]=new p(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){m[e]=new p(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){m[e]=new p(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){m[e]=new p(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){m[e]=new p(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){m[e]=new p(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){m[e]=new p(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function E(e,t,n,r){var i=m.hasOwnProperty(t)?m[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(g,e)||!d.call(f,e)&&(h.test(e)?g[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);m[t]=new p(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);m[t]=new p(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);m[t]=new p(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!1,!1)}),m.xlinkHref=new p("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=Symbol.for("react.element"),T=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),A=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var C=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function N(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var M,F=Object.assign;function U(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var B=!1;function j(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),s=r.stack.split("\n"),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||i[a]!==s[o]){var l="\n"+i[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function G(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function K(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case k:return"Fragment";case T:return"Portal";case w:return"Profiler";case x:return"StrictMode";case I:return"Suspense";case _:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case L:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case D:return null!==(t=e.displayName||null)?t:K(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return K(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return K(t);case 8:return t===x?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=z(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=z(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&E(e,"checked",t,!1)}function J(e,t){$(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function se(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function pe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=pe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach(function(e){ge.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ve=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function Ee(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Te=null,ke=null,xe=null;function we(e){if(e=Ei(e)){if("function"!==typeof Te)throw Error(s(280));var t=e.stateNode;t&&(t=Si(t),Te(e.stateNode,e.type,t))}}function Le(e){ke?xe?xe.push(e):xe=[e]:ke=e}function Ae(){if(ke){var e=ke,t=xe;if(xe=ke=null,we(e),t)for(e=0;e<t.length;e++)we(t[e])}}function Re(e,t){return e(t)}function Ie(){}var _e=!1;function De(e,t,n){if(_e)return e(t,n);_e=!0;try{return Re(e,t,n)}finally{_e=!1,(null!==ke||null!==xe)&&(Ie(),Ae())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=Si(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var Ce=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){Ce=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){Ce=!1}function Ne(e,t,n,r,i,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Me=!1,Fe=null,Ue=!1,Be=null,je={onError:function(e){Me=!0,Fe=e}};function Ge(e,t,n,r,i,s,a,o,l){Me=!1,Fe=null,Ne.apply(je,arguments)}function Ke(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(Ke(e)!==e)throw Error(s(188))}function ze(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ke(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Ve(i),e;if(a===r)return Ve(i),t;a=a.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,r=a;break}if(l===r){o=!0,r=i,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,r=i;break}if(l===r){o=!0,r=a,n=i;break}l=l.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ye=i.unstable_scheduleCallback,qe=i.unstable_cancelCallback,Qe=i.unstable_shouldYield,Xe=i.unstable_requestPaint,$e=i.unstable_now,Je=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~i;0!==o?r=dt(o):0!==(s&=a)&&(r=dt(s))}else 0!==(a=n&~i)?r=dt(a):0!==s&&(r=dt(s));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(s=t&-t)||16===i&&0!==(4194240&s)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-at(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function gt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var Et=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var St,Tt,kt,xt,wt,Lt=!1,At=[],Rt=null,It=null,_t=null,Dt=new Map,Pt=new Map,Ct=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":_t=null;break;case"pointerover":case"pointerout":Dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Mt(e,t,n,r,i,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},null!==t&&(null!==(t=Ei(t))&&Tt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ft(e){var t=yi(e.target);if(null!==t){var n=Ke(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void wt(e.priority,function(){kt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=Ei(n))&&Tt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Bt(e,t,n){Ut(e)&&n.delete(t)}function jt(){Lt=!1,null!==Rt&&Ut(Rt)&&(Rt=null),null!==It&&Ut(It)&&(It=null),null!==_t&&Ut(_t)&&(_t=null),Dt.forEach(Bt),Pt.forEach(Bt)}function Gt(e,t){e.blockedOn===t&&(e.blockedOn=null,Lt||(Lt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,jt)))}function Kt(e){function t(t){return Gt(t,e)}if(0<At.length){Gt(At[0],e);for(var n=1;n<At.length;n++){var r=At[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Rt&&Gt(Rt,e),null!==It&&Gt(It,e),null!==_t&&Gt(_t,e),Dt.forEach(t),Pt.forEach(t),n=0;n<Ct.length;n++)(r=Ct[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ct.length&&null===(n=Ct[0]).blockedOn;)Ft(n),null===n.blockedOn&&Ct.shift()}var Ht=b.ReactCurrentBatchConfig,Vt=!0;function zt(e,t,n,r){var i=Et,s=Ht.transition;Ht.transition=null;try{Et=1,Yt(e,t,n,r)}finally{Et=i,Ht.transition=s}}function Wt(e,t,n,r){var i=Et,s=Ht.transition;Ht.transition=null;try{Et=4,Yt(e,t,n,r)}finally{Et=i,Ht.transition=s}}function Yt(e,t,n,r){if(Vt){var i=Qt(e,t,n,r);if(null===i)Vr(e,t,r,qt,n),Nt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Rt=Mt(Rt,e,t,n,r,i),!0;case"dragenter":return It=Mt(It,e,t,n,r,i),!0;case"mouseover":return _t=Mt(_t,e,t,n,r,i),!0;case"pointerover":var s=i.pointerId;return Dt.set(s,Mt(Dt.get(s)||null,e,t,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Pt.set(s,Mt(Pt.get(s)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Nt(e,r),4&t&&-1<Ot.indexOf(e)){for(;null!==i;){var s=Ei(i);if(null!==s&&St(s),null===(s=Qt(e,t,n,r))&&Vr(e,t,r,qt,n),s===i)break;i=s}null!==i&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var qt=null;function Qt(e,t,n,r){if(qt=null,null!==(e=yi(e=Se(r))))if(null===(t=Ke(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var $t=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,r=n.length,i="value"in $t?$t.value:$t.textContent,s=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[s-t];t++);return Zt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,r,i,s){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(cn),dn=F({},cn,{view:0,detail:0}),hn=sn(dn),fn=F({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),gn=sn(fn),pn=sn(F({},fn,{dataTransfer:0})),mn=sn(F({},dn,{relatedTarget:0})),vn=sn(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),En=sn(yn),bn=sn(F({},cn,{data:0})),Sn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function wn(){return xn}var Ln=F({},dn,{key:function(e){if(e.key){var t=Sn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Tn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),An=sn(Ln),Rn=sn(F({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=sn(F({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wn})),_n=sn(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Dn=F({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=sn(Dn),Cn=[9,13,27,32],On=u&&"CompositionEvent"in window,Nn=null;u&&"documentMode"in document&&(Nn=document.documentMode);var Mn=u&&"TextEvent"in window&&!Nn,Fn=u&&(!On||Nn&&8<Nn&&11>=Nn),Un=String.fromCharCode(32),Bn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Cn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Kn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function zn(e,t,n,r){Le(r),0<(t=Wr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,Yn=null;function qn(e){Ur(e,0)}function Qn(e){if(Y(bi(e)))return e}function Xn(e,t){if("change"===e)return t}var $n=!1;if(u){var Jn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Jn=Zn}else Jn=!1;$n=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),Yn=Wn=null)}function nr(e){if("value"===e.propertyName&&Qn(Yn)){var t=[];zn(t,Yn,e,Se(e)),De(qn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Yn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Yn)}function sr(e,t){if("click"===e)return Qn(t)}function ar(e,t){if("input"===e||"change"===e)return Qn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!or(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=void 0===r.end?s:Math.min(r.end,i),!e.extend&&s>r&&(i=r,r=s,s=i),i=ur(n,s);var a=ur(n,r);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var pr=u&&"documentMode"in document&&11>=document.documentMode,mr=null,vr=null,yr=null,Er=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;Er||null==mr||mr!==q(r)||("selectionStart"in(r=mr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&lr(yr,r)||(yr=r,0<(r=Wr(vr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function Sr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Tr={animationend:Sr("Animation","AnimationEnd"),animationiteration:Sr("Animation","AnimationIteration"),animationstart:Sr("Animation","AnimationStart"),transitionend:Sr("Transition","TransitionEnd")},kr={},xr={};function wr(e){if(kr[e])return kr[e];if(!Tr[e])return e;var t,n=Tr[e];for(t in n)if(n.hasOwnProperty(t)&&t in xr)return kr[e]=n[t];return e}u&&(xr=document.createElement("div").style,"AnimationEvent"in window||(delete Tr.animationend.animation,delete Tr.animationiteration.animation,delete Tr.animationstart.animation),"TransitionEvent"in window||delete Tr.transitionend.transition);var Lr=wr("animationend"),Ar=wr("animationiteration"),Rr=wr("animationstart"),Ir=wr("transitionend"),_r=new Map,Dr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){_r.set(e,t),l(t,[e])}for(var Cr=0;Cr<Dr.length;Cr++){var Or=Dr[Cr];Pr(Or.toLowerCase(),"on"+(Or[0].toUpperCase()+Or.slice(1)))}Pr(Lr,"onAnimationEnd"),Pr(Ar,"onAnimationIteration"),Pr(Rr,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Ir,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nr));function Fr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,o,l,c){if(Ge.apply(this,arguments),Me){if(!Me)throw Error(s(198));var u=Fe;Me=!1,Fe=null,Ue||(Ue=!0,Be=u)}}(r,t,void 0,e),e.currentTarget=null}function Ur(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&i.isPropagationStopped())break e;Fr(i,o,c),s=l}else for(a=0;a<r.length;a++){if(l=(o=r[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&i.isPropagationStopped())break e;Fr(i,o,c),s=l}}}if(Ue)throw e=Be,Ue=!1,Be=null,e}function Br(e,t){var n=t[pi];void 0===n&&(n=t[pi]=new Set);var r=e+"__bubble";n.has(r)||(Hr(t,e,2,!1),n.add(r))}function jr(e,t,n){var r=0;t&&(r|=4),Hr(n,e,r,t)}var Gr="_reactListening"+Math.random().toString(36).slice(2);function Kr(e){if(!e[Gr]){e[Gr]=!0,a.forEach(function(t){"selectionchange"!==t&&(Mr.has(t)||jr(t,!1,e),jr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Gr]||(t[Gr]=!0,jr("selectionchange",!1,t))}}function Hr(e,t,n,r){switch(Xt(t)){case 1:var i=zt;break;case 4:i=Wt;break;default:i=Yt}n=i.bind(null,t,n,e),i=void 0,!Ce||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,i){var s=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var o=r.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;a=a.return}for(;null!==o;){if(null===(a=yi(o)))return;if(5===(l=a.tag)||6===l){r=s=a;continue e}o=o.parentNode}}r=r.return}De(function(){var r=s,i=Se(n),a=[];e:{var o=_r.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=An;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=gn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=pn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Lr:case Ar:case Rr:l=vn;break;case Ir:l=_n;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=En;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Rn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==o?o+"Capture":null:o;u=[];for(var f,g=r;null!==g;){var p=(f=g).stateNode;if(5===f.tag&&null!==p&&(f=p,null!==h&&(null!=(p=Pe(g,h))&&u.push(zr(g,p,f)))),d)break;g=g.return}0<u.length&&(o=new l(o,c,null,n,i),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!yi(c)&&!c[gi])&&(l||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?yi(c):null)&&(c!==(d=Ke(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=gn,p="onMouseLeave",h="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=Rn,p="onPointerLeave",h="onPointerEnter",g="pointer"),d=null==l?o:bi(l),f=null==c?o:bi(c),(o=new u(p,g+"leave",l,n,i)).target=d,o.relatedTarget=f,p=null,yi(i)===r&&((u=new u(h,g+"enter",c,n,i)).target=f,u.relatedTarget=d,p=u),d=p,l&&c)e:{for(h=c,g=0,f=u=l;f;f=Yr(f))g++;for(f=0,p=h;p;p=Yr(p))f++;for(;0<g-f;)u=Yr(u),g--;for(;0<f-g;)h=Yr(h),f--;for(;g--;){if(u===h||null!==h&&u===h.alternate)break e;u=Yr(u),h=Yr(h)}u=null}else u=null;null!==l&&qr(a,o,l,u,!1),null!==c&&null!==d&&qr(a,d,c,u,!0)}if("select"===(l=(o=r?bi(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var m=Xn;else if(Vn(o))if($n)m=ar;else{m=ir;var v=rr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=sr);switch(m&&(m=m(e,r))?zn(a,m,n,i):(v&&v(e,o,r),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=r?bi(r):window,e){case"focusin":(Vn(v)||"true"===v.contentEditable)&&(mr=v,vr=r,yr=null);break;case"focusout":yr=vr=mr=null;break;case"mousedown":Er=!0;break;case"contextmenu":case"mouseup":case"dragend":Er=!1,br(a,n,i);break;case"selectionchange":if(pr)break;case"keydown":case"keyup":br(a,n,i)}var y;if(On)e:{switch(e){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Kn?jn(e,n)&&(E="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(E="onCompositionStart");E&&(Fn&&"ko"!==n.locale&&(Kn||"onCompositionStart"!==E?"onCompositionEnd"===E&&Kn&&(y=en()):(Jt="value"in($t=i)?$t.value:$t.textContent,Kn=!0)),0<(v=Wr(r,E)).length&&(E=new bn(E,e,null,n,i),a.push({event:E,listeners:v}),y?E.data=y:null!==(y=Gn(n))&&(E.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Gn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Un);case"textInput":return(e=t.data)===Un&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Kn)return"compositionend"===e||!On&&jn(e,t)?(e=en(),Zt=Jt=$t=null,Kn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Wr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=y))}Ur(a,t)})}function zr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,s=i.stateNode;5===i.tag&&null!==s&&(i=s,null!=(s=Pe(e,n))&&r.unshift(zr(e,s,i)),null!=(s=Pe(e,t))&&r.push(zr(e,s,i))),e=e.return}return r}function Yr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qr(e,t,n,r,i){for(var s=t._reactName,a=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,i?null!=(l=Pe(n,s))&&a.unshift(zr(n,l,o)):i||null!=(l=Pe(n,s))&&a.push(zr(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Qr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function $r(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace(Xr,"")}function Jr(e,t,n){if(t=$r(t),$r(e)!==t&&n)throw Error(s(425))}function Zr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,si="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof si?function(e){return si.resolve(null).then(e).catch(oi)}:ri;function oi(e){setTimeout(function(){throw e})}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Kt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Kt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,fi="__reactProps$"+di,gi="__reactContainer$"+di,pi="__reactEvents$"+di,mi="__reactListeners$"+di,vi="__reactHandles$"+di;function yi(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[gi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[hi])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function Ei(e){return!(e=e[hi]||e[gi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function Si(e){return e[fi]||null}var Ti=[],ki=-1;function xi(e){return{current:e}}function wi(e){0>ki||(e.current=Ti[ki],Ti[ki]=null,ki--)}function Li(e,t){ki++,Ti[ki]=e.current,e.current=t}var Ai={},Ri=xi(Ai),Ii=xi(!1),_i=Ai;function Di(e,t){var n=e.type.contextTypes;if(!n)return Ai;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in n)s[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ci(){wi(Ii),wi(Ri)}function Oi(e,t,n){if(Ri.current!==Ai)throw Error(s(168));Li(Ri,t),Li(Ii,n)}function Ni(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(s(108,H(e)||"Unknown",i));return F({},n,r)}function Mi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ai,_i=Ri.current,Li(Ri,e),Li(Ii,Ii.current),!0}function Fi(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=Ni(e,t,_i),r.__reactInternalMemoizedMergedChildContext=e,wi(Ii),wi(Ri),Li(Ri,e)):wi(Ii),Li(Ii,n)}var Ui=null,Bi=!1,ji=!1;function Gi(e){null===Ui?Ui=[e]:Ui.push(e)}function Ki(){if(!ji&&null!==Ui){ji=!0;var e=0,t=Et;try{var n=Ui;for(Et=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ui=null,Bi=!1}catch(i){throw null!==Ui&&(Ui=Ui.slice(e+1)),Ye(Ze,Ki),i}finally{Et=t,ji=!1}}return null}var Hi=[],Vi=0,zi=null,Wi=0,Yi=[],qi=0,Qi=null,Xi=1,$i="";function Ji(e,t){Hi[Vi++]=Wi,Hi[Vi++]=zi,zi=e,Wi=t}function Zi(e,t,n){Yi[qi++]=Xi,Yi[qi++]=$i,Yi[qi++]=Qi,Qi=e;var r=Xi;e=$i;var i=32-at(r)-1;r&=~(1<<i),n+=1;var s=32-at(t)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Xi=1<<32-at(t)+i|n<<i|r,$i=s+e}else Xi=1<<s|n<<i|r,$i=e}function es(e){null!==e.return&&(Ji(e,1),Zi(e,1,0))}function ts(e){for(;e===zi;)zi=Hi[--Vi],Hi[Vi]=null,Wi=Hi[--Vi],Hi[Vi]=null;for(;e===Qi;)Qi=Yi[--qi],Yi[qi]=null,$i=Yi[--qi],Yi[qi]=null,Xi=Yi[--qi],Yi[qi]=null}var ns=null,rs=null,is=!1,ss=null;function as(e,t){var n=Dc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function os(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,rs=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,rs=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qi?{id:Xi,overflow:$i}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Dc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,rs=null,!0);default:return!1}}function ls(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cs(e){if(is){var t=rs;if(t){var n=t;if(!os(e,t)){if(ls(e))throw Error(s(418));t=ci(n.nextSibling);var r=ns;t&&os(e,t)?as(r,n):(e.flags=-4097&e.flags|2,is=!1,ns=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,is=!1,ns=e}}}function us(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function ds(e){if(e!==ns)return!1;if(!is)return us(e),is=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=rs)){if(ls(e))throw hs(),Error(s(418));for(;t;)as(e,t),t=ci(t.nextSibling)}if(us(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){rs=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}rs=null}}else rs=ns?ci(e.stateNode.nextSibling):null;return!0}function hs(){for(var e=rs;e;)e=ci(e.nextSibling)}function fs(){rs=ns=null,is=!1}function gs(e){null===ss?ss=[e]:ss.push(e)}var ps=b.ReactCurrentBatchConfig;function ms(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=i.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function vs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ys(e){return(0,e._init)(e._payload)}function Es(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Cc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Fc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var s=n.type;return s===k?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===P&&ys(s)===t.type)?((r=i(t,n.props)).ref=ms(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=ms(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,s){return null===t||7!==t.tag?((t=Nc(n,e.mode,r,s)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case S:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=ms(e,null,t),n.return=e,n;case T:return(t=Uc(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=Nc(t,e.mode,n,null)).return=e,t;vs(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case S:return n.key===i?c(e,t,n,r):null;case T:return n.key===i?u(e,t,n,r):null;case P:return f(e,t,(i=n._init)(n._payload),r)}if(te(n)||N(n))return null!==i?null:d(e,t,n,r,null);vs(e,n)}return null}function g(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case S:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case T:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case P:return g(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||N(r))return d(t,e=e.get(n)||null,r,i,null);vs(t,r)}return null}function p(i,s,o,l){for(var c=null,u=null,d=s,p=s=0,m=null;null!==d&&p<o.length;p++){d.index>p?(m=d,d=null):m=d.sibling;var v=f(i,d,o[p],l);if(null===v){null===d&&(d=m);break}e&&d&&null===v.alternate&&t(i,d),s=a(v,s,p),null===u?c=v:u.sibling=v,u=v,d=m}if(p===o.length)return n(i,d),is&&Ji(i,p),c;if(null===d){for(;p<o.length;p++)null!==(d=h(i,o[p],l))&&(s=a(d,s,p),null===u?c=d:u.sibling=d,u=d);return is&&Ji(i,p),c}for(d=r(i,d);p<o.length;p++)null!==(m=g(d,i,p,o[p],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?p:m.key),s=a(m,s,p),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach(function(e){return t(i,e)}),is&&Ji(i,p),c}function m(i,o,l,c){var u=N(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var d=u=null,p=o,m=o=0,v=null,y=l.next();null!==p&&!y.done;m++,y=l.next()){p.index>m?(v=p,p=null):v=p.sibling;var E=f(i,p,y.value,c);if(null===E){null===p&&(p=v);break}e&&p&&null===E.alternate&&t(i,p),o=a(E,o,m),null===d?u=E:d.sibling=E,d=E,p=v}if(y.done)return n(i,p),is&&Ji(i,m),u;if(null===p){for(;!y.done;m++,y=l.next())null!==(y=h(i,y.value,c))&&(o=a(y,o,m),null===d?u=y:d.sibling=y,d=y);return is&&Ji(i,m),u}for(p=r(i,p);!y.done;m++,y=l.next())null!==(y=g(p,i,m,y.value,c))&&(e&&null!==y.alternate&&p.delete(null===y.key?m:y.key),o=a(y,o,m),null===d?u=y:d.sibling=y,d=y);return e&&p.forEach(function(e){return t(i,e)}),is&&Ji(i,m),u}return function e(r,s,a,l){if("object"===typeof a&&null!==a&&a.type===k&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case S:e:{for(var c=a.key,u=s;null!==u;){if(u.key===c){if((c=a.type)===k){if(7===u.tag){n(r,u.sibling),(s=i(u,a.props.children)).return=r,r=s;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&ys(c)===u.type){n(r,u.sibling),(s=i(u,a.props)).ref=ms(r,u,a),s.return=r,r=s;break e}n(r,u);break}t(r,u),u=u.sibling}a.type===k?((s=Nc(a.props.children,r.mode,l,a.key)).return=r,r=s):((l=Oc(a.type,a.key,a.props,null,r.mode,l)).ref=ms(r,s,a),l.return=r,r=l)}return o(r);case T:e:{for(u=a.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(r,s.sibling),(s=i(s,a.children||[])).return=r,r=s;break e}n(r,s);break}t(r,s),s=s.sibling}(s=Uc(a,r.mode,l)).return=r,r=s}return o(r);case P:return e(r,s,(u=a._init)(a._payload),l)}if(te(a))return p(r,s,a,l);if(N(a))return m(r,s,a,l);vs(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(n(r,s.sibling),(s=i(s,a)).return=r,r=s):(n(r,s),(s=Fc(a,r.mode,l)).return=r,r=s),o(r)):n(r,s)}}var bs=Es(!0),Ss=Es(!1),Ts=xi(null),ks=null,xs=null,ws=null;function Ls(){ws=xs=ks=null}function As(e){var t=Ts.current;wi(Ts),e._currentValue=t}function Rs(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Is(e,t){ks=e,ws=xs=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Eo=!0),e.firstContext=null)}function _s(e){var t=e._currentValue;if(ws!==e)if(e={context:e,memoizedValue:t,next:null},null===xs){if(null===ks)throw Error(s(308));xs=e,ks.dependencies={lanes:0,firstContext:e}}else xs=xs.next=e;return t}var Ds=null;function Ps(e){null===Ds?Ds=[e]:Ds.push(e)}function Cs(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ps(t)):(n.next=i.next,i.next=n),t.interleaved=n,Os(e,r)}function Os(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ns=!1;function Ms(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Us(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Bs(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Rl)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Os(e,n)}return null===(i=r.interleaved)?(t.next=t,Ps(r)):(t.next=i.next,i.next=t),r.interleaved=t,Os(e,n)}function js(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Gs(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?i=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?i=s=t:s=s.next=t}else i=s=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ks(e,t,n,r){var i=e.updateQueue;Ns=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==s){var d=i.baseState;for(a=0,u=c=l=null,o=s;;){var h=o.lane,f=o.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=e,p=o;switch(h=t,f=n,p.tag){case 1:if("function"===typeof(g=p.payload)){d=g.call(f,d,h);break e}d=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null===(h="function"===typeof(g=p.payload)?g.call(f,d,h):g)||void 0===h)break e;d=F({},d,h);break e;case 2:Ns=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,a|=h;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(h=o).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{a|=i.lane,i=i.next}while(i!==t)}else null===s&&(i.shared.lanes=0);Ml|=a,e.lanes=a,e.memoizedState=d}}function Hs(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(s(191,i));i.call(r)}}}var Vs={},zs=xi(Vs),Ws=xi(Vs),Ys=xi(Vs);function qs(e){if(e===Vs)throw Error(s(174));return e}function Qs(e,t){switch(Li(Ys,t),Li(Ws,e),Li(zs,Vs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}wi(zs),Li(zs,t)}function Xs(){wi(zs),wi(Ws),wi(Ys)}function $s(e){qs(Ys.current);var t=qs(zs.current),n=le(t,e.type);t!==n&&(Li(Ws,e),Li(zs,n))}function Js(e){Ws.current===e&&(wi(zs),wi(Ws))}var Zs=xi(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function na(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ra=b.ReactCurrentDispatcher,ia=b.ReactCurrentBatchConfig,sa=0,aa=null,oa=null,la=null,ca=!1,ua=!1,da=0,ha=0;function fa(){throw Error(s(321))}function ga(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function pa(e,t,n,r,i,a){if(sa=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ra.current=null===e||null===e.memoizedState?Ja:Za,e=n(r,i),ua){a=0;do{if(ua=!1,da=0,25<=a)throw Error(s(301));a+=1,la=oa=null,t.updateQueue=null,ra.current=eo,e=n(r,i)}while(ua)}if(ra.current=$a,t=null!==oa&&null!==oa.next,sa=0,la=oa=aa=null,ca=!1,t)throw Error(s(300));return e}function ma(){var e=0!==da;return da=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(s(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function Ea(e,t){return"function"===typeof t?t(e):t}function ba(e){var t=ya(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=oa,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(null!==i){a=i.next,r=r.baseState;var l=o=null,c=null,u=a;do{var d=u.lane;if((sa&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,o=r):c=c.next=h,aa.lanes|=d,Ml|=d}u=u.next}while(null!==u&&u!==a);null===c?o=r:c.next=l,or(r,t.memoizedState)||(Eo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{a=i.lane,aa.lanes|=a,Ml|=a,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Sa(e){var t=ya(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);or(a,t.memoizedState)||(Eo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Ta(){}function ka(e,t){var n=aa,r=ya(),i=t(),a=!or(r.memoizedState,i);if(a&&(r.memoizedState=i,Eo=!0),r=r.queue,Na(La.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,_a(9,wa.bind(null,n,r,i,t),void 0,null),null===Il)throw Error(s(349));0!==(30&sa)||xa(n,t,i)}return i}function xa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function wa(e,t,n,r){t.value=n,t.getSnapshot=r,Aa(t)&&Ra(e)}function La(e,t,n){return n(function(){Aa(t)&&Ra(e)})}function Aa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function Ra(e){var t=Os(e,1);null!==t&&nc(t,e,1,-1)}function Ia(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:e},t.queue=e,e=e.dispatch=Ya.bind(null,aa,e),[t.memoizedState,e]}function _a(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Da(){return ya().memoizedState}function Pa(e,t,n,r){var i=va();aa.flags|=e,i.memoizedState=_a(1|t,n,void 0,void 0===r?null:r)}function Ca(e,t,n,r){var i=ya();r=void 0===r?null:r;var s=void 0;if(null!==oa){var a=oa.memoizedState;if(s=a.destroy,null!==r&&ga(r,a.deps))return void(i.memoizedState=_a(t,n,s,r))}aa.flags|=e,i.memoizedState=_a(1|t,n,s,r)}function Oa(e,t){return Pa(8390656,8,e,t)}function Na(e,t){return Ca(2048,8,e,t)}function Ma(e,t){return Ca(4,2,e,t)}function Fa(e,t){return Ca(4,4,e,t)}function Ua(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ba(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ca(4,4,Ua.bind(null,t,e),n)}function ja(){}function Ga(e,t){var n=ya();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ga(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ka(e,t){var n=ya();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ga(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ha(e,t,n){return 0===(21&sa)?(e.baseState&&(e.baseState=!1,Eo=!0),e.memoizedState=n):(or(n,t)||(n=pt(),aa.lanes|=n,Ml|=n,e.baseState=!0),t)}function Va(e,t){var n=Et;Et=0!==n&&4>n?n:4,e(!0);var r=ia.transition;ia.transition={};try{e(!1),t()}finally{Et=n,ia.transition=r}}function za(){return ya().memoizedState}function Wa(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},qa(e))Qa(t,n);else if(null!==(n=Cs(e,t,n,r))){nc(n,e,r,ec()),Xa(n,t,r)}}function Ya(e,t,n){var r=tc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(qa(e))Qa(t,i);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(i.hasEagerState=!0,i.eagerState=o,or(o,a)){var l=t.interleaved;return null===l?(i.next=i,Ps(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Cs(e,t,i,r))&&(nc(n,e,r,i=ec()),Xa(n,t,r))}}function qa(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Qa(e,t){ua=ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Xa(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var $a={readContext:_s,useCallback:fa,useContext:fa,useEffect:fa,useImperativeHandle:fa,useInsertionEffect:fa,useLayoutEffect:fa,useMemo:fa,useReducer:fa,useRef:fa,useState:fa,useDebugValue:fa,useDeferredValue:fa,useTransition:fa,useMutableSource:fa,useSyncExternalStore:fa,useId:fa,unstable_isNewReconciler:!1},Ja={readContext:_s,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:_s,useEffect:Oa,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pa(4194308,4,Ua.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pa(4,2,e,t)},useMemo:function(e,t){var n=va();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=va();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Wa.bind(null,aa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Ia,useDebugValue:ja,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Ia(!1),t=e[0];return e=Va.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=aa,i=va();if(is){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Il)throw Error(s(349));0!==(30&sa)||xa(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Oa(La.bind(null,r,a,e),[e]),r.flags|=2048,_a(9,wa.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=va(),t=Il.identifierPrefix;if(is){var n=$i;t=":"+t+"R"+(n=(Xi&~(1<<32-at(Xi)-1)).toString(32)+n),0<(n=da++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ha++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Za={readContext:_s,useCallback:Ga,useContext:_s,useEffect:Na,useImperativeHandle:Ba,useInsertionEffect:Ma,useLayoutEffect:Fa,useMemo:Ka,useReducer:ba,useRef:Da,useState:function(){return ba(Ea)},useDebugValue:ja,useDeferredValue:function(e){return Ha(ya(),oa.memoizedState,e)},useTransition:function(){return[ba(Ea)[0],ya().memoizedState]},useMutableSource:Ta,useSyncExternalStore:ka,useId:za,unstable_isNewReconciler:!1},eo={readContext:_s,useCallback:Ga,useContext:_s,useEffect:Na,useImperativeHandle:Ba,useInsertionEffect:Ma,useLayoutEffect:Fa,useMemo:Ka,useReducer:Sa,useRef:Da,useState:function(){return Sa(Ea)},useDebugValue:ja,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:Ha(t,oa.memoizedState,e)},useTransition:function(){return[Sa(Ea)[0],ya().memoizedState]},useMutableSource:Ta,useSyncExternalStore:ka,useId:za,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ro={isMounted:function(e){return!!(e=e._reactInternals)&&Ke(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),s=Us(r,i);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Bs(e,s,i))&&(nc(t,e,i,r),js(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),s=Us(r,i);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Bs(e,s,i))&&(nc(t,e,i,r),js(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),i=Us(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Bs(e,i,r))&&(nc(t,e,r,n),js(t,e,r))}};function io(e,t,n,r,i,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(i,s))}function so(e,t,n){var r=!1,i=Ai,s=t.contextType;return"object"===typeof s&&null!==s?s=_s(s):(i=Pi(t)?_i:Ri.current,s=(r=null!==(r=t.contextTypes)&&void 0!==r)?Di(e,i):Ai),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ro,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function ao(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Ms(e);var s=t.contextType;"object"===typeof s&&null!==s?i.context=_s(s):(s=Pi(t)?_i:Ri.current,i.context=Di(e,s)),i.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(no(e,t,s,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ro.enqueueReplaceState(i,i.state,null),Ks(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",r=t;do{n+=G(r),r=r.return}while(r);var i=n}catch(s){i="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:i,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function fo(e,t,n){(n=Us(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vl||(Vl=!0,zl=r),uo(0,t)},n}function go(e,t,n){(n=Us(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){uo(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof r&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function po(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=wc.bind(null,e,t,n),t.then(e,e))}function mo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Us(-1,1)).tag=2,Bs(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var yo=b.ReactCurrentOwner,Eo=!1;function bo(e,t,n,r){t.child=null===e?Ss(t,null,n,r):bs(t,e.child,n,r)}function So(e,t,n,r,i){n=n.render;var s=t.ref;return Is(t,i),r=pa(e,t,n,r,s,i),n=ma(),null===e||Eo?(is&&n&&es(t),t.flags|=1,bo(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vo(e,t,i))}function To(e,t,n,r,i){if(null===e){var s=n.type;return"function"!==typeof s||Pc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,ko(e,t,s,r,i))}if(s=e.child,0===(e.lanes&i)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(a,r)&&e.ref===t.ref)return Vo(e,t,i)}return t.flags|=1,(e=Cc(s,r)).ref=t.ref,e.return=t,t.child=e}function ko(e,t,n,r,i){if(null!==e){var s=e.memoizedProps;if(lr(s,r)&&e.ref===t.ref){if(Eo=!1,t.pendingProps=r=s,0===(e.lanes&i))return t.lanes=e.lanes,Vo(e,t,i);0!==(131072&e.flags)&&(Eo=!0)}}return Lo(e,t,n,r,i)}function xo(e,t,n){var r=t.pendingProps,i=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Li(Cl,Pl),Pl|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Li(Cl,Pl),Pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==s?s.baseLanes:n,Li(Cl,Pl),Pl|=r}else null!==s?(r=s.baseLanes|n,t.memoizedState=null):r=n,Li(Cl,Pl),Pl|=r;return bo(e,t,i,n),t.child}function wo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Lo(e,t,n,r,i){var s=Pi(n)?_i:Ri.current;return s=Di(t,s),Is(t,i),n=pa(e,t,n,r,s,i),r=ma(),null===e||Eo?(is&&r&&es(t),t.flags|=1,bo(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vo(e,t,i))}function Ao(e,t,n,r,i){if(Pi(n)){var s=!0;Mi(t)}else s=!1;if(Is(t,i),null===t.stateNode)Ho(e,t),so(t,n,r),oo(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=_s(c):c=Di(t,c=Pi(n)?_i:Ri.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==r||l!==c)&&ao(t,a,r,c),Ns=!1;var h=t.memoizedState;a.state=h,Ks(t,r,a,i),l=t.memoizedState,o!==r||h!==l||Ii.current||Ns?("function"===typeof u&&(no(t,n,u,r),l=t.memoizedState),(o=Ns||io(t,n,o,r,h,l,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Fs(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,d=t.pendingProps,h=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=_s(l):l=Di(t,l=Pi(n)?_i:Ri.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==d||h!==l)&&ao(t,a,r,l),Ns=!1,h=t.memoizedState,a.state=h,Ks(t,r,a,i);var g=t.memoizedState;o!==d||h!==g||Ii.current||Ns?("function"===typeof f&&(no(t,n,f,r),g=t.memoizedState),(c=Ns||io(t,n,c,r,h,g,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,g,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,g,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=g),a.props=r,a.state=g,a.context=l,r=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ro(e,t,n,r,s,i)}function Ro(e,t,n,r,i,s){wo(e,t);var a=0!==(128&t.flags);if(!r&&!a)return i&&Fi(t,n,!1),Vo(e,t,s);r=t.stateNode,yo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=bs(t,e.child,null,s),t.child=bs(t,null,o,s)):bo(e,t,o,s),t.memoizedState=r.state,i&&Fi(t,n,!0),t.child}function Io(e){var t=e.stateNode;t.pendingContext?Oi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Oi(0,t.context,!1),Qs(e,t.containerInfo)}function _o(e,t,n,r,i){return fs(),gs(i),t.flags|=256,bo(e,t,n,r),t.child}var Do,Po,Co,Oo,No={dehydrated:null,treeContext:null,retryLane:0};function Mo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fo(e,t,n){var r,i=t.pendingProps,a=Zs.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Li(Zs,1&a),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,o?(i=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&i)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Mc(l,i,0,null),e=Nc(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Mo(n),t.memoizedState=No,e):Uo(t,l));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,i,a,o){if(n)return 256&t.flags?(t.flags&=-257,Bo(e,t,o,r=co(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=Mc({mode:"visible",children:r.children},i,0,null),(a=Nc(a,i,o,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&bs(t,e.child,null,o),t.child.memoizedState=Mo(o),t.memoizedState=No,a);if(0===(1&t.mode))return Bo(e,t,o,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Bo(e,t,o,r=co(a=Error(s(419)),r,void 0))}if(l=0!==(o&e.childLanes),Eo||l){if(null!==(r=Il)){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|o))?0:i)&&i!==a.retryLane&&(a.retryLane=i,Os(e,i),nc(r,e,i,-1))}return pc(),Bo(e,t,o,r=co(Error(s(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ac.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,rs=ci(i.nextSibling),ns=t,is=!0,ss=null,null!==e&&(Yi[qi++]=Xi,Yi[qi++]=$i,Yi[qi++]=Qi,Xi=e.id,$i=e.overflow,Qi=t),t=Uo(t,r.children),t.flags|=4096,t)}(e,t,l,i,r,a,n);if(o){o=i.fallback,l=t.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&t.child!==a?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Cc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?o=Cc(r,o):(o=Nc(o,l,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,l=null===(l=e.child.memoizedState)?Mo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=No,i}return e=(o=e.child).sibling,i=Cc(o,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Uo(e,t){return(t=Mc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bo(e,t,n,r){return null!==r&&gs(r),bs(t,e.child,null,n),(e=Uo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function jo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Rs(e.return,t,n)}function Go(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Ko(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail;if(bo(e,t,r.children,n),0!==(2&(r=Zs.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&jo(e,n,t);else if(19===e.tag)jo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Li(Zs,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ea(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Go(t,!1,i,n,s);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ea(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Go(t,!0,n,null,s);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ho(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ml|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Cc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Cc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function zo(e,t){if(!is)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Wo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Yo(e,t,n){var r=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wo(t),null;case 1:case 17:return Pi(t.type)&&Ci(),Wo(t),null;case 3:return r=t.stateNode,Xs(),wi(Ii),wi(Ri),na(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ds(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(ac(ss),ss=null))),Po(e,t),Wo(t),null;case 5:Js(t);var i=qs(Ys.current);if(n=t.type,null!==e&&null!=t.stateNode)Co(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(s(166));return Wo(t),null}if(e=qs(zs.current),ds(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[hi]=t,r[fi]=a,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(i=0;i<Nr.length;i++)Br(Nr[i],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":X(r,a),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Br("invalid",r);break;case"textarea":ie(r,a),Br("invalid",r)}for(var l in ye(n,a),i=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Jr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Jr(r.textContent,c,e),i=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Br("scroll",r)}switch(n){case"input":W(r),Z(r,a,!0);break;case"textarea":W(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=Zr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[hi]=t,e[fi]=r,Do(e,t,!1,!1),t.stateNode=e;e:{switch(l=Ee(n,r),n){case"dialog":Br("cancel",e),Br("close",e),i=r;break;case"iframe":case"object":case"embed":Br("load",e),i=r;break;case"video":case"audio":for(i=0;i<Nr.length;i++)Br(Nr[i],e);i=r;break;case"source":Br("error",e),i=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),i=r;break;case"details":Br("toggle",e),i=r;break;case"input":X(e,r),i=Q(e,r),Br("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=F({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Br("invalid",e)}for(a in ye(n,i),c=i)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?me(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Br("scroll",e):null!=u&&E(e,a,u,l))}switch(n){case"input":W(e),Z(e,r,!1);break;case"textarea":W(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Wo(t),null;case 6:if(e&&null!=t.stateNode)Oo(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(n=qs(Ys.current),qs(zs.current),ds(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(a=r.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return Wo(t),null;case 13:if(wi(Zs),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(is&&null!==rs&&0!==(1&t.mode)&&0===(128&t.flags))hs(),fs(),t.flags|=98560,a=!1;else if(a=ds(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[hi]=t}else fs(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wo(t),a=!1}else null!==ss&&(ac(ss),ss=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zs.current)?0===Ol&&(Ol=3):pc())),null!==t.updateQueue&&(t.flags|=4),Wo(t),null);case 4:return Xs(),Po(e,t),null===e&&Kr(t.stateNode.containerInfo),Wo(t),null;case 10:return As(t.type._context),Wo(t),null;case 19:if(wi(Zs),null===(a=t.memoizedState))return Wo(t),null;if(r=0!==(128&t.flags),null===(l=a.rendering))if(r)zo(a,!1);else{if(0!==Ol||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,zo(a,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Li(Zs,1&Zs.current|2),t.child}e=e.sibling}null!==a.tail&&$e()>Kl&&(t.flags|=128,r=!0,zo(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ea(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),zo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!is)return Wo(t),null}else 2*$e()-a.renderingStartTime>Kl&&1073741824!==n&&(t.flags|=128,r=!0,zo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=$e(),t.sibling=null,n=Zs.current,Li(Zs,r?1&n|2:1&n),t):(Wo(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Pl)&&(Wo(t),6&t.subtreeFlags&&(t.flags|=8192)):Wo(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function qo(e,t){switch(ts(t),t.tag){case 1:return Pi(t.type)&&Ci(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Xs(),wi(Ii),wi(Ri),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Js(t),null;case 13:if(wi(Zs),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));fs()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return wi(Zs),null;case 4:return Xs(),null;case 10:return As(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Do=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(){},Co=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,qs(zs.current);var s,a=null;switch(n){case"input":i=Q(e,i),r=Q(e,r),a=[];break;case"select":i=F({},i,{value:void 0}),r=F({},r,{value:void 0}),a=[];break;case"textarea":i=re(e,i),r=re(e,r),a=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(u in ye(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Br("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Oo=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qo=!1,Xo=!1,$o="function"===typeof WeakSet?WeakSet:Set,Jo=null;function Zo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){xc(e,t,r)}else n.current=null}function el(e,t,n){try{n()}catch(r){xc(e,t,r)}}var tl=!1;function nl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,void 0!==s&&el(t,n,s)}i=i.next}while(i!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function il(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[fi],delete t[pi],delete t[mi],delete t[vi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,dl=!1;function hl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(it,n)}catch(o){}switch(n.tag){case 5:Xo||Zo(n,t);case 6:var r=ul,i=dl;ul=null,hl(e,t,n),dl=i,null!==(ul=r)&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),Kt(e)):li(ul,n.stateNode));break;case 4:r=ul,i=dl,ul=n.stateNode.containerInfo,dl=!0,hl(e,t,n),ul=r,dl=i;break;case 0:case 11:case 14:case 15:if(!Xo&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&el(n,t,a),i=i.next}while(i!==r)}hl(e,t,n);break;case 1:if(!Xo&&(Zo(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){xc(n,t,o)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Xo=(r=Xo)||null!==n.memoizedState,hl(e,t,n),Xo=r):hl(e,t,n);break;default:hl(e,t,n)}}function gl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new $o),t.forEach(function(t){var r=Rc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function pl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,dl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===ul)throw Error(s(160));fl(a,o,i),ul=null,dl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){xc(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)ml(t,e),t=t.sibling}function ml(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pl(t,e),vl(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(m){xc(e,e.return,m)}try{nl(5,e,e.return)}catch(m){xc(e,e.return,m)}}break;case 1:pl(t,e),vl(e),512&r&&null!==n&&Zo(n,n.return);break;case 5:if(pl(t,e),vl(e),512&r&&null!==n&&Zo(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(m){xc(e,e.return,m)}}if(4&r&&null!=(i=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&$(i,a),Ee(l,o);var u=Ee(l,a);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];"style"===d?me(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):E(i,d,h,u)}switch(l){case"input":J(i,a);break;case"textarea":se(i,a);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var g=a.value;null!=g?ne(i,!!a.multiple,g,!1):f!==!!a.multiple&&(null!=a.defaultValue?ne(i,!!a.multiple,a.defaultValue,!0):ne(i,!!a.multiple,a.multiple?[]:"",!1))}i[fi]=a}catch(m){xc(e,e.return,m)}}break;case 6:if(pl(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(s(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(m){xc(e,e.return,m)}}break;case 3:if(pl(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Kt(t.containerInfo)}catch(m){xc(e,e.return,m)}break;case 4:default:pl(t,e),vl(e);break;case 13:pl(t,e),vl(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(Gl=$e())),4&r&&gl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Xo=(u=Xo)||d,pl(t,e),Xo=u):pl(t,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Jo=e,d=e.child;null!==d;){for(h=Jo=d;null!==Jo;){switch(g=(f=Jo).child,f.tag){case 0:case 11:case 14:case 15:nl(4,f,f.return);break;case 1:Zo(f,f.return);var p=f.stateNode;if("function"===typeof p.componentWillUnmount){r=f,n=f.return;try{t=r,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(m){xc(r,n,m)}}break;case 5:Zo(f,f.return);break;case 22:if(null!==f.memoizedState){Sl(h);continue}}null!==g?(g.return=f,Jo=g):Sl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"===typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=pe("display",o))}catch(m){xc(e,e.return,m)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(m){xc(e,e.return,m)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:pl(t,e),vl(e),4&r&&gl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var r=n;break e}n=n.return}throw Error(s(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),cl(e,ol(e),i);break;case 3:case 4:var a=r.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(s(161))}}catch(o){xc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Jo=e,El(e,t,n)}function El(e,t,n){for(var r=0!==(1&e.mode);null!==Jo;){var i=Jo,s=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||Qo;if(!a){var o=i.alternate,l=null!==o&&null!==o.memoizedState||Xo;o=Qo;var c=Xo;if(Qo=a,(Xo=l)&&!c)for(Jo=i;null!==Jo;)l=(a=Jo).child,22===a.tag&&null!==a.memoizedState?Tl(i):null!==l?(l.return=a,Jo=l):Tl(i);for(;null!==s;)Jo=s,El(s,t,n),s=s.sibling;Jo=i,Qo=o,Xo=c}bl(e)}else 0!==(8772&i.subtreeFlags)&&null!==s?(s.return=i,Jo=s):bl(e)}}function bl(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xo||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xo)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Hs(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Hs(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Kt(h)}}}break;default:throw Error(s(163))}Xo||512&t.flags&&il(t)}catch(f){xc(t,t.return,f)}}if(t===e){Jo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Jo=n;break}Jo=t.return}}function Sl(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Jo=n;break}Jo=t.return}}function Tl(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){xc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(l){xc(t,i,l)}}var s=t.return;try{il(t)}catch(l){xc(t,s,l)}break;case 5:var a=t.return;try{il(t)}catch(l){xc(t,a,l)}}}catch(l){xc(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var kl,xl=Math.ceil,wl=b.ReactCurrentDispatcher,Ll=b.ReactCurrentOwner,Al=b.ReactCurrentBatchConfig,Rl=0,Il=null,_l=null,Dl=0,Pl=0,Cl=xi(0),Ol=0,Nl=null,Ml=0,Fl=0,Ul=0,Bl=null,jl=null,Gl=0,Kl=1/0,Hl=null,Vl=!1,zl=null,Wl=null,Yl=!1,ql=null,Ql=0,Xl=0,$l=null,Jl=-1,Zl=0;function ec(){return 0!==(6&Rl)?$e():-1!==Jl?Jl:Jl=$e()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Rl)&&0!==Dl?Dl&-Dl:null!==ps.transition?(0===Zl&&(Zl=pt()),Zl):0!==(e=Et)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function nc(e,t,n,r){if(50<Xl)throw Xl=0,$l=null,Error(s(185));vt(e,n,r),0!==(2&Rl)&&e===Il||(e===Il&&(0===(2&Rl)&&(Fl|=n),4===Ol&&oc(e,Dl)),rc(e,r),1===n&&0===Rl&&0===(1&t.mode)&&(Kl=$e()+500,Bi&&Ki()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-at(s),o=1<<a,l=i[a];-1===l?0!==(o&n)&&0===(o&r)||(i[a]=ft(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var r=ht(e,e===Il?Dl:0);if(0===r)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){Bi=!0,Gi(e)}(lc.bind(null,e)):Gi(lc.bind(null,e)),ai(function(){0===(6&Rl)&&Ki()}),n=null;else{switch(bt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ic(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if(Jl=-1,Zl=0,0!==(6&Rl))throw Error(s(327));var n=e.callbackNode;if(Tc()&&e.callbackNode!==n)return null;var r=ht(e,e===Il?Dl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mc(e,r);else{t=r;var i=Rl;Rl|=2;var a=gc();for(Il===e&&Dl===t||(Hl=null,Kl=$e()+500,hc(e,t));;)try{yc();break}catch(l){fc(e,l)}Ls(),wl.current=a,Rl=i,null!==_l?t=0:(Il=null,Dl=0,t=Ol)}if(0!==t){if(2===t&&(0!==(i=gt(e))&&(r=i,t=sc(e,i))),1===t)throw n=Nl,hc(e,0),oc(e,r),rc(e,$e()),n;if(6===t)oc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!or(s(),i))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=mc(e,r))&&(0!==(a=gt(e))&&(r=a,t=sc(e,a))),1===t))throw n=Nl,hc(e,0),oc(e,r),rc(e,$e()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(s(345));case 2:case 5:Sc(e,jl,Hl);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(t=Gl+500-$e())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(Sc.bind(null,e,jl,Hl),t);break}Sc(e,jl,Hl);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-at(r);a=1<<o,(o=t[o])>i&&(i=o),r&=~a}if(r=i,10<(r=(120>(r=$e()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*xl(r/1960))-r)){e.timeoutHandle=ri(Sc.bind(null,e,jl,Hl),r);break}Sc(e,jl,Hl);break;default:throw Error(s(329))}}}return rc(e,$e()),e.callbackNode===n?ic.bind(null,e):null}function sc(e,t){var n=Bl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=jl,jl=n,null!==t&&ac(t)),e}function ac(e){null===jl?jl=e:jl.push.apply(jl,e)}function oc(e,t){for(t&=~Ul,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&Rl))throw Error(s(327));Tc();var t=ht(e,0);if(0===(1&t))return rc(e,$e()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var r=gt(e);0!==r&&(t=r,n=sc(e,r))}if(1===n)throw n=Nl,hc(e,0),oc(e,t),rc(e,$e()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,jl,Hl),rc(e,$e()),null}function cc(e,t){var n=Rl;Rl|=1;try{return e(t)}finally{0===(Rl=n)&&(Kl=$e()+500,Bi&&Ki())}}function uc(e){null!==ql&&0===ql.tag&&0===(6&Rl)&&Tc();var t=Rl;Rl|=1;var n=Al.transition,r=Et;try{if(Al.transition=null,Et=1,e)return e()}finally{Et=r,Al.transition=n,0===(6&(Rl=t))&&Ki()}}function dc(){Pl=Cl.current,wi(Cl)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==_l)for(n=_l.return;null!==n;){var r=n;switch(ts(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Ci();break;case 3:Xs(),wi(Ii),wi(Ri),na();break;case 5:Js(r);break;case 4:Xs();break;case 13:case 19:wi(Zs);break;case 10:As(r.type._context);break;case 22:case 23:dc()}n=n.return}if(Il=e,_l=e=Cc(e.current,null),Dl=Pl=t,Ol=0,Nl=null,Ul=Fl=Ml=0,jl=Bl=null,null!==Ds){for(t=0;t<Ds.length;t++)if(null!==(r=(n=Ds[t]).interleaved)){n.interleaved=null;var i=r.next,s=n.pending;if(null!==s){var a=s.next;s.next=i,r.next=a}n.pending=r}Ds=null}return e}function fc(e,t){for(;;){var n=_l;try{if(Ls(),ra.current=$a,ca){for(var r=aa.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ca=!1}if(sa=0,la=oa=aa=null,ua=!1,da=0,Ll.current=null,null===n||null===n.return){Ol=1,Nl=t,_l=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Dl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var g=mo(o);if(null!==g){g.flags&=-257,vo(g,o,l,0,t),1&g.mode&&po(a,u,t),c=u;var p=(t=g).updateQueue;if(null===p){var m=new Set;m.add(c),t.updateQueue=m}else p.add(c);break e}if(0===(1&t)){po(a,u,t),pc();break e}c=Error(s(426))}else if(is&&1&l.mode){var v=mo(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),gs(lo(c,l));break e}}a=c=lo(c,l),4!==Ol&&(Ol=2),null===Bl?Bl=[a]:Bl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Gs(a,fo(0,c,t));break e;case 1:l=c;var y=a.type,E=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==E&&"function"===typeof E.componentDidCatch&&(null===Wl||!Wl.has(E)))){a.flags|=65536,t&=-t,a.lanes|=t,Gs(a,go(a,l,t));break e}}a=a.return}while(null!==a)}bc(n)}catch(b){t=b,_l===n&&null!==n&&(_l=n=n.return);continue}break}}function gc(){var e=wl.current;return wl.current=$a,null===e?$a:e}function pc(){0!==Ol&&3!==Ol&&2!==Ol||(Ol=4),null===Il||0===(268435455&Ml)&&0===(268435455&Fl)||oc(Il,Dl)}function mc(e,t){var n=Rl;Rl|=2;var r=gc();for(Il===e&&Dl===t||(Hl=null,hc(e,t));;)try{vc();break}catch(i){fc(e,i)}if(Ls(),Rl=n,wl.current=r,null!==_l)throw Error(s(261));return Il=null,Dl=0,Ol}function vc(){for(;null!==_l;)Ec(_l)}function yc(){for(;null!==_l&&!Qe();)Ec(_l)}function Ec(e){var t=kl(e.alternate,e,Pl);e.memoizedProps=e.pendingProps,null===t?bc(e):_l=t,Ll.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Yo(n,t,Pl)))return void(_l=n)}else{if(null!==(n=qo(n,t)))return n.flags&=32767,void(_l=n);if(null===e)return Ol=6,void(_l=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(_l=t);_l=t=e}while(null!==t);0===Ol&&(Ol=5)}function Sc(e,t,n){var r=Et,i=Al.transition;try{Al.transition=null,Et=1,function(e,t,n,r){do{Tc()}while(null!==ql);if(0!==(6&Rl))throw Error(s(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-at(n),s=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~s}}(e,a),e===Il&&(_l=Il=null,Dl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yl||(Yl=!0,Ic(tt,function(){return Tc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Al.transition,Al.transition=null;var o=Et;Et=1;var l=Rl;Rl|=4,Ll.current=null,function(e,t){if(ei=Vt,fr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(S){n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var g;h!==n||0!==i&&3!==h.nodeType||(l=o+i),h!==a||0!==r&&3!==h.nodeType||(c=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(g=h.firstChild);)f=h,h=g;for(;;){if(h===e)break t;if(f===n&&++u===i&&(l=o),f===a&&++d===r&&(c=o),null!==(g=h.nextSibling))break;f=(h=f).parentNode}h=g}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Vt=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var p=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==p){var m=p.memoizedProps,v=p.memoizedState,y=t.stateNode,E=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:to(t.type,m),v);y.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(s(163))}}catch(S){xc(t,t.return,S)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}p=tl,tl=!1}(e,n),ml(n,e),gr(ti),Vt=!!ei,ti=ei=null,e.current=n,yl(n,e,i),Xe(),Rl=l,Et=o,Al.transition=a}else e.current=n;if(Yl&&(Yl=!1,ql=e,Ql=i),a=e.pendingLanes,0===a&&(Wl=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,$e()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Vl)throw Vl=!1,e=zl,zl=null,e;0!==(1&Ql)&&0!==e.tag&&Tc(),a=e.pendingLanes,0!==(1&a)?e===$l?Xl++:(Xl=0,$l=e):Xl=0,Ki()}(e,t,n,r)}finally{Al.transition=i,Et=r}return null}function Tc(){if(null!==ql){var e=bt(Ql),t=Al.transition,n=Et;try{if(Al.transition=null,Et=16>e?16:e,null===ql)var r=!1;else{if(e=ql,ql=null,Ql=0,0!==(6&Rl))throw Error(s(331));var i=Rl;for(Rl|=4,Jo=e.current;null!==Jo;){var a=Jo,o=a.child;if(0!==(16&Jo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Jo=u;null!==Jo;){var d=Jo;switch(d.tag){case 0:case 11:case 15:nl(8,d,a)}var h=d.child;if(null!==h)h.return=d,Jo=h;else for(;null!==Jo;){var f=(d=Jo).sibling,g=d.return;if(sl(d),d===u){Jo=null;break}if(null!==f){f.return=g,Jo=f;break}Jo=g}}}var p=a.alternate;if(null!==p){var m=p.child;if(null!==m){p.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}Jo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(a=Jo).flags))switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Jo=y;break e}Jo=a.return}}var E=e.current;for(Jo=E;null!==Jo;){var b=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==b)b.return=o,Jo=b;else e:for(o=E;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(T){xc(l,l.return,T)}if(l===o){Jo=null;break e}var S=l.sibling;if(null!==S){S.return=l.return,Jo=S;break e}Jo=l.return}}if(Rl=i,Ki(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(it,e)}catch(T){}r=!0}return r}finally{Et=n,Al.transition=t}}return!1}function kc(e,t,n){e=Bs(e,t=fo(0,t=lo(n,t),1),1),t=ec(),null!==e&&(vt(e,1,t),rc(e,t))}function xc(e,t,n){if(3===e.tag)kc(e,e,n);else for(;null!==t;){if(3===t.tag){kc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Wl||!Wl.has(r))){t=Bs(t,e=go(t,e=lo(n,e),1),1),e=ec(),null!==t&&(vt(t,1,e),rc(t,e));break}}t=t.return}}function wc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(Dl&n)===n&&(4===Ol||3===Ol&&(130023424&Dl)===Dl&&500>$e()-Gl?hc(e,0):Ul|=n),rc(e,t)}function Lc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Os(e,t))&&(vt(e,t,n),rc(e,n))}function Ac(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Lc(e,n)}function Rc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(t),Lc(e,n)}function Ic(e,t){return Ye(e,t)}function _c(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dc(e,t,n,r){return new _c(e,t,n,r)}function Pc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Cc(e,t){var n=e.alternate;return null===n?((n=Dc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,i,a){var o=2;if(r=e,"function"===typeof e)Pc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case k:return Nc(n.children,i,a,t);case x:o=8,i|=8;break;case w:return(e=Dc(12,n,t,2|i)).elementType=w,e.lanes=a,e;case I:return(e=Dc(13,n,t,i)).elementType=I,e.lanes=a,e;case _:return(e=Dc(19,n,t,i)).elementType=_,e.lanes=a,e;case C:return Mc(n,i,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case L:o=10;break e;case A:o=9;break e;case R:o=11;break e;case D:o=14;break e;case P:o=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Dc(o,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function Nc(e,t,n,r){return(e=Dc(7,e,r,t)).lanes=n,e}function Mc(e,t,n,r){return(e=Dc(22,e,r,t)).elementType=C,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=Dc(6,e,null,t)).lanes=n,e}function Uc(e,t,n){return(t=Dc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function jc(e,t,n,r,i,s,a,o,l){return e=new Bc(e,t,n,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Dc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ms(s),e}function Gc(e){if(!e)return Ai;e:{if(Ke(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Pi(n))return Ni(e,n,t)}return t}function Kc(e,t,n,r,i,s,a,o,l){return(e=jc(n,r,!0,e,0,s,0,o,l)).context=Gc(null),n=e.current,(s=Us(r=ec(),i=tc(n))).callback=void 0!==t&&null!==t?t:null,Bs(n,s,i),e.current.lanes=i,vt(e,i,r),rc(e,r),e}function Hc(e,t,n,r){var i=t.current,s=ec(),a=tc(i);return n=Gc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Us(s,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Bs(i,t,a))&&(nc(e,i,a,s),js(e,i,a)),a}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function zc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){zc(e,t),(e=e.alternate)&&zc(e,t)}kl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ii.current)Eo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Eo=!1,function(e,t,n){switch(t.tag){case 3:Io(t),fs();break;case 5:$s(t);break;case 1:Pi(t.type)&&Mi(t);break;case 4:Qs(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Li(Ts,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Li(Zs,1&Zs.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fo(e,t,n):(Li(Zs,1&Zs.current),null!==(e=Vo(e,t,n))?e.sibling:null);Li(Zs,1&Zs.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ko(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Li(Zs,Zs.current),r)break;return null;case 22:case 23:return t.lanes=0,xo(e,t,n)}return Vo(e,t,n)}(e,t,n);Eo=0!==(131072&e.flags)}else Eo=!1,is&&0!==(1048576&t.flags)&&Zi(t,Wi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ho(e,t),e=t.pendingProps;var i=Di(t,Ri.current);Is(t,n),i=pa(null,t,r,e,i,n);var a=ma();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pi(r)?(a=!0,Mi(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Ms(t),i.updater=ro,t.stateNode=i,i._reactInternals=t,oo(t,r,e,n),t=Ro(null,t,r,!0,a,n)):(t.tag=0,is&&a&&es(t),bo(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ho(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Pc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===D)return 14}return 2}(r),e=to(r,e),i){case 0:t=Lo(null,t,r,e,n);break e;case 1:t=Ao(null,t,r,e,n);break e;case 11:t=So(null,t,r,e,n);break e;case 14:t=To(null,t,r,to(r.type,e),n);break e}throw Error(s(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Lo(e,t,r,i=t.elementType===r?i:to(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ao(e,t,r,i=t.elementType===r?i:to(r,i),n);case 3:e:{if(Io(t),null===e)throw Error(s(387));r=t.pendingProps,i=(a=t.memoizedState).element,Fs(e,t),Ks(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=_o(e,t,r,n,i=lo(Error(s(423)),t));break e}if(r!==i){t=_o(e,t,r,n,i=lo(Error(s(424)),t));break e}for(rs=ci(t.stateNode.containerInfo.firstChild),ns=t,is=!0,ss=null,n=Ss(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fs(),r===i){t=Vo(e,t,n);break e}bo(e,t,r,n)}t=t.child}return t;case 5:return $s(t),null===e&&cs(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,o=i.children,ni(r,i)?o=null:null!==a&&ni(r,a)&&(t.flags|=32),wo(e,t),bo(e,t,o,n),t.child;case 6:return null===e&&cs(t),null;case 13:return Fo(e,t,n);case 4:return Qs(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=bs(t,null,r,n):bo(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,So(e,t,r,i=t.elementType===r?i:to(r,i),n);case 7:return bo(e,t,t.pendingProps,n),t.child;case 8:case 12:return bo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,Li(Ts,r._currentValue),r._currentValue=o,null!==a)if(or(a.value,o)){if(a.children===i.children&&!Ii.current){t=Vo(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=Us(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Rs(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Rs(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}bo(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Is(t,n),r=r(i=_s(i)),t.flags|=1,bo(e,t,r,n),t.child;case 14:return i=to(r=t.type,t.pendingProps),To(e,t,r,i=to(r.type,i),n);case 15:return ko(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:to(r,i),Ho(e,t),t.tag=1,Pi(r)?(e=!0,Mi(t)):e=!1,Is(t,n),so(t,r,i),oo(t,r,i,n),Ro(null,t,r,!0,e,n);case 19:return Ko(e,t,n);case 22:return xo(e,t,n)}throw Error(s(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function qc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function Zc(e,t,n,r,i){var s=n._reactRootContainer;if(s){var a=s;if("function"===typeof i){var o=i;i=function(){var e=Vc(a);o.call(e)}}Hc(t,a,e,i)}else a=function(e,t,n,r,i){if(i){if("function"===typeof r){var s=r;r=function(){var e=Vc(a);s.call(e)}}var a=Kc(t,r,e,0,null,!1,0,"",Jc);return e._reactRootContainer=a,e[gi]=a.current,Kr(8===e.nodeType?e.parentNode:e),uc(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var o=r;r=function(){var e=Vc(l);o.call(e)}}var l=jc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[gi]=l.current,Kr(8===e.nodeType?e.parentNode:e),uc(function(){Hc(t,l,n,r)}),l}(n,t,e,i,r);return Vc(a)}Qc.prototype.render=qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Hc(e,t,null,null)},Qc.prototype.unmount=qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){Hc(null,e,null,null)}),t[gi]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=xt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ct.length&&0!==t&&t<Ct[n].priority;n++);Ct.splice(n,0,e),0===n&&Ft(e)}},St=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,$e()),0===(6&Rl)&&(Kl=$e()+500,Ki()))}break;case 13:uc(function(){var t=Os(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Wc(e,1)}},Tt=function(e){if(13===e.tag){var t=Os(e,134217728);if(null!==t)nc(t,e,134217728,ec());Wc(e,134217728)}},kt=function(e){if(13===e.tag){var t=tc(e),n=Os(e,t);if(null!==n)nc(n,e,t,ec());Wc(e,t)}},xt=function(){return Et},wt=function(e,t){var n=Et;try{return Et=e,t()}finally{Et=n}},Te=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Si(r);if(!i)throw Error(s(90));Y(r),J(r,i)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Re=cc,Ie=uc;var eu={usingClientEntryPoint:!1,Events:[Ei,bi,Si,Le,Ae,cc]},tu={findFiberByHostInstance:yi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=ze(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{it=ru.inject(nu),st=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xc(t))throw Error(s(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:T,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xc(e))throw Error(s(299));var n=!1,r="",i=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=jc(e,1,!1,null,0,n,0,r,i),e[gi]=t.current,Kr(8===e.nodeType?e.parentNode:e),new qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=ze(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!$c(t))throw Error(s(200));return Zc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xc(e))throw Error(s(405));var r=null!=n&&n.hydratedSources||null,i=!1,a="",o=Yc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Kc(t,null,e,1,null!=n?n:null,i,0,a,o),e[gi]=t.current,Kr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Qc(t)},t.render=function(e,t,n){if(!$c(t))throw Error(s(200));return Zc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!$c(e))throw Error(s(40));return!!e._reactRootContainer&&(uc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[gi]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!$c(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return Zc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{e.exports=n(234)},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.m=e,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var s=Object.create(null);n.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&i&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>r[e]);return a.default=()=>r,n.d(s,a),s}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+".293b5985.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="khopadi-movies-frontend:";n.l=(r,i,s,a)=>{if(e[r])e[r].push(i);else{var o,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+s){o=d;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+s),o.src=r),e[r]=[i];var h=(t,n)=>{o.onerror=o.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach(e=>e(n)),t)return t(n)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/khopadi.github.io/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var s=new Promise((n,r)=>i=e[t]=[n,r]);r.push(i[2]=s);var a=n.p+n.u(t),o=new Error;n.l(a,r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var s=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,i[1](o)}},"chunk-"+t,t)}};var t=(t,r)=>{var i,s,[a,o,l]=r,c=0;if(a.some(t=>0!==e[t])){for(i in o)n.o(o,i)&&(n.m[i]=o[i]);if(l)l(n)}for(t&&t(r);c<a.length;c++)s=a[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0},r=self.webpackChunkkhopadi_movies_frontend=self.webpackChunkkhopadi_movies_frontend||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r={};n.r(r),n.d(r,{hasBrowserEnv:()=>Xt,hasStandardBrowserEnv:()=>Jt,hasStandardBrowserWebWorkerEnv:()=>Zt,navigator:()=>$t,origin:()=>en});var i,s=n(43),a=n.t(s,2),o=n(391),l=n(950),c=n.t(l,2);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(i||(i={}));const d="popstate";function h(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function f(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function g(e,t){return{usr:e.state,key:e.key,idx:t}}function p(e,t,n,r){return void 0===n&&(n=null),u({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?v(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function m(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function v(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function y(e,t,n,r){void 0===r&&(r={});let{window:s=document.defaultView,v5Compat:a=!1}=r,o=s.history,l=i.Pop,c=null,f=v();function v(){return(o.state||{idx:null}).idx}function y(){l=i.Pop;let e=v(),t=null==e?null:e-f;f=e,c&&c({action:l,location:b.location,delta:t})}function E(e){let t="null"!==s.location.origin?s.location.origin:s.location.href,n="string"===typeof e?e:m(e);return n=n.replace(/ $/,"%20"),h(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==f&&(f=0,o.replaceState(u({},o.state,{idx:f}),""));let b={get action(){return l},get location(){return e(s,o)},listen(e){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(d,y),c=e,()=>{s.removeEventListener(d,y),c=null}},createHref:e=>t(s,e),createURL:E,encodeLocation(e){let t=E(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){l=i.Push;let r=p(b.location,e,t);n&&n(r,e),f=v()+1;let u=g(r,f),d=b.createHref(r);try{o.pushState(u,"",d)}catch(h){if(h instanceof DOMException&&"DataCloneError"===h.name)throw h;s.location.assign(d)}a&&c&&c({action:l,location:b.location,delta:1})},replace:function(e,t){l=i.Replace;let r=p(b.location,e,t);n&&n(r,e),f=v();let s=g(r,f),u=b.createHref(r);o.replaceState(s,"",u),a&&c&&c({action:l,location:b.location,delta:0})},go:e=>o.go(e)};return b}var E;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(E||(E={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function b(e,t,n){return void 0===n&&(n="/"),S(e,t,n,!1)}function S(e,t,n,r){let i=N(("string"===typeof t?v(t):t).pathname||"/",n);if(null==i)return null;let s=T(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(s);let a=null;for(let o=0;null==a&&o<s.length;++o){let e=O(i);a=P(s[o],e,r)}return a}function T(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,s)=>{let a={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(h(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let o=H([r,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(h(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),T(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:D(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of k(e.path))i(e,t,r);else i(e,t)}),t}function k(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(0===r.length)return i?[s,""]:[s];let a=k(r.join("/")),o=[];return o.push(...a.map(e=>""===e?s:[s,e].join("/"))),i&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const x=/^:[\w-]+$/,w=3,L=2,A=1,R=10,I=-2,_=e=>"*"===e;function D(e,t){let n=e.split("/"),r=n.length;return n.some(_)&&(r+=I),t&&(r+=L),n.filter(e=>!_(e)).reduce((e,t)=>e+(x.test(t)?w:""===t?A:R),r)}function P(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,i={},s="/",a=[];for(let o=0;o<r.length;++o){let e=r[o],l=o===r.length-1,c="/"===s?t:t.slice(s.length)||"/",u=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),d=e.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),a.push({params:i,pathname:H([s,u.pathname]),pathnameBase:V(H([s,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(s=H([s,u.pathnameBase]))}return a}function C(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);f("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let s=new RegExp(i,t?void 0:"i");return[s,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=o[n]||"";a=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[r]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:s,pathnameBase:a,pattern:e}}function O(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return f(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function N(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}const M=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function F(e,t){void 0===t&&(t="/");let n,{pathname:r,search:i="",hash:s=""}="string"===typeof e?v(e):e;if(r)if(a=r,M.test(a))n=r;else{if(r.includes("//")){let e=r;r=r.replace(/\/\/+/g,"/"),f(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+r)}n=r.startsWith("/")?U(r.substring(1),"/"):U(r,t)}else n=t;var a;return{pathname:n,search:z(i),hash:W(s)}}function U(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function B(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function j(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function G(e,t){let n=j(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function K(e,t,n,r){let i;void 0===r&&(r=!1),"string"===typeof e?i=v(e):(i=u({},e),h(!i.pathname||!i.pathname.includes("?"),B("?","pathname","search",i)),h(!i.pathname||!i.pathname.includes("#"),B("#","pathname","hash",i)),h(!i.search||!i.search.includes("#"),B("#","search","hash",i)));let s,a=""===e||""===i.pathname,o=a?"/":i.pathname;if(null==o)s=n;else{let e=t.length-1;if(!r&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}s=e>=0?t[e]:"/"}let l=F(i,s),c=o&&"/"!==o&&o.endsWith("/"),d=(a||"."===o)&&n.endsWith("/");return l.pathname.endsWith("/")||!c&&!d||(l.pathname+="/"),l}const H=e=>e.join("/").replace(/\/\/+/g,"/"),V=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),z=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",W=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function Y(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const q=["post","put","patch","delete"],Q=(new Set(q),["get",...q]);new Set(Q),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function X(){return X=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},X.apply(this,arguments)}const $=s.createContext(null);const J=s.createContext(null);const Z=s.createContext(null);const ee=s.createContext(null);const te=s.createContext({outlet:null,matches:[],isDataRoute:!1});const ne=s.createContext(null);function re(){return null!=s.useContext(ee)}function ie(){return re()||h(!1),s.useContext(ee).location}function se(e){s.useContext(Z).static||s.useLayoutEffect(e)}function ae(){let{isDataRoute:e}=s.useContext(te);return e?function(){let{router:e}=ve(pe.UseNavigateStable),t=Ee(me.UseNavigateStable),n=s.useRef(!1);return se(()=>{n.current=!0}),s.useCallback(function(r,i){void 0===i&&(i={}),n.current&&("number"===typeof r?e.navigate(r):e.navigate(r,X({fromRouteId:t},i)))},[e,t])}():function(){re()||h(!1);let e=s.useContext($),{basename:t,future:n,navigator:r}=s.useContext(Z),{matches:i}=s.useContext(te),{pathname:a}=ie(),o=JSON.stringify(G(i,n.v7_relativeSplatPath)),l=s.useRef(!1);return se(()=>{l.current=!0}),s.useCallback(function(n,i){if(void 0===i&&(i={}),!l.current)return;if("number"===typeof n)return void r.go(n);let s=K(n,JSON.parse(o),a,"path"===i.relative);null==e&&"/"!==t&&(s.pathname="/"===s.pathname?t:H([t,s.pathname])),(i.replace?r.replace:r.push)(s,i.state,i)},[t,r,o,a,e])}()}function oe(){let{matches:e}=s.useContext(te),t=e[e.length-1];return t?t.params:{}}function le(e,t){let{relative:n}=void 0===t?{}:t,{future:r}=s.useContext(Z),{matches:i}=s.useContext(te),{pathname:a}=ie(),o=JSON.stringify(G(i,r.v7_relativeSplatPath));return s.useMemo(()=>K(e,JSON.parse(o),a,"path"===n),[e,o,a,n])}function ce(e,t,n,r){re()||h(!1);let{navigator:a}=s.useContext(Z),{matches:o}=s.useContext(te),l=o[o.length-1],c=l?l.params:{},u=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let d,f=ie();if(t){var g;let e="string"===typeof t?v(t):t;"/"===u||(null==(g=e.pathname)?void 0:g.startsWith(u))||h(!1),d=e}else d=f;let p=d.pathname||"/",m=p;if("/"!==u){let e=u.replace(/^\//,"").split("/");m="/"+p.replace(/^\//,"").split("/").slice(e.length).join("/")}let y=b(e,{pathname:m});let E=ge(y&&y.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:H([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:H([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,n,r);return t&&E?s.createElement(ee.Provider,{value:{location:X({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:i.Pop}},E):E}function ue(){let e=function(){var e;let t=s.useContext(ne),n=ye(me.UseRouteError),r=Ee(me.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=Y(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r};return s.createElement(s.Fragment,null,s.createElement("h2",null,"Unexpected Application Error!"),s.createElement("h3",{style:{fontStyle:"italic"}},t),n?s.createElement("pre",{style:i},n):null,null)}const de=s.createElement(ue,null);class he extends s.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?s.createElement(te.Provider,{value:this.props.routeContext},s.createElement(ne.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function fe(e){let{routeContext:t,match:n,children:r}=e,i=s.useContext($);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),s.createElement(te.Provider,{value:t},r)}function ge(e,t,n,r){var i;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var a;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(a=r)&&a.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let o=e,l=null==(i=n)?void 0:i.errors;if(null!=l){let e=o.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||h(!1),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let s=0;s<o.length;s++){let e=o[s];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=s),e.route.id){let{loaderData:t,errors:r}=n,i=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||i){c=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,r,i)=>{let a,d=!1,h=null,f=null;var g;n&&(a=l&&r.route.id?l[r.route.id]:void 0,h=r.route.errorElement||de,c&&(u<0&&0===i?(g="route-fallback",!1||be[g]||(be[g]=!0),d=!0,f=null):u===i&&(d=!0,f=r.route.hydrateFallbackElement||null)));let p=t.concat(o.slice(0,i+1)),m=()=>{let t;return t=a?h:d?f:r.route.Component?s.createElement(r.route.Component,null):r.route.element?r.route.element:e,s.createElement(fe,{match:r,routeContext:{outlet:e,matches:p,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===i)?s.createElement(he,{location:n.location,revalidation:n.revalidation,component:h,error:a,children:m(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):m()},null)}var pe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(pe||{}),me=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(me||{});function ve(e){let t=s.useContext($);return t||h(!1),t}function ye(e){let t=s.useContext(J);return t||h(!1),t}function Ee(e){let t=function(){let e=s.useContext(te);return e||h(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||h(!1),n.route.id}const be={};function Se(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}a.startTransition;function Te(e){h(!1)}function ke(e){let{basename:t="/",children:n=null,location:r,navigationType:a=i.Pop,navigator:o,static:l=!1,future:c}=e;re()&&h(!1);let u=t.replace(/^\/*/,"/"),d=s.useMemo(()=>({basename:u,navigator:o,static:l,future:X({v7_relativeSplatPath:!1},c)}),[u,c,o,l]);"string"===typeof r&&(r=v(r));let{pathname:f="/",search:g="",hash:p="",state:m=null,key:y="default"}=r,E=s.useMemo(()=>{let e=N(f,u);return null==e?null:{location:{pathname:e,search:g,hash:p,state:m,key:y},navigationType:a}},[u,f,g,p,m,y,a]);return null==E?null:s.createElement(Z.Provider,{value:d},s.createElement(ee.Provider,{children:n,value:E}))}function xe(e){let{children:t,location:n}=e;return ce(we(t),n)}new Promise(()=>{});s.Component;function we(e,t){void 0===t&&(t=[]);let n=[];return s.Children.forEach(e,(e,r)=>{if(!s.isValidElement(e))return;let i=[...t,r];if(e.type===s.Fragment)return void n.push.apply(n,we(e.props.children,i));e.type!==Te&&h(!1),e.props.index&&e.props.children&&h(!1);let a={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=we(e.props.children,i)),n.push(a)}),n}function Le(){return Le=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Le.apply(this,arguments)}function Ae(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function Re(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(e=>[n,e]):[[n,r]])},[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Ie=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(rf){}new Map;const _e=a.startTransition;c.flushSync,a.useId;function De(e){let{basename:t,children:n,future:r,window:i}=e,a=s.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:i,v5Compat:!0})&&(o={}),y(function(e,t){let{pathname:n,search:r,hash:i}=e.location;return p("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:m(t)},null,o)));let l=a.current,[c,u]=s.useState({action:l.action,location:l.location}),{v7_startTransition:d}=r||{},h=s.useCallback(e=>{d&&_e?_e(()=>u(e)):u(e)},[u,d]);return s.useLayoutEffect(()=>l.listen(h),[l,h]),s.useEffect(()=>Se(r),[r]),s.createElement(ke,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:l,future:r})}const Pe="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Oe=s.forwardRef(function(e,t){let n,{onClick:r,relative:i,reloadDocument:a,replace:o,state:l,target:c,to:u,preventScrollReset:d,viewTransition:f}=e,g=Ae(e,Ie),{basename:p}=s.useContext(Z),v=!1;if("string"===typeof u&&Ce.test(u)&&(n=u,Pe))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),n=N(t.pathname,p);t.origin===e.origin&&null!=n?u=n+t.search+t.hash:v=!0}catch(rf){}let y=function(e,t){let{relative:n}=void 0===t?{}:t;re()||h(!1);let{basename:r,navigator:i}=s.useContext(Z),{hash:a,pathname:o,search:l}=le(e,{relative:n}),c=o;return"/"!==r&&(c="/"===o?r:H([r,o])),i.createHref({pathname:c,search:l,hash:a})}(u,{relative:i}),E=function(e,t){let{target:n,replace:r,state:i,preventScrollReset:a,relative:o,viewTransition:l}=void 0===t?{}:t,c=ae(),u=ie(),d=le(e,{relative:o});return s.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:m(u)===m(d);c(e,{replace:n,state:i,preventScrollReset:a,relative:o,viewTransition:l})}},[u,c,d,r,i,n,e,a,o,l])}(u,{replace:o,state:l,target:c,preventScrollReset:d,relative:i,viewTransition:f});return s.createElement("a",Le({},g,{href:n||y,onClick:v||a?r:function(e){r&&r(e),e.defaultPrevented||E(e)},ref:t,target:c}))});var Ne,Me;function Fe(e){let t=s.useRef(Re(e)),n=s.useRef(!1),r=ie(),i=s.useMemo(()=>function(e,t){let n=Re(e);return t&&t.forEach((e,r)=>{n.has(r)||t.getAll(r).forEach(e=>{n.append(r,e)})}),n}(r.search,n.current?null:t.current),[r.search]),a=ae(),o=s.useCallback((e,t)=>{const r=Re("function"===typeof e?e(i):e);n.current=!0,a("?"+r,t)},[a,i]);return[i,o]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ne||(Ne={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Me||(Me={}));var Ue=n(579);const Be=()=>{const{isDarkMode:e,toggleTheme:t,colors:n}=Jh(),[r,i]=(0,s.useState)(!1),[a,o]=(0,s.useState)(!1),[l,c]=(0,s.useState)(""),[u,d]=(0,s.useState)(null),h=ae();(0,s.useEffect)(()=>{const e=()=>{const e=JSON.parse(localStorage.getItem("currentUser")||"null");d(e)};return e(),window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);const f=()=>{localStorage.removeItem("currentUser"),d(null),h("/login")},g=e=>{e.preventDefault(),l.trim()&&(h("/?search=".concat(encodeURIComponent(l))),o(!1),c(""))};return(0,Ue.jsxs)("nav",{className:"fixed w-full z-50 ".concat(n.bg," ").concat(n.text," shadow-lg"),children:[(0,Ue.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Ue.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,Ue.jsxs)(Oe,{to:"/",className:"flex items-center space-x-2",children:[(0,Ue.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-red-600 to-orange-500 rounded-lg flex items-center justify-center",children:(0,Ue.jsx)("span",{className:"text-2xl font-bold text-white",children:"K"})}),(0,Ue.jsx)("span",{className:"text-xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent",children:"KHOPADI"})]}),(0,Ue.jsxs)("div",{className:"hidden md:flex items-center space-x-8",children:[(0,Ue.jsx)(Oe,{to:"/",className:"hover:text-red-500 transition-colors",children:"Home"}),(0,Ue.jsx)(Oe,{to:"/movies",className:"hover:text-red-500 transition-colors",children:"Movies"}),(0,Ue.jsx)(Oe,{to:"/tv-shows",className:"hover:text-red-500 transition-colors",children:"TV Shows"}),(0,Ue.jsx)(Oe,{to:"/anime",className:"hover:text-red-500 transition-colors",children:"Anime"}),(0,Ue.jsx)(Oe,{to:"/upcoming",className:"hover:text-red-500 transition-colors",children:"Upcoming"})]}),(0,Ue.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Ue.jsx)("button",{onClick:()=>o(!a),className:"p-2 rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Search",children:(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Ue.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,Ue.jsx)("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Toggle theme",children:e?(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ue.jsx)("path",{d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"})}):(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ue.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}),u?(0,Ue.jsxs)("div",{className:"hidden md:flex items-center space-x-3",children:[(0,Ue.jsxs)(Oe,{to:"/profile",className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors",children:[(0,Ue.jsx)("span",{className:"w-8 h-8 bg-red-600 rounded-full flex items-center justify-center text-sm font-bold",children:u.username.charAt(0).toUpperCase()}),(0,Ue.jsx)("span",{className:"font-semibold",children:u.username})]}),(0,Ue.jsx)("button",{onClick:f,className:"px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white transition-colors",children:"Logout"})]}):(0,Ue.jsxs)("div",{className:"hidden md:flex items-center space-x-3",children:[(0,Ue.jsx)(Oe,{to:"/login",className:"px-4 py-2 rounded-lg border border-red-500 text-red-500 hover:bg-red-500 hover:text-white transition-colors",children:"Login"}),(0,Ue.jsx)(Oe,{to:"/register",className:"px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white transition-colors",children:"Register"})]}),(0,Ue.jsx)("button",{onClick:()=>i(!r),className:"md:hidden p-2 rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Toggle menu",children:r?(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Ue.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Ue.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]}),a&&(0,Ue.jsx)("div",{className:"pb-4 animate-slide-down",children:(0,Ue.jsxs)("form",{onSubmit:g,className:"flex gap-2",children:[(0,Ue.jsx)("input",{type:"text",placeholder:"Search movies, TV shows, anime...",value:l,onChange:e=>c(e.target.value),className:"flex-1 px-4 py-2 bg-gray-800 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-500",autoFocus:!0}),(0,Ue.jsx)("button",{type:"submit",className:"px-6 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors",children:"\ud83d\udd0d Search"})]})})]}),r&&(0,Ue.jsx)("div",{className:"md:hidden",children:(0,Ue.jsxs)("div",{className:"px-2 pt-2 pb-3 space-y-1 bg-gray-800",children:[(0,Ue.jsx)(Oe,{to:"/",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>i(!1),children:"Home"}),(0,Ue.jsx)(Oe,{to:"/movies",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>i(!1),children:"Movies"}),(0,Ue.jsx)(Oe,{to:"/tv-shows",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>i(!1),children:"TV Shows"}),(0,Ue.jsx)(Oe,{to:"/anime",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>i(!1),children:"Anime"}),(0,Ue.jsx)(Oe,{to:"/upcoming",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>i(!1),children:"Upcoming"}),(0,Ue.jsx)("form",{onSubmit:g,className:"px-3 py-2",children:(0,Ue.jsx)("input",{type:"text",placeholder:"Search...",value:l,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-500"})}),u?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsxs)(Oe,{to:"/profile",className:"block px-3 py-2 rounded-md bg-gray-700 hover:bg-gray-600",onClick:()=>i(!1),children:["\ud83d\udc64 ",u.username]}),(0,Ue.jsx)("button",{onClick:()=>{f(),i(!1)},className:"w-full text-left px-3 py-2 rounded-md bg-red-600 hover:bg-red-700",children:"Logout"})]}):(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)(Oe,{to:"/login",className:"block px-3 py-2 rounded-md bg-gray-700 hover:bg-gray-600",onClick:()=>i(!1),children:"Login"}),(0,Ue.jsx)(Oe,{to:"/register",className:"block px-3 py-2 rounded-md bg-red-600 hover:bg-red-700",onClick:()=>i(!1),children:"Register"})]})]})})]})};function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ge(e){var t=function(e,t){if("object"!=je(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==je(t)?t:t+""}function Ke(e,t,n){return(t=Ge(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(Object(n),!0).forEach(function(t){Ke(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ze(e,t){return function(){return e.apply(t,arguments)}}const{toString:We}=Object.prototype,{getPrototypeOf:Ye}=Object,{iterator:qe,toStringTag:Qe}=Symbol,Xe=($e=Object.create(null),e=>{const t=We.call(e);return $e[t]||($e[t]=t.slice(8,-1).toLowerCase())});var $e;const Je=e=>(e=e.toLowerCase(),t=>Xe(t)===e),Ze=e=>t=>typeof t===e,{isArray:et}=Array,tt=Ze("undefined");function nt(e){return null!==e&&!tt(e)&&null!==e.constructor&&!tt(e.constructor)&&st(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const rt=Je("ArrayBuffer");const it=Ze("string"),st=Ze("function"),at=Ze("number"),ot=e=>null!==e&&"object"===typeof e,lt=e=>{if("object"!==Xe(e))return!1;const t=Ye(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Qe in e)&&!(qe in e)},ct=Je("Date"),ut=Je("File"),dt=Je("Blob"),ht=Je("FileList"),ft=Je("URLSearchParams"),[gt,pt,mt,vt]=["ReadableStream","Request","Response","Headers"].map(Je);function yt(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),et(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{if(nt(e))return;const r=i?Object.getOwnPropertyNames(e):Object.keys(e),s=r.length;let a;for(n=0;n<s;n++)a=r[n],t.call(null,e[a],a,e)}}function Et(e,t){if(nt(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const bt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,St=e=>!tt(e)&&e!==bt;const Tt=(kt="undefined"!==typeof Uint8Array&&Ye(Uint8Array),e=>kt&&e instanceof kt);var kt;const xt=Je("HTMLFormElement"),wt=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),Lt=Je("RegExp"),At=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};yt(n,(n,i)=>{let s;!1!==(s=t(n,i,e))&&(r[i]=s||n)}),Object.defineProperties(e,r)};const Rt=Je("AsyncFunction"),It=((e,t)=>{return e?setImmediate:t?(n="axios@".concat(Math.random()),r=[],bt.addEventListener("message",e=>{let{source:t,data:i}=e;t===bt&&i===n&&r.length&&r.shift()()},!1),e=>{r.push(e),bt.postMessage(n,"*")}):e=>setTimeout(e);var n,r})("function"===typeof setImmediate,st(bt.postMessage)),_t="undefined"!==typeof queueMicrotask?queueMicrotask.bind(bt):"undefined"!==typeof process&&process.nextTick||It,Dt={isArray:et,isArrayBuffer:rt,isBuffer:nt,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||st(e.append)&&("formdata"===(t=Xe(e))||"object"===t&&st(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&rt(e.buffer),t},isString:it,isNumber:at,isBoolean:e=>!0===e||!1===e,isObject:ot,isPlainObject:lt,isEmptyObject:e=>{if(!ot(e)||nt(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(rf){return!1}},isReadableStream:gt,isRequest:pt,isResponse:mt,isHeaders:vt,isUndefined:tt,isDate:ct,isFile:ut,isBlob:dt,isRegExp:Lt,isFunction:st,isStream:e=>ot(e)&&st(e.pipe),isURLSearchParams:ft,isTypedArray:Tt,isFileList:ht,forEach:yt,merge:function e(){const{caseless:t,skipUndefined:n}=St(this)&&this||{},r={},i=(i,s)=>{const a=t&&Et(r,s)||s;lt(r[a])&&lt(i)?r[a]=e(r[a],i):lt(i)?r[a]=e({},i):et(i)?r[a]=i.slice():n&&tt(i)||(r[a]=i)};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&yt(arguments[s],i);return r},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return yt(t,(t,r)=>{n&&st(t)?e[r]=ze(t,n):e[r]=t},{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,a;const o={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)a=i[s],r&&!r(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==n&&Ye(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Xe,kindOfTest:Je,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(et(e))return e;let t=e.length;if(!at(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[qe]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:xt,hasOwnProperty:wt,hasOwnProp:wt,reduceDescriptors:At,freezeMethods:e=>{At(e,(t,n)=>{if(st(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];st(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return et(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Et,global:bt,isContextDefined:St,isSpecCompliantForm:function(e){return!!(e&&st(e.append)&&"FormData"===e[Qe]&&e[qe])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(ot(e)){if(t.indexOf(e)>=0)return;if(nt(e))return e;if(!("toJSON"in e)){t[r]=e;const i=et(e)?[]:{};return yt(e,(e,t)=>{const s=n(e,r+1);!tt(s)&&(i[t]=s)}),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:Rt,isThenable:e=>e&&(ot(e)||st(e))&&st(e.then)&&st(e.catch),setImmediate:It,asap:_t,isIterable:e=>null!=e&&st(e[qe])};function Pt(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Dt.inherits(Pt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Dt.toJSONObject(this.config),code:this.code,status:this.status}}});const Ct=Pt.prototype,Ot={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Ot[e]={value:e}}),Object.defineProperties(Pt,Ot),Object.defineProperty(Ct,"isAxiosError",{value:!0}),Pt.from=(e,t,n,r,i,s)=>{const a=Object.create(Ct);Dt.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const o=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return Pt.call(a,o,l,n,r,i),e&&null==a.cause&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",s&&Object.assign(a,s),a};const Nt=Pt;function Mt(e){return Dt.isPlainObject(e)||Dt.isArray(e)}function Ft(e){return Dt.endsWith(e,"[]")?e.slice(0,-2):e}function Ut(e,t,n){return e?e.concat(t).map(function(e,t){return e=Ft(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const Bt=Dt.toFlatObject(Dt,{},null,function(e){return/^is[A-Z]/.test(e)});const jt=function(e,t,n){if(!Dt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Dt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Dt.isUndefined(t[e])})).metaTokens,i=n.visitor||c,s=n.dots,a=n.indexes,o=(n.Blob||"undefined"!==typeof Blob&&Blob)&&Dt.isSpecCompliantForm(t);if(!Dt.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Dt.isDate(e))return e.toISOString();if(Dt.isBoolean(e))return e.toString();if(!o&&Dt.isBlob(e))throw new Nt("Blob is not supported. Use a Buffer instead.");return Dt.isArrayBuffer(e)||Dt.isTypedArray(e)?o&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,i){let o=e;if(e&&!i&&"object"===typeof e)if(Dt.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(Dt.isArray(e)&&function(e){return Dt.isArray(e)&&!e.some(Mt)}(e)||(Dt.isFileList(e)||Dt.endsWith(n,"[]"))&&(o=Dt.toArray(e)))return n=Ft(n),o.forEach(function(e,r){!Dt.isUndefined(e)&&null!==e&&t.append(!0===a?Ut([n],r,s):null===a?n:n+"[]",l(e))}),!1;return!!Mt(e)||(t.append(Ut(i,n,s),l(e)),!1)}const u=[],d=Object.assign(Bt,{defaultVisitor:c,convertValue:l,isVisitable:Mt});if(!Dt.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!Dt.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),Dt.forEach(n,function(n,s){!0===(!(Dt.isUndefined(n)||null===n)&&i.call(t,n,Dt.isString(s)?s.trim():s,r,d))&&e(n,r?r.concat(s):[s])}),u.pop()}}(e),t};function Gt(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Kt(e,t){this._pairs=[],e&&jt(e,this,t)}const Ht=Kt.prototype;Ht.append=function(e,t){this._pairs.push([e,t])},Ht.toString=function(e){const t=e?function(t){return e.call(this,t,Gt)}:Gt;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const Vt=Kt;function zt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Wt(e,t,n){if(!t)return e;const r=n&&n.encode||zt;Dt.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):Dt.isURLSearchParams(t)?t.toString():new Vt(t,n).toString(r),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}const Yt=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Dt.forEach(this.handlers,function(t){null!==t&&e(t)})}},qt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qt={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Vt,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Xt="undefined"!==typeof window&&"undefined"!==typeof document,$t="object"===typeof navigator&&navigator||void 0,Jt=Xt&&(!$t||["ReactNative","NativeScript","NS"].indexOf($t.product)<0),Zt="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,en=Xt&&window.location.href||"http://localhost",tn=Ve(Ve({},r),Qt);const nn=function(e){function t(e,n,r,i){let s=e[i++];if("__proto__"===s)return!0;const a=Number.isFinite(+s),o=i>=e.length;if(s=!s&&Dt.isArray(r)?r.length:s,o)return Dt.hasOwnProp(r,s)?r[s]=[r[s],n]:r[s]=n,!a;r[s]&&Dt.isObject(r[s])||(r[s]=[]);return t(e,n,r[s],i)&&Dt.isArray(r[s])&&(r[s]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let s;for(r=0;r<i;r++)s=n[r],t[s]=e[s];return t}(r[s])),!a}if(Dt.isFormData(e)&&Dt.isFunction(e.entries)){const n={};return Dt.forEachEntry(e,(e,r)=>{t(function(e){return Dt.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null};const rn={transitional:qt,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Dt.isObject(e);i&&Dt.isHTMLForm(e)&&(e=new FormData(e));if(Dt.isFormData(e))return r?JSON.stringify(nn(e)):e;if(Dt.isArrayBuffer(e)||Dt.isBuffer(e)||Dt.isStream(e)||Dt.isFile(e)||Dt.isBlob(e)||Dt.isReadableStream(e))return e;if(Dt.isArrayBufferView(e))return e.buffer;if(Dt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return jt(e,new tn.classes.URLSearchParams,Ve({visitor:function(e,t,n,r){return tn.isNode&&Dt.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=Dt.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return jt(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(Dt.isString(e))try{return(t||JSON.parse)(e),Dt.trim(e)}catch(rf){if("SyntaxError"!==rf.name)throw rf}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||rn.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(Dt.isResponse(e)||Dt.isReadableStream(e))return e;if(e&&Dt.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(rf){if(n){if("SyntaxError"===rf.name)throw Nt.from(rf,Nt.ERR_BAD_RESPONSE,this,null,this.response);throw rf}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:tn.classes.FormData,Blob:tn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Dt.forEach(["delete","get","head","post","put","patch"],e=>{rn.headers[e]={}});const sn=rn,an=Dt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),on=Symbol("internals");function ln(e){return e&&String(e).trim().toLowerCase()}function cn(e){return!1===e||null==e?e:Dt.isArray(e)?e.map(cn):String(e)}function un(e,t,n,r,i){return Dt.isFunction(r)?r.call(this,t,n):(i&&(t=n),Dt.isString(t)?Dt.isString(r)?-1!==t.indexOf(r):Dt.isRegExp(r)?r.test(t):void 0:void 0)}class dn{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=ln(t);if(!i)throw new Error("header name must be a non-empty string");const s=Dt.findKey(r,i);(!s||void 0===r[s]||!0===n||void 0===n&&!1!==r[s])&&(r[s||t]=cn(e))}const s=(e,t)=>Dt.forEach(e,(e,n)=>i(e,n,t));if(Dt.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(Dt.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&an[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(Dt.isObject(e)&&Dt.isIterable(e)){let n,r,i={};for(const t of e){if(!Dt.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[r=t[0]]=(n=i[r])?Dt.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}s(i,t)}else null!=e&&i(t,e,n);return this}get(e,t){if(e=ln(e)){const n=Dt.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(Dt.isFunction(t))return t.call(this,e,n);if(Dt.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ln(e)){const n=Dt.findKey(this,e);return!(!n||void 0===this[n]||t&&!un(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=ln(e)){const i=Dt.findKey(n,e);!i||t&&!un(0,n[i],i,t)||(delete n[i],r=!0)}}return Dt.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!un(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return Dt.forEach(this,(r,i)=>{const s=Dt.findKey(n,i);if(s)return t[s]=cn(r),void delete t[i];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(i):String(i).trim();a!==i&&delete t[i],t[a]=cn(r),n[a]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return Dt.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&Dt.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[on]=this[on]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=ln(e);t[r]||(!function(e,t){const n=Dt.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})})}(n,e),t[r]=!0)}return Dt.isArray(e)?e.forEach(r):r(e),this}}dn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Dt.reduceDescriptors(dn.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}}),Dt.freezeMethods(dn);const hn=dn;function fn(e,t){const n=this||sn,r=t||n,i=hn.from(r.headers);let s=r.data;return Dt.forEach(e,function(e){s=e.call(n,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function gn(e){return!(!e||!e.__CANCEL__)}function pn(e,t,n){Nt.call(this,null==e?"canceled":e,Nt.ERR_CANCELED,t,n),this.name="CanceledError"}Dt.inherits(pn,Nt,{__CANCEL__:!0});const mn=pn;function vn(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Nt("Request failed with status code "+n.status,[Nt.ERR_BAD_REQUEST,Nt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const yn=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,s=0,a=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),c=r[a];i||(i=l),n[s]=o,r[s]=l;let u=a,d=0;for(;u!==s;)d+=n[u++],u%=e;if(s=(s+1)%e,s===a&&(a=(a+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*d/h):void 0}};const En=function(e,t){let n,r,i=0,s=1e3/t;const a=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=s,n=null,r&&(clearTimeout(r),r=null),e(...t)};return[function(){const e=Date.now(),t=e-i;for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];t>=s?a(l,e):(n=l,r||(r=setTimeout(()=>{r=null,a(n)},s-t)))},()=>n&&a(n)]},bn=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const i=yn(50,250);return En(n=>{const s=n.loaded,a=n.lengthComputable?n.total:void 0,o=s-r,l=i(o);r=s;e({loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&s<=a?(a-s)/l:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})},n)},Sn=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Tn=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Dt.asap(()=>e(...n))},kn=tn.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,tn.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(tn.origin),tn.navigator&&/(msie|trident)/i.test(tn.navigator.userAgent)):()=>!0,xn=tn.hasStandardBrowserEnv?{write(e,t,n,r,i,s,a){if("undefined"===typeof document)return;const o=["".concat(e,"=").concat(encodeURIComponent(t))];Dt.isNumber(n)&&o.push("expires=".concat(new Date(n).toUTCString())),Dt.isString(r)&&o.push("path=".concat(r)),Dt.isString(i)&&o.push("domain=".concat(i)),!0===s&&o.push("secure"),Dt.isString(a)&&o.push("SameSite=".concat(a)),document.cookie=o.join("; ")},read(e){if("undefined"===typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function wn(e,t,n){let r=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Ln=e=>e instanceof hn?Ve({},e):e;function An(e,t){t=t||{};const n={};function r(e,t,n,r){return Dt.isPlainObject(e)&&Dt.isPlainObject(t)?Dt.merge.call({caseless:r},e,t):Dt.isPlainObject(t)?Dt.merge({},t):Dt.isArray(t)?t.slice():t}function i(e,t,n,i){return Dt.isUndefined(t)?Dt.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function s(e,t){if(!Dt.isUndefined(t))return r(void 0,t)}function a(e,t){return Dt.isUndefined(t)?Dt.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function o(n,i,s){return s in t?r(n,i):s in e?r(void 0,n):void 0}const l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,n)=>i(Ln(e),Ln(t),0,!0)};return Dt.forEach(Object.keys(Ve(Ve({},e),t)),function(r){const s=l[r]||i,a=s(e[r],t[r],r);Dt.isUndefined(a)&&s!==o||(n[r]=a)}),n}const Rn=e=>{const t=An({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:s,headers:a,auth:o}=t;if(t.headers=a=hn.from(a),t.url=Wt(wn(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),Dt.isFormData(n))if(tn.hasStandardBrowserEnv||tn.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(Dt.isFunction(n.getHeaders)){const e=n.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(e=>{let[n,r]=e;t.includes(n.toLowerCase())&&a.set(n,r)})}if(tn.hasStandardBrowserEnv&&(r&&Dt.isFunction(r)&&(r=r(t)),r||!1!==r&&kn(t.url))){const e=i&&s&&xn.read(s);e&&a.set(i,e)}return t},In="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const r=Rn(e);let i=r.data;const s=hn.from(r.headers).normalize();let a,o,l,c,u,{responseType:d,onUploadProgress:h,onDownloadProgress:f}=r;function g(){c&&c(),u&&u(),r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let p=new XMLHttpRequest;function m(){if(!p)return;const r=hn.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders());vn(function(e){t(e),g()},function(e){n(e),g()},{data:d&&"text"!==d&&"json"!==d?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:r,config:e,request:p}),p=null}p.open(r.method.toUpperCase(),r.url,!0),p.timeout=r.timeout,"onloadend"in p?p.onloadend=m:p.onreadystatechange=function(){p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&setTimeout(m)},p.onabort=function(){p&&(n(new Nt("Request aborted",Nt.ECONNABORTED,e,p)),p=null)},p.onerror=function(t){const r=t&&t.message?t.message:"Network Error",i=new Nt(r,Nt.ERR_NETWORK,e,p);i.event=t||null,n(i),p=null},p.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||qt;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new Nt(t,i.clarifyTimeoutError?Nt.ETIMEDOUT:Nt.ECONNABORTED,e,p)),p=null},void 0===i&&s.setContentType(null),"setRequestHeader"in p&&Dt.forEach(s.toJSON(),function(e,t){p.setRequestHeader(t,e)}),Dt.isUndefined(r.withCredentials)||(p.withCredentials=!!r.withCredentials),d&&"json"!==d&&(p.responseType=r.responseType),f&&([l,u]=bn(f,!0),p.addEventListener("progress",l)),h&&p.upload&&([o,c]=bn(h),p.upload.addEventListener("progress",o),p.upload.addEventListener("loadend",c)),(r.cancelToken||r.signal)&&(a=t=>{p&&(n(!t||t.type?new mn(null,e,p):t),p.abort(),p=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);v&&-1===tn.protocols.indexOf(v)?n(new Nt("Unsupported protocol "+v+":",Nt.ERR_BAD_REQUEST,e)):p.send(i||null)})},_n=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;r.abort(t instanceof Nt?t:new mn(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,i(new Nt("timeout ".concat(t," of ms exceeded"),Nt.ETIMEDOUT))},t);const a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:o}=r;return o.unsubscribe=()=>Dt.asap(a),o}};function Dn(e,t){this.v=e,this.k=t}function Pn(e){return function(){return new Cn(e.apply(this,arguments))}}function Cn(e){var t,n;function r(t,n){try{var s=e[t](n),a=s.value,o=a instanceof Dn;Promise.resolve(o?a.v:a).then(function(n){if(o){var l="return"===t?"return":"next";if(!a.k||n.done)return r(l,n);n=e[l](n).value}i(s.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise(function(s,a){var o={key:e,arg:i,resolve:s,reject:a,next:null};n?n=n.next=o:(t=n=o,r(e,i))})},"function"!=typeof e.return&&(this.return=void 0)}function On(e){return new Dn(e,0)}function Nn(e){var t={},n=!1;function r(t,r){return n=!0,r=new Promise(function(n){n(e[t](r))}),{done:!1,value:new Dn(r,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}function Mn(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new Fn(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Fn(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Fn=function(e){this.s=e,this.n=e.next},Fn.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Fn(e)}Cn.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Cn.prototype.next=function(e){return this._invoke("next",e)},Cn.prototype.throw=function(e){return this._invoke("throw",e)},Cn.prototype.return=function(e){return this._invoke("return",e)};const Un=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},Bn=function(){var e=Pn(function*(e,t){var n,r=!1,i=!1;try{for(var s,a=Mn(jn(e));r=!(s=yield On(a.next())).done;r=!1){const e=s.value;yield*Nn(Mn(Un(e,t)))}}catch(o){i=!0,n=o}finally{try{r&&null!=a.return&&(yield On(a.return()))}finally{if(i)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),jn=function(){var e=Pn(function*(e){if(e[Symbol.asyncIterator])return void(yield*Nn(Mn(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield On(t.read());if(e)break;yield n}}finally{yield On(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),Gn=(e,t,n,r)=>{const i=Bn(e,t);let s,a=0,o=e=>{s||(s=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return o(),void e.close();let s=r.byteLength;if(n){let e=a+=s;n(e)}e.enqueue(new Uint8Array(r))}catch(t){throw o(t),t}},cancel:e=>(o(e),i.return())},{highWaterMark:2})},{isFunction:Kn}=Dt,Hn=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(Dt.global),{ReadableStream:Vn,TextEncoder:zn}=Dt.global,Wn=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(rf){return!1}},Yn=e=>{e=Dt.merge.call({skipUndefined:!0},Hn,e);const{fetch:t,Request:n,Response:r}=e,i=t?Kn(t):"function"===typeof fetch,s=Kn(n),a=Kn(r);if(!i)return!1;const o=i&&Kn(Vn),l=i&&("function"===typeof zn?(c=new zn,e=>c.encode(e)):async e=>new Uint8Array(await new n(e).arrayBuffer()));var c;const u=s&&o&&Wn(()=>{let e=!1;const t=new n(tn.origin,{body:new Vn,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),d=a&&o&&Wn(()=>Dt.isReadableStream(new r("").body)),h={stream:d&&(e=>e.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!h[e]&&(h[e]=(t,n)=>{let r=t&&t[e];if(r)return r.call(t);throw new Nt("Response type '".concat(e,"' is not supported"),Nt.ERR_NOT_SUPPORT,n)})});const f=async(e,t)=>{const r=Dt.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(Dt.isBlob(e))return e.size;if(Dt.isSpecCompliantForm(e)){const t=new n(tn.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Dt.isArrayBufferView(e)||Dt.isArrayBuffer(e)?e.byteLength:(Dt.isURLSearchParams(e)&&(e+=""),Dt.isString(e)?(await l(e)).byteLength:void 0)})(t):r};return async e=>{let{url:i,method:a,data:o,signal:l,cancelToken:c,timeout:g,onDownloadProgress:p,onUploadProgress:m,responseType:v,headers:y,withCredentials:E="same-origin",fetchOptions:b}=Rn(e),S=t||fetch;v=v?(v+"").toLowerCase():"text";let T=_n([l,c&&c.toAbortSignal()],g),k=null;const x=T&&T.unsubscribe&&(()=>{T.unsubscribe()});let w;try{if(m&&u&&"get"!==a&&"head"!==a&&0!==(w=await f(y,o))){let e,t=new n(i,{method:"POST",body:o,duplex:"half"});if(Dt.isFormData(o)&&(e=t.headers.get("content-type"))&&y.setContentType(e),t.body){const[e,n]=Sn(w,bn(Tn(m)));o=Gn(t.body,65536,e,n)}}Dt.isString(E)||(E=E?"include":"omit");const t=s&&"credentials"in n.prototype,l=Ve(Ve({},b),{},{signal:T,method:a.toUpperCase(),headers:y.normalize().toJSON(),body:o,duplex:"half",credentials:t?E:void 0});k=s&&new n(i,l);let c=await(s?S(k,b):S(i,l));const g=d&&("stream"===v||"response"===v);if(d&&(p||g&&x)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=c[t]});const t=Dt.toFiniteNumber(c.headers.get("content-length")),[n,i]=p&&Sn(t,bn(Tn(p),!0))||[];c=new r(Gn(c.body,65536,n,()=>{i&&i(),x&&x()}),e)}v=v||"text";let L=await h[Dt.findKey(h,v)||"text"](c,e);return!g&&x&&x(),await new Promise((t,n)=>{vn(t,n,{data:L,headers:hn.from(c.headers),status:c.status,statusText:c.statusText,config:e,request:k})})}catch(L){if(x&&x(),L&&"TypeError"===L.name&&/Load failed|fetch/i.test(L.message))throw Object.assign(new Nt("Network Error",Nt.ERR_NETWORK,e,k),{cause:L.cause||L});throw Nt.from(L,L&&L.code,e,k)}}},qn=new Map,Qn=e=>{let t=e&&e.env||{};const{fetch:n,Request:r,Response:i}=t,s=[r,i,n];let a,o,l=s.length,c=qn;for(;l--;)a=s[l],o=c.get(a),void 0===o&&c.set(a,o=l?new Map:Yn(t)),c=o;return o},Xn=(Qn(),{http:null,xhr:In,fetch:{get:Qn}});Dt.forEach(Xn,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(rf){}Object.defineProperty(e,"adapterName",{value:t})}});const $n=e=>"- ".concat(e),Jn=e=>Dt.isFunction(e)||null===e||!1===e;const Zn={getAdapter:function(e,t){e=Dt.isArray(e)?e:[e];const{length:n}=e;let r,i;const s={};for(let a=0;a<n;a++){let n;if(r=e[a],i=r,!Jn(r)&&(i=Xn[(n=String(r)).toLowerCase()],void 0===i))throw new Nt("Unknown adapter '".concat(n,"'"));if(i&&(Dt.isFunction(i)||(i=i.get(t))))break;s[n||"#"+a]=i}if(!i){const e=Object.entries(s).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});let t=n?e.length>1?"since :\n"+e.map($n).join("\n"):" "+$n(e[0]):"as no adapter specified";throw new Nt("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return i},adapters:Xn};function er(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new mn(null,e)}function tr(e){er(e),e.headers=hn.from(e.headers),e.data=fn.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Zn.getAdapter(e.adapter||sn.adapter,e)(e).then(function(t){return er(e),t.data=fn.call(e,e.transformResponse,t),t.headers=hn.from(t.headers),t},function(t){return gn(t)||(er(e),t&&t.response&&(t.response.data=fn.call(e,e.transformResponse,t.response),t.response.headers=hn.from(t.response.headers))),Promise.reject(t)})}const nr="1.13.2",rr={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{rr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const ir={};rr.transitional=function(e,t,n){function r(e,t){return"[Axios v"+nr+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,s)=>{if(!1===e)throw new Nt(r(i," has been removed"+(t?" in "+t:"")),Nt.ERR_DEPRECATED);return t&&!ir[i]&&(ir[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,s)}},rr.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const sr={assertOptions:function(e,t,n){if("object"!==typeof e)throw new Nt("options must be an object",Nt.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],a=t[s];if(a){const t=e[s],n=void 0===t||a(t,s,e);if(!0!==n)throw new Nt("option "+s+" must be "+n,Nt.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new Nt("Unknown option "+s,Nt.ERR_BAD_OPTION)}},validators:rr},ar=sr.validators;class or{constructor(e){this.defaults=e||{},this.interceptors={request:new Yt,response:new Yt}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(rf){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=An(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&sr.assertOptions(n,{silentJSONParsing:ar.transitional(ar.boolean),forcedJSONParsing:ar.transitional(ar.boolean),clarifyTimeoutError:ar.transitional(ar.boolean)},!1),null!=r&&(Dt.isFunction(r)?t.paramsSerializer={serialize:r}:sr.assertOptions(r,{encode:ar.function,serialize:ar.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),sr.assertOptions(t,{baseUrl:ar.spelling("baseURL"),withXsrfToken:ar.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Dt.merge(i.common,i[t.method]);i&&Dt.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=hn.concat(s,i);const a=[];let o=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let u,d=0;if(!o){const e=[tr.bind(this),void 0];for(e.unshift(...a),e.push(...l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=a.length;let h=t;for(;d<u;){const e=a[d++],t=a[d++];try{h=e(h)}catch(f){t.call(this,f);break}}try{c=tr.call(this,h)}catch(f){return Promise.reject(f)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return Wt(wn((e=An(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}Dt.forEach(["delete","get","head","options"],function(e){or.prototype[e]=function(t,n){return this.request(An(n||{},{method:e,url:t,data:(n||{}).data}))}}),Dt.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,i){return this.request(An(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}or.prototype[e]=t(),or.prototype[e+"Form"]=t(!0)});const lr=or;class cr{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,i){n.reason||(n.reason=new mn(e,r,i),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new cr(function(t){e=t}),cancel:e}}}const ur=cr;const dr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(dr).forEach(e=>{let[t,n]=e;dr[n]=t});const hr=dr;const fr=function e(t){const n=new lr(t),r=ze(lr.prototype.request,n);return Dt.extend(r,lr.prototype,n,{allOwnKeys:!0}),Dt.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(An(t,n))},r}(sn);fr.Axios=lr,fr.CanceledError=mn,fr.CancelToken=ur,fr.isCancel=gn,fr.VERSION=nr,fr.toFormData=jt,fr.AxiosError=Nt,fr.Cancel=fr.CanceledError,fr.all=function(e){return Promise.all(e)},fr.spread=function(e){return function(t){return e.apply(null,t)}},fr.isAxiosError=function(e){return Dt.isObject(e)&&!0===e.isAxiosError},fr.mergeConfig=An,fr.AxiosHeaders=hn,fr.formToJSON=e=>nn(Dt.isHTMLForm(e)?new FormData(e):e),fr.getAdapter=Zn.getAdapter,fr.HttpStatusCode=hr,fr.default=fr;const gr=fr,pr=["https://hianime-api2.vercel.app","https://api-aniwatch.onrender.com","https://hianime-api.onrender.com","https://api.aniwatch.pro"];let mr=0;const vr=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(let r=0;r<pr.length;r++)try{const n="".concat(pr[(mr+r)%pr.length],"/api/v1").concat(e),i=await gr.get(n,{params:t,timeout:1e4});if(i.data.success)return mr=(mr+r)%pr.length,i.data.data}catch(n){if(console.error("Server ".concat(r+1," failed:"),n.message),r===pr.length-1)throw new Error("All anime servers are down")}},yr={home:async()=>{try{return await vr("/home")}catch(e){return console.error("HiAnime home error:",e),null}},search:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{return await vr("/search",{keyword:e,page:t})}catch(n){return console.error("HiAnime search error:",n),{animes:[],pageInfo:{}}}},details:async e=>{try{return await vr("/anime/".concat(e))}catch(t){return console.error("HiAnime details error:",t),null}},episodes:async e=>{try{return await vr("/episodes/".concat(e))}catch(t){return console.error("HiAnime episodes error:",t),{episodes:[]}}},servers:async e=>{try{return await vr("/servers",{id:e})}catch(t){return console.error("HiAnime servers error:",t),{sub:[],dub:[]}}},stream:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hd-1",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sub";try{return await vr("/stream",{id:e,server:t,type:n})}catch(r){return console.error("HiAnime stream error:",r),null}},topAiring:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return await vr("/animes/top-airing",{page:e})}catch(t){return console.error("HiAnime top airing error:",t),{animes:[],pageInfo:{}}}},popular:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return await vr("/animes/most-popular",{page:e})}catch(t){return console.error("HiAnime popular error:",t),{animes:[],pageInfo:{}}}},recentEpisodes:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return await vr("/animes/recently-updated",{page:e})}catch(t){return console.error("HiAnime recent error:",t),{animes:[],pageInfo:{}}}},genres:async()=>{try{return await vr("/genres")}catch(e){return console.error("HiAnime genres error:",e),[]}},filter:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{return await vr("/filter",Ve(Ve({},e),{},{page:t}))}catch(n){return console.error("HiAnime filter error:",n),{animes:[],pageInfo:{}}}},random:async()=>{try{const e=await vr("/random");return(null===e||void 0===e?void 0:e.id)||null}catch(e){return console.error("HiAnime random error:",e),null}},schedule:async e=>{try{return await vr("/schedules",e?{date:e}:{})}catch(t){return console.error("HiAnime schedule error:",t),{}}}},Er="b97bbe91d4e62db2ae1eea9d5bf2f2aa",br="https://api.themoviedb.org/3",Sr="https://api.tvmaze.com",Tr="https://api.breakingbadquotes.xyz/v1/quotes",kr="https://movie-quote-api.herokuapp.com/v1/quote",xr=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"w500";return e?e.startsWith("http")?e:"".concat("https://image.tmdb.org/t/p","/").concat(t).concat(e):"/placeholder-movie.jpg"},wr={trending:async()=>{try{return(await gr.get("".concat(br,"/trending/movie/week"),{params:{api_key:Er}})).data.results}catch(e){return console.error("TMDB trending error:",e),[]}},movies:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return(await gr.get("".concat(br,"/movie/popular"),{params:{api_key:Er,page:e}})).data}catch(t){return console.error("TMDB movies error:",t),{results:[],total_pages:0}}},tvShows:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return(await gr.get("".concat(br,"/tv/popular"),{params:{api_key:Er,page:e}})).data}catch(t){return console.error("TMDB TV error:",t),{results:[],total_pages:0}}},anime:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return(await gr.get("".concat(br,"/discover/tv"),{params:{api_key:Er,with_genres:"16",with_keywords:"210024|287501",page:e}})).data}catch(t){return console.error("TMDB anime error:",t),{results:[],total_pages:0}}},upcoming:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return(await gr.get("".concat(br,"/movie/upcoming"),{params:{api_key:Er,page:e}})).data}catch(t){return console.error("TMDB upcoming error:",t),{results:[],total_pages:0}}},search:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{return(await gr.get("".concat(br,"/search/multi"),{params:{api_key:Er,query:e,page:t}})).data}catch(n){return console.error("TMDB search error:",n),{results:[],total_pages:0}}},details:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"movie";try{return(await gr.get("".concat(br,"/").concat(t,"/").concat(e),{params:{api_key:Er,append_to_response:"videos,credits,similar"}})).data}catch(n){return console.error("TMDB details error:",n),null}}},Lr={search:async e=>{try{return(await gr.get("".concat(Sr,"/search/shows"),{params:{q:e}})).data.map(e=>{var t,n;return{id:e.show.id,name:e.show.name,image:(null===(t=e.show.image)||void 0===t?void 0:t.medium)||"/placeholder-movie.jpg",summary:e.show.summary,rating:(null===(n=e.show.rating)||void 0===n?void 0:n.average)||"N/A",genres:e.show.genres}})}catch(t){return console.error("TVMaze search error:",t),[]}},schedule:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"US";try{return(await gr.get("".concat(Sr,"/schedule"),{params:{country:e,date:(new Date).toISOString().split("T")[0]}})).data.slice(0,20)}catch(t){return console.error("TVMaze schedule error:",t),[]}}},Ar={search:async e=>{try{const t=await gr.get("https://www.omdbapi.com",{params:{apikey:"3c0368f7",s:e,type:"movie"}});return"True"===t.data.Response?t.data.Search.map(e=>({id:e.imdbID,title:e.Title,poster:"N/A"!==e.Poster?e.Poster:"/placeholder-movie.jpg",year:e.Year})):[]}catch(t){return console.error("OMDb search error:",t),[]}}},Rr={random:async()=>{try{return(await gr.get(kr)).data}catch(e){return console.error("Quotes error:",e),{quote:"The greatest glory in living lies not in never falling, but in rising every time we fall.",role:"Nelson Mandela"}}},breakingBad:async()=>{try{return(await gr.get(Tr)).data[0]}catch(e){return null}}},Ir=async e=>{try{const t=await wr.search(e);if(t.results&&t.results.length>0)return{source:"TMDB",data:t.results,type:"mixed"};const n=await yr.search(e,1);if(n.animes&&n.animes.length>0)return{source:"HiAnime",data:n.animes.map(e=>Ve(Ve({},e),{},{media_type:"anime",poster_path:e.poster,name:e.title})),type:"anime"};const r=await Ar.search(e);if(r.length>0)return{source:"OMDb",data:r,type:"movies"};const i=await Lr.search(e);return i.length>0?{source:"TVMaze",data:i,type:"tv"}:{source:"none",data:[],type:"none"}}catch(t){return console.error("Smart search error:",t),{source:"error",data:[],type:"error"}}},_r=e=>{let{movie:t,type:n="movie"}=e;const r=t.title||t.name||"Untitled",i=t.release_date||t.first_air_date||"",s=i?new Date(i).getFullYear():"N/A",a=t.vote_average?t.vote_average.toFixed(1):"N/A",o=t.poster_path||t.poster||t.Poster,l=o&&"N/A"!==o?o.startsWith("http")?o:xr(o,"w300"):"/placeholder-movie.jpg";return(0,Ue.jsxs)(Oe,{to:"anime"===t.media_type||"anime"===n?"/anime/watch/".concat(t.id||t.imdbID):"/".concat(n,"/").concat(t.id||t.imdbID),className:"group relative block overflow-hidden rounded-lg bg-gray-800 transition-transform duration-300 hover:scale-105 hover:shadow-2xl",children:[(0,Ue.jsx)("div",{className:"aspect-[2/3] overflow-hidden",children:(0,Ue.jsx)("img",{src:l,alt:r,className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-110",loading:"lazy",onError:e=>{e.target.src="/placeholder-movie.jpg"}})}),(0,Ue.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100",children:(0,Ue.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[(0,Ue.jsx)("h3",{className:"mb-1 text-sm font-semibold text-white line-clamp-2",children:r}),(0,Ue.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-300",children:[(0,Ue.jsxs)("span",{children:["\ud83d\udcc5 ",s]}),"N/A"!==a&&(0,Ue.jsxs)("span",{className:"flex items-center gap-1",children:["\u2b50 ",a]})]})]})}),(0,Ue.jsx)("div",{className:"absolute right-2 top-2 rounded bg-red-600 px-2 py-1 text-xs font-bold text-white",children:"anime"===t.media_type||"anime"===n?"\u2728 ANIME":"tv"===n||"tv"===t.media_type?"\ud83d\udcfa TV":"\ud83c\udfac MOVIE"}),"N/A"!==a&&(0,Ue.jsxs)("div",{className:"absolute left-2 top-2 rounded bg-black/70 px-2 py-1 text-xs font-bold text-white backdrop-blur-sm",children:["\u2b50 ",a]})]})},Dr=()=>{const[e]=Fe(),t=e.get("search"),[n,r]=(0,s.useState)([]),[i,a]=(0,s.useState)([]),[o,l]=(0,s.useState)(t||""),[c,u]=(0,s.useState)(null),[d,h]=(0,s.useState)(!0),[f,g]=(0,s.useState)(!1);(0,s.useEffect)(()=>{p()},[]),(0,s.useEffect)(()=>{t&&(l(t),m(t))},[t]);const p=async()=>{h(!0);const[e,t]=await Promise.all([wr.trending(),Rr.random()]);r(e),u(t),h(!1)},m=async e=>{if(!e.trim())return void a([]);g(!0);const t=await Ir(e);a(t.data||[]),g(!1)},v=i.length>0?i:n,y=i.length>0?'Search Results for "'.concat(o,'"'):"\ud83d\udd25 Trending This Week";return(0,Ue.jsxs)("div",{className:"min-h-screen pt-20 pb-10",children:[(0,Ue.jsx)("div",{className:"relative h-96 bg-gradient-to-r from-red-900 via-gray-900 to-black",children:(0,Ue.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-6 text-center",children:[(0,Ue.jsxs)("h1",{className:"mb-4 text-5xl font-bold text-white md:text-6xl",children:["Welcome to ",(0,Ue.jsx)("span",{className:"bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent",children:"Khopadi Movies"})]}),(0,Ue.jsx)("p",{className:"mb-2 text-xl text-gray-300",children:"Discover millions of movies, TV shows and anime"}),c&&(0,Ue.jsxs)("div",{className:"mb-6 max-w-2xl",children:[(0,Ue.jsxs)("p",{className:"text-sm italic text-gray-400",children:['"',c.quote,'"']}),(0,Ue.jsxs)("p",{className:"text-xs text-red-400",children:["- ",c.role]})]}),(0,Ue.jsx)("form",{onSubmit:async e=>{e.preventDefault(),m(o)},className:"w-full max-w-2xl",children:(0,Ue.jsxs)("div",{className:"flex gap-2",children:[(0,Ue.jsx)("input",{type:"text",placeholder:"Search for movies, TV shows, anime...",value:o,onChange:e=>l(e.target.value),className:"flex-1 rounded-lg bg-white/10 px-6 py-4 text-white placeholder-gray-400 backdrop-blur-md focus:outline-none focus:ring-2 focus:ring-red-500"}),(0,Ue.jsx)("button",{type:"submit",disabled:f,className:"rounded-lg bg-red-600 px-8 py-4 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50",children:f?"\ud83d\udd0d Searching...":"\ud83d\udd0d Search"})]})})]})}),(0,Ue.jsxs)("div",{className:"container mx-auto px-4 py-10",children:[(0,Ue.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,Ue.jsx)("h2",{className:"text-3xl font-bold",children:y}),i.length>0&&(0,Ue.jsx)("button",{onClick:()=>{a([]),l(""),window.history.pushState({},"","/")},className:"text-red-500 hover:text-red-400",children:"\u2716 Clear Search"})]}),d?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(12)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):v.length>0?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:v.map(e=>(0,Ue.jsx)(_r,{movie:e,type:e.media_type||"movie"},e.id))}):(0,Ue.jsxs)("div",{className:"py-20 text-center",children:[(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No results found"}),(0,Ue.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Try a different search term"})]})]})]})},Pr=()=>{const[e,t]=(0,s.useState)([]),[n,r]=(0,s.useState)(!0),[i,a]=(0,s.useState)(1),[o,l]=(0,s.useState)(1);(0,s.useEffect)(()=>{c()},[i]);const c=async()=>{r(!0);const e=await wr.movies(i);t(e.results||[]),l(e.total_pages||1),r(!1),window.scrollTo({top:0,behavior:"smooth"})};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4",children:[(0,Ue.jsxs)("div",{className:"mb-8",children:[(0,Ue.jsx)("h1",{className:"mb-2 text-4xl font-bold",children:"\ud83c\udfac Popular Movies"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Discover the most popular movies of all time"})]}),n?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(18)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):e.length>0?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:e.map(e=>(0,Ue.jsx)(_r,{movie:e,type:"movie"},e.id))}),(0,Ue.jsxs)("div",{className:"mt-10 flex items-center justify-center gap-4",children:[(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.max(1,e-1)),disabled:1===i,className:"rounded-lg bg-gray-800 px-6 py-2 font-semibold text-white transition-colors hover:bg-gray-700 disabled:opacity-50",children:"\u2190 Previous"}),(0,Ue.jsxs)("span",{className:"text-lg",children:["Page ",i," of ",Math.min(o,500)]}),(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.min(500,e+1)),disabled:i>=o||i>=500,className:"rounded-lg bg-red-600 px-6 py-2 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50",children:"Next \u2192"})]})]}):(0,Ue.jsx)("div",{className:"py-20 text-center",children:(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No movies found"})})]})})},Cr=()=>{const[e,t]=(0,s.useState)([]),[n,r]=(0,s.useState)(!0),[i,a]=(0,s.useState)(1),[o,l]=(0,s.useState)(1);(0,s.useEffect)(()=>{c()},[i]);const c=async()=>{r(!0);const e=await wr.tvShows(i);t(e.results||[]),l(e.total_pages||1),r(!1),window.scrollTo({top:0,behavior:"smooth"})};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4",children:[(0,Ue.jsxs)("div",{className:"mb-8",children:[(0,Ue.jsx)("h1",{className:"mb-2 text-4xl font-bold",children:"\ud83d\udcfa Popular TV Shows"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Binge-watch the best TV series"})]}),n?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(18)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):e.length>0?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:e.map(e=>(0,Ue.jsx)(_r,{movie:e,type:"tv"},e.id))}),(0,Ue.jsxs)("div",{className:"mt-10 flex items-center justify-center gap-4",children:[(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.max(1,e-1)),disabled:1===i,className:"rounded-lg bg-gray-800 px-6 py-2 font-semibold text-white transition-colors hover:bg-gray-700 disabled:opacity-50",children:"\u2190 Previous"}),(0,Ue.jsxs)("span",{className:"text-lg",children:["Page ",i," of ",Math.min(o,500)]}),(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.min(500,e+1)),disabled:i>=o||i>=500,className:"rounded-lg bg-red-600 px-6 py-2 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50",children:"Next \u2192"})]})]}):(0,Ue.jsx)("div",{className:"py-20 text-center",children:(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No TV shows found"})})]})})},Or=e=>{var t,n;let{anime:r}=e;const i=r.title||r.name||"Untitled",s=r.poster||"/placeholder-movie.jpg",a=r.type||"TV",o=(null===(t=r.episodes)||void 0===t?void 0:t.sub)||(null===(n=r.episodes)||void 0===n?void 0:n.eps)||0;r.duration;return(0,Ue.jsxs)(Oe,{to:"/anime/watch/".concat(r.id),className:"group relative block overflow-hidden rounded-lg bg-gray-800 transition-transform duration-300 hover:scale-105 hover:shadow-2xl",children:[(0,Ue.jsx)("div",{className:"aspect-[2/3] overflow-hidden",children:(0,Ue.jsx)("img",{src:s,alt:i,className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-110",loading:"lazy",onError:e=>{e.target.src="/placeholder-movie.jpg"}})}),(0,Ue.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100",children:(0,Ue.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[(0,Ue.jsx)("h3",{className:"mb-1 text-sm font-semibold text-white line-clamp-2",children:i}),(0,Ue.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-300",children:[(0,Ue.jsxs)("span",{children:["\ud83c\udfa5 ",a]}),o>0&&(0,Ue.jsxs)("span",{children:["\ud83d\udcfa ",o," eps"]})]})]})}),(0,Ue.jsx)("div",{className:"absolute right-2 top-2 rounded bg-red-600 px-2 py-1 text-xs font-bold text-white",children:a}),o>0&&(0,Ue.jsxs)("div",{className:"absolute left-2 top-2 rounded bg-black/70 px-2 py-1 text-xs font-bold text-white backdrop-blur-sm",children:["\ud83d\udcfa ",o]})]})},Nr=()=>{const[e,t]=(0,s.useState)([]),[n,r]=(0,s.useState)(!0),[i,a]=(0,s.useState)(1),[o,l]=(0,s.useState)(1),[c,u]=(0,s.useState)("top-airing");(0,s.useEffect)(()=>{d()},[i,c]);const d=async()=>{var e;let n;switch(r(!0),c){case"top-airing":default:n=await yr.topAiring(i);break;case"popular":n=await yr.popular(i);break;case"recent":n=await yr.recentEpisodes(i)}t(n.animes||[]),l((null===(e=n.pageInfo)||void 0===e?void 0:e.totalPages)||1),r(!1),window.scrollTo({top:0,behavior:"smooth"})};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4",children:[(0,Ue.jsxs)("div",{className:"mb-8",children:[(0,Ue.jsx)("h1",{className:"mb-4 text-4xl font-bold",children:"\u2728 Anime Hub"}),(0,Ue.jsx)("p",{className:"mb-4 text-gray-400",children:"Watch the best anime with multiple servers and subtitles"}),(0,Ue.jsx)("div",{className:"flex flex-wrap gap-3",children:[{value:"top-airing",label:"\ud83d\udd25 Top Airing",emoji:"\ud83d\udd25"},{value:"popular",label:"\u2b50 Most Popular",emoji:"\u2b50"},{value:"recent",label:"\ud83c\udd95 Recent Episodes",emoji:"\ud83c\udd95"}].map(e=>(0,Ue.jsxs)("button",{onClick:()=>{u(e.value),a(1)},className:"px-6 py-3 rounded-lg font-semibold transition-all ".concat(c===e.value?"bg-red-600 text-white scale-105":"bg-gray-800 text-gray-300 hover:bg-gray-700"),children:[e.emoji," ",e.label]},e.value))})]}),n?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(18)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):e.length>0?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:e.map(e=>(0,Ue.jsx)(Or,{anime:e},e.id))}),(0,Ue.jsxs)("div",{className:"mt-10 flex items-center justify-center gap-4",children:[(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.max(1,e-1)),disabled:1===i,className:"rounded-lg bg-gray-800 px-6 py-2 font-semibold text-white transition-colors hover:bg-gray-700 disabled:opacity-50",children:"\u2190 Previous"}),(0,Ue.jsxs)("span",{className:"text-lg",children:["Page ",i," of ",Math.min(o,100)]}),(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.min(100,e+1)),disabled:i>=o||i>=100,className:"rounded-lg bg-red-600 px-6 py-2 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50",children:"Next \u2192"})]})]}):(0,Ue.jsx)("div",{className:"py-20 text-center",children:(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No anime found"})})]})})},Mr=()=>{const[e,t]=(0,s.useState)([]),[n,r]=(0,s.useState)(!0),[i,a]=(0,s.useState)(1),[o,l]=(0,s.useState)(1);(0,s.useEffect)(()=>{c()},[i]);const c=async()=>{r(!0);const e=await wr.upcoming(i);t(e.results||[]),l(e.total_pages||1),r(!1),window.scrollTo({top:0,behavior:"smooth"})};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4",children:[(0,Ue.jsxs)("div",{className:"mb-8",children:[(0,Ue.jsx)("h1",{className:"mb-2 text-4xl font-bold",children:"\ud83c\udfac Upcoming Movies"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Coming soon to theaters near you"})]}),n?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(18)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):e.length>0?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:e.map(e=>(0,Ue.jsx)(_r,{movie:e,type:"movie"},e.id))}),(0,Ue.jsxs)("div",{className:"mt-10 flex items-center justify-center gap-4",children:[(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.max(1,e-1)),disabled:1===i,className:"rounded-lg bg-gray-800 px-6 py-2 font-semibold text-white transition-colors hover:bg-gray-700 disabled:opacity-50",children:"\u2190 Previous"}),(0,Ue.jsxs)("span",{className:"text-lg",children:["Page ",i," of ",Math.min(o,500)]}),(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.min(500,e+1)),disabled:i>=o||i>=500,className:"rounded-lg bg-red-600 px-6 py-2 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50",children:"Next \u2192"})]})]}):(0,Ue.jsx)("div",{className:"py-20 text-center",children:(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No upcoming movies found"})})]})})},Fr=()=>{var e,t,n,r,i,a;const{id:o}=oe(),{colors:l}=Jh(),[c,u]=(0,s.useState)(null),[d,h]=(0,s.useState)(!0),[f,g]=(0,s.useState)(!1);(0,s.useEffect)(()=>{p(),window.scrollTo(0,0)},[o]);const p=async()=>{try{h(!0);const e=await wr.details(o,"movie");u(e)}catch(e){console.error("Error fetching movie details:",e)}finally{h(!1)}};if(d)return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20",children:(0,Ue.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-600"})});if(!c)return null;const m=null===(e=c.videos)||void 0===e||null===(t=e.results)||void 0===t?void 0:t.find(e=>"Trailer"===e.type&&"YouTube"===e.site);return(0,Ue.jsxs)("div",{className:"pt-16",children:[(0,Ue.jsxs)("div",{className:"relative h-[80vh]",children:[(0,Ue.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-black/80 to-transparent z-10"}),(0,Ue.jsx)("img",{src:xr(c.backdrop_path,"original"),alt:c.title,className:"w-full h-full object-cover"}),(0,Ue.jsx)("div",{className:"absolute inset-0 z-20 flex items-center",children:(0,Ue.jsx)("div",{className:"container mx-auto px-6",children:(0,Ue.jsxs)("div",{className:"max-w-4xl",children:[(0,Ue.jsx)("h1",{className:"text-5xl md:text-7xl font-bold mb-4",children:c.title}),(0,Ue.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,Ue.jsxs)("span",{className:"bg-yellow-500 text-black px-3 py-1 rounded font-bold text-lg",children:["\u2b50 ",(null===(n=c.vote_average)||void 0===n?void 0:n.toFixed(1))||"N/A"]}),(0,Ue.jsx)("span",{className:"text-gray-300",children:c.release_date?new Date(c.release_date).getFullYear():"N/A"}),(0,Ue.jsxs)("span",{className:"text-gray-300",children:[c.runtime||0," min"]}),(0,Ue.jsx)("span",{className:"text-gray-300",children:(null===(r=c.genres)||void 0===r?void 0:r.map(e=>e.name).join(", "))||"N/A"})]}),(0,Ue.jsx)("p",{className:"text-lg md:text-xl mb-8 text-gray-300 leading-relaxed",children:c.overview||"No description available"}),(0,Ue.jsxs)("div",{className:"flex space-x-4",children:[m&&(0,Ue.jsxs)("button",{onClick:()=>g(!0),className:"bg-red-600 hover:bg-red-700 text-white px-8 py-3 rounded-lg font-semibold flex items-center space-x-2 transition-colors",children:[(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ue.jsx)("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})}),(0,Ue.jsx)("span",{children:"\u25b6 Watch Trailer"})]}),(0,Ue.jsx)("button",{className:"bg-gray-800 hover:bg-gray-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors",children:"\u2795 Add to Watchlist"})]})]})})})]}),f&&m&&(0,Ue.jsx)("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>g(!1),children:(0,Ue.jsxs)("div",{className:"relative w-full max-w-6xl aspect-video",onClick:e=>e.stopPropagation(),children:[(0,Ue.jsx)("button",{onClick:()=>g(!1),className:"absolute -top-12 right-0 text-white hover:text-red-500 text-4xl",children:"\xd7"}),(0,Ue.jsx)("iframe",{src:"https://www.youtube.com/embed/".concat(m.key,"?autoplay=1"),className:"w-full h-full rounded-lg",allowFullScreen:!0,allow:"autoplay"})]})}),(0,Ue.jsxs)("div",{className:"container mx-auto px-6 py-12",children:[(null===(i=c.credits)||void 0===i?void 0:i.cast)&&c.credits.cast.length>0&&(0,Ue.jsxs)("div",{className:"mb-12",children:[(0,Ue.jsx)("h2",{className:"text-3xl font-bold mb-6",children:"\ud83c\udfad Cast"}),(0,Ue.jsx)("div",{className:"flex overflow-x-auto space-x-6 pb-4 scrollbar-hide",children:c.credits.cast.slice(0,10).map(e=>(0,Ue.jsxs)("div",{className:"flex-shrink-0 w-32",children:[(0,Ue.jsx)("img",{src:e.profile_path?xr(e.profile_path,"w185"):"/placeholder-movie.jpg",alt:e.name,className:"w-32 h-48 object-cover rounded-lg mb-2",onError:e=>e.target.src="/placeholder-movie.jpg"}),(0,Ue.jsx)("p",{className:"font-semibold text-sm",children:e.name}),(0,Ue.jsx)("p",{className:"text-xs text-gray-400",children:e.character})]},e.id))})]}),(null===(a=c.similar)||void 0===a?void 0:a.results)&&c.similar.results.length>0&&(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("h2",{className:"text-3xl font-bold mb-6",children:"\ud83c\udfac Similar Movies"}),(0,Ue.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6",children:c.similar.results.slice(0,12).map(e=>{var t;return(0,Ue.jsx)(Oe,{to:"/movie/".concat(e.id),className:"group cursor-pointer",children:(0,Ue.jsxs)("div",{className:"relative overflow-hidden rounded-lg shadow-lg transition-transform group-hover:scale-105",children:[(0,Ue.jsx)("img",{src:xr(e.poster_path,"w342"),alt:e.title,className:"w-full h-auto",onError:e=>e.target.src="/placeholder-movie.jpg"}),(0,Ue.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-4",children:(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("h3",{className:"font-semibold text-sm line-clamp-2",children:e.title}),(0,Ue.jsxs)("p",{className:"text-yellow-500 text-xs mt-1",children:["\u2b50 ",(null===(t=e.vote_average)||void 0===t?void 0:t.toFixed(1))||"N/A"]})]})})]})},e.id)})})]})]})]})},Ur=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},Br=Number.isSafeInteger||function(e){return"number"===typeof e&&Math.abs(e)<=jr},jr=Number.MAX_SAFE_INTEGER||9007199254740991;let Gr=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),Kr=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),Hr=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var Vr="manifest",zr="level",Wr="audioTrack",Yr="subtitleTrack",qr="main",Qr="audio",Xr="subtitle";class $r{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Jr{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new $r(e),this.fast_=new $r(t),this.defaultTTFB_=r,this.ttfb_=new $r(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:i}=this;n.halfLife!==e&&(this.slow_=new $r(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new $r(t,r.getEstimate(),r.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new $r(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){const n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Zr(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ei(){return ei=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ei.apply(null,arguments)}function ti(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ni(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ti(Object(n),!0).forEach(function(t){Zr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ti(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class ri{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n="[".concat(e,"]:");this.trace=ii,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const ii=function(){},si={trace:ii,debug:ii,log:ii,warn:ii,info:ii,error:ii};function ai(){return ei({},si)}function oi(e,t,n){return t[e]?t[e].bind(t):function(e,t){const n=self.console[e];return n?n.bind(self.console,"".concat(t?"["+t+"] ":"","[").concat(e,"] >")):ii}(e,n)}const li=ai();const ci=li;function ui(){if("undefined"===typeof self)return;return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function di(e,t){const n=Object.keys(e),r=Object.keys(t),i=n.length,s=r.length;return!i||!s||i===s&&!n.some(e=>-1===r.indexOf(e))}function hi(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("undefined"!==typeof TextDecoder){const n=new TextDecoder("utf-8").decode(e);if(t){const e=n.indexOf("\0");return-1!==e?n.substring(0,e):n}return n.replace(/\0/g,"")}const n=e.length;let r,i,s,a="",o=0;for(;o<n;){if(r=e[o++],0===r&&t)return a;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:i=e[o++],a+=String.fromCharCode((31&r)<<6|63&i);break;case 14:i=e[o++],s=e[o++],a+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&s)}}return a}function fi(e){let t="";for(let n=0;n<e.length;n++){let r=e[n].toString(16);r.length<2&&(r="0"+r),t+=r}return t}function gi(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function pi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var mi,vi={exports:{}};var yi=function(){return mi||(mi=1,e=vi,function(){var t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var i=s.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=s.normalizePath(i.path),s.buildURLFromParts(i)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=n.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var c={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var u=o.path,d=u.substring(0,u.lastIndexOf("/")+1)+a.path;c.path=s.normalizePath(d)}else c.path=o.path,a.params||(c.params=o.params,a.query||(c.query=o.query));return null===c.path&&(c.path=r.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(c)},parseURL:function(e){var n=t.exec(e);return n?{scheme:n[1]||"",netLoc:n[2]||"",path:n[3]||"",params:n[4]||"",query:n[5]||"",fragment:n[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(i,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s}()),vi.exports;var e}();class Ei{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var bi="audio",Si="video",Ti="audiovideo";class ki{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"===typeof e&&(e={url:e}),this.base=e,function(e,t){const n=Ai(e,t);n&&(n.enumerable=!0,Object.defineProperty(e,t,n))}(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;r=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[bi]:null,[Si]:null,[Ti]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new Ei),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=yi.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[bi]=null,e[Si]=null,e[Ti]=null}}function xi(e){return"initSegment"!==e.sn}class wi extends ki{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ur(e)&&Ur(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(null==(e=this._decryptdata)||!e.keyId){const e=Object.keys(t);if(1===e.length){const n=this._decryptdata=t[e[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=Ur(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t;const e=Object.keys(this.levelkeys),n=e.length;if(n>1||1===n&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){Ur(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return xi(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const r=t[e];!r||null!=(n=this._decryptdata)&&n.keyId||(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,i)):a[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:i,partial:s}}}class Li extends ki{constructor(e,t,n,r,i){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const s=e.enumeratedString("BYTERANGE");s&&this.setByteRange(s,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Ai(e,t){const n=Object.getPrototypeOf(e);if(n){const e=Object.getOwnPropertyDescriptor(n,t);return e||Ai(n,t)}}const Ri=Math.pow(2,32)-1,Ii=[].push,_i={video:1,audio:2,id3:3,text:4};function Di(e){return String.fromCharCode.apply(null,e)}function Pi(e,t){const n=e[t]<<8|e[t+1];return n<0?65536+n:n}function Ci(e,t){const n=Ni(e,t);return n<0?4294967296+n:n}function Oi(e,t){let n=Ci(e,t);return n*=Math.pow(2,32),n+=Ci(e,t+4),n}function Ni(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Mi(e,t){const n=[];if(!t.length)return n;const r=e.byteLength;for(let i=0;i<r;){const s=Ci(e,i),a=s>1?i+s:r;if(Di(e.subarray(i+4,i+8))===t[0])if(1===t.length)n.push(e.subarray(i+8,a));else{const r=Mi(e.subarray(i+8,a),t.slice(1));r.length&&Ii.apply(n,r)}i=a}return n}function Fi(e){const t=[],n=e[0];let r=8;const i=Ci(e,r);r+=4;let s=0,a=0;0===n?(s=Ci(e,r),a=Ci(e,r+4),r+=8):(s=Oi(e,r),a=Oi(e,r+8),r+=16),r+=2;let o=e.length+a;const l=Pi(e,r);r+=2;for(let c=0;c<l;c++){let n=r;const s=Ci(e,n);n+=4;const a=2147483647&s;if(1===(2147483648&s)>>>31)return ci.warn("SIDX has hierarchical references (not supported)"),null;const l=Ci(e,n);n+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/i,start:o,end:o+a-1}}),o+=a,n+=4,r=n}return{earliestPresentationTime:s,timescale:i,version:n,referencesCount:l,references:t}}function Ui(e){const t=[],n=Mi(e,["moov","trak"]);for(let r=0;r<n.length;r++){const e=n[r],i=Mi(e,["tkhd"])[0];if(i){let n=i[0];const r=Ci(i,0===n?12:20),s=Mi(e,["mdia","mdhd"])[0];if(s){n=s[0];const i=Ci(s,0===n?12:20),a=Mi(e,["mdia","hdlr"])[0];if(a){const n=Di(a.subarray(8,12)),s={soun:bi,vide:Si}[n],o=Bi(Mi(e,["mdia","minf","stbl","stsd"])[0]);s?(t[r]={timescale:i,type:s,stsd:o},t[s]=ni({timescale:i,id:r},o)):t[r]={timescale:i,type:n,stsd:o}}}}}return Mi(e,["moov","mvex","trex"]).forEach(e=>{const n=Ci(e,4),r=t[n];r&&(r.default={duration:Ci(e,12),flags:Ci(e,20)})}),t}function Bi(e){const t=e.subarray(8),n=t.subarray(86),r=Di(t.subarray(4,8));let i,s=r;const a="enca"===r||"encv"===r;if(a){const e=Mi(t,[r])[0];Mi(e.subarray("enca"===r?28:78),["sinf"]).forEach(e=>{const t=Mi(e,["schm"])[0];if(t){const n=Di(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=Mi(e,["frma"])[0];t&&(s=Di(t))}}})}const o=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const e=Mi(n,["avcC"])[0];e&&e.length>3&&(s+="."+Ki(e[1])+Ki(e[2])+Ki(e[3]),i=ji("avc1"===o?"dva1":"dvav",n));break}case"mp4a":{const e=Mi(t,[r])[0],n=Mi(e.subarray(28),["esds"])[0];if(n&&n.length>7){let e=4;if(3!==n[e++])break;e=Gi(n,e),e+=2;const t=n[e++];if(128&t&&(e+=2),64&t&&(e+=n[e++]),4!==n[e++])break;e=Gi(n,e);const r=n[e++];if(64!==r)break;if(s+="."+Ki(r),e+=12,5!==n[e++])break;e=Gi(n,e);const i=n[e++];let a=(248&i)>>3;31===a&&(a+=1+((7&i)<<3)+((224&n[e])>>5)),s+="."+a}break}case"hvc1":case"hev1":{const e=Mi(n,["hvcC"])[0];if(e&&e.length>12){const t=e[1],n=["","A","B","C"][t>>6],r=31&t,i=Ci(e,2),a=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);s+="."+n+r,s+="."+function(e){let t=0;for(let n=0;n<32;n++)t|=(e>>n&1)<<31-n;return t>>>0}(i).toString(16).toUpperCase(),s+="."+a+o;let c="";for(let e=l.length;e--;){const t=l[e];if(t||c){c="."+t.toString(16).toUpperCase()+c}}s+=c}i=ji("hev1"==o?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":s=ji(s,n)||s;break;case"vp09":{const e=Mi(n,["vpcC"])[0];if(e&&e.length>6){const t=e[4],n=e[5],r=e[6]>>4&15;s+="."+Hi(t)+"."+Hi(n)+"."+Hi(r)}break}case"av01":{const e=Mi(n,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,r=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,c=2===t&&o?l?12:10:o?10:8,u=(16&e[2])>>4,d=(8&e[2])>>3,h=(4&e[2])>>2,f=3&e[2],g=1,p=1,m=1,v=0;s+="."+t+"."+Hi(r)+a+"."+Hi(c)+"."+u+"."+d+h+f+"."+Hi(g)+"."+Hi(p)+"."+Hi(m)+"."+v,i=ji("dav1",n)}break}}return{codec:s,encrypted:a,supplemental:i}}function ji(e,t){const n=Mi(t,["dvvC"]),r=n.length?n[0]:Mi(t,["dvcC"])[0];if(r){const t=r[2]>>1&127,n=r[2]<<5&32|r[3]>>3&31;return e+"."+Hi(t)+"."+Hi(n)}}function Gi(e,t){const n=t+5;for(;128&e[t++]&&t<n;);return t}function Ki(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function Hi(e){return(e<10?"0":"")+e}function Vi(e,t){Mi(e,["moov","trak"]).forEach(e=>{const n=Mi(e,["mdia","minf","stbl","stsd"])[0];if(!n)return;const r=n.subarray(8);let i=Mi(r,["enca"]);const s=i.length>0;s||(i=Mi(r,["encv"])),i.forEach(e=>{Mi(s?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{const n=zi(e);n&&t(n,s)})})})}function zi(e){const t=Mi(e,["schm"])[0];if(t){const n=Di(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=Mi(e,["schi","tenc"])[0];if(t)return t}}}function Wi(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function Yi(e,t){const n=[],r=t.samples,i=t.timescale,s=t.id;let a=!1;return Mi(r,["moof"]).map(o=>{const l=o.byteOffset-8;Mi(o,["traf"]).map(o=>{const c=Mi(o,["tfdt"]).map(e=>{const t=e[0];let n=Ci(e,4);return 1===t&&(n*=Math.pow(2,32),n+=Ci(e,8)),n/i})[0];return void 0!==c&&(e=c),Mi(o,["tfhd"]).map(c=>{const u=Ci(c,4),d=16777215&Ci(c,0);let h=0;const f=0!==(16&d);let g=0;const p=0!==(32&d);let m=8;u===s&&(0!==(1&d)&&(m+=8),0!==(2&d)&&(m+=4),0!==(8&d)&&(h=Ci(c,m),m+=4),f&&(g=Ci(c,m),m+=4),p&&(m+=4),"video"===t.type&&(a=qi(t.codec)),Mi(o,["trun"]).map(s=>{const o=s[0],c=16777215&Ci(s,0),u=0!==(1&c);let d=0;const f=0!==(4&c),p=0!==(256&c);let m=0;const v=0!==(512&c);let y=0;const E=0!==(1024&c),b=0!==(2048&c);let S=0;const T=Ci(s,4);let k=8;u&&(d=Ci(s,k),k+=4),f&&(k+=4);let x=d+l;for(let l=0;l<T;l++){if(p?(m=Ci(s,k),k+=4):m=h,v?(y=Ci(s,k),k+=4):y=g,E&&(k+=4),b&&(S=0===o?Ci(s,k):Ni(s,k),k+=4),t.type===Si){let t=0;for(;t<y;){const s=Ci(r,x);if(x+=4,Qi(a,r[x])){Xi(r.subarray(x,x+s),a?2:1,e+S/i,n)}x+=s,t+=s+4}}e+=m/i}}))})})}),n}function qi(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function Qi(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function Xi(e,t,n,r){const i=$i(e);let s=0;s+=t;let a=0,o=0,l=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;l=i[s++],a+=l}while(255===l);o=0;do{if(s>=i.length)break;l=i[s++],o+=l}while(255===l);const e=i.length-s;let t=s;if(o<e)s+=o;else if(o>e){ci.error("Malformed SEI payload. ".concat(o," is too small, only ").concat(e," bytes left to parse."));break}if(4===a){if(181===i[t++]){const e=Pi(i,t);if(t+=2,49===e){const e=Ci(i,t);if(t+=4,1195456820===e){const e=i[t++];if(3===e){const s=i[t++],o=64&s,l=o?2+3*(31&s):0,c=new Uint8Array(l);if(o){c[0]=s;for(let e=1;e<l;e++)c[e]=i[t++]}r.push({type:e,payloadType:a,pts:n,bytes:c})}}}}}else if(5===a&&o>16){const e=[];for(let n=0;n<16;n++){const r=i[t++].toString(16);e.push(1==r.length?"0"+r:r),3!==n&&5!==n&&7!==n&&9!==n||e.push("-")}const s=o-16,l=new Uint8Array(s);for(let n=0;n<s;n++)l[n]=i[t++];r.push({payloadType:a,pts:n,uuid:e.join(""),userData:hi(l),userDataBytes:l})}}}function $i(e){const t=e.byteLength,n=[];let r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;const i=t-n.length,s=new Uint8Array(i);let a=0;for(r=0;r<i;a++,r++)a===n[0]&&(a++,n.shift()),s[r]=e[a];return s}function Ji(e,t,n){if(16!==e.byteLength)throw new RangeError("Invalid system id");let r,i,s;r=0,i=new Uint8Array,s=new Uint8Array;const a=new Uint8Array(4);return n.byteLength>0&&new DataView(a.buffer).setUint32(0,n.byteLength,!1),function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.length;let s=8,a=i;for(;a--;)s+=n[a].byteLength;const o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=255&s,o.set(e,4),a=0,s=8;a<i;a++)o.set(n[a],s),s+=n[a].byteLength;return o}([112,115,115,104],new Uint8Array([0,0,0,0]),e,s,i,a,n)}function Zi(e){const t=e.getUint32(0),n=e.byteOffset,r=e.byteLength;if(r<t)return{offset:n,size:r};if(1886614376!==e.getUint32(4))return{offset:n,size:t};const i=e.getUint32(8)>>>24;if(0!==i&&1!==i)return{offset:n,size:t};const s=e.buffer,a=fi(new Uint8Array(s,n+12,16));let o=null,l=null,c=0;if(0===i)c=28;else{const i=e.getUint32(28);if(!i||r<32+16*i)return{offset:n,size:t};o=[];for(let e=0;e<i;e++)o.push(new Uint8Array(s,n+32+16*e,16));c=32+16*i}if(!c)return{offset:n,size:t};const u=e.getUint32(c);return t-32<u?{offset:n,size:t}:(l=new Uint8Array(s,n+c+4,u),{version:i,systemId:a,kids:o,data:l,offset:n,size:t})}const es=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ts={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ns(e,t){const n=ts[t];return!!n&&!!n[e.slice(0,4)]}function rs(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!e.split(",").some(e=>!is(e,t,n))}function is(e,t){var n;const r=ui(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);return null!=(n=null==r?void 0:r.isTypeSupported(ss(e,t)))&&n}function ss(e,t){return"".concat(t,"/mp4;codecs=").concat(e)}function as(e){if(e){const t=e.substring(0,4);return ts.video[t]}return 2}function os(e){const t=es();return e.split(",").reduce((e,n)=>{const r=t&&qi(n)?9:ts.video[n];return r?(2*r+e)/(e?3:2):(ts.audio[n]+e)/(e?2:1)},0)}const ls={};const cs=/flac|opus|mp4a\.40\.34/i;function us(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(cs,e=>function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(ls[e])return ls[e];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let i=0;i<n.length;i++){var r;if(is(n[i],"audio",t))return ls[e]=n[i],n[i];if("mp3"===n[i]&&null!=(r=ui(t))&&r.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t))}function ds(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(hs(e,"audio")||hs(e,"video")))return e;if(t){const n=t.split(",");if(n.length>1){if(e)for(let t=n.length;t--;)if(n[t].substring(0,4)===e.substring(0,4))return n[t];return n[0]}}return t||e}function hs(e,t){return ns(e,t)&&is(e,t)}function fs(e){if(e.startsWith("av01.")){const t=e.split("."),n=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=n[e-4];return t.join(".")}return e}function gs(e){const t=ui(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function ps(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const ms={supported:!1,smooth:!1,powerEfficient:!1},vs={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function ys(e,t){return{supported:!1,configurations:t,decodingInfoResults:[ms],error:e}}function Es(e,t,n,r,i,s){const a=e.videoCodec,o=e.audioCodec?e.audioGroups:null,l=null==s?void 0:s.audioCodec,c=null==s?void 0:s.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(null!=o&&o.length)try{d=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce((e,n)=>{if(n){const r=t.groups[n];if(!r)throw new Error("Audio track group ".concat(n," not found"));Object.keys(r.channels).forEach(t=>{e[t]=(e[t]||0)+r.channels[t]})}return e},{2:0})}catch(h){return!0}return void 0!==a&&(a.split(",").some(e=>qi(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(r,30)||"SDR"!==e.videoRange&&e.videoRange!==n||e.bitrate>Math.max(i,8e6))||!!d&&Ur(u)&&Object.keys(d).some(e=>parseInt(e)>u)}function bs(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=e.videoCodec;if(!i&&!e.audioCodec||!n)return Promise.resolve(vs);const s=[],a=function(e){var t;const n=null==(t=e.videoCodec)?void 0:t.split(","),r=Ts(e),i=e.width||640,s=e.height||480,a=e.frameRate||30,o=e.videoRange.toLowerCase();return n?n.map(e=>{const t={contentType:ss(fs(e),"video"),width:i,height:s,bitrate:r,framerate:a};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=a.length,l=function(e,t,n){var r;const i=null==(r=e.audioCodec)?void 0:r.split(","),s=Ts(e);if(i&&e.audioGroups)return e.audioGroups.reduce((e,r)=>{var a;const o=r?null==(a=t.groups[r])?void 0:a.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===r){const r=parseFloat(t.channels||"");i.forEach(t=>{const i={contentType:ss(t,"audio"),bitrate:n?Ss(t,s):s};r&&(i.channels=""+r),e.push(i)})}return e},e):e},[]);return[]}(e,t,o>0),c=l.length;for(let u=o||1*c||1;u--;){const e={type:"media-source"};if(o&&(e.video=a[u%o]),c){e.audio=l[u%c];const t=e.audio.bitrate;e.video&&t&&(e.video.bitrate-=t)}s.push(e)}if(i){const e=navigator.userAgent;if(i.split(",").some(e=>qi(e))&&es())return Promise.resolve(ys(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(e,")")),s))}return Promise.all(s.map(e=>{const t=function(e){let t="";const{audio:n,video:r}=e;if(r){const e=ps(r.contentType);t+="".concat(e,"_r").concat(r.height,"x").concat(r.width,"f").concat(Math.ceil(r.framerate)).concat(r.transferFunction||"sd","_").concat(Math.ceil(r.bitrate/1e5))}if(n){const e=ps(n.contentType);t+="".concat(r?"_":"").concat(e,"_c").concat(n.channels)}return t}(e);return r[t]||(r[t]=n.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:s,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:s,decodingInfoResults:[],error:e}))}function Ss(e,t){if(t<=1)return 1;let n=128e3;return"ec-3"===e?n=768e3:"ac-3"===e&&(n=64e4),Math.min(t/2,n)}function Ts(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}const ks=["NONE","TYPE-0","TYPE-1",null];const xs=["SDR","PQ","HLG"];var ws="",Ls="YES",As="v2";function Rs(e){const{canSkipUntil:t,canSkipDateRanges:n,age:r}=e;return t&&r<t/2?n?As:Ls:ws}class Is{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class _s{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=null==(t=e.supplemental)?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=",".concat(n.substring(0,4)))}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Ds(this._audioGroups,e)}hasSubtitleGroup(e){return Ds(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function Ds(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Ps(e,t){let n=!1,r=[];if(e&&(n="SDR"!==e,r=[e]),t){r=t.allowedVideoRanges||xs.slice(0);const e="SDR"!==r.join("")&&!t.videoCodec;n=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"===typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),n||(r=["SDR"])}return{preferHDR:n,allowedVideoRanges:r}}const Cs=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(n,r)=>{if(e&&(r=e(n,r)),"object"===typeof r&&null!==r){if(t.has(r))return;t.add(r)}return r}})(t));function Os(e,t){ci.log('[abr] start candidates with "'.concat(e,'" ignored because ').concat(t))}function Ns(e){return e.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Ms(e){if(!e)return e;const{lang:t,assocLang:n,characteristics:r,channels:i,audioCodec:s}=e;return{lang:t,assocLang:n,characteristics:r,channels:i,audioCodec:s}}function Fs(e,t,n){if("attrs"in e){const n=t.indexOf(e);if(-1!==n)return n}for(let r=0;r<t.length;r++){if(Us(e,t[r],n))return r}return-1}function Us(e,t,n){const{groupId:r,name:i,lang:s,assocLang:a,default:o}=e,l=e.forced;return(void 0===r||t.groupId===r)&&(void 0===i||t.name===i)&&(void 0===s||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--";if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(s,t.lang))&&(void 0===s||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split(","),r=t.split(",");return n.length===r.length&&!n.some(e=>-1===r.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===n||n(e,t))}function Bs(e,t){const{audioCodec:n,channels:r}=e;return(void 0===n||(t.audioCodec||"").substring(0,4)===n.substring(0,4))&&(void 0===r||r===(t.channels||"2"))}function js(e,t,n){for(let r=t;r>-1;r--)if(n(e[r]))return r;for(let r=t+1;r<e.length;r++)if(n(e[r]))return r;return-1}function Gs(e,t){var n;return!!e&&e!==(null==(n=t.loadLevelObj)?void 0:n.uri)}const Ks=function(e,t){let n=0,r=e.length-1,i=null,s=null;for(;n<=r;){i=(n+r)/2|0,s=e[i];const a=t(s);if(a>0)n=i+1;else{if(!(a<0))return s;r=i-1}}return null};function Hs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,s=null;if(e){s=t[1+e.sn-t[0].sn]||null;const r=e.endDTS-n;r>0&&r<15e-7&&(n+=15e-7),s&&e.level!==s.level&&s.end<=e.end&&(s=t[2+e.sn-t[0].sn]||null)}else 0===n&&0===t[0].start&&(s=t[0]);if(s&&((!e||e.level===s.level)&&0===Vs(n,r,s)||function(e,t,n){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const r=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),n);return e.start<=r}return!1}(s,e,Math.min(i,r))))return s;const a=Ks(t,Vs.bind(null,n,r));return!a||a===e&&s?s:a}function Vs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(n.start<=e&&n.start+n.duration>e)return 0;const r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function zs(e,t,n){const r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}function Ws(e,t,n){if(e&&e.startCC<=t&&e.endCC>=t){let r=e.fragments;const{fragmentHint:i}=e;let s;return i&&(r=r.concat(i)),Ks(r,e=>e.cc<t?1:e.cc>t?-1:(s=e,e.end<=n?1:e.start>n?-1:0)),s||null}return null}function Ys(e){switch(e.details){case Kr.FRAG_LOAD_TIMEOUT:case Kr.KEY_LOAD_TIMEOUT:case Kr.LEVEL_LOAD_TIMEOUT:case Kr.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function qs(e){return e.details.startsWith("key")}function Qs(e){return qs(e)&&!!e.frag&&!e.frag.decryptdata}function Xs(e,t){const n=Ys(t);return e.default["".concat(n?"timeout":"error","Retry")]}function $s(e,t){const n="linear"===e.backoff?1:Math.pow(2,t);return Math.min(n*e.retryDelayMs,e.maxRetryDelayMs)}function Js(e){return ni(ni({},e),{errorRetry:null,timeoutRetry:null})}function Zs(e,t,n,r){if(!e)return!1;const i=null==r?void 0:r.code,s=t<e.maxNumRetry&&(function(e){return ea(e)||!!e&&(e<400||e>499)}(i)||!!n);return e.shouldRetry?e.shouldRetry(e,t,n,r,s):s}function ea(e){return 0===e&&!1===navigator.onLine}var ta=0,na=2,ra=3,ia=5,sa=0,aa=1,oa=2,la=4;function ca(e){const t={action:ta,flags:sa};return e&&(t.resolved=!0),t}var ua="NOT_LOADED",da="APPENDING",ha="PARTIAL",fa="OK";class ga{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Hr.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Hr.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Hr.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Hr.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let r=n.length;r--;){const t=n[r];if(!t)break;if(t.start<=e&&e<=t.end&&t.loaded)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,i=Object.keys(r);for(let s=i.length;s--;){const a=r[i[s]];if((null==a?void 0:a.body.type)===t&&(!n||a.buffered)){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,n,r,i){this.timeRanges&&(this.timeRanges[e]=t);const s=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(r=>{const a=this.fragments[r];if(!a)return;if(s>=a.body.sn)return;if(!a.buffered&&(!a.loaded||i))return void(a.body.type===n&&this.removeFragment(a.body));const o=a.range[e];o&&(0!==o.time.length?o.time.some(e=>{const n=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&this.removeFragment(a.body),n}):this.removeFragment(a.body))})}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const n=e.frag,r=ma(n),i=this.fragments[r];if(!i||i.buffered&&n.gap)return;const s=!n.relurl;Object.keys(t).forEach(r=>{const a=n.elementaryStreams[r];if(!a)return;const o=t[r],l=s||!0===a.partial;i.range[r]=this.getBufferedTimes(n,e.part,l,o)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,n),pa(i)||this.removeParts(n.sn-1,n.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0;(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=va(n,t=>t.fragment.sn>=e))}fragBuffered(e,t){const n=ma(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,n,r){const i={time:[],partial:n},s=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||s;for(let c=0;c<r.length;c++){const e=r.start(c)-this.bufferPadding,t=r.end(c)+this.bufferPadding;if(l>=e&&o<=t){i.time.push({startPTS:Math.max(s,r.start(c)),endPTS:Math.min(a,r.end(c))});break}if(s<t&&a>e){const e=Math.max(s,r.start(c)),t=Math.min(a,r.end(c));t>e&&(i.partial=!0,i.time.push({startPTS:e,endPTS:t}))}else if(a<=e)break}return i}getPartialFragment(e){let t,n,r,i=null,s=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const c=o[l];c&&pa(c)&&(n=c.body.start-a,r=c.body.end+a,e>=n&&e<=r&&(t=Math.min(e-n,r-e),s<=t&&(i=c.body,s=t)))}),i}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||pa(t))}getState(e){const t=ma(e),n=this.fragments[t];return n?n.buffered?pa(n)?ha:fa:da:ua}isTimeBuffered(e,t,n){let r,i;for(let s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,i=ma(n);this.fragments[i]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:i,type:s}=t;if("initSegment"===n.sn)return;const a=n.type;if(r){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(r)}this.timeRanges=i;const o=i[s];this.detectEvictedFragments(s,o,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ma(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const i=t[n[r]];if((null==i?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,n,r,i){r&&!this.hasGaps||Object.keys(this.fragments).forEach(s=>{const a=this.fragments[s];if(!a)return;const o=a.body;o.type!==n||r&&!o.gap||o.start<t&&o.end>e&&(a.buffered||i)&&this.removeFragment(o)})}removeFragment(e){const t=ma(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const t=e.sn;this.activePartLists[e.type]=va(n,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function pa(e){var t,n,r;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(n=e.range.audio)&&n.partial||null!=(r=e.range.audiovideo)&&r.partial)}function ma(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.sn)}function va(e,t){return e.filter(e=>{const n=t(e);return n||e.clearElementaryStreamInfo(),n})}var ya=0,Ea=1;class ba{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case ya:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ea:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error("[AESCrypto] invalid aes mode ".concat(this.aesMode))}}}class Sa{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=t.getUint32(4*r);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],s=n[2],a=n[3],o=this.invSubMix,l=o[0],c=o[1],u=o[2],d=o[3],h=new Uint32Array(256);let f=0,g=0,p=0;for(p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){let n=g^g<<1^g<<2^g<<3^g<<4;n=n>>>8^255&n^99,e[f]=n,t[n]=f;const o=h[f],p=h[o],m=h[p];let v=257*h[n]^16843008*n;r[f]=v<<24|v>>>8,i[f]=v<<16|v>>>16,s[f]=v<<8|v>>>24,a[f]=v,v=16843009*m^65537*p^257*o^16843008*f,l[n]=v<<24|v>>>8,c[n]=v<<16|v>>>16,u[n]=v<<8|v>>>24,d[n]=v,f?(f=o^h[h[h[m^o]]],g^=h[h[g]]):f=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);const s=this.ksRows=4*(i+6+1);let a,o;const l=this.keySchedule=new Uint32Array(s),c=this.invKeySchedule=new Uint32Array(s),u=this.sBox,d=this.rcon,h=this.invSubMix,f=h[0],g=h[1],p=h[2],m=h[3];let v,y;for(a=0;a<s;a++)a<i?v=l[a]=t[a]:(y=v,a%i===0?(y=y<<8|y>>>24,y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y],y^=d[a/i|0]<<24):i>6&&a%i===4&&(y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y]),l[a]=v=(l[a-i]^y)>>>0);for(o=0;o<s;o++)a=s-o,y=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?y:f[u[y>>>24]]^g[u[y>>>16&255]]^p[u[y>>>8&255]]^m[u[255&y]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,i=this.invKeySchedule,s=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],u=a[3],d=this.uint8ArrayToUint32Array_(n);let h=d[0],f=d[1],g=d[2],p=d[3];const m=new Int32Array(e),v=new Int32Array(m.length);let y,E,b,S,T,k,x,w,L,A,R,I,_,D;const P=this.networkToHostOrderSwap;for(;t<m.length;){for(L=P(m[t]),A=P(m[t+1]),R=P(m[t+2]),I=P(m[t+3]),T=L^i[0],k=I^i[1],x=R^i[2],w=A^i[3],_=4,D=1;D<r;D++)y=o[T>>>24]^l[k>>16&255]^c[x>>8&255]^u[255&w]^i[_],E=o[k>>>24]^l[x>>16&255]^c[w>>8&255]^u[255&T]^i[_+1],b=o[x>>>24]^l[w>>16&255]^c[T>>8&255]^u[255&k]^i[_+2],S=o[w>>>24]^l[T>>16&255]^c[k>>8&255]^u[255&x]^i[_+3],T=y,k=E,x=b,w=S,_+=4;y=s[T>>>24]<<24^s[k>>16&255]<<16^s[x>>8&255]<<8^s[255&w]^i[_],E=s[k>>>24]<<24^s[x>>16&255]<<16^s[w>>8&255]<<8^s[255&T]^i[_+1],b=s[x>>>24]<<24^s[w>>16&255]<<16^s[T>>8&255]<<8^s[255&k]^i[_+2],S=s[w>>>24]<<24^s[T>>16&255]<<16^s[k>>8&255]<<8^s[255&x]^i[_+3],v[t]=P(y^h),v[t+1]=P(S^f),v[t+2]=P(b^g),v[t+3]=P(E^p),h=L,f=A,g=R,p=I,t+=4}return v.buffer}}class Ta{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=function(e){switch(e){case ya:return"AES-CBC";case Ea:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode ".concat(e))}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class ka{constructor(e){let{removePKCS7Padding:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(rf){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?e.slice(0,t-n):e}(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((i,s)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,r);const o=this.flush();o?i(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:i,currentResult:s,remainderData:a}=this;if(r!==ya||16!==t.byteLength)return ci.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Wi(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;i&&(n=i);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new Sa),l.expandKey(t);const c=s;return this.currentResult=l.decrypt(o.buffer,0,n),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new Ta(this.subtle,t,r)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new ba(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,t)}).catch(i=>(ci.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(i.name,": ").concat(i.message)),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const i=this.flush();if(i)return i.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%16;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(ci.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}const xa=Math.pow(2,17);class wa{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Ra({type:Gr.NETWORK_ERROR,details:Kr.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a ".concat(n?"part list":"url")),networkDetails:null}));this.abort();const r=this.config,i=r.fLoader,s=r.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void o(Aa(e));e.gap=!1}const l=this.loader=i?new i(r):new s(r),c=La(e);e.loader=l;const u=Js(r.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:xa};e.stats=l.stats;const h={onSuccess:(t,n,r,i)=>{this.resetLoader(e,l);let s=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),a({frag:e,part:null,payload:s,networkDetails:i})},onError:(t,r,i,s)=>{this.resetLoader(e,l),o(new Ra({type:Gr.NETWORK_ERROR,details:Kr.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ni({url:n,data:void 0},t),error:new Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:i,stats:s}))},onAbort:(t,n,r)=>{this.resetLoader(e,l),o(new Ra({type:Gr.NETWORK_ERROR,details:Kr.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:(t,n,r)=>{this.resetLoader(e,l),o(new Ra({type:Gr.NETWORK_ERROR,details:Kr.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:r,stats:t}))}};t&&(h.onProgress=(n,r,i,s)=>t({frag:e,part:null,payload:i,networkDetails:s})),l.load(c,d,h)})}loadPart(e,t,n){this.abort();const r=this.config,i=r.fLoader,s=r.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(Aa(e,t));const l=this.loader=i?new i(r):new s(r),c=La(e,t);e.loader=l;const u=Js(r.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:xa};t.stats=l.stats,l.load(c,d,{onSuccess:(r,i,s,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:r.data,networkDetails:o};n(c),a(c)},onError:(n,r,i,s)=>{this.resetLoader(e,l),o(new Ra({type:Gr.NETWORK_ERROR,details:Kr.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ni({url:c.url,data:void 0},n),error:new Error("HTTP Error ".concat(n.code," ").concat(n.text)),networkDetails:i,stats:s}))},onAbort:(n,r,i)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new Ra({type:Gr.NETWORK_ERROR,details:Kr.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:i,stats:n}))},onTimeout:(n,r,i)=>{this.resetLoader(e,l),o(new Ra({type:Gr.NETWORK_ERROR,details:Kr.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:i,stats:n}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,i=r.total;if(n.loaded+=r.loaded,i){const r=Math.round(e.duration/t.duration),s=Math.min(Math.round(n.loaded/i),r),a=(r-s)*Math.round(n.loaded/s);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);const s=n.loading,a=r.loading;s.start?s.first+=a.first-a.start:(s.start=a.start,s.first=a.first),s.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function La(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},i=n.byteRangeStartOffset,s=n.byteRangeEndOffset;if(Ur(i)&&Ur(s)){var a;let t=i,n=s;if("initSegment"===e.sn&&("AES-128"===(o=null==(a=e.decryptdata)?void 0:a.method)||"AES-256"===o)){const e=s-i;e%16&&(n=s+(16-e%16)),0!==i&&(r.resetIV=!0,t=i-16)}r.rangeStart=t,r.rangeEnd=n}var o;return r}function Aa(e,t){const n=new Error("GAP ".concat(e.gap?"tag":"attribute"," found")),r={type:Gr.MEDIA_ERROR,details:Kr.FRAG_GAP,fatal:!1,frag:e,error:n,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new Ra(r)}class Ra extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Ia extends ri{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class _a{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=i,this.partial=s}}const Da={length:0,start:()=>0,end:()=>0};class Pa{static isBuffered(e,t){if(e){const n=Pa.getBuffered(e);for(let e=n.length;e--;)if(t>=n.start(e)&&t<=n.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Pa.getBuffered(e);return Pa.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=Pa.bufferedRanges(e);if(r.length)return Pa.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let r=-1,i=[];if(n)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(r=c);const s=i.length;if(s){const t=i[s-1].end;e[c].start-t<n?e[c].end>t&&(i[s-1].end=e[c].end):i.push(e[c])}else i.push(e[c])}else i=e;let s,a=0,o=t,l=t;for(let c=0;c<i.length;c++){const e=i[c].start,u=i[c].end;if(-1===r&&t>=e&&t<=u&&(r=c),t+n>=e&&t<u)o=e,l=u,a=l-t;else if(t+n<e){s=e;break}}return{len:a,start:o||0,end:l||0,nextStart:s,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||Da}catch(rf){return ci.log("failed to get media.buffered",rf),Da}}}const Ca=/\{\$([a-zA-Z0-9-_]+)\}/g;function Oa(e){return Ca.test(e)}function Na(e,t){if(null!==e.variableList||e.hasVariableRefs){const n=e.variableList;return t.replace(Ca,t=>{const r=t.substring(2,t.length-1),i=null==n?void 0:n[r];return void 0===i?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(r,'"'))),t):i})}return t}function Ma(e,t,n){let r,i,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{const e=new self.URL(n).searchParams;if(!e.has(r))throw new Error('"'.concat(r,'" does not match any query parameter in URI: "').concat(n,'"'));i=e.get(r)}catch(a){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(a.message)))}}else r=t.NAME,i=t.VALUE;r in s?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(r,'"'))):s[r]=i||""}function Fa(e,t,n){const r=t.IMPORT;if(n&&r in n){let t=e.variableList;t||(e.variableList=t={}),t[r]=n[r]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(r,'"')))}const Ua=/^(\d+)x(\d+)$/,Ba=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ja{constructor(e,t){"string"===typeof e&&(e=ja.parseAttrList(e,t)),ei(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const n=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)n[e]=parseInt(t.slice(2*e,2*e+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=Ua.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={};for(Ba.lastIndex=0;null!==(n=Ba.exec(e));){const i=n[1].trim();let s=n[2];const a=0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1;let o=!1;if(a)s=s.slice(1,-1);else switch(i){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(a||o))s=Na(t,s);else if(!o&&!a)switch(i){case"CLOSED-CAPTIONS":if("NONE"===s)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":ci.warn("".concat(e,": attribute ").concat(i," is missing quotes"))}r[i]=s}return r}}function Ga(e){return"ID"!==e&&"CLASS"!==e&&"CUE"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function Ka(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class Ha{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(r=null==t?void 0:t.tagOrder)?r:n,t){const n=t.attr;for(const t in n)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==n[t]){ci.warn('DATERANGE tag attribute: "'.concat(t,'" does not match for tags with ID: "').concat(e.ID,'"')),this._badValueForSameId=t;break}e=ei(new ja({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Ur(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(ci.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id,'": ').concat(e)),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ur(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&Ur(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class Va{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return!!this.fragments.length&&Ur(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function za(e,t){return e.length===t.length&&!e.some((e,n)=>e!==t[n])}function Wa(e,t){return!e&&!t||!(!e||!t)&&za(e,t)}function Ya(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function qa(e){switch(e){case"AES-128":case"AES-256":return ya;case"AES-256-CTR":return Ea;default:throw new Error("invalid full segment method ".concat(e))}}function Qa(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function Xa(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function $a(e){const t=function(e,t,n){const r=e[t];e[t]=e[n],e[n]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function Ja(e){const t=e.split(":");let n=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),r=e[e.length-1].split(",");if(2===r.length){const t="base64"===r[0],i=r[1];t?(e.splice(-1,1),n=Qa(i)):n=function(e){const t=Xa(e).subarray(0,16),n=new Uint8Array(16);return n.set(t,16-t.length),n}(i)}}return n}const Za="undefined"!==typeof self?self:void 0;var eo={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},to="org.w3.clearkey",no="com.apple.streamingkeydelivery",ro="com.microsoft.playready",io="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function so(e){switch(e){case no:return eo.FAIRPLAY;case ro:return eo.PLAYREADY;case io:return eo.WIDEVINE;case to:return eo.CLEARKEY}}function ao(e){switch(e){case eo.FAIRPLAY:return no;case eo.PLAYREADY:return ro;case eo.WIDEVINE:return io;case eo.CLEARKEY:return to}}function oo(e){const{drmSystems:t,widevineLicenseUrl:n}=e,r=t?[eo.FAIRPLAY,eo.WIDEVINE,eo.PLAYREADY,eo.CLEARKEY].filter(e=>!!t[e]):[];return!r[eo.WIDEVINE]&&n&&r.push(eo.WIDEVINE),r}const lo=null!=Za&&null!=(co=Za.navigator)&&co.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var co;function uo(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),n=String.fromCharCode.apply(null,Array.from(t)),r=n.substring(n.indexOf("<"),n.length),i=(new DOMParser).parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(i){const e=i.childNodes[0]?i.childNodes[0].nodeValue:i.getAttribute("VALUE");if(e){const t=Qa(e).subarray(0,16);return $a(t),t}}return null}let ho={};class fo{static clearKeyUriToKeyIdMap(){ho={}}static setKeyIdForUri(e,t){ho[e]=t}static addKeyIdForUri(e){const t=Object.keys(ho).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),ho[e]=n,n}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5?arguments[5]:void 0;this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=i,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!Ya(e),null!=s&&s.startsWith("0x")&&(this.keyId=new Uint8Array(gi(s)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&za(e.keyFormatVersions,this.keyFormatVersions)&&Wa(e.iv,this.iv)&&Wa(e.keyId,this.keyId)}isSupported(){if(this.method){if(Ya(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case no:case io:case ro:case to:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Ya(this.method)){let t=this.iv;t||("number"!==typeof e&&(ci.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),e=0),t=function(e){const t=new Uint8Array(16);for(let n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}(e));return new fo(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.keyId){const e=ho[this.uri];if(e&&!za(this.keyId,e)&&fo.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=Ja(this.uri);if(n)switch(this.keyFormat){case io:if(this.pssh=n,!this.keyId){const e=function(e){const t=[];if(e instanceof ArrayBuffer){const n=e.byteLength;let r=0;for(;r+32<n;){const n=Zi(new DataView(e,r));t.push(n),r+=n.size}}return t}(n.buffer);if(e.length){var r;const t=e[0];this.keyId=null!=(r=t.kids)&&r.length?t.kids[0]:null}}this.keyId||(this.keyId=go(t));break;case ro:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Ji(e,0,n),this.keyId=uo(n);break}default:{let e=n.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e;e=function(e){const t=null==e?void 0:e[io];if(t)return t.keyId;return null}(t),e||(e=go(t),e||(e=ho[this.uri])),e&&(this.keyId=e,fo.setKeyIdForUri(this.uri,e))}return this}}function go(e){const t=null==e?void 0:e[ro];if(t){const e=Ja(t.uri);if(e)return uo(e)}return null}const po=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,mo=/#EXT-X-MEDIA:(.*)/g,vo=/^#EXT(?:INF|-X-TARGETDURATION):/m,yo=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Eo=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class bo{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return yi.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return vo.test(e)}static parseMasterPlaylist(e,t){const n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Oa(e)},r=[];if(po.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let i;for(;null!=(i=po.exec(e));)if(i[1]){var s;const e=new ja(i[1],n),a=Na(n,i[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:bo.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),wo(e.CODECS,o);const c=e["SUPPLEMENTAL-CODECS"];c&&(o.supplemental={},wo(c,o.supplemental)),null!=(s=o.unknownCodecs)&&s.length||r.push(o),n.levels.push(o)}else if(i[3]){const e=i[3],r=i[4];switch(e){case"SESSION-DATA":{const e=new ja(r,n),t=e["DATA-ID"];t&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[t]=e);break}case"SESSION-KEY":{const e=ko(r,t,n);e.encrypted&&e.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(e)):ci.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(r,'"'));break}case"DEFINE":Ma(n,new ja(r,n),t);break;case"CONTENT-STEERING":{const e=new ja(r,n);n.contentSteering={uri:bo.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=xo(r)}}const a=r.length>0&&r.length<n.levels.length;return n.levels=a?r:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,n){let r;const i={},s=n.levels,a={AUDIO:s.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:s.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(mo.lastIndex=0;null!==(r=mo.exec(e));){const e=new ja(r[1],n),s=e.TYPE;if(s){const n=a[s],r=i[s]||[];i[s]=r;const l=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],u=e.CHANNELS,d=e.CHARACTERISTICS,h=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:s,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?bo.resolve(e.URI,t):""};if(c&&(f.assocLang=c),u&&(f.channels=u),d&&(f.characteristics=d),h&&(f.instreamId=h),null!=n&&n.length){const e=bo.findGroup(n,f.groupId)||n[0];Lo(f,e,"audioCodec"),Lo(f,e,"textCodec")}r.push(f)}}return i}static parseLevelPlaylist(e,t,n,r,i,s){var a;const o={url:t},l=new Va(t),c=l.fragments,u=[];let d,h,f,g,p=null,m=0,v=0,y=0,E=0,b=0,S=null,T=new wi(r,o),k=-1,x=!1,w=null;if(yo.lastIndex=0,l.m3u8=e,l.hasVariableRefs=Oa(e),"#EXTM3U"!==(null==(a=yo.exec(e))?void 0:a[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(d=yo.exec(e));){x&&(x=!1,T=new wi(r,o),T.playlistOffset=y,T.setStart(y),T.sn=m,T.cc=E,b&&(T.bitrate=b),T.level=n,p&&(T.initSegment=p,p.rawProgramDateTime&&(T.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),w&&(T.setByteRange(w),w=null)));const e=d[1];if(e){T.duration=parseFloat(e);const t=(" "+d[2]).slice(1);T.title=t||null,T.tagList.push(t?["INF",e,t]:["INF",e])}else if(d[3]){if(Ur(T.duration)){T.playlistOffset=y,T.setStart(y),f&&Io(T,f,l),T.sn=m,T.level=n,T.cc=E,c.push(T);const e=(" "+d[3]).slice(1);T.relurl=Na(l,e),Ao(T,S,u),S=T,y+=T.duration,m++,v=0,x=!0}}else{if(d=d[0].match(Eo),!d){ci.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<d.length&&void 0===d[h];h++);const e=(" "+d[h]).slice(1),i=(" "+d[h+1]).slice(1),a=d[h+2]?(" "+d[h+2]).slice(1):null;switch(e){case"BYTERANGE":S?T.setByteRange(i,S):T.setByteRange(i);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=i,T.tagList.push(["PROGRAM-DATE-TIME",i]),-1===k&&(k=c.length);break;case"PLAYLIST-TYPE":l.type&&_o(l,e,d),l.type=i.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?_o(l,e,d):c.length>0&&Do(l,e,d),m=l.startSN=parseInt(i);break;case"SKIP":{l.skippedSegments&&_o(l,e,d);const t=new ja(i,l),n=t.decimalInteger("SKIPPED-SEGMENTS");if(Ur(n)){l.skippedSegments+=n;for(let e=n;e--;)c.push(null);m+=n}const r=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(r.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&_o(l,e,d),l.targetduration=Math.max(parseInt(i),1);break;case"VERSION":null!==l.version&&_o(l,e,d),l.version=parseInt(i);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||_o(l,e,d),l.live=!1;break;case"#":(i||a)&&T.tagList.push(a?[i,a]:[i]);break;case"DISCONTINUITY":E++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([e]);break;case"BITRATE":T.tagList.push([e,i]),b=1e3*parseInt(i),Ur(b)?T.bitrate=b:b=0;break;case"DATERANGE":{const e=new ja(i,l),t=new Ha(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:ci.warn('Ignoring invalid DATERANGE tag: "'.concat(i,'"')),T.tagList.push(["EXT-X-DATERANGE",i]);break}case"DEFINE":{const e=new ja(i,l);"IMPORT"in e?Fa(l,e,s):Ma(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?_o(l,e,d):c.length>0&&Do(l,e,d),l.startCC=E=parseInt(i);break;case"KEY":{const e=ko(i,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={});const t=f[e.keyFormat];null!=t&&t.matches(e)||(t&&(f=ei({},f)),f[e.keyFormat]=e)}else ci.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(i,'"'));break}case"START":l.startTimeOffset=xo(i);break;case"MAP":{const e=new ja(i,l);if(T.duration){const t=new wi(r,o);Ro(t,e,n,f),p=t,T.initSegment=p,p.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=p.rawProgramDateTime)}else{const t=T.byteRangeEndOffset;if(t){const e=T.byteRangeStartOffset;w="".concat(t-e,"@").concat(e)}else w=null;Ro(T,e,n,f),p=T,x=!0}p.cc=E;break}case"SERVER-CONTROL":g&&_o(l,e,d),g=new ja(i),l.canBlockReload=g.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=g.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&g.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=g.optionalFloat("PART-HOLD-BACK",0),l.holdBack=g.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&_o(l,e,d);const t=new ja(i);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=v>0?e[e.length-1]:void 0,n=v++,r=new ja(i,l),s=new Li(r,T,o,n,t);e.push(s),T.duration+=s.duration;break}case"PRELOAD-HINT":{const e=new ja(i,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new ja(i,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:ci.warn("line parsed but not handled: ".concat(d))}}}S&&!S.relurl?(c.pop(),y-=S.duration,l.partList&&(l.fragmentHint=S)):l.partList&&(Ao(T,S,u),T.cc=E,l.fragmentHint=T,f&&Io(T,f,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const L=c.length,A=c[0],R=c[L-1];if(y+=l.skippedSegments*l.targetduration,y>0&&L&&R){l.averagetargetduration=y/L;const e=R.sn;l.endSN="initSegment"!==e?e:0,l.live||(R.endList=!0),k>0&&(!function(e,t){let n=e[t];for(let r=t;r--;){const t=e[r];if(!t)return;t.programDateTime=n.programDateTime-1e3*t.duration,n=t}}(c,k),A&&u.unshift(A))}return l.fragmentHint&&(y+=l.fragmentHint.duration),l.totalduration=y,u.length&&l.dateRangeTagCount&&A&&So(u,l),l.endCC=E,l}}function So(e,t){let n=e.length;if(!n){if(!t.hasProgramDateTime)return;{const r=t.fragments[t.fragments.length-1];e.push(r),n++}}const r=e[n-1],i=t.live?1/0:t.totalduration,s=Object.keys(t.dateRanges);for(let o=s.length;o--;){const l=t.dateRanges[s[o]],c=l.startDate.getTime();l.tagAnchor=r.ref;for(let r=n;r--;){var a;if((null==(a=e[r])?void 0:a.sn)<t.startSN)break;const n=To(t,c,e,r,i);if(-1!==n){l.tagAnchor=t.fragments[n].ref;break}}}}function To(e,t,n,r,i){const s=n[r];if(s){const o=s.programDateTime;if(t>=o||0===r){var a;if(t<=o+1e3*(((null==(a=n[r+1])?void 0:a.start)||i)-s.start)){const i=n[r].sn-e.startSN;if(i<0)return-1;const s=e.fragments;if(s.length>n.length){for(let a=(n[r+1]||s[s.length-1]).sn-e.startSN;a>i;a--){const e=s[a].programDateTime;if(t>=e&&t<e+1e3*s[a].duration)return a}}return i}}}return-1}function ko(e,t,n){var r,i;const s=new ja(e,n),a=null!=(r=s.METHOD)?r:"",o=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=null!=(i=s.KEYFORMAT)?i:"identity";o&&s.IV&&!l&&ci.error("Invalid IV: ".concat(s.IV));const d=o?bo.resolve(o,t):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new fo(a,d,u,h,l,s.KEYID)}function xo(e){const t=new ja(e).decimalFloatingPoint("TIME-OFFSET");return Ur(t)?t:null}function wo(e,t){let n=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const r=n.filter(t=>ns(t,e));r.length&&(t["".concat(e,"Codec")]=r.map(e=>e.split("/")[0]).join(","),n=n.filter(e=>-1===r.indexOf(e)))}),t.unknownCodecs=n}function Lo(e,t,n){const r=t[n];r&&(e[n]=r)}function Ao(e,t,n){e.rawProgramDateTime?n.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function Ro(e,t,n,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function Io(e,t,n){e.levelkeys=t;const{encryptedFragments:r}=n;r.length&&r[r.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||r.push(e)}function _o(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must not appear more than once (").concat(n[0],")"))}function Do(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must appear before the first Media Segment (").concat(n[0],")"))}function Po(e,t){const n=t.startPTS;if(Ur(n)){let r,i=0;t.sn>e.sn?(i=n-e.start,r=e):(i=e.start-n,r=t),r.duration!==i&&r.setDuration(i)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function Co(e,t,n,r,i,s,a){r-n<=0&&(a.warn("Fragment should have a positive duration",t),r=n+t.duration,s=i+t.duration);let o=n,l=r;const c=t.startPTS,u=t.endPTS;if(Ur(c)){const d=Math.abs(c-n);e&&d>e.totalduration?a.warn("media timestamps and playlist times differ by ".concat(d,"s for level ").concat(t.level," ").concat(e.url)):Ur(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,o=Math.max(n,c),n=Math.min(n,c),i=void 0!==t.startDTS?Math.min(i,t.startDTS):i,l=Math.min(r,u),r=Math.max(r,u),s=void 0!==t.endDTS?Math.max(s,t.endDTS):s}const d=n-t.start;0!==t.start&&t.setStart(n),t.setDuration(r-t.start),t.startPTS=n,t.maxStartPTS=o,t.startDTS=i,t.endPTS=r,t.minEndPTS=l,t.endDTS=s;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let f;const g=h-e.startSN,p=e.fragments;for(p[g]=t,f=g;f>0;f--)Po(p[f],p[f-1]);for(f=g;f<p.length-1;f++)Po(p[f],p[f+1]);return e.fragmentHint&&Po(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function Oo(e,t,n){if(e===t)return;let r=null;const i=e.fragments;for(let u=i.length-1;u>=0;u--){const e=i[u].initSegment;if(e){r=e;break}}let s;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,n){const r=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=i;c<=s;c++){const i=l[a+c];let s=o[c];if(r&&!s&&i&&(s=t.fragments[c]=i),i&&s){n(i,s,c,o);const r=i.relurl,a=s.relurl;if(r&&Ho(r,a))return void(t.playlistParsingError=No("media sequence mismatch ".concat(s.sn,":"),e,t,i,s));if(i.cc!==s.cc)return void(t.playlistParsingError=No("discontinuity sequence mismatch (".concat(i.cc,"!=").concat(s.cc,")"),e,t,i,s))}}}(e,t,(e,n,i,a)=>{if((!t.startCC||t.skippedSegments)&&n.cc!==e.cc){const r=e.cc-n.cc;for(let e=i;e<a.length;e++)a[e].cc+=r;t.endCC=a[a.length-1].cc}Ur(e.startPTS)&&Ur(e.endPTS)&&(n.setStart(n.startPTS=e.startPTS),n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.setDuration(e.endPTS-e.startPTS),n.duration&&(s=n),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(n.elementaryStreams=e.elementaryStreams),n.loader=e.loader,e.hasStats&&(n.stats=e.stats),e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)});const a=t.fragments,o=t.fragmentHint?a.concat(t.fragmentHint):a;if(r&&o.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)}),t.skippedSegments){if(t.deltaUpdateFailed=a.some(e=>!e),t.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)a.shift();t.startSN=a[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,n){const{dateRanges:r,recentlyRemovedDateranges:i}=t,s=ei({},e);i&&i.forEach(e=>{delete s[e]});const a=Object.keys(s).length;if(!a)return r;return Object.keys(r).forEach(e=>{const t=s[e],i=new Ha(r[e].attr,t);i.isValid?(s[e]=i,t||(i.tagOrder+=a)):n.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(Cs(r[e].attr),'"'))}),s}(e.dateRanges,t,n));const r=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<o.length;e++)null===o[e].programDateTime&&Ao(o[e],o[e-1],r);So(r,t)}t.endCC=a[a.length-1].cc}if(!t.startCC){var l;const n=Bo(e,t.startSN-1);t.startCC=null!=(l=null==n?void 0:n.cc)?l:a[0].cc}!function(e,t,n){if(e&&t){let r=0;for(let i=0,s=e.length;i<=s;i++){const s=e[i],a=t[i+r];s&&a&&s.index===a.index&&s.fragment.sn===a.fragment.sn?n(s,a):r--}}}(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),s?Co(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,n):Mo(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const c=t.advancedDateTime;if(t.advanced&&c){const e=t.edge;t.driftStart||(t.driftStartTime=c,t.driftStart=e),t.driftEndTime=c,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function No(e,t,n,r,i){return new Error("".concat(e," ").concat(i.url,"\nPlaylist starting @").concat(t.startSN,"\n").concat(t.m3u8,"\n\nPlaylist starting @").concat(n.startSN,"\n").concat(n.m3u8))}function Mo(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=t.startSN+t.skippedSegments-e.startSN,i=e.fragments,s=r>=0;let a=0;if(s&&r<i.length)a=i[r].start;else if(s&&t.startSN===e.endSN+1)a=e.fragmentEnd;else if(s&&n)a=e.fragmentStart+r*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;a=e.fragmentStart}Fo(t,a)}function Fo(e,t){if(t){const n=e.fragments;for(let r=e.skippedSegments;r<n.length;r++)n[r].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function Uo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=1e3*e.targetduration;if(e.updated){const r=e.fragments,i=4;if(r.length&&n*i>t){const e=1e3*r[r.length-1].duration;e<n&&(n=e)}}else n/=2;return Math.round(n)}function Bo(e,t,n){if(!e)return null;let r=e.fragments[t-e.startSN];return r||(r=e.fragmentHint,r&&r.sn===t?r:t<e.startSN&&n&&n.sn===t?n:null)}function jo(e,t,n){return e?Go(e.partList,t,n):null}function Go(e,t,n){if(e)for(let r=e.length;r--;){const i=e[r];if(i.index===n&&i.fragment.sn===t)return i}return null}function Ko(e){e.forEach((e,t)=>{var n;null==(n=e.details)||n.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function Ho(e,t){return!(e===t||!t)&&Vo(e)!==Vo(t)}function Vo(e){return e.replace(/\?[^?]*$/,"")}function zo(e,t){for(let r=0,i=e.length;r<i;r++){var n;if((null==(n=e[r])?void 0:n.cc)===t)return e[r]}return null}function Wo(e,t){const n=e.start+t;e.startPTS=n,e.setStart(n),e.endPTS=n+e.duration}function Yo(e,t){const n=t.fragments;for(let r=0,i=n.length;r<i;r++)Wo(n[r],e);t.fragmentHint&&Wo(t.fragmentHint,e),t.alignedSliding=!0}function qo(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const n=Math.min(t.endCC,e.endCC),r=zo(t.fragments,n),i=zo(e.fragments,n);if(!r||!i)return;ci.log("Aligning playlist at start of dicontinuity sequence ".concat(n));Yo(r.start-i.start,e)}function Qo(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const n=e.fragments,r=t.fragments;if(!n.length||!r.length)return;let i,s;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(i=zo(r,a),s=zo(n,a)),i&&s||(i=r[Math.floor(r.length/2)],s=zo(n,i.cc)||n[Math.floor(n.length/2)]);const o=i.programDateTime,l=s.programDateTime;if(!o||!l)return;Yo((l-o)/1e3-(s.start-i.start),e)}function Xo(e,t,n){$o(e,t,n),e.addEventListener(t,n)}function $o(e,t,n){e.removeEventListener(t,n)}const Jo=function(e){let t="";const n=e.length;for(let r=0;r<n;r++)t+="[".concat(e.start(r).toFixed(3),"-").concat(e.end(r).toFixed(3),"]");return t},Zo="STOPPED",el="IDLE",tl="KEY_LOADING",nl="FRAG_LOADING",rl="FRAG_LOADING_WAITING_RETRY",il="WAITING_TRACK",sl="PARSING",al="PARSED",ol="ENDED",ll="ERROR",cl="WAITING_INIT_PTS",ul="WAITING_LEVEL";class dl extends Ia{constructor(e,t,n,r,i){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Zo,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:n,mediaBuffer:r,state:i}=this,s=n?n.currentTime:0,a=Pa.bufferInfo(r||n,s,e.maxBufferHole),o=!a.len;if(this.log("Media seeking to ".concat(Ur(s)?s.toFixed(3):s,", state: ").concat(i,", ").concat(o?"out of":"in"," buffer")),this.state===ol)this.resetLoadingState();else if(t){const n=e.maxFragLookUpTolerance,r=t.start-n,i=t.start+t.duration+n;if(o||i<a.start||r>a.end){const e=s>i;(s<r||e)&&(e&&t.loader&&(this.log("Cancelling fragment load for seek (sn: ".concat(t.sn,")")),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(n){this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0);if(s>this.lastCurrentTime&&(this.lastCurrentTime=s),!this.loadingParts){const e=Math.max(a.end,s),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log("LL-Part loading ON after seeking to ".concat(s.toFixed(2)," with buffer @").concat(e.toFixed(2))),this.loadingParts=t)}}this.hls.hasEnoughToStart||(this.log("Setting ".concat(o?"startPosition":"nextLoadPosition"," to ").concat(s," for seek without enough to start")),this.nextLoadPosition=s,o&&(this.startPosition=s)),o&&this.state===el&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new wa(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new ka(e.config)}registerListeners(){const{hls:e}=this;e.on(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Hr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Hr.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Zo)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Zo}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=Pa.bufferedInfo(i,e.start,0));const s=e.nextStart;if(s&&s>r&&s<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const a=t.partList;if(null!=a&&a.length){const e=a[a.length-1];return Pa.isBuffered(this.media,e.start+e.duration/2)}const o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;Xo(n,"seeking",this.onMediaSeeking),Xo(n,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===Zo&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(null!==r){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),$o(r,"seeking",this.onMediaSeeking),$o(r,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Zo,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){this._doFragLoad(e,t,n,e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn("".concat(t.type," sn: ").concat(t.sn).concat(e.part?" part: "+e.part.index:""," of ").concat(this.fragInfo(t,!1,e.part),") was dropped during download.")),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const t=this.state,n=e.frag;this.fragContextChanged(n)?(t===nl||!this.fragCurrent&&t===sl)&&(this.fragmentTracker.removeFragment(n),this.state=el):("payload"in e&&(this.log("Loaded ".concat(n.type," sn: ").concat(n.sn," of ").concat(this.playlistLabel()," ").concat(n.level)),this.hls.trigger(Hr.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(t=>{this.state!==Zo&&this.state!==ll&&(this.warn("Frag error: ".concat((null==t?void 0:t.message)||t)),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===da){const t=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,t),i=Math.max(e.duration,r?r.len:this.config.maxBufferLength),s=this.backtrackFragment;(1===(s?e.sn-s.sn:0)||this.reduceMaxBufferLength(i,e.duration))&&n.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===ha&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null};this.hls.trigger(Hr.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:t}=this,{frag:n,payload:r}=e,i=n.decryptdata;if(r&&r.byteLength>0&&null!=i&&i.key&&i.iv&&Ya(i.method)){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer,qa(i.method)).catch(e=>{throw t.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:n}),e}).then(r=>{const i=self.performance.now();return t.trigger(Hr.FRAG_DECRYPTED,{frag:n,payload:r,stats:{tstart:s,tdecrypt:i}}),e.payload=r,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==Zo&&this.state!==ll&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==Zo&&(this.state=el),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,r;const i=e.tracks;if(i&&!t.encrypted&&(null!=(n=i.audio)&&n.encrypted||null!=(r=i.video)&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const e=this.media,n=new Error("Encrypted track with no key in ".concat(this.fragInfo(t)," (media ").concat(e?"attached mediaKeys: "+e.mediaKeys:"detached",")"));return this.warn(n.message),!e||e.mediaKeys?!1:(this.hls.trigger(Hr.ERROR,{type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_NO_KEYS,fatal:!1,error:n,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t)," > buffer:").concat(n?Jo(Pa.getBuffered(n)):"(detached)",")")),xi(e)){var r;if(e.type!==Xr){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=el)}const t=null==(r=this.levels)?void 0:r[e.level];null!=t&&t.fragmentError&&(this.log("Resetting level fragment error count of ".concat(t.fragmentError," on frag buffered")),t.fragmentError=0)}this.state=el}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:i}=e,s=!i||0===i.length||i.some(e=>!e),a=new _a(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!s);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;var i;this.fragCurrent=e;const s=t.details;if(!this.levels||!s)throw new Error("frag load aborted, missing level".concat(s?"":" detail","s"));let a=null;if(!e.encrypted||null!=(i=e.decryptdata)&&i.key)e.encrypted||(a=this.keyLoader.loadClear(e,s.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log("Loading key for ".concat(e.sn," of [").concat(s.startSN,"-").concat(s.endSN,"], ").concat(this.playlistLabel()," ").concat(e.level)),this.state=tl,this.fragCurrent=e,a=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(Hr.KEY_LOADED,e),this.state===tl&&(this.state=el),e}),this.hls.trigger(Hr.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const o=this.fragPrevious;if(xi(e)&&(!o||e.sn!==o.sn)){const n=this.shouldLoadParts(t.details,e.end);n!==this.loadingParts&&(this.log("LL-Part loading ".concat(n?"ON":"OFF"," loading sn ").concat(null==o?void 0:o.sn,"->").concat(e.sn)),this.loadingParts=n)}if(n=Math.max(e.start,n||0),this.loadingParts&&xi(e)){const i=s.partList;if(i&&r){n>s.fragmentEnd&&s.fragmentHint&&(e=s.fragmentHint);const o=this.getNextPart(i,e,n);if(o>-1){const l=i[o];let c;return e=this.fragCurrent=l.fragment,this.log("Loading ".concat(e.type," sn: ").concat(e.sn," part: ").concat(l.index," (").concat(o,"/").concat(i.length-1,") of ").concat(this.fragInfo(e,!1,l),") cc: ").concat(e.cc," [").concat(s.startSN,"-").concat(s.endSN,"], target: ").concat(parseFloat(n.toFixed(3)))),this.nextLoadPosition=l.start+l.duration,this.state=nl,c=a?a.then(n=>!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(e,l,t,r)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,r).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(Hr.FRAG_LOADING,{frag:e,part:l,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(i,n))return Promise.resolve(null)}}var l;if(xi(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @".concat(n.toFixed(2)," Check buffer at sn: ").concat(e.sn," loaded parts: ").concat(null==(l=s.partList)?void 0:l.filter(e=>e.loaded).map(e=>"[".concat(e.start,"-").concat(e.end,"]")))),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading ".concat(e.type," sn: ").concat(e.sn," of ").concat(this.fragInfo(e,!1),") cc: ").concat(e.cc," ").concat("["+s.startSN+"-"+s.endSN+"]",", target: ").concat(parseFloat(n.toFixed(3)))),Ur(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=nl;const c=this.config.progressive&&e.type!==Xr;let u;return u=c&&a?a.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,r)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,c?r:void 0),a]).then(e=>{let[t]=e;return!c&&r&&r(t),t}).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(Hr.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,n,r){return new Promise((i,s)=>{var a;const o=[],l=null==(a=n.details)?void 0:a.partList,c=t=>{this.fragmentLoader.loadPart(e,t,r).then(r=>{o[t.index]=r;const s=r.part;this.hls.trigger(Hr.FRAG_LOADED,r);const a=jo(n.details,e.sn,t.index+1)||Go(l,e.sn,t.index+1);if(!a)return i({frag:e,part:s,partsLoaded:o});c(a)}).catch(s)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Kr.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Gr.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(Hr.ERROR,t)}else this.hls.trigger(Hr.ERROR,{type:Gr.OTHER_ERROR,details:Kr.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==sl)return void(this.fragCurrent||this.state===Zo||this.state===ll||(this.state=el));const{frag:n,part:r,level:i}=t,s=self.performance.now();n.stats.parsing.end=s,r&&(r.stats.parsing.end=s);const a=this.getLevelDetails(),o=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);o!==this.loadingParts&&(this.log("LL-Part loading ".concat(o?"ON":"OFF"," after parsing segment ending @").concat(n.end.toFixed(2))),this.loadingParts=o),this.updateLevelTiming(n,r,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const i=e.partList[0];if(i.fragment.type===Xr)return!1;if(t>=i.end+((null==(n=e.fragmentHint)?void 0:n.duration)||0)){var r;if((this.hls.hasEnoughToStart?(null==(r=this.media)?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:i,part:s}=e;if(null==t||!t[r])return this.warn("Levels object was unset while buffering fragment ".concat(i," of ").concat(this.playlistLabel()," ").concat(r,". The current chunk will not be buffered.")),null;const a=t[r],o=a.details,l=s>-1?jo(o,i,s):null,c=l?l.fragment:Bo(o,i,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,n,r,i){if(this.state!==sl)return;const{data1:s,data2:a}=e;let o=s;if(a&&(o=Wi(s,a)),!o.length)return;const l=this.initPTS[t.cc],c=l?-l.baseTime/l.timescale:void 0,u={type:e.type,frag:t,part:n,chunkMeta:r,offset:c,parent:t.type,data:o};if(this.hls.trigger(Hr.BUFFER_APPENDING,u),e.dropped&&e.independent&&!n){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Pa.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const n=t.currentTime,r=Pa.bufferInfo(t,n,0),i=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),a=Math.max(Math.min(e.start-s,r.end-s),n+s);e.start-a>s&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!Ur(r))return null;const i=this.lastCurrentTime>r||null!=(n=this.media)&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,i)}getFwdBufferInfoAtPos(e,t,n,r){const i=Pa.bufferInfo(e,t,r);if(0===i.len&&void 0!==i.nextStart){const s=this.fragmentTracker.getBufferedFrag(t,n);if(s&&(i.nextStart<=s.end||s.gap)){const n=Math.max(Math.min(i.nextStart,s.end)-t,r);return Pa.bufferInfo(e,t,n)}}return i}getMaxBufferLength(e){const{config:t}=this;let n;return n=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),i=Math.max(e-3*t,n.maxMaxBufferLength/2,r);return i>=r&&(n.maxMaxBufferLength=i,this.warn("Reduce max buffer length to ".concat(i,"s")),!0)}getAppendedFrag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qr;const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:i}=this,s=n[0].start,a=i.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const n=i.initialLiveManifestSize;if(r<n)return this.warn("Not enough fragments to start playback (have: ".concat(r,", need: ").concat(n,")")),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<s){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);const n=this.hls.startPosition,r=this.hls.liveSyncPosition,i=o?(-1!==n&&n>=s?n:r)||o.start:e;this.log("Setting startPosition to ".concat(i," to match start frag at live edge. mainStart: ").concat(n," liveSyncPosition: ").concat(r," frag.start: ").concat(null==(l=o)?void 0:l.start)),this.startPosition=this.nextLoadPosition=i}}else e<=s&&(o=n[0]);if(!o){const n=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,n,t)}let c=this.filterReplacedPrimary(o,t);if(!c&&o){const e=o.sn-t.startSN;c=this.filterReplacedPrimary(n[e+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===fa||n===ha&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,i){let s=null;if(e.gap&&(s=this.getNextFragment(this.nextLoadPosition,t),s&&!s.gap&&n.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(null!==e&&n.len+e.len>=i){const e=s.sn;return this.loopSn!==e&&(this.log('buffer full after gaps in "'.concat(r,'" playlist starting at sn: ').concat(e)),this.loopSn=e),null}}return this.loopSn=void 0,s}get primaryPrefetch(){if(hl(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(hl(this.config)&&e.type!==Xr){const n=this.hls.interstitialsManager,r=null==n?void 0:n.bufferingItem;if(r){const n=r.event;if(n){if(n.appendInPlace||Math.abs(e.start-r.start)>1||0===r.start)return null}else{if(e.end<=r.start&&!1===(null==t?void 0:t.live))return null;if(e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}}const i=null==n?void 0:n.playerQueue;if(i)for(let t=i.length;t--;){const n=i[t].interstitial;if(n.appendInPlace&&e.start>=n.startTime&&e.end<=n.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,n){let r=-1,i=!1,s=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(s=s&&!o.independent,r>-1&&n<o.start)break;const l=o.loaded;l?r=-1:(i||(o.independent||s)&&o.fragment===t)&&(o.fragment!==t&&this.warn("Need buffer at ".concat(n," but next unloaded part starts at ").concat(o.start)),r=a),i=l}return r}loadedEndOfParts(e,t){let n;for(let r=e.length;r--;){if(n=e[r],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(n.programDateTime)),r=function(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!Ur(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;for(let r=0;r<e.length;++r){const i=e[r];if(zs(t,n,i))return i}return null}(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const i=n.sn+1;if(i>=e.startSN&&i<=e.endSN){const s=t[i-e.startSN];n.cc===s.cc&&(r=s,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(r.sn)))}r||(r=Ws(e,n.cc,n.end),r&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(r.sn)))}}else{const t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:i}=this,{fragments:s,endSN:a}=n;const{fragmentHint:o}=n,{maxFragLookUpTolerance:l}=r,c=n.partList,u=!!(this.loadingParts&&null!=c&&c.length&&o);let d;if(u&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(s=s.concat(o),a=o.sn),e<t){var h;d=Hs(i,s,e,e<this.lastCurrentTime||e>t-l||null!=(h=this.media)&&h.paused||!this.startFragRequested?0:l)}else d=s[s.length-1];if(d){const e=d.sn-n.startSN,t=this.fragmentTracker.getState(d);if((t===fa||t===ha&&d.gap)&&(i=d),i&&d.sn===i.sn&&(!u||c[0].fragment.sn>d.sn||!n.live)){if(d.level===i.level){const t=s[e+1];d=d.sn<a&&this.fragmentTracker.getState(t)!==fa?t:null}}}return d}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,s=!t,a=e.alignedSliding&&Ur(i);if(s||!a&&!i){!function(e,t){e&&(qo(t,e),t.alignedSliding||Qo(t,e),t.alignedSliding||t.skippedSegments||Mo(e,t,!1))}(n,e);const i=e.fragmentStart;return this.log("Live playlist sliding: ".concat(i.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," fragments: ").concat(r)),i}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(-1===n){const i=null!==this.startTimeOffset,s=i?this.startTimeOffset:e.startTimeOffset;null!==s&&Ur(s)?(n=t+s,s<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log("Setting startPosition to ".concat(n," for start time offset ").concat(s," found in ").concat(i?"multivariant":"media"," playlist")),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge ".concat(n)),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&xi(e)&&e.stats.aborted&&(this.log("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of ").concat(this.playlistLabel()," ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===rl)||(this.state=el)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var i;if(this.fragContextChanged(r))return void this.warn("Frag load error must match current frag to retry ".concat(r.url," > ").concat(null==(i=this.fragCurrent)?void 0:i.url));const s=t.details===Kr.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction;if(!a)return void(this.state=ll);const{action:o,flags:l,retryCount:c=0,retryConfig:u}=a,d=!!u,h=d&&o===ia,f=d&&!a.resolved&&l===aa,g=null==(n=this.hls.latestLevelDetails)?void 0:n.live;if(!h&&f&&xi(r)&&!r.endList&&g&&!Qs(t))this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((h||f)&&c<u.maxNumRetry){var p;const n=ea(null==(p=t.response)?void 0:p.code),i=$s(u,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+i,this.state=rl,a.resolved=!0,n)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(t.reason="offline");this.warn("Fragment ".concat(r.sn," of ").concat(e," ").concat(r.level," errored with ").concat(t.details,", retrying loading ").concat(c+1,"/").concat(u.maxNumRetry," in ").concat(i,"ms"))}else if(u){if(this.resetFragmentErrors(e),!(c<u.maxNumRetry))return void this.warn("".concat(t.details," reached or exceeded max retry (").concat(c,")"));s||o===ra||(a.resolved=!0)}else this.state=o===na?ul:ll;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!ea(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=el)}reduceLengthAndFlushBuffer(e){if(this.state===sl||this.state===al){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),i=r&&r.len>.5;i&&this.reduceMaxBufferLength(r.len,(null==t?void 0:t.duration)||10);const s=!i;return s&&this.warn("Buffer full error while media.currentTime (".concat(this.getLoadPosition(),") is not buffered, flush ").concat(n," buffer")),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===Qr&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Zo&&(this.state=el)}afterBufferFlushed(e,t,n){if(!e)return;const r=Pa.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===ol&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Zo&&(this.state=el)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log("Loading context changed while buffering sn ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(-1===e.level?"<removed>":e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const i=n.details;if(!i)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce((t,s)=>{const a=e.elementaryStreams[s];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn("Could not parse fragment ".concat(e.sn," ").concat(s," duration reliably (").concat(o,")")),t||!1;const l=r?0:Co(i,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS,this);return this.hls.trigger(Hr.LEVEL_PTS_UPDATED,{details:i,level:n,drift:l,type:s,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t},!1)){var s;const t=null===(null==(s=this.transmuxer)?void 0:s.error);if((0===n.fragmentError||t&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),t){const t=new Error("Found no media in fragment ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(this.warn(t.message),this.hls.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:"Found no media in msn ".concat(e.sn," of ").concat(this.playlistLabel(),' "').concat(n.url,'"')}),!this.hls)return;this.resetTransmuxer()}}this.state=al,this.log("Parsed ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t),")")),this.hls.trigger(Hr.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===qr?"level":"track"}fragInfo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;var r,i;return"".concat(this.playlistLabel()," ").concat(e.level," (").concat(n?"part":"frag",":[").concat((null!=(r=t&&!n?e.startPTS:(n||e).start)?r:NaN).toFixed(3),"-").concat((null!=(i=t&&!n?e.endPTS:(n||e).end)?i:NaN).toFixed(3),"]").concat(n&&"main"===e.type?"INDEPENDENT="+(n.independent?"YES":"NO"):"")}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}get state(){return this._state}}function hl(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class fl{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;return e.length?(n=1===e.length?e[0]:function(e,t){const n=new Uint8Array(t);let r=0;for(let i=0;i<e.length;i++){const t=e[i];n.set(t,r),r+=t.length}return n}(e,t),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var gl,pl={exports:{}};var ml=(gl||(gl=1,function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,r,s,a){if("function"!==typeof r)throw new TypeError("The listener must be a function");var o=new i(r,s||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);i<s;i++)a[i]=r[i].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,i,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,s),!0;case 6:return u.fn.call(u.context,t,r,i,s,a),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||i&&!o.once||r&&o.context!==r||a(this,s);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||i&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[s]=1===c.length?c[0]:c:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(pl)),pl.exports),vl=pi(ml);const yl="1.6.15",El={};function bl(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Sl(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Tl(e,t){let n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3],n}function kl(e,t){const n=t;let r=0;for(;Sl(e,t);){r+=10;r+=Tl(e,t+6),bl(e,t+10)&&(r+=10),t+=r}if(r>0)return e.subarray(n,n+r)}function xl(e,t){return 255===e[t]&&240===(246&e[t+1])}function wl(e,t){return 1&e[t+1]?7:9}function Ll(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Al(e,t){return t+1<e.length&&xl(e,t)}function Rl(e,t){if(Al(e,t)){const n=wl(e,t);if(t+n>=e.length)return!1;const r=Ll(e,t);if(r<=n)return!1;const i=t+r;return i===e.length||Al(e,i)}return!1}function Il(e,t,n,r,i){if(!e.samplerate){const s=function(e,t,n,r){const i=t[n+2],s=i>>2&15;if(s>12){const t=new Error("invalid ADTS sampling index:".concat(s));return void e.emit(Hr.ERROR,Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const a=1+(i>>6&3),o=t[n+3]>>6&3|(1&i)<<2,l="mp4a.40."+a,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][s];let u=s;5!==a&&29!==a||(u-=3);const d=[a<<3|(14&u)>>1,(1&u)<<7|o<<3];return ci.log("manifest codec:".concat(r,", parsed codec:").concat(l,", channels:").concat(o,", rate:").concat(c," (ADTS object type:").concat(a," sampling index:").concat(s,")")),{config:d,samplerate:c,channelCount:o,codec:l,parsedCodec:l,manifestCodec:r}}(t,n,r,i);if(!s)return;ei(e,s)}}function _l(e){return 9216e4/e}function Dl(e,t,n,r,i){const s=r+i*_l(e.samplerate),a=function(e,t){const n=wl(e,t);if(t+n<=e.length){const r=Ll(e,t)-n;if(r>0)return{headerLength:n,frameLength:r}}}(t,n);let o;if(a){const{frameLength:r,headerLength:i}=a,l=i+r,c=Math.max(0,n+l-t.length);c?(o=new Uint8Array(l-i),o.set(t.subarray(n+i,t.length),0)):o=t.subarray(n+i,n+l);const u={unit:o,pts:s};return c||e.samples.push(u),{sample:u,length:l,missing:c}}const l=t.length-n;o=new Uint8Array(l),o.set(t.subarray(n,t.length),0);return{sample:{unit:o,pts:s},length:l,missing:-1}}function Pl(e,t){return Sl(e,t)&&Tl(e,t+6)+10<=e.length-t}function Cl(e){return function(e,t,n,r){const i=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let s=1;"BYTES_PER_ELEMENT"in r&&(s=r.BYTES_PER_ELEMENT);const a=(d=e,d&&d.buffer instanceof ArrayBuffer&&void 0!==d.byteLength&&void 0!==d.byteOffset?e.byteOffset:0),o=(a+e.byteLength)/s,l=(a+t)/s,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(n,0),o));var d;return new r(i,c,u-c)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,Uint8Array)}function Ol(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");const n=e.data.subarray(1).indexOf(0);if(-1===n)return;const r=hi(Cl(e.data,1,n)),i=e.data[2+n],s=e.data.subarray(3+n).indexOf(0);if(-1===s)return;const a=hi(Cl(e.data,3+n,s));let o;return o="--\x3e"===r?hi(Cl(e.data,4+n+s)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+n+s)),t.mimeType=r,t.pictureType=i,t.description=a,t.data=o,t}function Nl(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=hi(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const n=hi(e.data.subarray(t),!0);t+=n.length+1;const r=hi(e.data.subarray(t));return{key:e.type,info:n,data:r}}const t=hi(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?Ol(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const n=hi(e.data.subarray(t),!0);t+=n.length+1;const r=hi(e.data.subarray(t));return{key:e.type,info:n,data:r}}const t=hi(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function Ml(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=Tl(e,4);return{type:t,size:n,data:e.subarray(10,10+n)}}function Fl(e){let t=0;const n=[];for(;Sl(e,t);){const r=Tl(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const i=t+r;for(;t+10<i;){const r=Ml(e.subarray(t)),i=Nl(r);i&&n.push(i),t+=r.size+10}bl(e,t)&&(t+=10)}return n}function Ul(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function Bl(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),n=1&t[3];let r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}}function jl(e){const t=Fl(e);for(let n=0;n<t.length;n++){const e=t[n];if(Ul(e))return Bl(e)}}let Gl=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function Kl(){return{type:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",id:-1,pid:-1,inputTimeScale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,sequenceNumber:-1,samples:[],dropped:0}}class Hl{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Wi(this.cachedData,e),this.cachedData=null);let n,r=kl(e,0),i=r?r.length:0;const s=this._audioTrack,a=this._id3Track,o=r?jl(r):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&Ur(o))&&(this.basePTS=Vl(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Gl.audioId3,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){const t=this.appendFrame(s,e,i);t?(this.frameIndex++,this.lastPTS=t.sample.pts,i+=t.length,n=i):i=l}else Pl(e,i)?(r=kl(e,i),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Gl.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,n=i):i++;if(i===l&&n!==l){const t=e.slice(n);this.cachedData?this.cachedData=Wi(this.cachedData,t):this.cachedData=t}}return{audioTrack:s,videoTrack:Kl(),id3Track:a,textTrack:Kl()}}demuxSampleAes(e,t,n){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Kl(),id3Track:this._id3Track,textTrack:Kl()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Vl=(e,t,n)=>{if(Ur(e))return 90*e;return 9e4*t+(n?9e4*n.baseTime/n.timescale:0)};let zl=null;const Wl=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Yl=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ql=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Ql=[0,1,1,4];function Xl(e,t,n,r,i){if(n+24>t.length)return;const s=$l(t,n);if(s&&n+s.frameLength<=t.length){const a=r+i*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:t.subarray(n,n+s.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}function $l(e,t){const n=e[t+1]>>3&3,r=e[t+1]>>1&3,i=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==n&&0!==i&&15!==i&&3!==s){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*Wl[14*(3===n?3-r:3===r?3:4)+i-1],c=Yl[3*(3===n?0:2===n?1:2)+s],u=3===o?1:2,d=ql[n][r],h=Ql[r],f=8*d*h,g=Math.floor(d*l/c+a)*h;if(null===zl){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);zl=e?parseInt(e[1]):0}return!!zl&&zl<=87&&2===r&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:u,frameLength:g,samplesPerFrame:f}}}function Jl(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function Zl(e,t){return t+1<e.length&&Jl(e,t)}function ec(e,t){if(t+1<e.length&&Jl(e,t)){const n=4,r=$l(e,t);let i=n;null!=r&&r.frameLength&&(i=r.frameLength);const s=t+i;return s===e.length||Zl(e,s)}return!1}const tc=(e,t)=>{let n=0,r=5;t+=r;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=e[t];const o=Math.min(r,8),l=8-o;s[0]=4278190080>>>24+l<<l,i[0]=(a[0]&s[0])>>l,n=n?n<<o|i[0]:i[0],t+=1,r-=o}return n};class nc extends Hl{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=rc(e,t,n,this.basePTS,this.frameIndex);if(-1!==r){return{sample:e.samples[e.samples.length-1],length:r,missing:0}}}static probe(e){if(!e)return!1;const t=kl(e,0);if(!t)return!1;const n=t.length;return 11===e[n]&&119===e[n+1]&&void 0!==jl(t)&&tc(e,n)<16}}function rc(e,t,n,r,i){if(n+8>t.length)return-1;if(11!==t[n]||119!==t[n+1])return-1;const s=t[n+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],o=63&t[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+s];if(n+l>t.length)return-1;const c=t[n+6]>>5;let u=0;2===c?u+=2:(1&c&&1!==c&&(u+=2),4&c&&(u+=2));const d=(t[n+6]<<8|t[n+7])>>12-u&1,h=[2,1,2,3,3,4,4,5][c]+d,f=t[n+5]>>3,g=7&t[n+5],p=new Uint8Array([s<<6|f<<1|g>>2,(3&g)<<6|c<<3|d<<2|o>>4,o<<4&224]),m=r+i*(1536/a*9e4),v=t.subarray(n,n+l);return e.config=p,e.channelCount=h,e.samplerate=a,e.samples.push({unit:v,pts:m}),l}const ic=/\/emsg[-/]ID3/i;function sc(e,t){return Ur(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class ac{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new ka(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ya)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const i=r.subarray(16,r.length-r.length%16),s=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(s).then(i=>{const s=new Uint8Array(i);r.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t);let r=0;for(let i=32;i<e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let i=32;i<e.length-16;i+=160,r+=16)e.set(n.subarray(r,r+16),i);return e}decryptAvcSample(e,t,n,r,i){const s=$i(i.data),a=this.getAvcEncryptedData(s);this.decryptBuffer(a.buffer).then(a=>{i.data=this.getAvcDecryptedUnit(s,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)}).catch(r)}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void r();const i=e[t].units;for(;!(n>=i.length);n++){const s=i[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type)&&(this.decryptAvcSample(e,t,n,r,s),!this.decrypter.isSync()))return}}}}class oc{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n,r=this.VideoSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!=(t=r)&&t.units){const e=r.units;n=e[e.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const n=t.samples,r=n.length;if(!r)return void t.dropped++;{const t=n[r-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let i=e.naluState||0;const s=i,a=[];let o,l,c,u=0,d=-1,h=0;for(-1===i&&(d=0,h=this.getNALuType(t,0),i=0,u=1);u<r;)if(o=t[u++],i)if(1!==i)if(o)if(1===o){if(l=u-i-1,d>=0){const e={data:t.subarray(d,l),type:h};a.push(e)}else{const n=this.getLastNalUnit(e.samples);n&&(s&&u<=4-s&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-s)),l>0&&(n.data=Wi(n.data,t.subarray(0,l)),n.state=0))}u<r?(c=this.getNALuType(t,u),d=u,h=c,i=0):i=-1}else i=0;else i=3;else i=o?0:2;else i=o?0:1;if(d>=0&&i>=0){const e={data:t.subarray(d,r),type:h,state:i};a.push(e)}if(0===a.length){const n=this.getLastNalUnit(e.samples);n&&(n.data=Wi(n.data,t))}return e.naluState=i,a}}class lc{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&ci.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class cc extends oc{parsePES(e,t,n,r){const i=this.parseNALu(e,n.data,r);let s,a=this.VideoSample,o=!1;n.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(r=>{var i,l;switch(r.type){case 1:{let t=!1;s=!0;const i=r.data;if(o&&i.length>4){const e=this.readSliceType(i);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var c;if(t)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=t;break}case 5:s=!0,null!=(i=a)&&i.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:s=!0,Xi(r.data,1,n.pts,t.samples);break;case 7:{var u,d;s=!0,o=!0;const t=r.data,n=this.readSPS(t);if(!e.sps||e.width!==n.width||e.height!==n.height||(null==(u=e.pixelRatio)?void 0:u[0])!==n.pixelRatio[0]||(null==(d=e.pixelRatio)?void 0:d[1])!==n.pixelRatio[1]){e.width=n.width,e.height=n.height,e.pixelRatio=n.pixelRatio,e.sps=[t];const r=t.subarray(1,4);let i="avc1.";for(let e=0;e<3;e++){let t=r[e].toString(16);t.length<2&&(t="0"+t),i+=t}e.codec=i}break}case 8:s=!0,e.pps=[r.data];break;case 9:s=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:s=!0;break;default:s=!1}if(a&&s){a.units.push(r)}}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new lc(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n,r=8,i=8;for(let s=0;s<e;s++)0!==i&&(n=t.readEG(),i=(r+n+256)%256),r=0===i?r:i}readSPS(e){const t=new lc(e);let n,r,i,s=0,a=0,o=0,l=0;const c=t.readUByte.bind(t),u=t.readBits.bind(t),d=t.readUEG.bind(t),h=t.readBoolean.bind(t),f=t.skipBits.bind(t),g=t.skipEG.bind(t),p=t.skipUEG.bind(t),m=this.skipScalingList.bind(this);c();const v=c();if(u(5),f(3),c(),p(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const e=d();if(3===e&&f(1),p(),p(),f(1),h())for(r=3!==e?8:12,i=0;i<r;i++)h()&&m(i<6?16:64,t)}p();const y=d();if(0===y)d();else if(1===y)for(f(1),g(),g(),n=d(),i=0;i<n;i++)g();p(),f(1);const E=d(),b=d(),S=u(1);0===S&&f(1),f(1),h()&&(s=d(),a=d(),o=d(),l=d());let T=[1,1];if(h()&&h()){switch(c()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(E+1)-2*s-2*a),height:(2-S)*(b+1)*16-(S?2:4)*(o+l),pixelRatio:T}}}class uc extends oc{constructor(){super(...arguments),this.initVPS=null}parsePES(e,t,n,r){const i=this.parseNALu(e,n.data,r);let s,a=this.VideoSample,o=!1;n.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(r=>{var i,l;switch(r.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,s=!0;break;case 16:case 17:case 18:case 21:var c;if(s=!0,o)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:s=!0,null!=(i=a)&&i.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:s=!0,Xi(r.data,2,n.pts,t.samples);break;case 32:s=!0,e.vps||("object"!==typeof e.params&&(e.params={}),e.params=ei(e.params,this.readVPS(r.data)),this.initVPS=r.data),e.vps=[r.data];break;case 33:if(s=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],r.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(r.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!==typeof e.params&&(e.params={});for(const n in t.params)e.params[n]=t.params[n]}this.pushParameterSet(e.sps,r.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(s=!0,"object"===typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(r.data);for(const n in t)e.params[n]=t[n]}this.pushParameterSet(e.pps,r.data,e.vps)}break;case 35:s=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:s=!1}if(a&&s){a.units.push(r)}}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&3===e[r]&&0===e[r-1]&&0===e[r-2]||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new lc(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new lc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),i=t.readBoolean(),s=t.readBits(5),a=t.readUByte(),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),g=t.readUByte(),p=t.readUByte(),m=t.readUByte(),v=[],y=[];for(let W=0;W<n;W++)v.push(t.readBoolean()),y.push(t.readBoolean());if(n>0)for(let W=n;W<8;W++)t.readBits(2);for(let W=0;W<n;W++)v[W]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[W]&&t.readUByte();t.readUEG();const E=t.readUEG();3==E&&t.skipBits(1);const b=t.readUEG(),S=t.readUEG(),T=t.readBoolean();let k=0,x=0,w=0,L=0;T&&(k+=t.readUEG(),x+=t.readUEG(),w+=t.readUEG(),L+=t.readUEG());const A=t.readUEG(),R=t.readUEG(),I=t.readUEG();for(let W=t.readBoolean()?0:n;W<=n;W++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let n=0;n<(3===e?2:6);n++){if(t.readBoolean()){const n=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<n;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const _=t.readUEG();let D=0;for(let W=0;W<_;W++){let e=!1;if(0!==W&&(e=t.readBoolean()),e){W===_&&t.readUEG(),t.readBoolean(),t.readUEG();let e=0;for(let n=0;n<=D;n++){const n=t.readBoolean();let r=!1;n||(r=t.readBoolean()),(n||r)&&e++}D=e}else{const e=t.readUEG(),n=t.readUEG();D=e+n;for(let r=0;r<e;r++)t.readUEG(),t.readBoolean();for(let r=0;r<n;r++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let n=0;n<e;n++){for(let e=0;e<I+4;e++)t.readBits(1);t.readBits(1)}}let P=0,C=1,O=1,N=!0,M=1,F=0;t.readBoolean(),t.readBoolean();let U=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(C=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(C=t.readBits(16),O=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readBoolean(),U&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG());if(t.readBoolean()){M=t.readBits(32),F=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),r=t.readBoolean();let i=!1;(e||r)&&(i=t.readBoolean(),i&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),i&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let s=0;s<=n;s++){N=t.readBoolean();let n=!1;N||t.readBoolean()?t.readEG():n=t.readBoolean();const s=n?1:t.readUEG()+1;if(e)for(let e=0;e<s;e++)t.readUEG(),t.readUEG(),i&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(r)for(let e=0;e<s;e++)t.readUEG(),t.readUEG(),i&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let B=b,j=S;if(T){let e=1,t=1;1===E?e=t=2:2==E&&(e=2),B=b-e*x-e*k,j=S-t*L-t*w}const G=r?["A","B","C"][r]:"",K=a<<24|o<<16|l<<8|c;let H=0;for(let W=0;W<32;W++)H=(H|(K>>W&1)<<31-W)>>>0;let V=H.toString(16);1===s&&"2"===V&&(V="6");const z=i?"H":"L";return{codecString:"hvc1.".concat(G).concat(s,".").concat(V,".").concat(z).concat(m,".B0"),params:{general_tier_flag:i,general_profile_idc:s,general_profile_space:r,general_profile_compatibility_flags:[a,o,l,c],general_constraint_indicator_flags:[u,d,h,f,g,p],general_level_idc:m,bit_depth:A+8,bit_depth_luma_minus8:A,bit_depth_chroma_minus8:R,min_spatial_segmentation_idc:P,chroma_format_idc:E,frame_rate:{fixed:N,fps:F/M}},width:B,height:j,pixelRatio:[C,O]}}readPPS(e){const t=new lc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let i=1;return r&&n?i=0:r?i=3:n&&(i=2),{parallelismType:i}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const dc=188;class hc{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=hc.syncOffset(e);return n>0&&t.warn("MPEG2-TS detected but first sync word found @ offset ".concat(n)),-1!==n}static syncOffset(e){const t=e.length;let n=Math.min(940,t-dc)+1,r=0;for(;r<n;){let i=!1,s=-1,a=0;for(let o=r;o<t;o+=dc){if(71!==e[o]||t-o!==dc&&71!==e[o+dc]){if(a)return-1;break}if(a++,-1===s&&(s=o,0!==s&&(n=Math.min(s+18612,e.length-dc)+1)),i||(i=0===fc(e,o)),i&&a>1&&(0===s&&a>2||o+dc>n))return s}r++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:_i[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=hc.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=hc.createTrack("audio",r),this._id3Track=hc.createTrack("id3"),this._txtTrack=hc.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t){let n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r||(this.sampleAes=null);const s=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=s.pid,u=s.pesData,d=a.pid,h=o.pid,f=a.pesData,g=o.pesData,p=null,m=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=Wi(this.remainderData,e)).length,this.remainderData=null),y<dc&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};const E=Math.max(0,hc.syncOffset(e));y-=(y-E)%dc,y<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let b=0;for(let T=E;T<y;T+=dc)if(71===e[T]){const t=!!(64&e[T+1]),i=fc(e,T);let y;if((48&e[T+3])>>4>1){if(y=T+5+e[T+4],y===T+dc)continue}else y=T+4;switch(i){case c:t&&(u&&(n=yc(u,this.logger))&&(this.readyVideoParser(s.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(s,l,n,!1)),u={data:[],size:0}),u&&(u.data.push(e.subarray(y,T+dc)),u.size+=T+dc-y);break;case d:if(t){if(f&&(n=yc(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,n);break;case"mp3":this.parseMPEGPES(a,n);break;case"ac3":this.parseAC3PES(a,n)}f={data:[],size:0}}f&&(f.data.push(e.subarray(y,T+dc)),f.size+=T+dc-y);break;case h:t&&(g&&(n=yc(g,this.logger))&&this.parseID3PES(o,n),g={data:[],size:0}),g&&(g.data.push(e.subarray(y,T+dc)),g.size+=T+dc-y);break;case 0:t&&(y+=e[y]+1),v=this._pmtId=gc(e,y);break;case v:{t&&(y+=e[y]+1);const n=pc(e,y,this.typeSupported,r,this.observer,this.logger);c=n.videoPid,c>0&&(s.pid=c,s.segmentCodec=n.segmentVideoCodec),d=n.audioPid,d>0&&(a.pid=d,a.segmentCodec=n.segmentAudioCodec),h=n.id3Pid,h>0&&(o.pid=h),null===p||m||(this.logger.warn("MPEG-TS PMT found at ".concat(T," after unknown PID '").concat(p,"'. Backtracking to sync byte @").concat(E," to parse all TS packets.")),p=null,T=E-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=i}}else b++;b>0&&mc(this.observer,new Error("Found ".concat(b," TS packet/s that do not start with 0x47")),void 0,this.logger),s.pesData=u,a.pesData=f,o.pesData=g;const S={audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(S),S}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:i}=e,s=n.pesData,a=t.pesData,o=r.pesData;let l;if(s&&(l=yc(s,this.logger))?(this.readyVideoParser(n.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(n,i,l,!0),n.pesData=null)):n.pesData=s,a&&(l=yc(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=yc(o,this.logger))?(this.parseID3PES(r,l),r.pesData=null):r.pesData=o}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),i=this.sampleAes=new ac(this.observer,this.config,t);return this.decrypt(r,i)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new cc:"hevc"===e&&(this.videoParser=new uc))}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:i}=e;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{n(e)}):n(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let i,s,a,o=t.data;if(r){this.aacOverFlow=null;const t=r.missing,i=r.sample.unit.byteLength;if(-1===t)o=Wi(r.sample.unit,o);else{const s=i-t;r.sample.unit.set(o.subarray(0,t),s),e.samples.push(r.sample),n=r.missing}}for(i=n,s=o.length;i<s-1&&!Al(o,i);i++);if(i!==n){let e;const t=i<s-1;if(e=t?"AAC PES did not start with ADTS header,offset:".concat(i):"No ADTS header found in AAC PES",mc(this.observer,new Error(e),t,this.logger),!t)return}if(Il(e,this.observer,o,i,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!r)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=_l(e.samplerate);a=r.sample.pts+t}}let l,c=0;for(;i<s;){if(l=Dl(e,o,i,a,c),i+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;i<s-1&&!Al(o,i);i++);}}parseMPEGPES(e,t){const n=t.data,r=n.length;let i=0,s=0;const a=t.pts;if(void 0!==a)for(;s<r;)if(Zl(n,s)){const t=Xl(e,n,s,a,i);if(!t)break;s+=t.length,i++}else s++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(void 0===r)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const i=n.length;let s,a=0,o=0;for(;o<i&&(s=rc(e,n,o,r,a++))>0;)o+=s}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=ei({},t,{type:this._videoTrack?Gl.emsg:Gl.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function fc(e,t){return((31&e[t+1])<<8)+e[t+2]}function gc(e,t){return(31&e[t+10])<<8|e[t+11]}function pc(e,t,n,r,i,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=fc(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!r){vc("ADTS AAC",s);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!r){vc("H.264",s);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:n.mpeg||n.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):s.log("MPEG audio found, not supported in this browser");break;case 193:if(!r){vc("AC-3",s);break}case 129:n.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let r=t+5,i=l;for(;i>2;){if(106===e[r])!0!==n.ac3?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const t=e[r+1]+2;r+=t,i-=t}}break;case 194:case 135:return mc(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"))}t+=l+5}return a}function mc(e,t,n,r){r.warn("parsing error: ".concat(t.message)),e.emit(Hr.ERROR,Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:t,reason:t.message})}function vc(e,t){t.log("".concat(e," with AES-128-CBC encryption found in unencrypted stream"))}function yc(e,t){let n,r,i,s,a,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=Wi(l[0],l[1]),l.splice(1,1);n=l[0];if(1===(n[0]<<16)+(n[1]<<8)+n[2]){if(r=(n[4]<<8)+n[5],r&&r>e.size-6)return null;const c=n[7];192&c&&(s=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&c?(a=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2,s-a>54e5&&(t.warn("".concat(Math.round((s-a)/9e4),"s delta between PTS and DTS, align them")),s=a)):a=s),i=n[8];let u=i+9;if(e.size<=u)return null;e.size-=u;const d=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){n=l[e];let t=n.byteLength;if(u){if(u>t){u-=t;continue}n=n.subarray(u),t-=u,u=0}d.set(n,o),o+=t}return r&&(r-=i+3),{data:d,pts:s,dts:a,len:r}}return null}class Ec{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const bc=Math.pow(2,32)-1;class Sc{static init(){let e;for(e in Sc.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Sc.types)Sc.types.hasOwnProperty(e)&&(Sc.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Sc.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);Sc.STTS=Sc.STSC=Sc.STCO=i,Sc.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Sc.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Sc.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Sc.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Sc.FTYP=Sc.box(Sc.types.ftyp,s,o,s,a),Sc.DINF=Sc.box(Sc.types.dinf,Sc.box(Sc.types.dref,r))}static box(e){let t=8;for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];let s=r.length;const a=s;for(;s--;)t+=r[s].byteLength;const o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),s=0,t=8;s<a;s++)o.set(r[s],t),t+=r[s].byteLength;return o}static hdlr(e){return Sc.box(Sc.types.hdlr,Sc.HDLR_TYPES[e])}static mdat(e){return Sc.box(Sc.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(bc+1)),r=Math.floor(t%(bc+1));return Sc.box(Sc.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(e){return Sc.box(Sc.types.mdia,Sc.mdhd(e.timescale||0,e.duration||0),Sc.hdlr(e.type),Sc.minf(e))}static mfhd(e){return Sc.box(Sc.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?Sc.box(Sc.types.minf,Sc.box(Sc.types.smhd,Sc.SMHD),Sc.DINF,Sc.stbl(e)):Sc.box(Sc.types.minf,Sc.box(Sc.types.vmhd,Sc.VMHD),Sc.DINF,Sc.stbl(e))}static moof(e,t,n){return Sc.box(Sc.types.moof,Sc.mfhd(e),Sc.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=Sc.trak(e[t]);return Sc.box.apply(null,[Sc.types.moov,Sc.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(Sc.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=Sc.trex(e[t]);return Sc.box.apply(null,[Sc.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(bc+1)),r=Math.floor(t%(bc+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Sc.box(Sc.types.mvhd,i)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,i;for(r=0;r<t.length;r++)i=t[r].flags,n[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return Sc.box(Sc.types.sdtp,n)}static stbl(e){return Sc.box(Sc.types.stbl,Sc.stsd(e),Sc.box(Sc.types.stts,Sc.STTS),Sc.box(Sc.types.stsc,Sc.STSC),Sc.box(Sc.types.stsz,Sc.STSZ),Sc.box(Sc.types.stco,Sc.STCO))}static avc1(e){let t,n,r,i=[],s=[];for(t=0;t<e.sps.length;t++)n=e.sps[t],r=n.byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(n));for(t=0;t<e.pps.length;t++)n=e.pps[t],r=n.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(n));const a=Sc.box(Sc.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(s))),o=e.width,l=e.height,c=e.pixelRatio[0],u=e.pixelRatio[1];return Sc.box(Sc.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,Sc.box(Sc.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Sc.box(Sc.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return Sc.box(Sc.types.mp4a,Sc.audioStsd(e),Sc.box(Sc.types.esds,Sc.esds(e)))}static mp3(e){return Sc.box(Sc.types[".mp3"],Sc.audioStsd(e))}static ac3(e){return Sc.box(Sc.types["ac-3"],Sc.audioStsd(e),Sc.box(Sc.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return Sc.box(Sc.types.stsd,Sc.STSD,Sc.mp4a(e));if("ac3"===t&&e.config)return Sc.box(Sc.types.stsd,Sc.STSD,Sc.ac3(e));if("mp3"===t&&"mp3"===e.codec)return Sc.box(Sc.types.stsd,Sc.STSD,Sc.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return Sc.box(Sc.types.stsd,Sc.STSD,Sc.avc1(e));if("hevc"===t&&e.vps)return Sc.box(Sc.types.stsd,Sc.STSD,Sc.hvc1(e))}throw new Error("unsupported ".concat(e.type," segment codec (").concat(t,"/").concat(e.codec,")"))}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,i=e.height||0,s=Math.floor(n/(bc+1)),a=Math.floor(n%(bc+1));return Sc.box(Sc.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))}static traf(e,t){const n=Sc.sdtp(e),r=e.id,i=Math.floor(t/(bc+1)),s=Math.floor(t%(bc+1));return Sc.box(Sc.types.traf,Sc.box(Sc.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),Sc.box(Sc.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s])),Sc.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,Sc.box(Sc.types.trak,Sc.tkhd(e),Sc.mdia(e))}static trex(e){const t=e.id;return Sc.box(Sc.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,i=12+16*r,s=new Uint8Array(i);let a,o,l,c,u,d;for(t+=8+i,s.set(["video"===e.type?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<r;a++)o=n[a],l=o.duration,c=o.size,u=o.flags,d=o.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*a);return Sc.box(Sc.types.trun,s)}static initSegment(e){Sc.types||Sc.init();const t=Sc.moov(e);return Wi(Sc.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let i=r.length;for(let h=0;h<n.length;h+=1){i+=3;for(let e=0;e<n[h].length;e+=1)i+=2+n[h][e].length}const s=new Uint8Array(i);s.set(r,0),i=r.length;const a=n.length-1;for(let h=0;h<n.length;h+=1){s.set(new Uint8Array([32+h|(h===a?128:0),0,n[h].length]),i),i+=3;for(let e=0;e<n[h].length;e+=1)s.set(new Uint8Array([n[h][e].length>>8,255&n[h][e].length]),i),i+=2,s.set(n[h][e],i),i+=n[h][e].length}const o=Sc.box(Sc.types.hvcC,s),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return Sc.box(Sc.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Sc.box(Sc.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Sc.box(Sc.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))}}Sc.types=void 0,Sc.HDLR_TYPES=void 0,Sc.STTS=void 0,Sc.STSC=void 0,Sc.STCO=void 0,Sc.STSZ=void 0,Sc.VMHD=void 0,Sc.SMHD=void 0,Sc.STSD=void 0,Sc.FTYP=void 0,Sc.DINF=void 0;function Tc(e,t){const n=e*t*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?Math.round(n):n}function kc(e){return Tc(e,1e3,1/9e4,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}function xc(e){const{baseTime:t,timescale:n,trackId:r}=e;return"".concat(t/n," (").concat(t,"/").concat(n,") trackId: ").concat(r)}let wc,Lc=null,Ac=null;function Rc(e,t,n,r){return{duration:t,size:n,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class Ic extends ri{constructor(e,t,n,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===Lc){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Lc=e?parseInt(e[1]):0}if(null===Ac){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Ac=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;t&&e&&e.trackId===t.trackId&&e.baseTime===t.baseTime&&e.timescale===t.timescale||this.log("Reset initPTS: ".concat(t?xc(t):t," > ").concat(e?xc(e):e)),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((e,r)=>{let i=r.pts,s=i-e;return s<-4294967296&&(t=!0,i=_c(i,n),s=i-e),s>0?e:i},n);return t&&this.debug("PTS rollover detected"),r}remux(e,t,n,r,i,s,a,o){let l,c,u,d,h,f,g=i,p=i;const m=e.pid>-1,v=t.pid>-1,y=t.samples.length,E=e.samples.length>0,b=a&&y>0||y>1;if((!m||E)&&(!v||b)||this.ISGenerated||a){if(this.ISGenerated){var S,T,k,x;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(S=t.pixelRatio)?void 0:S[0])!==(null==(T=e.pixelRatio)?void 0:T[0])||(null==(k=t.pixelRatio)?void 0:k[1])!==(null==(x=e.pixelRatio)?void 0:x[1]))||!e&&b||null===this.nextAudioTs&&E)&&this.resetInitSegment()}this.ISGenerated||(u=this.generateIS(e,t,i,s));const n=this.isVideoContiguous;let r,a=-1;if(b&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){this.warn("Dropped ".concat(a," out of ").concat(y," video samples due to a missing keyframe"));const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,p+=(t.samples[0].pts-e)/t.inputTimeScale,r=p}else-1===a&&(this.warn("No keyframe found out of ".concat(y," video samples")),f=!1);if(this.ISGenerated){if(E&&b){const n=this.getVideoStartPts(t.samples),r=(_c(e.samples[0].pts,n)-n)/t.inputTimeScale;g+=Math.max(0,r),p+=Math.max(0,-r)}if(E){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),u=this.generateIS(e,t,i,s)),c=this.remuxAudio(e,g,this.isAudioContiguous,s,v||b||o===Qr?p:void 0),b){const r=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),u=this.generateIS(e,t,i,s)),l=this.remuxVideo(t,p,n,r)}}else b&&(l=this.remuxVideo(t,p,n,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(h=Dc(n,i,this._initPTS,this._initDTS)),r.samples.length&&(d=Pc(r,i,this._initPTS))),{audio:c,video:l,initSegment:u,independent:f,text:d,id3:h}}computeInitPts(e,t,n,r){const i=Math.round(n*t);let s=_c(e,i);if(s<i+t)for(this.log("Adjusting PTS for rollover in timeline near ".concat((i-s)/t," ").concat(r));s<i+t;)s+=8589934592;return s-i}generateIS(e,t,n,r){const i=e.samples,s=t.samples,a=this.typeSupported,o={},l=this._initPTS;let c,u,d,h=!l||r,f="audio/mp4",g=-1;if(h&&(c=u=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):Sc.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(g=e.id,d=e.inputTimeScale,l&&d===l.timescale?h=!1:c=u=this.computeInitPts(i[0].pts,d,n,"audio"))}if(t.sps&&t.pps&&s.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Sc.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(g=t.id,d=t.inputTimeScale,l&&d===l.timescale)h=!1;else{const e=this.getVideoStartPts(s),t=_c(s[0].dts,e),r=this.computeInitPts(t,d,n,"video"),i=this.computeInitPts(e,d,n,"video");u=Math.min(u,r),c=Math.min(c,i)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,h?(l&&this.warn("Timestamps at playlist time: ".concat(r?"":"~").concat(n," ").concat(c/d," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(n," offset: ").concat(c/d," (").concat(c,"/").concat(d,") trackId: ").concat(g)),this._initPTS={baseTime:c,timescale:d,trackId:g},this._initDTS={baseTime:u,timescale:d,trackId:g}):c=d=void 0,{tracks:o,initPTS:c,timescale:d,trackId:g}}remuxVideo(e,t,n,r){const i=e.inputTimeScale,s=e.samples,a=[],o=s.length,l=this._initPTS,c=l.baseTime*i/l.timescale;let u,d,h=this.nextVideoTs,f=8,g=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=!1;if(!n||null===h){const e=c+t*i,r=s[0].pts-_c(s[0].dts,s[0].pts);Lc&&null!==h&&Math.abs(e-r-(h+c))<15e3?n=!0:h=e-r-c}const y=h+c;for(let N=0;N<o;N++){const e=s[N];e.pts=_c(e.pts,y),e.dts=_c(e.dts,y),e.dts<s[N>0?N-1:N].dts&&(v=!0)}v&&s.sort(function(e,t){const n=e.dts-t.dts,r=e.pts-t.pts;return n||r}),u=s[0].dts,d=s[s.length-1].dts;const E=d-u,b=E?Math.round(E/(o-1)):g||e.inputTimeScale/30;if(n){const n=u-y,r=n>b,i=n<-1;if((r||i)&&(r?this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(kc(n,!0)," ms (").concat(n,"dts) hole between fragments detected at ").concat(t.toFixed(3))):this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(kc(-n,!0)," ms (").concat(n,"dts) overlapping between fragments detected at ").concat(t.toFixed(3))),!i||y>=s[0].pts||Lc)){u=y;const e=s[0].pts-n;if(r)s[0].dts=u,s[0].pts=e;else{let t=!0;for(let r=0;r<s.length&&!(s[r].dts>e&&t);r++){const e=s[r].pts;if(s[r].dts-=n,s[r].pts-=n,r<s.length-1){const n=s[r+1].pts;t=n<=s[r].pts==n<=e}}}this.log("Video: Initial PTS/DTS adjusted: ".concat(kc(e,!0),"/").concat(kc(u,!0),", delta: ").concat(kc(n,!0)," ms"))}}u=Math.max(0,u);let S=0,T=0,k=u;for(let N=0;N<o;N++){const e=s[N],t=e.units,n=t.length;let r=0;for(let i=0;i<n;i++)r+=t[i].data.length;T+=r,S+=n,e.length=r,e.dts<k?(e.dts=k,k+=b/4|0||1):k=e.dts,p=Math.min(e.pts,p),m=Math.max(e.pts,m)}d=s[o-1].dts;const x=T+4*S+8;let w;try{w=new Uint8Array(x)}catch(O){return void this.observer.emit(Hr.ERROR,Hr.ERROR,{type:Gr.MUX_ERROR,details:Kr.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:x,reason:"fail allocating video mdat ".concat(x)})}const L=new DataView(w.buffer);L.setUint32(0,x),w.set(Sc.types.mdat,4);let A=!1,R=Number.POSITIVE_INFINITY,I=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,D=Number.NEGATIVE_INFINITY;for(let N=0;N<o;N++){const e=s[N],t=e.units;let n,l=0;for(let r=0,i=t.length;r<i;r++){const e=t[r],n=e.data,i=e.data.byteLength;L.setUint32(f,i),f+=4,w.set(n,f),f+=i,l+=4+i}if(N<o-1)g=s[N+1].dts-e.dts,n=s[N+1].pts-e.pts;else{const t=this.config,a=N>0?e.dts-s[N-1].dts:b;if(n=N>0?e.pts-s[N-1].pts:b,t.stretchShortVideoTrack&&null!==this.nextAudioTs){const n=Math.floor(t.maxBufferHole*i),s=(r?p+r*i:this.nextAudioTs+c)-e.pts;s>n?(g=s-a,g<0?g=a:A=!0,this.log("It is approximately ".concat(s/90," ms to the next segment; using duration ").concat(g/90," ms for the last video frame."))):g=a}else g=a}const u=Math.round(e.pts-e.dts);R=Math.min(R,g),_=Math.max(_,g),I=Math.min(I,n),D=Math.max(D,n),a.push(Rc(e.key,g,l,u))}if(a.length)if(Lc){if(Lc<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Ac&&D-I<_-R&&b/_<.025&&0===a[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,n=a.length;t<n;t++){const r=e+a[t].duration,i=e+a[t].cts;if(t<n-1){const e=r+a[t+1].cts;a[t].duration=e-i}else a[t].duration=t?a[t-1].duration:b;a[t].cts=0,e=r}}g=A||!g?b:g;const P=d+g;this.nextVideoTs=h=P-c,this.videoSampleDuration=g,this.isVideoContiguous=!0;const C={data1:Sc.moof(e.sequenceNumber++,u,ei(e,{samples:a})),data2:w,startPTS:(p-c)/i,endPTS:(m+g-c)/i,startDTS:(u-c)/i,endDTS:h/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,C}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,n,r,i){const s=e.inputTimeScale,a=s/(e.samplerate?e.samplerate:s),o=this.getSamplesPerFrame(e),l=o*a,c=this._initPTS,u="mp3"===e.segmentCodec&&this.typeSupported.mpeg,d=[],h=void 0!==i;let f=e.samples,g=u?0:8,p=this.nextAudioTs||-1;const m=c.baseTime*s/c.timescale,v=m+t*s;if(this.isAudioContiguous=n=n||f.length&&p>0&&(r&&Math.abs(v-(p+m))<9e3||Math.abs(_c(f[0].pts,v)-(p+m))<20*l),f.forEach(function(e){e.pts=_c(e.pts,v)}),!n||p<0){const e=f.length;if(f=f.filter(e=>e.pts>=0),e!==f.length&&this.warn("Removed ".concat(f.length-e," of ").concat(e," samples (initPTS ").concat(m," / ").concat(s,")")),!f.length)return;p=0===i?0:r&&!h?Math.max(0,v-m):f[0].pts-m}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let n=0,r=p+m;n<f.length;n++){const i=f[n],a=i.pts,o=a-r,c=Math.abs(1e3*o/s);if(o<=-t*l&&h)0===n&&(this.warn("Audio frame @ ".concat((a/s).toFixed(3),"s overlaps marker by ").concat(Math.round(1e3*o/s)," ms.")),this.nextAudioTs=p=a-m,r=a);else if(o>=t*l&&c<1e4&&h){let t=Math.round(o/l);for(r=a-t*l;r<0&&t&&l;)t--,r+=l;0===n&&(this.nextAudioTs=p=r-m),this.warn("Injecting ".concat(t," audio frames @ ").concat(((r-m)/s).toFixed(3),"s due to ").concat(Math.round(1e3*o/s)," ms gap."));for(let s=0;s<t;s++){let t=Ec.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=i.unit.subarray()),f.splice(n,0,{unit:t,pts:r}),r+=l,n++}}i.pts=r,r+=l}}let y,E=null,b=null,S=0,T=f.length;for(;T--;)S+=f[T].unit.byteLength;for(let _=0,D=f.length;_<D;_++){const t=f[_],r=t.unit;let i=t.pts;if(null!==b){d[_-1].duration=Math.round((i-b)/a)}else{if(n&&"aac"===e.segmentCodec&&(i=p+m),E=i,!(S>0))return;S+=g;try{y=new Uint8Array(S)}catch(I){return void this.observer.emit(Hr.ERROR,Hr.ERROR,{type:Gr.MUX_ERROR,details:Kr.REMUX_ALLOC_ERROR,fatal:!1,error:I,bytes:S,reason:"fail allocating audio mdat ".concat(S)})}if(!u){new DataView(y.buffer).setUint32(0,S),y.set(Sc.types.mdat,4)}}y.set(r,g);const s=r.byteLength;g+=s,d.push(Rc(!0,o,s,0)),b=i}const k=d.length;if(!k)return;const x=d[d.length-1];p=b-m,this.nextAudioTs=p+a*x.duration;const w=u?new Uint8Array(0):Sc.moof(e.sequenceNumber++,E/a,ei({},e,{samples:d}));e.samples=[];const L=(E-m)/s,A=this.nextAudioTs/s,R={data1:w,data2:y,startPTS:L,endPTS:A,startDTS:L,endDTS:A,type:"audio",hasAudio:!0,hasVideo:!1,nb:k};return this.isAudioContiguous=!0,R}}function _c(e,t){let n;if(null===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}function Dc(e,t,n,r){const i=e.samples.length;if(!i)return;const s=e.inputTimeScale;for(let o=0;o<i;o++){const i=e.samples[o];i.pts=_c(i.pts-n.baseTime*s/n.timescale,t*s)/s,i.dts=_c(i.dts-r.baseTime*s/r.timescale,t*s)/s}const a=e.samples;return e.samples=[],{samples:a}}function Pc(e,t,n){const r=e.samples.length;if(!r)return;const i=e.inputTimeScale;for(let a=0;a<r;a++){const r=e.samples[a];r.pts=_c(r.pts-n.baseTime*i/n.timescale,t*i)/i}e.samples.sort((e,t)=>e.pts-t.pts);const s=e.samples;return e.samples=[],{samples:s}}function Cc(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==(null==e?void 0:e.start)?(e.start+(n?e.duration:0))/e.timescale:t}function Oc(e,t,n){const r=e.codec;if(r&&r.length>4)return r;if(t===bi){if("ec-3"===r||"ac-3"===r||"alac"===r)return r;if("fLaC"===r||"Opus"===r){return us(r,!1)}return n.warn('Unhandled audio codec "'.concat(r,'" in mp4 MAP')),r||"mp4a"}return n.warn('Unhandled video codec "'.concat(r,'" in mp4 MAP')),r||"avc1"}try{wc=self.performance.now.bind(self.performance)}catch(sf){wc=Date.now}const Nc=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const i=this.videoTrack=Kl("video",1),s=this.audioTrack=Kl("audio",1),a=this.txtTrack=Kl("text",1);if(this.id3Track=Kl("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Ui(e);if(o.video){const{id:e,timescale:t,codec:n,supplemental:r}=o.video;i.id=e,i.timescale=a.timescale=t,i.codec=n,i.supplemental=r}if(o.audio){const{id:e,timescale:t,codec:n}=o.audio;s.id=e,s.timescale=t,s.codec=n}a.id=_i.text,i.sampleDuration=0,i.duration=s.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let n=0;n<t;){const r=Ci(e,n);if(r>8&&109===e[n+4]&&111===e[n+5]&&111===e[n+6]&&102===e[n+7])return!0;n=r>1?n+r:t}return!1}(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Wi(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},n=Mi(e,["moof"]);if(n.length<2)return t.remainder=e,t;const r=n[n.length-1];return t.valid=e.slice(0,r.byteOffset-8),t.remainder=e.slice(r.byteOffset-8),t}(n);this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array}else r.samples=n;const s=this.extractID3Track(r,t);return i.samples=Yi(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=Yi(e,t),{videoTrack:t,audioTrack:Kl(),id3Track:r,textTrack:Kl()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=Mi(e.samples,["emsg"]);r&&r.forEach(e=>{const r=function(e){const t=e[0];let n="",r="",i=0,s=0,a=0,o=0,l=0,c=0;if(0===t){for(;"\0"!==Di(e.subarray(c,c+1));)n+=Di(e.subarray(c,c+1)),c+=1;for(n+=Di(e.subarray(c,c+1)),c+=1;"\0"!==Di(e.subarray(c,c+1));)r+=Di(e.subarray(c,c+1)),c+=1;r+=Di(e.subarray(c,c+1)),c+=1,i=Ci(e,12),s=Ci(e,16),o=Ci(e,20),l=Ci(e,24),c=28}else if(1===t){c+=4,i=Ci(e,c),c+=4;const t=Ci(e,c);c+=4;const s=Ci(e,c);for(c+=4,a=2**32*t+s,Br(a)||(a=Number.MAX_SAFE_INTEGER,ci.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Ci(e,c),c+=4,l=Ci(e,c),c+=4;"\0"!==Di(e.subarray(c,c+1));)n+=Di(e.subarray(c,c+1)),c+=1;for(n+=Di(e.subarray(c,c+1)),c+=1;"\0"!==Di(e.subarray(c,c+1));)r+=Di(e.subarray(c,c+1)),c+=1;r+=Di(e.subarray(c,c+1)),c+=1}return{schemeIdUri:n,value:r,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(ic.test(r.schemeIdUri)){const e=sc(r,t);let i=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;i<=.001&&(i=Number.POSITIVE_INFINITY);const s=r.payload;n.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:Gl.emsg,duration:i})}else if(this.config.enableEmsgKLVMetadata&&r.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=sc(r,t);n.samples.push({data:r.payload,len:r.payload.byteLength,dts:e,pts:e,type:Gl.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends ri{constructor(e,t,n,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:i,video:s}=this.initData=Ui(e);if(t)!function(e,t){if(!e||!t)return;const n=t.keyId;n&&t.isCommonEncryption&&Vi(e,(e,t)=>{const r=e.subarray(8,24);r.some(e=>0!==e)||(ci.log("[eme] Patching keyId in 'enc".concat(t?"a":"v",">sinf>>tenc' box: ").concat(fi(r)," -> ").concat(fi(n))),e.set(n,8))})}(e,t);else{const e=i||s;null!=e&&e.encrypted&&this.warn('Init segment with encrypted track with has no key ("'.concat(e.codec,'")!'))}i&&(n=Oc(i,bi,this)),s&&(r=Oc(s,Si,this));const a={};i&&s?a.audiovideo={container:"video/mp4",codec:n+","+r,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:e,id:"main"}:i?a.audio={container:"audio/mp4",codec:n,encrypted:i.encrypted,initSegment:e,id:"audio"}:s?a.video={container:"video/mp4",codec:r,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,r,i,s){var a,o;let{initPTS:l,lastEndTime:c}=this;const u={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};Ur(c)||(c=this.lastEndTime=i||0);const d=t.samples;if(!d.length)return u;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(d),f=this.initData),null==(o=f)||!o.length)return this.warn("Failed to generate initSegment."),u;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const g=function(e,t,n){const r={},i=Mi(e,["moof","traf"]);for(let s=0;s<i.length;s++){const e=i[s],a=Mi(e,["tfhd"])[0],o=Ci(a,4),l=t[o];if(!l)continue;r[o]||(r[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const c=r[o],u=Mi(e,["tfdt"])[0];if(u){const e=u[0];let t=Ci(u,4);1===e&&(t===Ri?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=Ri+1,t+=Ci(u,8))),Ur(t)&&(!Ur(c.start)||t<c.start)&&(c.start=t)}const d=l.default,h=Ci(a,0)|(null==d?void 0:d.flags);let f=(null==d?void 0:d.duration)||0;8&h&&(f=Ci(a,2&h?12:8));const g=Mi(e,["trun"]);let p=c.start||0,m=0,v=f;for(let t=0;t<g.length;t++){const e=g[t],n=Ci(e,4),r=c.sampleCount;c.sampleCount+=n;const i=1&e[3],s=4&e[3],a=1&e[2],o=2&e[2],l=4&e[2],u=8&e[2];let d=8,h=n;for(i&&(d+=4),s&&n&&(1&e[d+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=r),d+=4,a?(v=Ci(e,d),d+=4):v=f,o&&(d+=4),u&&(d+=4),p+=v,m+=v,h--);h--;)a?(v=Ci(e,d),d+=4):v=f,o&&(d+=4),l&&(1&e[d+1]||void 0===c.keyFrameIndex&&(c.keyFrameIndex=c.sampleCount-(h+1),c.keyFrameStart=p),d+=4),u&&(d+=4),p+=v,m+=v;!m&&f&&(m+=f*n)}c.duration+=m}if(!Object.keys(r).some(e=>r[e].duration)){let t=1/0,n=0;const i=Mi(e,["sidx"]);for(let e=0;e<i.length;e++){const r=Fi(i[e]);if(null!=r&&r.references){t=Math.min(t,r.earliestPresentationTime/r.timescale);const e=r.references.reduce((e,t)=>e+t.info.duration||0,0);n=Math.max(n,e+r.earliestPresentationTime/r.timescale)}}n&&Ur(n)&&Object.keys(r).forEach(e=>{r[e].duration||(r[e].duration=n*r[e].timescale-r[e].start)})}return r}(d,f,this),p=f.audio?g[f.audio.id]:null,m=f.video?g[f.video.id]:null,v=Cc(m,1/0),y=Cc(p,1/0),E=Cc(m,0,!0),b=Cc(p,0,!0);let S=i,T=0;const k=p&&(!m||!l&&y<v||l&&l.trackId===f.audio.id),x=k?p:m;if(x){const e=x.timescale,t=x.start-i*e,n=k?f.audio.id:f.video.id;S=x.start/e,T=k?b-y:E-v,!s&&l||!function(e,t,n,r){if(null===e)return!0;const i=Math.max(r,1),s=t-e.baseTime/e.timescale;return Math.abs(s-n)>i}(l,S,i,T)&&e===l.timescale||(l&&this.warn("Timestamps at playlist time: ".concat(s?"":"~").concat(i," ").concat(t/e," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(i," offset: ").concat(S-i," (").concat(t,"/").concat(e,") trackId: ").concat(n)),l=null,h.initPTS=t,h.timescale=e,h.trackId=n)}else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(i));l?(h.initPTS=l.baseTime,h.timescale=l.timescale,h.trackId=l.trackId):(h.timescale&&void 0!==h.trackId&&void 0!==h.initPTS||(this.warn("Could not set initPTS"),h.initPTS=S,h.timescale=1,h.trackId=-1),this.initPTS=l={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const w=S-l.baseTime/l.timescale,L=w+T;T>0?this.lastEndTime=L:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const A=!!f.audio,R=!!f.video;let I="";A&&(I+="audio"),R&&(I+="video");const _={data1:d,startPTS:w,startDTS:w,endPTS:L,endDTS:L,type:I,hasAudio:A,hasVideo:R,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};u.audio=A&&!R?_:void 0,u.video=R?_:void 0;const D=null==m?void 0:m.sampleCount;if(D){const e=m.keyFrameIndex,t=-1!==e;_.nb=D,_.dropped=0===e||this.isVideoContiguous?0:t?e:D,_.independent=t,_.firstKeyFrame=e,t&&m.keyFrameStart&&(_.firstKeyFramePTS=(m.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(u.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),_.dropped&&this.warn("fmp4 does not start with IDR: firstIDR ".concat(e,"/").concat(D," dropped: ").concat(_.dropped," start: ").concat(_.firstKeyFramePTS||"NA"))}return u.initSegment=h,u.id3=Dc(n,i,l,l),r.samples.length&&(u.text=Pc(r,i,l)),u}}},{demux:hc,remux:Ic},{demux:class extends Hl{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=kl(e,0);let r=(null==n?void 0:n.length)||0;if(ec(e,r))return!1;for(let i=e.length;r<i;r++)if(Rl(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&xl(e,t)&&Ll(e,t)<=e.length-t}(e,t)}appendFrame(e,t,n){Il(e,this.observer,t,n,e.manifestCodec);const r=Dl(e,t,n,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:Ic},{demux:class extends Hl{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=kl(e,0);let n=(null==t?void 0:t.length)||0;if(t&&11===e[n]&&119===e[n+1]&&void 0!==jl(t)&&tc(e,n)<=16)return!1;for(let r=e.length;n<r;n++)if(ec(e,n))return ci.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Jl(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,n){if(null!==this.basePTS)return Xl(e,t,n,this.basePTS,this.frameIndex)}},remux:Ic}];Nc.splice(2,0,{demux:nc,remux:Ic});class Mc{constructor(e,t,n,r,i,s){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=i,this.logger=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const i=n.transmuxing;i.executeStart=wc();let s=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;r&&(this.currentTransmuxState=r);const{contiguous:l,discontinuity:c,trackSwitch:u,accurateTimeOffset:d,timeOffset:h,initSegmentChange:f}=r||a,{audioCodec:g,videoCodec:p,defaultInitPts:m,duration:v,initSegmentData:y}=o,E=function(e,t){let n=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(n=t);return n}(s,t);if(E&&Ya(E.method)){const e=this.getDecrypter(),t=qa(E.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(s,E.key.buffer,E.iv.buffer,t).then(e=>{const t=this.push(e,null,n);return this.decryptionPromise=null,t}),this.decryptionPromise;{let r=e.softwareDecrypt(s,E.key.buffer,E.iv.buffer,t);if(n.part>-1){const t=e.flush();r=t?t.buffer:t}if(!r)return i.executeEnd=wc(),Fc(n);s=new Uint8Array(r)}}const b=this.needsProbing(c,u);if(b){const e=this.configureTransmuxer(s);if(e)return this.logger.warn("[transmuxer] ".concat(e.message)),this.observer.emit(Hr.ERROR,Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),i.executeEnd=wc(),Fc(n)}(c||u||f||b)&&this.resetInitSegment(y,g,p,v,t),(c||f||b)&&this.resetInitialTimestamp(m),l||this.resetContiguity();const S=this.transmux(s,E,h,d,n);this.asyncResult=Uc(S);const T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,i.executeEnd=wc(),S}flush(e){const t=e.transmuxing;t.executeStart=wc();const{decrypter:n,currentTransmuxState:r,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const s=[],{timeOffset:a}=r;if(n){const t=n.flush();t&&s.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=wc();const n=[Fc(e)];return this.asyncResult?Promise.resolve(n):n}const c=o.flush(a);return Uc(c)?(this.asyncResult=!0,c.then(t=>(this.flushRemux(s,t,e),s))):(this.flushRemux(s,c,e),this.asyncResult?Promise.resolve(s):s)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:i,id3Track:s,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log("[transmuxer.ts]: Flushed ".concat(this.id," sn: ").concat(n.sn).concat(n.part>-1?" part: "+n.part:""," of ").concat(this.id===qr?"level":"track"," ").concat(n.level));const c=this.remuxer.remux(r,i,s,a,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=wc()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,i){const{demuxer:s,remuxer:a}=this;s&&a&&(s.resetInitSegment(e,t,n,r),a.resetInitSegment(e,t,n,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,i){let s;return s=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,r,i):this.transmuxUnencrypted(e,n,r,i),s}transmuxUnencrypted(e,t,n,r){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,s,a,o,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,i){return this.demuxer.demuxSampleAes(e,t,n).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,r,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let i;for(let u=0,d=Nc.length;u<d;u++){var s;if(null!=(s=Nc[u].demux)&&s.probe(e,this.logger)){i=Nc[u];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=i.remux,c=i.demux;o&&o instanceof l||(this.remuxer=new l(n,t,r,this.logger)),a&&a instanceof c||(this.demuxer=new c(n,t,r,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new ka(this.config)),e}}const Fc=e=>({remuxResult:{},chunkMeta:e});function Uc(e){return"then"in e&&e.then instanceof Function}class Bc{constructor(e,t,n,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=i||null}}class jc{constructor(e,t,n,r,i,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=i,this.initSegmentChange=s}}let Gc=0;class Kc{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Gc++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,n=this.hls;if(n&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var r;const e=null==(r=this.workerContext)?void 0:r.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":n.logger[t.data.logType]&&n.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,n.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));this.hls.config.enableWorker=!1,this.hls.logger.warn('Error in "'.concat(this.id,'" Web Worker, fallback to inline')),this.hls.trigger(Hr.ERROR,{type:Gr.OTHER_ERROR,details:Kr.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const s=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===Hr.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new vl,this.observer.on(Hr.FRAG_DECRYPTED,s),this.observer.on(Hr.ERROR,s);const a=gs(i.preferManagedMediaSource);if(this.useWorker&&"undefined"!==typeof Worker){const n=this.hls.logger;if(i.workerPath||"function"===typeof __HLS_WORKER_BUNDLE__){try{i.workerPath?(n.log("loading Web Worker ".concat(i.workerPath,' for "').concat(t,'"')),this.workerContext=function(e){const t=El[e];if(t)return t.clientCount++,t;const n=new self.URL(e,self.location.href).href,r={worker:new self.Worker(n),scriptURL:n,clientCount:1};return El[e]=r,r}(i.workerPath)):(n.log('injecting Web Worker for "'.concat(t,'"')),this.workerContext=function(){const e=El[yl];if(e)return e.clientCount++,e;const t=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),n=self.URL.createObjectURL(t),r={worker:new self.Worker(n),objectURL:n,clientCount:1};return El[yl]=r,r}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:Cs(i)})}catch(sf){n.warn('Error setting up "'.concat(t,'" Web Worker, fallback to inline'),sf),this.terminateWorker(),this.error=null,this.transmuxer=new Mc(this.observer,a,i,"",t,e.logger)}return}}this.transmuxer=new Mc(this.observer,a,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Gc++;const t=this.hls.config,n=gs(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:Cs(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=El[e||yl];if(t&&1===t.clientCount--){const{worker:n,objectURL:r}=t;delete El[e||yl],r&&self.URL.revokeObjectURL(r),n.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,i,s,a,o,l,c){var u,d;l.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:f}=this,g=s?s.start:i.start,p=i.decryptdata,m=this.frag,v=!(m&&i.cc===m.cc),y=!(m&&l.level===m.level),E=m?l.sn-m.sn:-1,b=this.part?l.part-this.part.index:-1,S=0===E&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),T=!y&&(1===E||0===E&&(1===b||S&&b<=0)),k=self.performance.now();(y||E||0===i.stats.parsing.start)&&(i.stats.parsing.start=k),!s||!b&&T||(s.stats.parsing.start=k);const x=!(m&&(null==(u=i.initSegment)?void 0:u.url)===(null==(d=m.initSegment)?void 0:d.url)),w=new jc(v,T,o,y,g,x);if(!T||v||x){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for ".concat(i.type," sn: ").concat(l.sn).concat(l.part>-1?" part: "+l.part:""," ").concat(this.id===qr?"level":"track",": ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(v,"\n        trackSwitch: ").concat(y,"\n        contiguous: ").concat(T,"\n        accurateTimeOffset: ").concat(o,"\n        timeOffset: ").concat(g,"\n        initSegmentChange: ").concat(x));const e=new Bc(n,r,t,a,c);this.configureTransmuxer(e)}if(this.frag=i,this.part=s,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:w},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,p,l,w);Uc(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const t=n.flush(e);Uc(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class Hc extends ri{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=null==t?void 0:t.renditionReports;if(r){let s=-1;for(let n=0;n<r.length;n++){const a=r[n];let o;try{o=new self.URL(a.URI,t.url).href}catch(i){this.warn("Could not construct new URL for Rendition Report: ".concat(i)),o=a.URI||""}if(o===e){s=n;break}o===e.substring(0,o.length)&&(s=n)}if(-1!==s){const e=r[s],i=parseInt(e["LAST-MSN"])||t.lastPartSn;let a=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=n&&Rs(n);return new Is(i,a>=0?a:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(n))}return e}playlistLoaded(e,t,n){const{details:r,stats:i}=t,s=self.performance.now(),a=i.loading.first?Math.max(0,s-i.loading.first):0;r.advancedDateTime=Date.now()-a;const o=this.hls.config.timelineOffset;if(o!==r.appliedTimelineOffset){const e=Math.max(o||0,0);r.appliedTimelineOffset=e,r.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(r.live||null!=n&&n.live){const o="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){Oo(n,r,this);const e=r.playlistParsingError;if(e){this.warn(e);const n=this.hls;if(!n.config.ignorePlaylistParsingErrors){var l;const{networkDetails:s}=t;return void n.trigger(Hr.ERROR,{type:Gr.NETWORK_ERROR,details:Kr.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=r.fragments[0])?void 0:l.type,networkDetails:s,stats:i})}r.playlistParsingError=null}}-1===r.requestScheduled&&(r.requestScheduled=i.loading.start);const c=this.hls.mainForwardBufferInfo,u=c?c.end-c.len:0,d=Uo(r,1e3*(r.edge-u));if(r.requestScheduled+d<s?r.requestScheduled=s:r.requestScheduled+=d,this.log("live playlist ".concat(e," ").concat(r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED")),!this.canLoad||!r.live)return;let h,f,g;if(r.canBlockReload&&r.endSN&&r.advanced){const e=this.hls.config.lowLatencyMode,i=r.lastPartSn,a=r.endSN,l=r.lastPartIndex,c=i===a;-1!==l?c?(f=a+1,g=e?0:l):(f=i,g=e?l+1:r.maxPartIndex):f=a+1;const u=r.age,d=u+r.ageHeader;let p=Math.min(d-r.partTarget,1.5*r.targetduration);if(p>0){if(d>3*r.targetduration)this.log("Playlist last advanced ".concat(u.toFixed(2),"s ago. Omitting segment and part directives.")),f=void 0,g=void 0;else if(null!=n&&n.tuneInGoal&&d-r.partTarget>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(n.tuneInGoal," to: ").concat(p," with playlist age: ").concat(r.age)),p=0;else{const e=Math.floor(p/r.targetduration);if(f+=e,void 0!==g){g+=Math.round(p%r.targetduration/r.partTarget)}this.log("CDN Tune-in age: ".concat(r.ageHeader,"s last advanced ").concat(u.toFixed(2),"s goal: ").concat(p," skip sn ").concat(e," to part ").concat(g))}r.tuneInGoal=p}if(h=this.getDeliveryDirectives(r,t.deliveryDirectives,f,g),e||!c)return r.requestScheduled=s,void this.loadingPlaylist(o,h)}else(r.canBlockReload||r.canSkipUntil)&&(h=this.getDeliveryDirectives(r,t.deliveryDirectives,f,g));h&&void 0!==f&&r.canBlockReload&&(r.requestScheduled=i.loading.first+Math.max(d-2*a,d/2)),this.scheduleLoading(o,h,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r)return void this.loadingPlaylist(e,t);const i=self.performance.now(),s=r.requestScheduled;if(i>=s)return void this.loadingPlaylist(e,t);const a=s-i;this.log("reload live playlist ".concat(e.name||e.bitrate+"bps"," in ").concat(Math.round(a)," ms")),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,r){let i=Rs(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,i=ws),new Is(n,r,i)}checkRetry(e){const t=e.details,n=Ys(e),r=e.errorAction,{action:i,retryCount:s=0,retryConfig:a}=r||{},o=!!r&&!!a&&(i===ia||!r.resolved&&i===na);if(o){var l;if(s>=a.maxNumRetry)return!1;if(n&&null!=(l=e.context)&&l.deliveryDirectives)this.warn("Retrying playlist loading ".concat(s+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" without delivery-directives')),this.loadPlaylist();else{const e=$s(a,s);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn("Retrying playlist loading ".concat(s+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" in ').concat(e,"ms"))}e.levelRetry=!0,r.resolved=!0}return o}}function Vc(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!zc(e[n].attrs,t[n].attrs))return!1;return!0}function zc(e,t,n){const r=e["STABLE-RENDITION-ID"];return r&&!n?r===t["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>e[n]!==t[n])}function Wc(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class Yc{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(null===this.queues||null===this.tracks)return;const r=this.queues[t];r.push(e),1!==r.length||n||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=null==(t=e[0])?void 0:t.label;"async-blocker"!==n&&"async-blocker-prepend"!==n||(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(r){var n;if(i.onError(r),null===this.queues||null===this.tracks)return;const t=null==(n=this.tracks[e])?void 0:n.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":"\n".concat(this.list("video"),"\n").concat(this.list("audio"),"\n").concat(this.list("audiovideo"),"}")}list(e){var t,n;return null!=(t=this.queues)&&t[e]||null!=(n=this.tracks)&&n[e]?"".concat(e,": (").concat(this.listSbInfo(e),") ").concat(this.listOps(e)):""}listSbInfo(e){var t;const n=null==(t=this.tracks)?void 0:t[e],r=null==n?void 0:n.buffer;return r?"SourceBuffer".concat(r.updating?" updating":"").concat(n.ended?" ended":"").concat(n.ending?" ending":""):"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}const qc=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Qc="HlsJsTrackRemovedError";class Xc extends Error{constructor(e){super(e),this.name=Qc}}function $c(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function Jc(e){return"audio"===e?1:0}class Zc{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(Hr.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Hr.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(Hr.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Hr.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ur(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to ".concat(n,": ").concat(e[n].height,"p@").concat(e[n].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((t,n)=>this.isLevelAllowed(t)&&n<=e);return this.clientRect=null,Zc.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(rf){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,n){if(null==e||!e.length)return-1;const r=(e,t)=>!t||(e.width!==t.width||e.height!==t.height);let i=e.length-1;const s=Math.max(t,n);for(let a=0;a<e.length;a+=1){const t=e[a];if((t.width>=s||t.height>=s)&&r(t,e[a+1])){i=a;break}}return i}}const eu={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},tu={HLS:"h"};class nu{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof nu?e:new nu(e))),this.value=e,this.params=t}}function ru(e,t,n,r){return new Error("failed to ".concat(e,' "').concat((i=t,Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":"object"===typeof i?JSON.stringify(i):String(i)),'" as ').concat(n),{cause:r});var i}function iu(e,t,n){return ru("serialize",e,t,n)}class su{constructor(e){this.description=e}}const au="Bare Item";function ou(e){if(!1===ArrayBuffer.isView(e))throw iu(e,"Byte Sequence");return":".concat((t=e,btoa(String.fromCharCode(...t))),":");var t}function lu(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw iu(e,"Integer");return e.toString()}function cu(e,t){if(e<0)return-cu(-e,t);const n=Math.pow(10,t);if(Math.abs(e*n%1-.5)<Number.EPSILON){const t=Math.floor(e*n);return(t%2===0?t:t+1)/n}return Math.round(e*n)/n}function uu(e){const t=cu(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw iu(e,"Decimal");const n=t.toString();return n.includes(".")?n:"".concat(n,".0")}const du=/[\x00-\x1f\x7f]+/;function hu(e){const t=(n=e).description||n.toString().slice(7,-1);var n;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw iu(t,"Token");return t}function fu(e){switch(typeof e){case"number":if(!Ur(e))throw iu(e,au);return Number.isInteger(e)?lu(e):uu(e);case"string":return function(e){if(du.test(e))throw iu(e,"String");return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}(e);case"symbol":return hu(e);case"boolean":return function(e){if("boolean"!==typeof e)throw iu(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return"@".concat(lu(e.getTime()/1e3))}(e);if(e instanceof Uint8Array)return ou(e);if(e instanceof su)return hu(e);default:throw iu(e,au)}}function gu(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw iu(e,"Key");return e}function pu(e){return null==e?"":Object.entries(e).map(e=>{let[t,n]=e;return!0===n?";".concat(gu(t)):";".concat(gu(t),"=").concat(fu(n))}).join("")}function mu(e){return e instanceof nu?"".concat(fu(e.value)).concat(pu(e.params)):fu(e)}function vu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if("object"!==typeof e||null==e)throw iu(e,"Dict");const n=e instanceof Map?e.entries():Object.entries(e),r=(null===t||void 0===t?void 0:t.whitespace)?" ":"";return Array.from(n).map(e=>{let[t,n]=e;n instanceof nu===!1&&(n=new nu(n));let r=gu(t);var i;return!0===n.value?r+=pu(n.params):(r+="=",Array.isArray(n.value)?r+="(".concat((i=n).value.map(mu).join(" "),")").concat(pu(i.params)):r+=mu(n)),r}).join(",".concat(r))}function yu(e,t){return vu(e,t)}const Eu="CMCD-Object",bu="CMCD-Request",Su="CMCD-Session",Tu="CMCD-Status",ku={br:Eu,ab:Eu,d:Eu,ot:Eu,tb:Eu,tpb:Eu,lb:Eu,tab:Eu,lab:Eu,url:Eu,pb:bu,bl:bu,tbl:bu,dl:bu,ltc:bu,mtp:bu,nor:bu,nrr:bu,rc:bu,sn:bu,sta:bu,su:bu,ttfb:bu,ttfbb:bu,ttlb:bu,cmsdd:bu,cmsds:bu,smrt:bu,df:bu,cs:bu,ts:bu,cid:Su,pr:Su,sf:Su,sid:Su,st:Su,v:Su,msd:Su,bs:Tu,bsd:Tu,cdn:Tu,rtp:Tu,bg:Tu,pt:Tu,ec:Tu,e:Tu},xu=bu;function wu(e,t){const n={};if(!e)return n;const r=Object.keys(e),i=t?(s=t,Object.keys(s).reduce((e,t)=>{var n;return null===(n=s[t])||void 0===n||n.forEach(n=>e[n]=t),e},{})):{};var s;return r.reduce((t,n)=>{var r;const s=ku[n]||i[n]||xu;return(null!==(r=t[s])&&void 0!==r?r:t[s]={})[n]=e[n],t},n)}const Lu="event";const Au=e=>Math.round(e),Ru=(e,t)=>Array.isArray(e)?e.map(e=>Ru(e,t)):e instanceof nu&&"string"===typeof e.value?new nu(Ru(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){const n=new URL(e),r=new URL(t);if(n.origin!==r.origin)return e;const i=n.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")+n.search+n.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),Iu=e=>100*Au(e/100),_u={br:Au,d:Au,bl:Iu,dl:Iu,mtp:Iu,nor:(e,t)=>{let n=e;return t.version>=2&&(e instanceof nu&&"string"===typeof e.value?n=new nu([e]):"string"===typeof e&&(n=[e])),Ru(n,t)},rtp:Iu,tb:Au},Du="request",Pu="response",Cu=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Ou=["e"],Nu=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Mu(e){return Nu.test(e)}const Fu=["d","dl","nor","ot","rtp","su"];const Uu=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const Bu=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function ju(e){return Bu.includes(e)||Mu(e)}const Gu={[Pu]:function(e){return Cu.includes(e)||Fu.includes(e)||Uu.includes(e)||Mu(e)},[Lu]:function(e){return Cu.includes(e)||Ou.includes(e)||Mu(e)},[Du]:function(e){return Cu.includes(e)||Fu.includes(e)||Mu(e)}};function Ku(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(null==e||"object"!==typeof e)return n;const r=t.version||e.v||1,i=t.reportingMode||Du,s=1===r?ju:Gu[i];let a=Object.keys(e).filter(s);const o=t.filter;"function"===typeof o&&(a=a.filter(o));const l=i===Pu||i===Lu;l&&!a.includes("ts")&&a.push("ts"),r>1&&!a.includes("v")&&a.push("v");const c=ei({},_u,t.formatters),u={version:r,reportingMode:i,baseUrl:t.baseUrl};return a.sort().forEach(t=>{let i=e[t];const s=c[t];if("function"===typeof s&&(i=s(i,u)),"v"===t){if(1===r)return;i=r}"pr"==t&&1===i||(l&&"ts"===t&&!Ur(i)&&(i=Date.now()),function(e){return"number"===typeof e?Ur(e):null!=e&&""!==e&&!1!==e}(i)&&(function(e){return["ot","sf","st","e","sta"].includes(e)}(t)&&"string"===typeof i&&(i=new su(i)),n[t]=i))}),n}function Hu(e,t,n){return ei(e,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(!e)return n;const r=wu(Ku(e,t),null===t||void 0===t?void 0:t.customHeaderMap);return Object.entries(r).reduce((e,t)=>{let[n,r]=t;const i=yu(r,{whitespace:!1});return i&&(e[n]=i),e},n)}(t,n))}function Vu(e){if(!e)return"";const t=function(e){return e?yu(Ku(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),{whitespace:!1}):""}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return encodeURIComponent(t)}const zu=/CMCD=[^&#]+/;function Wu(e,t,n){const r=function(e){if(!e)return"";const t=Vu(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return"".concat("CMCD","=").concat(t)}(t,n);if(!r)return e;if(zu.test(e))return e.replace(zu,r);const i=e.includes("?")?"&":"?";return"".concat(e).concat(i).concat(r)}function Yu(e,t,n,r){e&&Object.keys(t).forEach(i=>{const s=e.filter(e=>e.groupId===i).map(e=>{const s=ei({},e);return s.details=void 0,s.attrs=new ja(s.attrs),s.url=s.attrs.URI=qu(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),s.groupId=s.attrs["GROUP-ID"]=t[i],s.attrs["PATHWAY-ID"]=r,s});e.push(...s)})}function qu(e,t,n,r){const{HOST:i,PARAMS:s,[n]:a}=r;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return i&&!o&&(l.host=i),s&&Object.keys(s).sort().forEach(e=>{e&&l.searchParams.set(e,s[e])}),l.href}class Qu extends ri{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Qu.CDMCleanupPromise?[Qu.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:t,initData:n}=e,r='"'.concat(e.type,'" event: init data type: "').concat(t,'"');if(this.debug(r),null!==n){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=oo(this.config));const t=e.map(ao).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(i=>{const s=so(i);if("sinf"!==t||s!==eo.FAIRPLAY)return void this.log('Ignoring "'.concat(e.type,'" event with init data type: "').concat(t,'" for selected key-system ').concat(s));let a;try{const e=Di(new Uint8Array(n)),t=zi(Qa(JSON.parse(e).sinf));if(!t)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(t.subarray(8,24))}catch(d){return void this.warn("".concat(r," Failed to parse sinf: ").concat(d))}const o=fi(a),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let u=l[o];for(let e=0;e<c.length;e++){const r=c[e],i=r.decryptdata;if(!i.keyId)continue;const s=fi(i.keyId);if(za(a,i.keyId)||-1!==i.uri.replace(/-/g,"").indexOf(o)){if(u=l[s],!u)continue;if(i.pssh)break;delete l[s],i.pssh=new Uint8Array(n),i.keyId=a,u=l[o]=u.then(()=>this.generateRequestWithPreferredKeySession(r,t,n,"encrypted-event-key-match")),u.catch(e=>this.handleError(e));break}}u||this.handleError(new Error("Key ID ".concat(o," not encountered in playlist. Key-system sessions ").concat(c.length,".")))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log('"'.concat(e.type,'" event'))},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Hr.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(Hr.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Hr.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(Hr.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=null==t?void 0:t[e];return r?r.licenseUrl:e===eo.WIDEVINE&&n?n:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error('no license server URL configured for key-system "'.concat(e,'"'));return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=null==t?void 0:t[e];if(n)return n.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}attemptKeySystemAccess(e){const t=this.hls.levels,n=(e,t,n)=>!!e&&n.indexOf(e)===t,r=t.map(e=>e.audioCodec).filter(n),i=t.map(e=>e.videoCodec).filter(n);return r.length+i.length===0&&i.push("avc1.42e01e"),new Promise((t,n)=>{const s=e=>{const a=e.shift();this.getMediaKeysPromise(a,r,i).then(e=>t({keySystem:a,mediaKeys:e})).catch(t=>{e.length?s(e):n(t instanceof Ju?t:new Ju({type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};s(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!==typeof n){let e="Configured requestMediaKeySystemAccess is not a function ".concat(n);return null===lo&&"http:"===self.location.protocol&&(e="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(e))}return n(e,t)}getMediaKeysPromise(e,t,n){var r;const i=function(e,t,n,r){let i;switch(e){case eo.FAIRPLAY:i=["cenc","sinf"];break;case eo.WIDEVINE:case eo.PLAYREADY:i=["cenc"];break;case eo.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(e))}return function(e,t,n,r){return[{initDataTypes:e,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:"audio/mp4; codecs=".concat(e),robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:n.map(e=>({contentType:"video/mp4; codecs=".concat(e),robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}(i,t,n,r)}(e,t,n,this.config.drmSystemOptions||{});let s=this.keySystemAccessPromises[e],a=null==(r=s)?void 0:r.keySystemAccess;if(!a){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(Cs(i))),a=this.requestMediaKeySystemAccess(e,i);const t=s=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(t=>{this.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))}),a.then(n=>{this.log('Access for key-system "'.concat(n.keySystem,'" obtained'));const r=this.fetchServerCertificate(e);this.log('Create media-keys for "'.concat(e,'"'));const i=t.mediaKeys=n.createMediaKeys().then(n=>(this.log('Media-keys created for "'.concat(e,'"')),t.hasMediaKeys=!0,r.then(t=>t?this.setMediaKeysServerCertificate(n,e,t):n)));return i.catch(t=>{this.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))}),i})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext(e){let{decryptdata:t,keySystem:n,mediaKeys:r}=e;this.log('Creating key-system session "'.concat(n,'" keyId: ').concat(fi(t.keyId||[])," keyUri: ").concat(t.uri));const i=r.createSession(),s={decryptdata:t,keySystem:n,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=Xu(t),i="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log('Updating key-session "'.concat(n.sessionId,'" for keyId ').concat(fi(e.decryptdata.keyId||[]),"\n      } (data length: ").concat(t.byteLength,")")),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(e=>{let{hasMediaKeys:t}=e;return!!t}).map(e=>{let{keySystem:t}=e;return ao(t)}).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:t,mediaKeys:n}=e;return this.attemptSetMediaKeys(t,n)})}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:r}=e;const i=ao(r);i?t(i):n(new Error('Unable to find format for key-system "'.concat(r,'"')))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=oo(this.config),n=e.map(so).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const r=$u(e,t[n]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,n=Xu(t),r=this.bannedKeyIds[n];if(r||"internal-error"===this.getKeyStatus(t)){const n=Zu(r||"internal-error",t);return this.handleError(n,e.frag),Promise.reject(n)}const i="(keyId: ".concat(n,' format: "').concat(t.keyFormat,'" method: ').concat(t.method," uri: ").concat(t.uri,")");this.log("Starting session for key ".concat(i));const s=this.keyIdToKeySessionPromise[n];if(!s){const r=this.getKeySystemForKeyPromise(t).then(n=>{let{keySystem:r,mediaKeys:s}=n;return this.throwIfDestroyed(),this.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(i)),this.attemptSetMediaKeys(r,s).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:r,mediaKeys:s,decryptdata:t})))}).then(e=>{const n=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",n,"playlist-key")});return r.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[n]=r,r}return s.catch(n=>{if(n instanceof Ju){const r=ni({},n.data);"internal-error"===this.getKeyStatus(t)&&(r.decryptdata=t);const i=new Ju(r,n.message);this.handleError(i,e.frag)}}),s}throwIfDestroyed(){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Ju){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error("".concat(e.message).concat(n?" (".concat(fi(n.keyId||[]),")"):"")),this.hls.trigger(Hr.ERROR,e.data)}else this.error(e.message),this.hls.trigger(Hr.ERROR,{type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Xu(e),n=this.keyIdToKeySessionPromise[t];if(!n){const t=so(e.keyFormat),n=t?[t]:oo(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=oo(this.config)),0===e.length)throw new Ju({type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(Cs({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));const r=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((e,n)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return n(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(e).catch(n)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log('Media-keys set for "'.concat(e,'"')),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===n.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,n,r){var i;const s=null==(i=this.config.drmSystems)||null==(i=i[e.keySystem])?void 0:i.generateRequest;if(s)try{const r=s.call(this.hls,t,n,e);if(!r)throw new Error("Invalid response from configured generateRequest filter");t=r.initDataType,n=r.initData?r.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(f){if(this.warn(f.message),this.hls&&this.hls.config.debug)throw f}if(null===n)return this.log('Skipping key-session request for "'.concat(r,'" (no initData)')),Promise.resolve(e);const a=Xu(e.decryptdata),o=e.decryptdata.uri;this.log('Generating key-session request for "'.concat(r,'" keyId: ').concat(a," URI: ").concat(o," (init data type: ").concat(t," length: ").concat(n.byteLength,")"));const l=new vl,c=e._onmessage=t=>{const n=e.mediaKeysSession;if(!n)return void l.emit("error",new Error("invalid state"));const{messageType:r,message:i}=t;this.log('"'.concat(r,'" message event for session "').concat(n.sessionId,'" message size: ').concat(i.byteLength)),"license-request"===r||"license-renewal"===r?this.renewLicense(e,i).catch(e=>{l.eventNames().length?l.emit("error",e):this.handleError(e)}):"license-release"===r?e.keySystem===eo.FAIRPLAY&&this.updateKeySession(e,Xa("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn('unhandled media key message type "'.concat(r,'"'))},u=(e,t)=>{let n;t.keyStatus=e,e.startsWith("usable")?l.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?n=Zu(e,t.decryptdata):"expired"===e?n=new Error("key expired (keyId: ".concat(a,")")):"released"===e?n=new Error("key released"):"status-pending"===e||this.warn('unhandled key status change "'.concat(e,'" (keyId: ').concat(a,")")),n&&(l.eventNames().length?l.emit("error",n):this.handleError(n))},d=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void l.emit("error",new Error("invalid state"));const n=this.getKeyStatuses(e);if(!Object.keys(n).some(e=>"status-pending"!==n[e]))return;if("expired"===n[a])return this.log("Expired key ".concat(Cs(n),' in key-session "').concat(e.mediaKeysSession.sessionId,'"')),void this.renewKeySession(e);let r=n[a];if(r)u(r,e);else{var i;const t=1e3;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(i=e.keyStatusTimeouts)[a]||(i[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const n=this.getKeyStatus(e.decryptdata);if(n&&"status-pending"!==n)return this.log("No status for keyId ".concat(a,' in key-session "').concat(e.mediaKeysSession.sessionId,'". Using session key-status ').concat(n," from other session.")),u(n,e);this.log("key status for ".concat(a,' in key-session "').concat(e.mediaKeysSession.sessionId,'" timed out after ').concat(t,"ms")),r="internal-error",u(r,e)},t)),this.log("No status for keyId ".concat(a," (").concat(Cs(n),")."))}};Xo(e.mediaKeysSession,"message",c),Xo(e.mediaKeysSession,"keystatuseschange",d);const h=new Promise((e,t)=>{l.on("error",t),l.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log('Request generated for key-session "'.concat(e.mediaKeysSession.sessionId,'" keyId: ').concat(a," URI: ").concat(o))}).catch(t=>{throw new Ju({type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},"Error generating key-session request: ".concat(t))}).then(()=>h).catch(t=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,r)=>{if("string"===typeof r&&"object"===typeof n){const e=r;r=n,n=e}const i="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===eo.PLAYREADY&&16===i.length){const e=fi(i);t[e]=n,$a(i)}const s=fi(i);"internal-error"===n&&(this.bannedKeyIds[s]=n),this.log('key status change "'.concat(n,'" for keyStatuses keyId: ').concat(s,' key-session "').concat(e.mediaKeysSession.sessionId,'"')),t[s]=n}),t}fetchServerCertificate(e){const t=this.config,n=new(0,t.loader)(t),r=this.getServerCertificateUrl(e);return r?(this.log('Fetching server certificate for "'.concat(e,'"')),new Promise((i,s)=>{const a={responseType:"arraybuffer",url:r},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{i(e.data)},onError:(t,n,i,o)=>{s(new Ju({type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:ni({url:a.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(r,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:(t,n,i)=>{s(new Ju({type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:a.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(r,")")))},onAbort:(e,t,n)=>{s(new Error("aborted"))}};n.load(a,l,c)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,i)=>{e.setServerCertificate(n).then(i=>{this.log("setServerCertificate ".concat(i?"success":"not supported by CDM"," (").concat(n.byteLength,') on "').concat(t,'"')),r(e)}).catch(e=>{i(new Ju({type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new Ju({type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=(new DOMParser).parseFromString(n,"application/xml"),i=r.querySelectorAll("HttpHeader");if(i.length>0){let t;for(let n=0,r=i.length;n<r;n++){var s,a;t=i[n];const r=null==(s=t.querySelector("name"))?void 0:s.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;r&&o&&e.setRequestHeader(r,o)}}const o=r.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return Xa(atob(l))}setupLicenseXHR(e,t,n,r){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,n,r)}).catch(s=>{if(!n.decryptdata)throw s;return e.open("POST",t,!0),i.call(this.hls,e,t,n,r)}).then(n=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:n||r}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,i)=>{const s=this.getLicenseServerUrlOrThrow(e.keySystem);this.log("Sending license request to URL: ".concat(s));const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log("License received ".concat(t instanceof ArrayBuffer?t.byteLength:t));const n=this.config.licenseResponseCallback;if(n)try{t=n.call(this.hls,a,s,e)}catch(o){this.error(o)}r(t)}else{const o=n.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)i(new Ju({type:Gr.KEY_SYSTEM_ERROR,details:Kr.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:s,data:void 0,code:a.status,text:a.statusText}},"License Request XHR failed (".concat(s,"). Status: ").concat(a.status," (").concat(a.statusText,")")));else{const n=l-this._requestLicenseFailureCount+1;this.warn("Retrying license request, ".concat(n," attempts left")),this.requestLicense(e,t).then(r,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,s,e,t).then(t=>{let{xhr:n,licenseChallenge:r}=t;e.keySystem==eo.PLAYREADY&&(r=this.unpackPlayReadyKeyMessage(n,r)),n.send(r)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,Xo(n,"encrypted",this.onMediaEncrypted),Xo(n,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&($o(e,"encrypted",this.onMediaEncrypted),$o(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,fo.clearKeyUriToKeyIdMap();const i=r.length;Qu.CDMCleanupPromise=Promise.all(r.map(e=>this.removeSession(e)).concat((null==n||null==(e=n.setMediaKeys(null))?void 0:e.catch(e=>{this.log("Could not clear media keys: ".concat(e)),this.hls&&this.hls.trigger(Hr.ERROR,{type:Gr.OTHER_ERROR,details:Kr.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: ".concat(e))})}))||Promise.resolve())).catch(e=>{this.log("Could not close sessions and clear media keys: ".concat(e)),this.hls&&this.hls.trigger(Hr.ERROR,{type:Gr.OTHER_ERROR,details:Kr.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: ".concat(e))})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,t){let{sessionKeys:n}=t;if(n&&this.config.emeEnabled&&!this.keyFormatPromise){const e=n.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log("Selecting key-system from session-keys ".concat(e.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:r}=e;if(t){this.log('Remove licenses and keys and close session "'.concat(t.sessionId,'" keyId: ').concat(fi((null==r?void 0:r.keyId)||[]))),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:s}=e;s&&Object.keys(s).forEach(e=>self.clearTimeout(s[e]));const{drmSystemOptions:a}=this.config,o=function(e){var t;return!!e&&("persistent-license"===e.sessionType||!(null==(t=e.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(a)?new Promise((e,n)=>{self.setTimeout(()=>n(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(n)}):Promise.resolve();return o.catch(e=>{this.log("Could not remove session: ".concat(e)),this.hls&&this.hls.trigger(Hr.ERROR,{type:Gr.OTHER_ERROR,details:Kr.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: ".concat(e))})}).then(()=>t.close()).catch(e=>{this.log("Could not close session: ".concat(e)),this.hls&&this.hls.trigger(Hr.ERROR,{type:Gr.OTHER_ERROR,details:Kr.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: ".concat(e))})})}return Promise.resolve()}}function Xu(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return fi(e.keyId)}function $u(e,t){return e.keyId&&t.mediaKeysSession.keyStatuses.has(e.keyId)?t.mediaKeysSession.keyStatuses.get(e.keyId):e.matches(t.decryptdata)?t.keyStatus:void 0}Qu.CDMCleanupPromise=void 0;class Ju extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Zu(e,t){const n="output-restricted"===e,r=n?Kr.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Kr.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ju({type:Gr.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:t},n?"HDCP level output restricted":'key status changed to "'.concat(e,'"'))}function ed(e,t){let n;try{n=new Event("addtrack")}catch(sf){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function td(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: ".concat(t))}catch(sf){ci.debug("[texttrack-utils]: ".concat(sf));try{const n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(r){ci.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(r))}}"disabled"===n&&(e.mode=n)}function nd(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues)for(let r=e.cues.length;r--;)t&&e.cues[r].removeEventListener("enter",t),e.removeCue(e.cues[r]);"disabled"===n&&(e.mode=n)}function rd(e,t,n,r){const i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0){const i=function(e,t,n){const r=[],i=function(e,t){if(t<=e[0].startTime)return 0;const n=e.length-1;if(t>e[n].endTime)return-1;let r,i=0,s=n;for(;i<=s;)if(r=Math.floor((s+i)/2),t<e[r].startTime)s=r-1;else{if(!(t>e[r].startTime&&i<n))return r;i=r+1}return e[i].startTime-t<t-e[s].startTime?i:s}(e,t);if(i>-1)for(let s=i,a=e.length;s<a;s++){const i=e[s];if(i.startTime>=t&&i.endTime<=n)r.push(i);else if(i.startTime>n)return r}return r}(e.cues,t,n);for(let t=0;t<i.length;t++)r&&!r(i[t])||e.removeCue(i[t])}"disabled"===i&&(e.mode=i)}function id(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];"subtitles"!==r.kind&&"captions"!==r.kind||!r.label||t.push(e[n])}return t}function sd(e){let t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}const ad=.025;let od=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function ld(e,t,n){return"".concat(e.identifier,"-").concat(n+1,"-").concat(sd(t))}class cd{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;if(e<=0||isNaN(n))return!1;if(0===n)return!0;return((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return ud(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-ud(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ur(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return ud(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ad))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?od.Range:od.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return'["'.concat((e=this).identifier,'" ').concat(e.cue.pre?"<pre>":e.cue.post?"<post>":"").concat(e.timelineStart.toFixed(2),"-").concat(e.resumeTime.toFixed(2),"]");var e}}function ud(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<ad)?t.start:t.start+t.duration}function dd(e,t,n){const r=new self.URL(e,n);return"data:"!==r.protocol&&r.searchParams.set("_HLS_primary_id",t),r}function hd(e,t){for(;null!=(n=e.assetList[++t])&&n.error;)var n;return t}function fd(e){const t=e.timelineStart,n=e.duration||0;return'["'.concat(e.identifier,'" ').concat(t.toFixed(2),"-").concat((t+n).toFixed(2),"]")}class gd{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(Hr.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=n,this.assetItem=r;const s=()=>{this.hasDetails=!0};i.once(Hr.LEVEL_LOADED,s),i.once(Hr.AUDIO_TRACK_LOADED,s),i.once(Hr.SUBTITLE_TRACK_LOADED,s),i.on(Hr.MEDIA_ATTACHING,(e,t)=>{let{media:n}=t;this.removeMediaListeners(),this.mediaAttached=n;this.interstitial.playoutLimit&&(n.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(Hr.BUFFER_APPENDED,()=>{const e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,i.trigger(Hr.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let n=this.assetItem.uri;try{n=dd(n,e.config.primarySessionId||"").href}catch(t){}e.loadSource(n)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,i=Pa.bufferInfo(e,r,0);return this.getAssetTime(i.end)>=n-.02}reachedPlayout(e){const t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Pa.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var r;null==(r=this.hls)||r.on(e,t)}once(e,t,n){var r;null==(r=this.hls)||r.once(e,t)}off(e,t,n){var r;null==(r=this.hls)||r.off(e,t)}toString(){var e;return"HlsAssetPlayer: ".concat(fd(this.assetItem)," ").concat(null==(e=this.hls)?void 0:e.sessionId," ").concat(this.appendInPlace?"append-in-place":"")}}class pd extends ri{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(void 0===t&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&null!=(i=r[n])&&i.event;){var i;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let i=n[r];if(t&&"primary"!==t&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const e=n[r].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if((null==(n=t[r].event)?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let i=0;i<r;i++){const e=n[i];if(!e.error){const n=e.timelineStart;if(t===n||t>n&&(t<n+(e.duration||0)||i===r-1))return i}}return 0}get assetIdAtEnd(){var e;const t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){const e=t.assetList,n=e[e.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,i=this.events,s=this.parseDateRanges(r,{url:n.url},t),a=Object.keys(r),o=i?i.filter(e=>!a.includes(e.identifier)):[];s.length&&s.sort((e,t)=>{const n=e.cue.pre,r=e.cue.post,i=t.cue.pre,s=t.cue.post;if(n&&!i)return-1;if(i&&!n)return 1;if(r&&!s)return 1;if(s&&!r)return-1;if(!n&&!i&&!r&&!s){const n=e.startTime,r=t.startTime;if(n!==r)return n-r}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=s,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.events||[];if(r.length||t.length||this.length<2){const i=this.items,s=this.parseSchedule(r,e);(n||t.length||(null==i?void 0:i.length)!==s.length||s.some((e,t)=>Math.abs(e.playout.start-i[t].playout.start)>.005||Math.abs(e.playout.end-i[t].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,n){const r=[],i=Object.keys(e);for(let s=0;s<i.length;s++){const a=i[s],o=e[a];if(o.isInterstitial){let e=this.eventMap[a];e?e.setDateRange(o):(e=new cd(o,t),this.eventMap[a]=e,!1===n&&(e.appendInPlace=n)),r.push(e)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,i=r.live?1/0:r.edge;let s=0;if((e=e.filter(e=>!e.error&&!(e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let r=0,o=0;if(e.forEach((t,a)=>{const l=t.cue.pre,c=t.cue.post,u=e[a-1]||null,d=t.appendInPlace,h=c?i:t.startOffset,f=t.duration,g=t.timelineOccupancy===od.Range?f:0,p=t.resumptionOffset,m=(null==u?void 0:u.startTime)===h,v=h+t.cumulativeDuration;let y=d?v+f:h+p;if(l||!c&&h<=0){const e=o;o+=g,t.timelineStart=v;const r=s;s+=f,n.push({event:t,start:v,end:y,playout:{start:r,end:s},integrated:{start:e,end:o}})}else{if(!(h<=i))return;{if(!m){const i=h-r;if(i>.033){const l=r,c=o;o+=i;const u=s;s+=i;const d={previousEvent:e[a-1]||null,nextEvent:t,start:l,end:l+i,playout:{start:u,end:s},integrated:{start:c,end:o}};n.push(d)}else i>0&&u&&(u.cumulativeDuration+=i,n[n.length-1].end=h)}c&&(y=v),t.timelineStart=v;const i=o;o+=g;const l=s;s+=f,n.push({event:t,start:v,end:y,playout:{start:l,end:s},integrated:{start:i,end:o}})}}const E=t.resumeTime;r=c||E>i?i:E}),r<i){var a;const e=r,t=o,l=i-r;o+=l;const c=s;s+=l,n.push({previousEvent:(null==(a=n[n.length-1])?void 0:a.event)||null,nextEvent:null,start:r,end:e+l,playout:{start:c,end:s},integrated:{start:t,end:o}})}this.setDurations(i,s,o)}else{const e=0;n.push({previousEvent:null,nextEvent:null,start:e,end:i,playout:{start:e,end:i},integrated:{start:e,end:i}}),this.setDurations(i,i,i)}return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let i=0,s=-1;e.forEach((a,o)=>{const l=a.cue.pre,c=a.cue.post,u=l?0:c?r:a.startTime;this.updateAssetDurations(a);if(s===u?a.cumulativeDuration=i:(i=0,s=u),!c&&a.snapOptions.in&&(a.resumeAnchor=Hs(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)}if(!a.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn("Could not change append strategy for abutting event ".concat(a)))}const d=Ur(a.resumeOffset)?a.resumeOffset:a.duration;i+=d})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;if(Math.abs(n-r)>ad)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with estimated timeline end ").concat(r)),!1;return!Object.keys(t).some(r=>{const i=t[r].details,s=i.edge;if(n>=s)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," past ").concat(r," playlist end ").concat(s)),!1;const a=Hs(null,i.fragments,n);if(!a)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," does not align with any fragments in ").concat(r," playlist (").concat(i.fragStart,"-").concat(i.fragmentEnd,")")),!0;const o="audio"===r?.175:0;return!(Math.abs(a.start-n)<ad+o||Math.abs(a.end-n)<ad+o)&&(this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with ").concat(r," fragment bounds (").concat(a.start,"-").concat(a.end," sn: ").concat(a.sn," cc: ").concat(a.cc,")")),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,i=!1;for(let s=0;s<e.assetList.length;s++){const a=e.assetList[s],o=t+n;a.startOffset=n,a.timelineStart=o,r||(r=null===a.duration),i||(i=!!a.error);n+=a.error?0:a.duration||0}e.duration=r&&!i?Math.max(n,e.duration):n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function md(e){return"[".concat(e.event?'"'+e.event.identifier+'"':"primary",": ").concat(e.start.toFixed(2),"-").concat(e.end.toFixed(2),"]")}class vd{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=dd(n,this.hls.sessionId,e.baseUrl)}catch(u){const t=this.assignAssetListError(e,Kr.ASSET_LIST_LOAD_ERROR,u,n);return void this.hls.trigger(Hr.ERROR,t)}t&&"data:"!==r.protocol&&r.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,s=new(0,i.loader)(i),a={responseType:"json",url:r.href},o=i.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,n,r,i)=>{const s=t.data,a=null==s?void 0:s.ASSETS;if(!Array.isArray(a)){const t=this.assignAssetListError(e,Kr.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),r.url,n,i);return void this.hls.trigger(Hr.ERROR,t)}e.assetListResponse=s,this.hls.trigger(Hr.ASSET_LIST_LOADED,{event:e,assetListResponse:s,networkDetails:i})},onError:(t,n,r,i)=>{const s=this.assignAssetListError(e,Kr.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status ".concat(t.code," ").concat(t.text," (").concat(n.url,")")),n.url,i,r);this.hls.trigger(Hr.ERROR,s)},onTimeout:(t,n,r)=>{const i=this.assignAssetListError(e,Kr.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST (".concat(n.url,")")),n.url,t,r);this.hls.trigger(Hr.ERROR,i)}};return s.load(a,l,c),this.hls.trigger(Hr.ASSET_LIST_LOADING,{event:e}),s}assignAssetListError(e,t,n,r,i,s){return e.error=n,{type:Gr.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:s,stats:i}}}function yd(e){var t;null==e||null==(t=e.play())||t.catch(()=>{})}function Ed(e,t){return"[".concat(e,"] Advancing timeline position to ").concat(t)}class bd{constructor(e){this.buffered=void 0;const t=(t,n,r)=>{if((n>>>=0)>r-1)throw new DOMException("Failed to execute '".concat(t,"' on 'TimeRanges': The index provided (").concat(n,") is greater than the maximum bound (").concat(r,")"));return e[n][t]};this.buffered={get length(){return e.length},end:n=>t("end",n,e.length),start:n=>t("start",n,e.length)}}}const Sd={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Td=e=>String.fromCharCode(Sd[e]||e),kd=15,xd=100,wd={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ld={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ad={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Rd={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Id=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class _d{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n="function"===typeof t?t():t;ci.log("".concat(this.time," [").concat(e,"] ").concat(n))}}}const Dd=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class Pd{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Cd{constructor(){this.uchar=" ",this.penState=new Pd}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Od{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Pd,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<xd;t++)this.chars.push(new Cd);this.logger=e}equals(e){for(let t=0;t<xd;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<xd;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<xd;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>xd&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=xd)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Td(e);this.pos>=xd?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<xd;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<xd;n++){const r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class Nd{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<kd;t++)this.rows.push(new Od(e));this.logger=e}reset(){for(let e=0;e<kd;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let n=0;n<kd;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<kd;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<kd;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Cs(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<kd;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const r=n.rows[e].cueStartTime,i=this.logger.time;if(null!==r&&null!==i&&r<i)for(let s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(n.rows[e+s])}}this.currRow=t;const n=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,r=Math.max(t-1,0);n.setCursor(e.indent),e.color=n.chars[r].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Cs(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let i=0;i<kd;i++){const n=this.rows[i].getTextString();n&&(r=i+1,e?t.push("Row "+r+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}getTextAndFormat(){return this.rows}}class Md{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Nd(n),this.nonDisplayedMemory=new Nd(n),this.lastOutputScreen=new Nd(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+Cs(t)),this.writeScreen.setPen(t)}outputDataUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Fd{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const r=this.logger=new _d;this.channels=[null,new Md(e,t,r),new Md(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const e=127&t[n],r=127&t[n+1];let i=!1,s=null;if(0===e&&0===r)continue;this.logger.log(3,()=>"["+Dd([t[n],t[n+1]])+"] -> ("+Dd([e,r])+")");const a=this.cmdHistory;if(e>=16&&e<=31){if(Bd(e,r,a)){Ud(null,null,a),this.logger.log(3,()=>"Repeated command ("+Dd([e,r])+") is dropped");continue}Ud(e,r,this.cmdHistory),i=this.parseCmd(e,r),i||(i=this.parseMidrow(e,r)),i||(i=this.parsePAC(e,r)),i||(i=this.parseBackgroundAttributes(e,r))}else Ud(null,null,a);if(!i&&(s=this.parseChars(e,r),s)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(s)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||s||this.logger.log(2,()=>"Couldn't parse cleaned data "+Dd([e,r])+" orig: "+Dd([t[n],t[n+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const n=20===e||21===e||23===e?1:2,r=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let n=0;if((17===e||25===e)&&t>=32&&t<=47){if(n=17===e?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return!!r&&(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Dd([e,t])+")"),!0)}return!1}parsePAC(e,t){let n;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const r=e<=23?1:2;n=t>=64&&t<=95?1===r?wd[e]:Ad[e]:1===r?Ld[e]:Rd[e];const i=this.channels[r];return!!i&&(i.setPAC(this.interpretPAC(n,t)),this.currentChannel=r,!0)}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1===(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}parseChars(e,t){let n,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){let e;e=17===i?t+80:18===i?t+112:t+144,this.logger.log(2,()=>"Special char '"+Td(e)+"' in channel "+n),r=[e]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+Dd(r).join(",")),r}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let n;const r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=Id[n],t%2===1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));const i=e<=23?1:2;return this.channels[i].setBkgData(r),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ud(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Ud(e,t,n){n.a=e,n.b=t}function Bd(e,t,n){return n.a===e&&n.b===t}var jd=function(){if(null!=Za&&Za.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!==typeof t)return!1;if(!Array.isArray(e))return!1;const n=t.toLowerCase();return!!~e.indexOf(n)&&n}function r(e){return n(t,e)}function i(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let i=1;for(;i<arguments.length;i++){const t=arguments[i];for(const n in t)e[n]=t[n]}return e}function s(t,s,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",u=!1,d=t,h=s,f=a,g=null,p="",m=!0,v="auto",y="start",E=50,b="middle",S=50,T="middle";Object.defineProperty(o,"id",i({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},l,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(o,"startTime",i({},l,{get:function(){return d},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},l,{get:function(){return h},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},l,{get:function(){return g},set:function(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},l,{get:function(){return p},set:function(t){const r=function(t){return n(e,t)}(t);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");p=r,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},l,{get:function(){return v},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},l,{get:function(){return y},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},l,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},l,{get:function(){return b},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},l,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},l,{get:function(){return T},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}();class Gd{decode(e,t){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Kd(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(r||0)}const n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}class Hd{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Vd(e,t,n,r){const i=r?e.split(r):[e];for(const s in i){if("string"!==typeof i[s])continue;const e=i[s].split(n);if(2!==e.length)continue;t(e[0],e[1])}}const zd=new jd(0,0,""),Wd="middle"===zd.align?"middle":"center";function Yd(e,t,n){const r=e;function i(){const t=Kd(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=i(),s(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.slice(3),s(),t.endTime=i(),s(),function(e,t){const r=new Hd;Vd(e,function(e,t){let i;switch(e){case"region":for(let i=n.length-1;i>=0;i--)if(n[i].id===t){r.set(e,n[i].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),r.integer(e,i[0]),r.percent(e,i[0])&&r.set("snapToLines",!1),r.alt(e,i[0],["auto"]),2===i.length&&r.alt("lineAlign",i[1],["start",Wd,"end"]);break;case"position":i=t.split(","),r.percent(e,i[0]),2===i.length&&r.alt("positionAlign",i[1],["start",Wd,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",Wd,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");let i=r.get("line","auto");"auto"===i&&-1===zd.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",Wd);let s=r.get("position","auto");"auto"===s&&50===zd.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(e,t)}function qd(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class Qd{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Gd,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function n(){let e=t.buffer,n=0;for(e=qd(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;const r=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),r}function r(e){Vd(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=n();const r=e.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==r||!r[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let i=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(i?i=!1:e=n(),t.state){case"HEADER":/:/.test(e)?r(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new jd(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Yd(e,t.cue,t.regionList)}catch(rf){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==e.indexOf("--\x3e");if(!e||n&&(i=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(rf){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(rf){e.onparsingerror&&e.onparsingerror(rf)}return e.onflush&&e.onflush(),this}}const Xd=/\r\n|\n\r|\n|\r/g,$d=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(n,n+t.length)===t};function Jd(e,t,n){return sd(e.toString())+sd(t.toString())+sd(n)}function Zd(e,t,n,r,i,s,a){const o=new Qd,l=hi(new Uint8Array(e)).trim().replace(Xd,"\n").split("\n"),c=[],u=t?function(e){return Tc(e,9e4,1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}(t.baseTime,t.timescale):0;let d,h="00:00.000",f=0,g=0,p=!0;o.oncue=function(e){const s=n[r];let a=n.ccOffset;const o=(f-u)/9e4;if(null!=s&&s.new&&(void 0!==g?a=n.ccOffset=s.start:function(e,t,n){let r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;null!=(s=i)&&s.new;){var s;e.ccOffset+=r.start-i.start,r.new=!1,r=i,i=e[r.prevCC]}e.presentationOffset=n}(n,r,o)),o){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));a=o-n.presentationOffset}const l=e.endTime-e.startTime,h=_c(9e4*(e.startTime+a-g),9e4*i)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const p=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(p)),e.id||(e.id=Jd(e.startTime,e.endTime,p)),e.endTime>0&&c.push(e)},o.onparsingerror=function(e){d=e},o.onflush=function(){d?a(d):s(c)},l.forEach(e=>{if(p){if($d(e,"X-TIMESTAMP-MAP=")){p=!1,e.slice(16).split(",").forEach(e=>{$d(e,"LOCAL:")?h=e.slice(6):$d(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{g=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ur(t)||!Ur(n)||!Ur(r)||!Ur(i))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*n,t+=6e4*r,t+=36e5*i,t}(h)/1e3}catch(t){d=t}return}""===e&&(p=!1)}o.parse(e+"\n")}),o.flush()}const eh="stpp.ttml.im1t",th=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,nh=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,rh={left:"start",center:"center",right:"end",start:"start",end:"end"};function ih(e,t,n,r){const i=Mi(new Uint8Array(e),["mdat"]);if(0===i.length)return void r(new Error("Could not parse IMSC1 mdat"));const s=i.map(e=>hi(e)),a=function(e,t){return Tc(e,t,1/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1),arguments.length>3&&void 0!==arguments[3]&&arguments[3])}(t.baseTime,1,t.timescale);try{s.forEach(e=>n(function(e,t){const n=(new DOMParser).parseFromString(e,"text/xml"),r=n.getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},s=Object.keys(i).reduce((e,t)=>(e[t]=r.getAttribute("ttp:".concat(t))||i[t],e),{}),a="preserve"!==r.getAttribute("xml:space"),o=ah(sh(r,"styling","style")),l=ah(sh(r,"layout","region")),c=sh(r,"body","[begin]");return[].map.call(c,e=>{const n=oh(e,a);if(!n||!e.hasAttribute("begin"))return null;const r=uh(e.getAttribute("begin"),s),i=uh(e.getAttribute("dur"),s);let c=uh(e.getAttribute("end"),s);if(null===r)throw ch(e);if(null===c){if(null===i)throw ch(e);c=r+i}const u=new jd(r-t,c-t,n);u.id=Jd(u.startTime,u.endTime,u.text);const d=function(e,t,n){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&n.hasOwnProperty(a)&&(i=n[a]);return s.reduce((n,s)=>{const a=lh(t,r,s)||lh(e,r,s)||lh(i,r,s);return a&&(n[s]=a),n},{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:h}=d;if(h){const e=rh[h];e&&(u.lineAlign=e),u.align=h}return ei(u,d),u}).filter(e=>null!==e)}(e,a)))}catch(o){r(o)}}function sh(e,t,n){const r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function ah(e){return e.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function oh(e,t){return[].slice.call(e.childNodes).reduce((e,n,r)=>{var i;return"br"===n.nodeName&&r?e+"\n":null!=(i=n.childNodes)&&i.length?oh(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent},"")}function lh(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function ch(e){return new Error("Could not parse ttml timestamp ".concat(e))}function uh(e,t){if(!e)return null;let n=Kd(e);return null===n&&(th.test(e)?n=function(e,t){const n=th.exec(e),r=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/t.frameRate}(e,t):nh.test(e)&&(n=function(e,t){const n=nh.exec(e),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),n}class dh{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function hh(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function fh(e,t){return!!e&&e.kind===hh(t)&&Wc(t,e)}function gh(e,t,n,r){return Math.min(t,r)-Math.max(e,n)}const ph=/\s/,mh={newCue(e,t,n,r){const i=[];let s,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let h=0;h<r.rows.length;h++)if(s=r.rows[h],o=!0,l=0,c="",!s.isEmpty()){var d;for(let e=0;e<s.chars.length;e++)ph.test(s.chars[e].uchar)&&o?l++:(c+=s.chars[e].uchar,o=!1);s.cueStartTime=t,t===n&&(n+=1e-4),l>=16?l--:l++;const r=qd(c.trim()),f=Jd(t,n,r);null!=e&&null!=(d=e.cues)&&d.getCueById(f)||(a=new u(t,n,r),a.id=f,a.line=h+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(a))}return e&&i.length&&(i.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),i.forEach(t=>td(e,t))),i}};const vh=/(\d+)-(\d+)\/(\d+)/;class yh{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Eh,this.controller=new self.AbortController,this.stats=new Ei}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const i=function(e,t){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(ei({},e.headers))};e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return n}(e,this.controller.signal),s="arraybuffer"===e.responseType,a=s?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=o&&Ur(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout);(Uc(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(n=>{var i;this.response=this.loader=n;const a=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},l-(a-r.loading.start)),!n.ok){const{status:e,statusText:t}=n;throw new bh(t||"fetch, bad network response",e,n)}r.loading.first=a,r.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=vh.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(Ur(e))return e}const n=e.get("Content-Length");if(n)return parseInt(n)}(n.headers)||r.total;const o=null==(i=this.callbacks)?void 0:i.onProgress;return o&&Ur(t.highWaterMark)?this.loadProgressively(n,r,e,t.highWaterMark,o):s?n.arrayBuffer():"json"===e.responseType?n.json():n.text()}).then(n=>{var i,s;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=n[a];l&&(r.loaded=r.total=l);const c={url:o.url,data:n,code:o.status},u=null==(i=this.callbacks)?void 0:i.onProgress;u&&!Ur(t.highWaterMark)&&u(r,e,n,o),null==(s=this.callbacks)||s.onSuccess(c,r,e,o)}).catch(t=>{var n;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const i=t&&t.code||0,s=t?t.message:null;null==(n=this.callbacks)||n.onError({code:i,text:s},e,t?t.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;const s=new fl,a=e.body.getReader(),o=()=>a.read().then(a=>{if(a.done)return s.dataLength&&i(t,n,s.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return t.loaded+=c,c<r||s.dataLength?(s.push(l),s.dataLength>=r&&i(t,n,s.flush().buffer,e)):i(t,n,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function Eh(e,t){return new self.Request(e.url,t)}class bh extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const Sh=/^age:\s*[\d.]+\s*$/im;class Th{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Ei,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return i(n,t.url)}).catch(e=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",t.url,!0),i(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(e=>{var i;null==(i=this.callbacks)||i.onError({code:n.status,text:e.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:s}=n.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=i&&Ur(i)?i:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,i=this.config;if(!n.aborted&&r>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const r=t.status,l="text"===t.responseType?t.responseText:null;if(r>=200&&r<300){const i=null!=l?l:t.response;if(null!=i){var s,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const o="arraybuffer"===t.responseType?i.byteLength:i.length;n.loaded=n.total=o,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first);const l=null==(s=this.callbacks)?void 0:s.onProgress;l&&l(n,e,i,t);const c={url:t.responseURL,data:i,code:r};return void(null==(a=this.callbacks)||a.onSuccess(c,n,e,t))}}const c=i.loadPolicy.errorRetry;var o;if(Zs(c,n.retry,!1,{url:e.url,data:void 0,code:r}))this.retry(c);else ci.error("".concat(r," while loading ").concat(e.url)),null==(o=this.callbacks)||o.onError({code:r,text:t.statusText},e,t,n)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(Zs(e,this.stats.retry,!0))this.retry(e);else{var t;ci.warn("timeout while loading ".concat(null==(t=this.context)?void 0:t.url));const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=$s(e,n.retry),n.retry++,ci.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==t?void 0:t.url,", retrying ").concat(n.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Sh.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const kh=ni(ni({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Th,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends ri{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:n,partCurrent:r,hls:i}=this,{autoLevelEnabled:s,media:a}=i;if(!n||!a)return;const o=performance.now(),l=r?r.stats:n.stats,c=r?r.duration:n.duration,u=o-l.loading.start,d=i.minAutoLevel,h=n.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||h<=d)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!s)return;const g=f>-1&&f!==h,p=!!e||g;if(!p&&(a.paused||!a.playbackRate||!a.readyState))return;const m=i.mainForwardBufferInfo;if(!p&&null===m)return;const v=this.bwEstimator.getEstimateTTFB(),y=Math.abs(a.playbackRate);if(u<=Math.max(v,c/(2*y)*1e3))return;const E=m?m.len/y:0,b=l.loading.first?l.loading.first-l.loading.start:-1,S=l.loaded&&b>-1,T=this.getBwEstimate(),k=i.levels,x=k[h],w=Math.max(l.loaded,Math.round(c*(n.bitrate||x.averageBitrate)/8));let L=S?u-b:u;L<1&&S&&(L=Math.min(u,8*l.loaded/T));const A=S?1e3*l.loaded/L:0,R=v/1e3,I=A?(w-l.loaded)/A:8*w/T+R;if(I<=E)return;const _=A?8*A:T,D=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),P=this.hls.config.abrBandWidthUpFactor;let C,O=Number.POSITIVE_INFINITY;for(C=h-1;C>d;C--){const e=k[C].maxBitrate,t=!k[C].details||D;if(O=this.getTimeToLoadFrag(R,_,c*e,t),O<Math.min(E,c+R))break}if(O>=I)return;if(O>10*c)return;S?this.bwEstimator.sample(u-Math.min(v,b),l.loaded):this.bwEstimator.sampleTTFB(u);const N=k[C].maxBitrate;this.getBwEstimate()*P>N&&this.resetEstimator(N);const M=this.findBestLevel(N,d,C,0,E,1,1);M>-1&&(C=M),this.warn("Fragment ".concat(n.sn).concat(r?" part "+r.index:""," of level ").concat(h," is loading too slowly;\n      Fragment duration: ").concat(n.duration.toFixed(3),"\n      Time to underbuffer: ").concat(E.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(I.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(O.toFixed(3)," s\n      TTFB estimate: ").concat(0|b," ms\n      Current BW estimate: ").concat(Ur(T)?0|T:"Unknown"," bps\n      New BW estimate: ").concat(0|this.getBwEstimate()," bps\n      Switching to level ").concat(C," @ ").concat(0|N," bps")),i.nextLoadLevel=i.nextAutoLevel=C,this.clearTimer();const F=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===C&&C>0){const e=this.getStarvationDelay();if(this.warn("Aborting inflight request ".concat(C>0?"and switching down":"","\n      Fragment duration: ").concat(n.duration.toFixed(3)," s\n      Time to underbuffer: ").concat(e.toFixed(3)," s")),n.abortRequests(),this.fragCurrent=this.partCurrent=null,C>d){let t=this.findBestLevel(this.hls.levels[d].bitrate,d,C,0,e,1,1);-1===t&&(t=d),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};g||I>2*O?F():this.timer=self.setInterval(F,1e3*O),i.trigger(Hr.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log("setting initial bwe to ".concat(e)),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Jr(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.FRAG_LOADING,this.onFragLoading,this),e.on(Hr.FRAG_LOADED,this.onFragLoaded,this),e.on(Hr.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Hr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Hr.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(Hr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.FRAG_LOADING,this.onFragLoading,this),e.off(Hr.FRAG_LOADED,this.onFragLoaded,this),e.off(Hr.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Hr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Hr.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(Hr.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){var r;if(!n.bitrateTest)this.fragCurrent=n,this.partCurrent=null!=(r=t.part)?r:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Kr.BUFFER_ADD_CODEC_ERROR:case Kr.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Kr.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:n,partCurrent:r}=this;if(e&&n&&e.sn===n.sn&&e.level===n.level){const t=performance.now(),n=r?r.stats:e.stats,i=t-n.loading.start,s=n.loading.first?n.loading.first-n.loading.start:-1;if(n.loaded&&s>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(i-Math.min(e,s),n.loaded)}else this.bwEstimator.sampleTTFB(i)}break}}}getTimeToLoadFrag(e,t,n,r){return e+n/t+(r?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,i=r.end-r.first;Ur(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,t){let{frag:n,part:r}=t;const i=r?r.stats:n.stats;if(n.type===qr&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=r?r.duration:n.duration,t=this.hls.levels[n.level],s=(t.loaded?t.loaded.bytes:0)+i.loaded,a=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:s,duration:a},t.realBitrate=Math.round(8*s/a)}if(n.bitrateTest){const e={stats:i,frag:n,part:r,id:n.type};this.onFragBuffered(Hr.FRAG_BUFFERED,e),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,i=null!=r&&r.stats.loaded?r.stats:n.stats;if(i.aborted)return;if(this.ignoreFragment(n))return;const s=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,i.loaded),i.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==qr||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,i=this.findBestLevel(n,t,e,0,r,1,1);if(i>-1)return i;const s=this.hls.firstLevel,a=Math.min(Math.max(s,t),e);return this.warn("Could not find best starting auto level. Defaulting to first in playlist ".concat(s," clamped to ").concat(a)),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(-1!==e&&(!t||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=t&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,r)&&t[e].loadError<=t[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:i,minAutoLevel:s}=n,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=i.abrBandWidthFactor,u=i.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,s,r,l,0,c,u);if(e>=0)return this.rebufferNotice=-1,e}let d=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){d=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-e,this.info("bitrate test took ".concat(Math.round(1e3*e),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*d)," ms")),c=u=1}}const h=this.findBestLevel(o,s,r,l,d,c,u);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info("".concat(l?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(h))),h>-1)return h;const f=n.levels[s],g=n.loadLevelObj;return g&&(null==f?void 0:f.bitrate)<g.bitrate?s:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,i,s,a){var o;const l=r+i,c=this.lastLoadedFragLevel,u=-1===c?this.hls.firstLevel:c,{fragCurrent:d,partCurrent:h}=this,{levels:f,allAudioTracks:g,loadLevel:p,config:m}=this.hls;if(1===f.length)return 0;const v=f[u],y=!(null==(o=this.hls.latestLevelDetails)||!o.live),E=-1===p||-1===c;let b,S="SDR",T=(null==v?void 0:v.frameRate)||0;const{audioPreference:k,videoPreference:x}=m,w=this.audioTracksByGroup||(this.audioTracksByGroup=Ns(g));let L=-1;if(E){if(-1!==this.firstSelection)return this.firstSelection;const r=this.codecTiers||(this.codecTiers=function(e,t,n,r){return e.slice(n,r+1).reduce((e,n,r)=>{if(!n.codecSet)return e;const i=n.audioGroups;let s=e[n.codecSet];s||(e[n.codecSet]=s={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:r,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),s.minBitrate=Math.min(s.minBitrate,n.bitrate);const a=Math.min(n.height,n.width);return s.minHeight=Math.min(s.minHeight,a),s.minFramerate=Math.min(s.minFramerate,n.frameRate),s.minIndex=Math.min(s.minIndex,r),s.maxScore=Math.max(s.maxScore,n.score),s.fragmentError+=n.fragmentError,s.videoRanges[n.videoRange]=(s.videoRanges[n.videoRange]||0)+1,i&&i.forEach(e=>{if(!e)return;const n=t.groups[e];n&&(s.hasDefaultAudio=s.hasDefaultAudio||t.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(n.channels).forEach(e=>{s.channels[e]=(s.channels[e]||0)+n.channels[e]}))}),e},{})}(f,w,t,n)),i=function(e,t,n,r,i){const s=Object.keys(e),a=null==r?void 0:r.channels,o=null==r?void 0:r.audioCodec,l=null==i?void 0:i.videoCodec,c=a&&2===parseInt(a);let u=!1,d=!1,h=1/0,f=1/0,g=1/0,p=1/0,m=0,v=[];const{preferHDR:y,allowedVideoRanges:E}=Ps(t,i);for(let k=s.length;k--;){const t=e[s[k]];u||(u=t.channels[2]>0),h=Math.min(h,t.minHeight),f=Math.min(f,t.minFramerate),g=Math.min(g,t.minBitrate),E.filter(e=>t.videoRanges[e]>0).length>0&&(d=!0)}h=Ur(h)?h:0,f=Ur(f)?f:0;const b=Math.max(1080,h),S=Math.max(30,f);g=Ur(g)?g:n,n=Math.max(g,n),d||(t=void 0);const T=s.length>1;return{codecSet:s.reduce((t,r)=>{const i=e[r];if(r===t)return t;if(v=d?E.filter(e=>i.videoRanges[e]>0):[],T){if(i.minBitrate>n)return Os(r,"min bitrate of ".concat(i.minBitrate," > current estimate of ").concat(n)),t;if(!i.hasDefaultAudio)return Os(r,"no renditions with default or auto-select sound found"),t;if(o&&r.indexOf(o.substring(0,4))%5!==0)return Os(r,'audio codec preference "'.concat(o,'" not found')),t;if(a&&!c){if(!i.channels[a])return Os(r,"no renditions with ".concat(a," channel sound found (channels options: ").concat(Object.keys(i.channels),")")),t}else if((!o||c)&&u&&0===i.channels[2])return Os(r,"no renditions with stereo sound found"),t;if(i.minHeight>b)return Os(r,"min resolution of ".concat(i.minHeight," > maximum of ").concat(b)),t;if(i.minFramerate>S)return Os(r,"min framerate of ".concat(i.minFramerate," > maximum of ").concat(S)),t;if(!v.some(e=>i.videoRanges[e]>0))return Os(r,"no variants with VIDEO-RANGE of ".concat(Cs(v)," found")),t;if(l&&r.indexOf(l.substring(0,4))%5!==0)return Os(r,'video codec preference "'.concat(l,'" not found')),t;if(i.maxScore<m)return Os(r,"max score of ".concat(i.maxScore," < selected max of ").concat(m)),t}return t&&(os(r)>=os(t)||i.fragmentError>e[t].fragmentError)?t:(p=i.minIndex,m=i.maxScore,r)},void 0),videoRanges:v,preferHDR:y,minFramerate:f,minBitrate:g,minIndex:p}}(r,S,e,k,x),{codecSet:s,videoRanges:a,minFramerate:o,minBitrate:l,minIndex:c,preferHDR:u}=i;L=c,b=s,S=u?a[a.length-1]:a[0],T=o,e=Math.max(e,l),this.log("picked start tier ".concat(Cs(i)))}else b=null==v?void 0:v.codecSet,S=null==v?void 0:v.videoRange;const A=h?h.duration:d?d.duration:0,R=this.bwEstimator.getEstimateTTFB()/1e3,I=[];for(let D=n;D>=t;D--){var _;const t=f[D],o=D>u;if(!t)continue;if(m.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const n=navigator.mediaCapabilities;"function"===typeof(null==n?void 0:n.decodingInfo)&&Es(t,w,S,T,e,k)?(t.supportedPromise=bs(t,w,n,this.supportedCache),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const n=this.hls.levels,r=n.indexOf(t);e.error?this.warn('MediaCapabilities decodingInfo error: "'.concat(e.error,'" for level ').concat(r," ").concat(Cs(e))):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log("MediaCapabilities decodingInfo for level ".concat(r," not smooth or powerEfficient: ").concat(Cs(e))):(this.warn("Unsupported MediaCapabilities decodingInfo result for level ".concat(r," ").concat(Cs(e))),r>-1&&n.length>1&&(this.log("Removing unsupported level ".concat(r)),this.hls.removeLevel(r),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn("Error handling MediaCapabilities decodingInfo: ".concat(e))})):t.supportedResult=vs}if((b&&t.codecSet!==b||S&&t.videoRange!==S||o&&T>t.frameRate||!o&&T>0&&T<t.frameRate||null!=(_=t.supportedResult)&&null!=(_=_.decodingInfoResults)&&_.some(e=>!1===e.smooth))&&(!E||D!==L)){I.push(D);continue}const d=t.details,g=(h?null==d?void 0:d.partTarget:null==d?void 0:d.averagetargetduration)||A;let v;v=o?a*e:s*e;const x=A&&r>=2*A&&0===i?t.averageBitrate:t.maxBitrate,P=this.getTimeToLoadFrag(R,v,x*g,void 0===d);if(v>=x&&(D===c||0===t.loadError&&0===t.fragmentError)&&(P<=R||!Ur(P)||y&&!this.bitrateTestDelay||P<l)){const e=this.forcedAutoLevel;return D===p||-1!==e&&e===p||(I.length&&this.trace("Skipped level(s) ".concat(I.join(",")," of ").concat(n,' max with CODECS and VIDEO-RANGE:"').concat(f[I[0]].codecs,'" ').concat(f[I[0]].videoRange,'; not compatible with "').concat(b,'" ').concat(S)),this.info("switch candidate:".concat(u,"->").concat(D," adjustedbw(").concat(Math.round(v),")-bitrate=").concat(Math.round(v-x)," ttfb:").concat(R.toFixed(1)," avgDuration:").concat(g.toFixed(1)," maxFetchDuration:").concat(l.toFixed(1)," fetchDuration:").concat(P.toFixed(1)," firstSelection:").concat(E," codecSet:").concat(t.codecSet," videoRange:").concat(t.videoRange," hls.loadLevel:").concat(p))),E&&(this.firstSelection=D),D}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}},bufferController:class extends ri{constructor(e,t){var n;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:n}=this;e&&this.log("Media source opened"),t&&n&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(Hr.MEDIA_ATTACHED,{media:t,mediaSource:n}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e,")"))},this.hls=e,this.fragmentTracker=t,this.appendSource=(n=ui(e.config.preferManagedMediaSource),"undefined"!==typeof self&&n===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hr.BUFFER_RESET,this.onBufferReset,this),e.on(Hr.BUFFER_APPENDING,this.onBufferAppending,this),e.on(Hr.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Hr.BUFFER_EOS,this.onBufferEos,this),e.on(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Hr.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Hr.FRAG_PARSED,this.onFragParsed,this),e.on(Hr.FRAG_CHANGED,this.onFragChanged,this),e.on(Hr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hr.BUFFER_RESET,this.onBufferReset,this),e.off(Hr.BUFFER_APPENDING,this.onBufferAppending,this),e.off(Hr.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Hr.BUFFER_EOS,this.onBufferEos,this),e.off(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Hr.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Hr.FRAG_PARSED,this.onFragParsed,this),e.off(Hr.FRAG_CHANGED,this.onFragChanged,this),e.off(Hr.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn("Transfering MediaSource with".concat(t?" operations in queue":"").concat(e?" updating SourceBuffer(s)":""," ").concat(this.operationQueue)),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?ei(n,r.tracks):this.sourceBuffers.forEach(e=>{const[t]=e;t&&(n[t]=ei({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log("".concat(r," bufferCodec event(s) expected.")),null!=(n=this.transferData)&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const r=ui(this.appendSource);if(r){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const s=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(s),e)this._objectUrl=n.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(s);if(this.appendSource)try{n.removeAttribute("src");const t=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||t&&s instanceof t,$c(n),function(e,t){const n=self.document.createElement("source");n.type="video/mp4",n.src=t,e.appendChild(n)}(n,e),n.load()}catch(i){n.src=e}else n.src=e}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log("".concat((null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"," media source: ").concat(null==(n=e.constructor)?void 0:n.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,i=r?Object.keys(r):null,s=i?i.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&i&&s){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log("attachTransferred: (bufferCodecEventsTotal ".concat(this.bufferCodecEventsTotal,")\nrequired tracks: ").concat(Cs(n,(e,t)=>"initSegment"===e?void 0:t),";\ntransfer tracks: ").concat(Cs(r,(e,t)=>"initSegment"===e?void 0:t),"}")),!di(r,n)){t.mediaSource=null,t.tracks=void 0;const i=e.currentTime,s=this.details,a=Math.max(i,(null==s?void 0:s.fragments[0].start)||0);return a-i>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time ".concat(i," -> ").concat(a)):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'.concat(Object.keys(r),'"->"').concat(Object.keys(n),'") start time: ').concat(a," currentTime: ").concat(i)),this.onMediaDetaching(Hr.MEDIA_DETACHING,{}),this.onMediaAttaching(Hr.MEDIA_ATTACHING,t),void(e.currentTime=a))}this.transferData=void 0,i.forEach(e=>{const t=e,n=r[t];if(n){const e=n.buffer;if(e){const r=this.fragmentTracker,i=n.id;if(r.hasFragments(i)||r.hasParts(i)){const n=Pa.getBuffered(e);r.detectEvictedFragments(t,n,i,null,!0)}const s=Jc(t),a=[t,e];this.sourceBuffers[s]=a,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,n)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:i,_objectUrl:s}=this;if(i){if(this.log("media source ".concat(n?"transferring":"detaching")),n)this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.removeBuffer(t)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===i.readyState;try{const t=i.sourceBuffers;for(let n=t.length;n--;)e&&t[n].abort(),i.removeSourceBuffer(t[n]);e&&i.endOfStream()}catch(sf){this.warn("onMediaDetaching: ".concat(sf.message," while calling endOfStream"))}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(s&&self.URL.revokeObjectURL(s),this.mediaSrc===s?(r.removeAttribute("src"),this.appendSource&&$c(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(Hr.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(e){var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;null!=(r=this.mediaSource)&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(sf){this.warn("onBufferReset ".concat(e),sf)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Jc(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Yc(this.tracks)}onBufferCodecs(e,t){var n;const r=this.tracks,i=Object.keys(t);this.log('BUFFER_CODECS: "'.concat(i,'" (current SB count ').concat(this.sourceBufferCount,")"));const s="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!s&&this.sourceBufferCount&&this.media&&i.some(e=>!r[e]);s||a?this.warn('Unsupported transition between "'.concat(Object.keys(r),'" and "').concat(i,'" SourceBuffers')):(i.forEach(e=>{var n,i;const s=t[e],{id:a,codec:o,levelCodec:l,container:c,metadata:u,supplemental:d}=s;let h=r[e];const f=null==(n=this.transferData)||null==(n=n.tracks)?void 0:n[e],g=null!=f&&f.buffer?f:h,p=(null==g?void 0:g.pendingCodec)||(null==g?void 0:g.codec),m=null==g?void 0:g.levelCodec;h||(h=r[e]={buffer:void 0,listeners:[],codec:o,supplemental:d,container:c,levelCodec:l,metadata:u,id:a});const v=ds(p,m),y=null==v?void 0:v.replace(qc,"$1");let E=ds(o,l);const b=null==(i=E)?void 0:i.replace(qc,"$1");E&&v&&y!==b&&("audio"===e.slice(0,5)&&(E=us(E,this.appendSource)),this.log("switching codec ".concat(p," to ").concat(E)),E!==(h.pendingCodec||h.codec)&&(h.pendingCodec=E),h.container=c,this.appendChangeType(e,c,E))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&"main"===(null==(n=t.audio)?void 0:n.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r="".concat(t,";codecs=").concat(n),i={label:"change-type=".concat(r),execute:()=>{const i=this.tracks[e];if(i){const s=i.buffer;null!=s&&s.changeType&&(this.log("changing ".concat(e," sourceBuffer type to ").concat(r)),s.changeType(r),i.codec=n,i.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn("Failed to change ".concat(e," SourceBuffer type"),t)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(n,qr))?void 0:t.gap))return;const i={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>r||null!=t&&t.buffer&&Pa.isBuffered(t.buffer,r)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(r,qr))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:i,frag:e},this.append(i,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:i,parent:s,frag:a,part:o,chunkMeta:l,offset:c}=t,u=l.buffering[i],{sn:d,cc:h}=a,f=self.performance.now();u.start=f;const g=a.stats.buffering,p=o?o.stats.buffering:null;0===g.start&&(g.start=f),p&&0===p.start&&(p.start=f);const m=n.audio;let v=!1;"audio"===i&&"audio/mpeg"===(null==m?void 0:m.container)&&(v=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const y=n.video,E=null==y?void 0:y.buffer;if(E&&"initSegment"!==d){const e=o||a,t=this.blockedAudioAppend;if("audio"!==i||"main"===s||this.blockedAudioAppend||y.ending||y.ended){if("video"===i){const n=e.end;if(t){const e=t.frag.start;(n>e||n<this.lastVideoAppendEnd||Pa.isBuffered(E,e))&&this.unblockAudio()}this.lastVideoAppendEnd=n}}else{const t=e.start+.05*e.duration,n=E.buffered,r=this.currentOp("video");n.length||r?!r&&!Pa.isBuffered(E,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const b=(o||a).start,S={label:"append-".concat(i),execute:()=>{var e;u.executeStart=self.performance.now();const t=null==(e=this.tracks[i])?void 0:e.buffer;t&&(v?this.updateTimestampOffset(t,b,.1,i,d,h):void 0!==c&&Ur(c)&&this.updateTimestampOffset(t,c,1e-6,i,d,h)),this.appendExecutor(r,i)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();u.executeEnd=u.end=e,0===g.first&&(g.first=e),p&&0===p.first&&(p.first=e);const t={};this.sourceBuffers.forEach(e=>{let[n,r]=e;n&&(t[n]=Pa.getBuffered(r))}),this.appendErrors[i]=0,"audio"===i||"video"===i?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Hr.BUFFER_APPENDED,{type:i,frag:a,part:o,chunkMeta:l,parent:a.type,timeRanges:t})},onError:e=>{var t;const n={type:Gr.MEDIA_ERROR,parent:a.type,details:Kr.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:o,chunkMeta:l,error:e,err:e,fatal:!1},r=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)n.details=Kr.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!r)n.errorAction=ca(!0);else if(e.name===Qc&&0===this.sourceBufferCount)n.errorAction=ca(!0);else{const e=++this.appendErrors[i];this.warn("Failed ".concat(e,"/").concat(this.hls.config.appendErrorMaxRetry,' times to append segment in "').concat(i,'" sourceBuffer (').concat(r||"no media error",")")),(e>=this.hls.config.appendErrorMaxRetry||r)&&(n.fatal=!0)}this.hls.trigger(Hr.ERROR,n)}};this.log('queuing "'.concat(i,'" append sn: ').concat(d).concat(o?" p: "+o.index:""," of ").concat(a.type===qr?"level":"track"," ").concat(a.level," cc: ").concat(h)),this.append(S,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,n){return this.log('queuing "'.concat(e,'" remove ').concat(t,"-").concat(n)),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(Hr.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn("Failed to remove ".concat(t,"-").concat(n,' from "').concat(e,'" SourceBuffer'),r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:i}=t;n?this.append(this.getFlushOp(n,r,i),n):this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.append(this.getFlushOp(t,r,i),t)})}onFragParsed(e,t){const{frag:n,part:r}=t,i=[],s=r?r.elementaryStreams:n.elementaryStreams;s[Ti]?i.push("audiovideo"):(s[bi]&&i.push("audio"),s[Si]&&i.push("video"));0===i.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(n.type," level: ").concat(n.level," sn: ").concat(n.sn)),this.blockBuffers(()=>{const e=self.performance.now();n.stats.buffering.end=e,r&&(r.stats.buffering.end=e);const t=r?r.stats:n.stats;this.hls.trigger(Hr.FRAG_BUFFERED,{frag:n,part:r,stats:t,id:n.type})},i).catch(e=>{this.warn("Fragment buffered callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(e=>{let[n]=e;if(n){const e=this.tracks[n];t.type&&t.type!==n||(e.ending=!0,e.ended||(e.ended=!0,this.log("".concat(n," buffer reached EOS"))))}});const r=!1!==(null==(n=this.overrides)?void 0:n.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;var n;return t&&!(null!=(n=this.tracks[t])&&n.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(Hr.BUFFERED_TO_END,void 0)):e&&this.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState))})):(this.tracksEnded(),this.hls.trigger(Hr.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(e=>{let[t]=e;if(null!==t){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(e,t){let{details:n}=t;n.fragments.length&&(this.details=n,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Kr.BUFFER_APPEND_ERROR&&t.frag){var n;const e=null==(n=t.errorAction)?void 0:n.nextAutoLevel;Ur(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||null===t)return;if(!this.sourceBufferCount)return;const r=e.config,i=n.currentTime,s=t.levelTargetDuration,a=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(Ur(a)&&a>=0){const e=Math.max(a,s),t=Math.floor(i/s)*s-e;this.flushBackBuffer(i,s,t)}const o=r.frontBufferFlushThreshold;if(Ur(o)&&o>0){const e=Math.max(r.maxBufferLength,o),t=Math.max(e,s),n=Math.floor(i/s)*s+t;this.flushFrontBuffer(i,s,n)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(e=>{let[t,r]=e;if(r){const e=Pa.getBuffered(r);if(e.length>0&&n>e.start(0)){var i;this.hls.trigger(Hr.BACK_BUFFER_REACHED,{bufferEnd:n});const e=this.tracks[t];if(null!=(i=this.details)&&i.live)this.hls.trigger(Hr.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(null!=e&&e.ended)return void this.log("Cannot flush ".concat(t," back buffer while SourceBuffer is in ended state"));this.hls.trigger(Hr.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:t})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(t=>{let[r,i]=t;if(i){const t=Pa.getBuffered(i),s=t.length;if(s<2)return;const a=t.start(s-1),o=t.end(s-1);if(n>a||e>=a&&e<=o)return;this.hls.trigger(Hr.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||"open"!==(null==n?void 0:n.readyState))return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,r)}}return{duration:1/0}}const i=null==(e=this.overrides)?void 0:e.duration;if(i)return Ur(i)?{duration:i}:null;const s=this.media.duration;return r>(Ur(n.duration)?n.duration:0)&&r>s||!Ur(s)?{duration:r}:null}updateMediaSource(e){let{duration:t,start:n,end:r}=e;const i=this.mediaSource;this.media&&i&&"open"===i.readyState&&(i.duration!==t&&(Ur(t)&&this.log("Updating MediaSource duration to ".concat(t.toFixed(3))),i.duration=t),void 0!==n&&void 0!==r&&(this.log("MediaSource duration is set to ".concat(i.duration,". Setting seekable range to ").concat(n,"-").concat(r,".")),i.setLiveSeekableRange(n,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log("checkPendingTracks (pending: ".concat(t," codec events expected: ").concat(e,") ").concat(Cs(n))),this.tracksReady){var r;const e=null==(r=this.transferData)?void 0:r.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(t=>{let[n,r]=t;if(n){const t=this.tracks[n];e[n]={buffer:r,container:t.container,codec:t.codec,supplemental:t.supplemental,levelCodec:t.levelCodec,id:t.id,metadata:t.metadata}}}),this.hls.trigger(Hr.BUFFER_CREATED,{tracks:e}),this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),this.sourceBuffers.forEach(e=>{let[t]=e;this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,o=e[a];if(this.isPending(o)){const e=this.getTrackCodec(o,a),s="".concat(o.container,";codecs=").concat(e);o.codec=e,this.log("creating sourceBuffer(".concat(s,")").concat(this.currentOp(a)?" Queued":""," ").concat(Cs(o)));try{const e=n.addSourceBuffer(s),r=Jc(a),i=[a,e];t[r]=i,o.buffer=e}catch(i){var r;return this.error("error while trying to add sourceBuffer: ".concat(i.message)),this.shiftAndExecuteNext(a),null==(r=this.operationQueue)||r.removeBlockers(),delete this.tracks[a],void this.hls.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:i,sourceBufferName:a,mimeType:s,parent:o.id})}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&("video"===t||"audiovideo"===t)&&rs(n,"video")&&(r=function(e,t){const n=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)ns(t[e],"video")||n.push(t[e])}return t&&n.push(t),n.join(",")}(r,n));const i=ds(r,e.levelCodec);return i?"audio"===t.slice(0,5)?us(i,this.appendSource):i:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{const n=t.removedRanges;null!=n&&n.length&&this.hls.trigger(Hr.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;const n=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==n?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error("".concat(e," SourceBuffer error. MediaSource readyState: ").concat(null==(n=this.mediaSource)?void 0:n.readyState));this.error("".concat(r),t),this.hls.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const i=this.currentOp(e);i&&i.onError(r)}updateTimestampOffset(e,t,n,r,i,s){const a=t-e.timestampOffset;Math.abs(a)>=n&&(this.log("Updating ".concat(r," SourceBuffer timestampOffset to ").concat(t," (sn: ").concat(i," cc: ").concat(s,")")),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:i}=this,s=this.tracks[e],a=null==s?void 0:s.buffer;if(!r||!i||!a)return this.warn("Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),void this.shiftAndExecuteNext(e);const o=Ur(r.duration)?r.duration:1/0,l=Ur(i.duration)?i.duration:1/0,c=Math.max(0,t),u=Math.min(n,o,l);u>c&&(!s.ending||s.ended)?(s.ended=!1,this.log("Removing [".concat(c,",").concat(u,"] from the ").concat(e," SourceBuffer")),a.remove(c,u)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=null==n?void 0:n.buffer;if(!r)throw new Xc("Attempting to append to the ".concat(t," SourceBuffer, but it does not exist"));n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn("SourceBuffer blocked callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn("Callback run without blocking ".concat(this.operationQueue," ").concat(t))}}isUpdating(){return this.sourceBuffers.some(e=>{let[t,n]=e;return t&&n.updating})}isQueued(){return this.sourceBuffers.some(e=>{let[t]=e;return t&&!!this.currentOp(t)})}isPending(e){return!!e&&!e.buffer}blockBuffers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceBufferTypes;if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,r=t.map(e=>this.appendBlocker(e));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(t=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;n&&!n.updating&&this.shiftAndExecuteNext(e)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,t)=>{let[n]=t;return e+(n?1:0)},0)}get sourceBufferTypes(){return this.sourceBuffers.map(e=>{let[t]=e;return t}).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const i=r.buffer;if(!i)return;const s=n.bind(this,e);r.listeners.push({event:t,listener:s}),i.addEventListener(t,s)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(e=>{n.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}},capLevelController:Zc,errorController:class extends ri{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Hr.ERROR,this.onError,this),e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Hr.ERROR,this.onError,this),e.off(Hr.ERROR,this.onErrorOut,this),e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===qr?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===n?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if(null!=(n=e.details)&&n.hasKey(t))return!0;const r=e.audioGroups;if(r){return this.hls.allAudioTracks.filter(e=>r.indexOf(e.groupId)>=0).some(e=>{var n;return null==(n=e.details)?void 0:n.hasKey(t)})}}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,i=t.context;switch(t.details){case Kr.FRAG_LOAD_ERROR:case Kr.FRAG_LOAD_TIMEOUT:case Kr.KEY_LOAD_ERROR:case Kr.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case Kr.FRAG_PARSING_ERROR:if(null!=(n=t.frag)&&n.gap)return void(t.errorAction=ca());case Kr.FRAG_GAP:case Kr.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=na);case Kr.LEVEL_EMPTY_ERROR:case Kr.LEVEL_PARSING_ERROR:{var s;const e=t.parent===qr?t.level:r.loadLevel;t.details===Kr.LEVEL_EMPTY_ERROR&&null!=(s=t.context)&&null!=(s=s.levelDetails)&&s.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case Kr.LEVEL_LOAD_ERROR:case Kr.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==i?void 0:i.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level)));case Kr.AUDIO_TRACK_LOAD_ERROR:case Kr.AUDIO_TRACK_LOAD_TIMEOUT:case Kr.SUBTITLE_LOAD_ERROR:case Kr.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const e=r.loadLevelObj;if(e&&(i.type===Wr&&e.hasAudioGroup(i.groupId)||i.type===Yr&&e.hasSubtitleGroup(i.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=na,void(t.errorAction.flags=aa)}return;case Kr.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(t.errorAction={action:na,flags:oa});case Kr.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Kr.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Kr.KEY_SYSTEM_NO_SESSION:return void(t.errorAction={action:na,flags:la});case Kr.BUFFER_ADD_CODEC_ERROR:case Kr.REMUX_ALLOC_ERROR:case Kr.BUFFER_APPEND_ERROR:var a;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(a=t.level)?a:r.loadLevel);return;case Kr.INTERNAL_EXCEPTION:case Kr.BUFFER_APPENDING_ERROR:case Kr.BUFFER_FULL_ERROR:case Kr.LEVEL_SWITCH_ERROR:case Kr.BUFFER_STALLED_ERROR:case Kr.BUFFER_SEEK_OVER_HOLE:case Kr.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=ca())}t.type===Gr.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ca())}getPlaylistRetryOrSwitchAction(e,t){const n=Xs(this.hls.config.playlistLoadPolicy,e),r=this.playlistError++;if(Zs(n,r,Ys(e),e.response))return{action:ia,flags:sa,retryConfig:n,retryCount:r};const i=this.getLevelSwitchAction(e,t);return n&&(i.retryConfig=n,i.retryCount=r),i}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:i,keyLoadPolicy:s}=t.config,a=Xs(qs(e)?s:i,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(r&&(e.details!==Kr.FRAG_GAP&&r.fragmentError++,!Qs(e))){if(Zs(a,o,Ys(e),e.response))return{action:ia,flags:sa,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(e,n);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(e,t){const n=this.hls;null!==t&&void 0!==t||(t=n.loadLevel);const r=this.hls.levels[t];if(r){var i,s;const t=e.details;r.loadError++,t===Kr.BUFFER_APPEND_ERROR&&r.fragmentError++;let l=-1;const{levels:c,loadLevel:u,minAutoLevel:d,maxAutoLevel:h}=n;n.autoLevelEnabled||n.config.preserveManualLevelOnError||(n.loadLevel=-1);const f=null==(i=e.frag)?void 0:i.type,g=(f===Qr&&t===Kr.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===Kr.BUFFER_ADD_CODEC_ERROR||t===Kr.BUFFER_APPEND_ERROR))&&c.some(e=>{let{audioCodec:t}=e;return r.audioCodec!==t}),p="video"===e.sourceBufferName&&(t===Kr.BUFFER_ADD_CODEC_ERROR||t===Kr.BUFFER_APPEND_ERROR)&&c.some(e=>{let{codecSet:t,audioCodec:n}=e;return r.codecSet!==t&&r.audioCodec===n}),{type:m,groupId:v}=null!=(s=e.context)?s:{};for(let n=c.length;n--;){const i=(n+u)%c.length;if(i!==u&&i>=d&&i<=h&&0===c[i].loadError){var a,o;const n=c[i];if(t===Kr.FRAG_GAP&&f===qr&&e.frag){const t=c[i].details;if(t){const n=Hs(e.frag,t.fragments,e.frag.start);if(null!=n&&n.gap)continue}}else{if(m===Wr&&n.hasAudioGroup(v)||m===Yr&&n.hasSubtitleGroup(v))continue;if(f===Qr&&null!=(a=r.audioGroups)&&a.some(e=>n.hasAudioGroup(e))||f===Xr&&null!=(o=r.subtitleGroups)&&o.some(e=>n.hasSubtitleGroup(e))||g&&r.audioCodec===n.audioCodec||p&&r.codecSet===n.codecSet||!g&&r.codecSet!==n.codecSet)continue}l=i;break}}if(l>-1&&n.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:na,flags:sa,nextAutoLevel:l}}return{action:na,flags:aa}}onErrorOut(e,t){var n;switch(null==(n=t.errorAction)?void 0:n.action){case ta:break;case na:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===Kr.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'.concat(t.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r}=n,i=n.nextAutoLevel;switch(r){case sa:this.switchLevel(e,i);break;case oa:{const r=this.getVariantLevelIndex(e.frag),i=t.levels[r],s=null==i?void 0:i.attrs["HDCP-LEVEL"];if(n.hdcpLevel=s,"NONE"===s)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(s){t.maxHdcpLevel=ks[ks.indexOf(s)-1],n.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'));break}}case la:{const t=e.decryptdata;if(t){const r=this.hls.levels,i=r.length;for(let n=i;n--;){var s,a;if(this.variantHasKey(r[n],t))this.log("Banned key found in level ".concat(n," (").concat(r[n].bitrate,'bps) or audio group "').concat(null==(s=r[n].audioGroups)?void 0:s.join(","),'" (').concat(null==(a=e.frag)?void 0:a.type," fragment) ").concat(fi(t.keyId||[]))),r[n].fragmentError++,r[n].loadError++,this.log("Removing level ".concat(n," with key error (").concat(e.error,")")),this.hls.removeLevel(n)}const o=e.frag;if(this.hls.levels.length<i)n.resolved=!0;else if(o&&o.type!==qr){const e=o.decryptdata;e&&!t.matches(e)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Kr.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=ps(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r]["".concat(e.sourceBufferName,"Codec")]===t&&(this.log("Removing level ".concat(r," for ").concat(e.details,' ("').concat(t,'" not supported)')),this.hls.removeLevel(r))}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"===typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const e=r-this.lastTime,i=n-this.lastDroppedFrames,s=t-this.lastDecodedFrames,a=1e3*i/e,o=this.hls;if(o.trigger(Hr.FPS_DROP,{currentDropped:i,currentDecoded:s,totalDroppedFrames:n}),a>0&&i>o.config.fpsDroppedMonitoringThreshold*s){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(Hr.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:lo,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:mh,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends dl{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",Xr),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hr.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Hr.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Hr.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Hr.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hr.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Hr.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Hr.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Hr.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=el,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(this.fragContextChanged(n)||(xi(n)&&(this.fragPrevious=n),this.state=el),!r)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let s;const a=n.start;for(let l=0;l<i.length;l++)if(a>=i[l].start&&a<=i[l].end){s=i[l];break}const o=n.start+n.duration;s?s.end=o:(s={start:a,end:o},i.push(s)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(0===n&&r!==Number.POSITIVE_INFINITY){const e=r-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let n=0;n<t.length;)if(t[n].end<=e)t.shift();else{if(!(t[n].start<e))break;t[n].start=e,n++}}),this.fragmentTracker.removeFragmentsInRange(n,e,Xr)}}onError(e,t){const n=t.frag;(null==n?void 0:n.type)===Xr&&(t.details===Kr.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Zo&&(this.state=el))}onSubtitleTracksUpdated(e,t){let{subtitleTracks:n}=t;this.levels&&Vc(this.levels,n)?this.levels=n.map(e=>new _s(e)):(this.tracksBuffered=[],this.levels=n.map(e=>{const t=new _s(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Xr),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==Zo&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:i}=this,{details:s,id:a}=t;if(!i)return void this.warn("Subtitle tracks were reset while loading level ".concat(a));const o=i[a];if(a>=i.length||!o)return;this.log("Subtitle track ".concat(a," loaded [").concat(s.startSN,",").concat(s.endSN,"]").concat(s.lastPartSn?"[part-".concat(s.lastPartSn,"-").concat(s.lastPartIndex,"]"):"",",duration:").concat(s.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(s.live||null!=(n=o.details)&&n.live){if(s.deltaUpdateFailed)return;const e=this.mainDetails;if(!e)return void(this.startFragRequested=!1);const t=e.fragments[0];var c;if(o.details)l=this.alignPlaylists(s,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&t&&(l=t.start,Fo(s,l));else s.hasProgramDateTime&&e.hasProgramDateTime?(Qo(s,e),l=s.fragmentStart):t&&(l=t.start,Fo(s,l));e&&!this.startFragRequested&&this.setStartPosition(e,l)}if(o.details=s,this.levelLastLoaded=o,a===r&&(this.hls.trigger(Hr.SUBTITLE_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===el)){Hs(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&null!=r&&r.key&&r.iv&&Ya(r.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,qa(r.method)).catch(e=>{throw i.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(n=>{const r=performance.now();i.trigger(Hr.FRAG_DECRYPTED,{frag:t,payload:n,stats:{tstart:e,tdecrypt:r}})}).catch(e=>{this.warn("".concat(e.name,": ").concat(e.message)),this.state=el})}}doTick(){if(this.media){if(this.state===el){const{currentTrackId:e,levels:t}=this,n=null==t?void 0:t[e];if(!n||!t.length||!n.details)return;if(this.waitForLive(n))return;const{config:r}=this,i=this.getLoadPosition(),s=Pa.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,r.maxBufferHole),{end:a,len:o}=s,l=n.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,u=c.length,d=l.edge;let h=null;const f=this.fragPrevious;if(a<d){const e=r.maxFragLookUpTolerance,t=a>d-e?0:e;h=Hs(f,c,Math.max(c[0].start,a),t),!h&&f&&f.start<c[0].start&&(h=c[0])}else h=c[u-1];if(h=this.filterReplacedPrimary(h,n.details),!h)return;const g=c[h.sn-l.startSN-1];if(g&&g.cc===h.cc&&this.fragmentTracker.getState(g)===ua&&(h=g),this.fragmentTracker.getState(h)===ua){const e=this.mapToInitFragWhenRequired(h);e&&this.loadFragment(e,n,a)}}}else this.state=el}loadFragment(e,t,n){xi(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new bd(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends Hc{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=id(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=t[r];else if("showing"===t[r].mode){e=t[r];break}const n=this.findTrackForTextTrack(e);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hr.LEVEL_LOADING,this.onLevelLoading,this),e.on(Hr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Hr.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Hr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hr.LEVEL_LOADING,this.onLevelLoading,this),e.off(Hr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Hr.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Hr.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;id(n.textTracks).forEach(e=>{nd(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:i}=t,s=this.tracksInGroup[n];if(!s||s.groupId!==r)return void this.warn("Subtitle track with id:".concat(n," and group:").concat(r," not found in active group ").concat(null==s?void 0:s.groupId));const a=s.details;s.details=t.details,this.log("Subtitle track ".concat(n,' "').concat(s.name,'" lang:').concat(s.lang," group:").concat(r," loaded [").concat(i.startSN,"-").concat(i.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let i=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==r?void 0:r.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!i&&t){this.selectDefaultTrack=!1;const n=Fs(t,e);if(n>-1)i=e[n];else{const e=Fs(t,this.tracks);i=this.tracks[e]}}let r=this.findTrackId(i);-1===r&&i&&(r=this.findTrackId(null));const s={subtitleTracks:e};this.log("Updating subtitle tracks, ".concat(e.length,' track(s) found in "').concat(null==n?void 0:n.join(","),'" group-id')),this.hls.trigger(Hr.SUBTITLE_TRACKS_UPDATED,s),-1!==r&&-1===this.trackId&&this.setSubtitleTrack(r)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const i=t[r];if((!n||i.default)&&(n||e)&&(!e||Us(i,e)))return r}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(zc(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(zc(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){if(Wc(t[n],e))return n}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Yr||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Us(e,n))return n;const r=Fs(e,this.tracksInGroup);if(r>-1){const e=this.tracksInGroup[r];return this.setSubtitleTrack(r),e}if(n)return null;{const n=Fs(e,t);if(n>-1)return t[n]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,i=this.getUrlWithDirectives(e.url,t),s=e.details,a=null==s?void 0:s.age;this.log("Loading subtitle ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""," ").concat(i)),this.hls.trigger(Hr.SUBTITLE_TRACK_LOADING,{url:i,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=id(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(e=>Wc(n,e))[0],r||this.warn('Unable to find subtitle TextTrack with name "'.concat(n.name,'" and language "').concat(n.lang,'"'))),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==r&&(e.mode="disabled")}),r){const e=this.subtitleDisplay?"showing":"hidden";r.mode!==e&&(r.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!Ur(e))return void this.warn("Invalid subtitle track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r)return void this.hls.trigger(Hr.SUBTITLE_TRACK_SWITCH,{id:e});const i=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&i)return;this.log("Switching to subtitle-track ".concat(e)+(r?' "'.concat(r.name,'" lang:').concat(r.lang," group:").concat(r.groupId):""));const{id:s,groupId:a="",name:o,type:l,url:c}=r;this.hls.trigger(Hr.SUBTITLE_TRACK_SWITCH,{id:s,groupId:a,name:o,type:l,url:c});const u=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(u)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Hr.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Hr.FRAG_LOADING,this.onFragLoading,this),e.on(Hr.FRAG_LOADED,this.onFragLoaded,this),e.on(Hr.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(Hr.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(Hr.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Hr.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Hr.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Hr.FRAG_LOADING,this.onFragLoading,this),e.off(Hr.FRAG_LOADED,this.onFragLoaded,this),e.off(Hr.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(Hr.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(Hr.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Hr.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new dh(this,"textTrack1"),t=new dh(this,"textTrack2"),n=new dh(this,"textTrack3"),r=new dh(this,"textTrack4");this.cea608Parser1=new Fd(1,e,t),this.cea608Parser2=new Fd(3,n,r)}addCues(e,t,n,r,i){let s=!1;for(let a=i.length;a--;){const e=i[a],r=gh(e[0],e[1],t,n);if(r>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],n),s=!0,r/(n-t)>.5))return}if(s||i.push([t,n]),this.config.renderTextTracksNatively){const i=this.captionsTracks[e];this.Cues.newCue(i,t,n,r)}else{const i=this.Cues.newCue(null,t,n,r);this.hls.trigger(Hr.CUES_PARSED,{type:"captions",cues:i,track:e})}}onInitPtsFound(e,t){let{frag:n,id:r,initPTS:i,timescale:s,trackId:a}=t;const{unparsedVttFrags:o}=this;r===qr&&(this.initPTS[n.cc]={baseTime:i,timescale:s,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(Hr.FRAG_LOADED,e):this.hls.trigger(Hr.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const i=n.textTracks[r];if(fh(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:i,languageCode:s}=t[e],a=this.getExistingTrack(i,s);if(a)n[e]=a,nd(n[e]),ed(n[e],r);else{const t=this.createTextTrack("captions",i,s);t&&(t[e]=!0,n[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(Hr.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(e=>{nd(r[e]),delete r[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)nd(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(e=>e.textCodec===eh);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Vc(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const e=this.media,t=e?id(e.textTracks):null;if(this.tracks.forEach((e,n)=>{let r;if(t){let n=null;for(let r=0;r<t.length;r++)if(t[r]&&fh(t[r],e)){n=t[r],t[r]=null;break}n&&(r=n)}if(r)nd(r);else{const t=hh(e);r=this.createTextTrack(t,e.name,e.lang),r&&(r.mode="disabled")}r&&this.textTracks.push(r)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: ".concat(e.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){const e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(Hr.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const n="textTrack".concat(t[1]),r=this.captionsProperties[n];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===qr){var n,r;const{cea608Parser1:e,cea608Parser2:i,lastSn:s}=this,{cc:a,sn:o}=t.frag,l=null!=(n=null==(r=t.part)?void 0:r.index)?n:-1;e&&i&&(o!==s+1||o===s&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),i.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===Xr)if(r.byteLength){const e=n.decryptdata,i="stats"in t;if(null==e||!e.encrypted||i){const e=this.tracks[n.level],i=this.vttCCs;i[n.cc]||(i[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),e&&e.textCodec===eh?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(Hr.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;ih(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),n.trigger(Hr.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{n.logger.log("Failed to parse IMSC1: ".concat(t)),n.trigger(Hr.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:i,unparsedVttFrags:s}=this,a=i.length-1;if(!i[n.cc]&&-1===a)return void s.push(e);const o=this.hls;Zd(null!=(t=n.initSegment)&&t.data?Wi(n.initSegment.data,new Uint8Array(r)).buffer:r,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,e=>{this._appendCues(e,n.level),o.trigger(Hr.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},t=>{const i="Missing initPTS for VTT MPEGTS"===t.message;i?s.push(e):this._fallbackToIMSC1(n,r),o.logger.log("Failed to parse VTT cue: ".concat(t)),i&&a>n.cc||o.trigger(Hr.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||ih(t,this.initPTS[e.cc],()=>{n.textCodec=eh,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach(e=>td(n,e))}else{const r=this.tracks[t];if(!r)return;const i=r.default?"default":"subtitles"+t;n.trigger(Hr.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===Xr&&this.onFragLoaded(Hr.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(n.type!==qr||"NONE"!==this.closedCaptionsForLevel(n))for(let i=0;i<r.length;i++){const e=r[i].bytes;if(e){this.cea608Parser1||this.initCea608Parsers();const t=this.extractCea608Data(e);this.cea608Parser1.addData(r[i].pts,t[0]),this.cea608Parser2.addData(r[i].pts,t[1])}}}onBufferFlushing(e,t){let{startOffset:n,endOffset:r,endOffsetSubtitles:i,type:s}=t;const{media:a}=this;if(a&&!(a.currentTime<r)){if(!s||"video"===s){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>rd(e[t],n,r))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==i){const{textTracks:e}=this;Object.keys(e).forEach(t=>rd(e[t],n,i))}}}extractCea608Data(e){const t=[[],[]],n=31&e[0];let r=2;for(let i=0;i<n;i++){const n=e[r++],i=127&e[r++],s=127&e[r++];if(0===i&&0===s)continue;if(0!==(4&n)){const e=3&n;0!==e&&1!==e||(t[e].push(i),t[e].push(s))}}return t}},audioStreamController:class extends dl{constructor(e,t,n){super(e,t,n,"audio-stream-controller",Qr),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hr.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(Hr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Hr.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Hr.BUFFER_RESET,this.onBufferReset,this),e.on(Hr.BUFFER_CREATED,this.onBufferCreated,this),e.on(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Hr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Hr.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Hr.FRAG_LOADING,this.onFragLoading,this),e.on(Hr.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hr.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(Hr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Hr.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Hr.BUFFER_RESET,this.onBufferReset,this),e.off(Hr.BUFFER_CREATED,this.onBufferCreated,this),e.off(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Hr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Hr.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Hr.FRAG_LOADING,this.onFragLoading,this),e.off(Hr.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,t){let{frag:n,id:r,initPTS:i,timescale:s,trackId:a}=t;if(r===qr){const e=n.cc,t=this.fragCurrent;if(this.initPTS[e]={baseTime:i,timescale:s,trackId:a},this.log("InitPTS for cc: ".concat(e," found from main: ").concat(i/s," (").concat(i,"/").concat(s,") trackId: ").concat(a)),this.mainAnchor=n,this.state===cl){const t=this.waitingData;(!t&&!this.loadingParts||t&&t.frag.cc!==e)&&this.syncWithAnchor(n,null==t?void 0:t.frag)}else!this.hls.hasEnoughToStart&&t&&t.cc!==e?(t.abortRequests(),this.syncWithAnchor(n,t)):this.state===el&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const r=(null==(n=this.mainFragLoading)?void 0:n.frag)||null;if(t&&(null==r?void 0:r.cc)===t.cc)return;const i=(r||e).cc,s=Ws(this.getLevelDetails(),i,this.getLoadPosition());s&&(this.log("Syncing with main frag at ".concat(s.start," cc ").concat(s.cc)),this.startFragRequested=!1,this.nextLoadPosition=s.start,this.resetLoadingState(),this.state===el&&this.doTickIdle())}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=Zo);const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),n>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n,this.state=el):this.state=il,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case el:this.doTickIdle();break;case il:{const{levels:e,trackId:t}=this,n=null==e?void 0:e[t],r=null==n?void 0:n.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=cl}break}case rl:this.checkRetryDate();break;case cl:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:r,complete:i}=e,s=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=nl;const e={frag:t,part:n,payload:r.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),i&&super._handleFragmentLoadComplete(e)}else s&&s.cc!==e.frag.cc&&this.syncWithAnchor(s,e.frag)}else this.state=el}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:i}=this,s=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!s.startFragPrefetch)||null==n||!n[i])return;const a=n[i],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=il,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,bi,Qr));const c=this.getFwdBufferInfo(l,Qr);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o))return t.trigger(Hr.BUFFER_EOS,{type:"audio"}),void(this.state=ol);const u=c.len,d=t.maxBufferLength,h=o.fragments,f=h[0].start,g=this.getLoadPosition(),p=this.flushing?g:c.end;if(this.switchingTrack&&r){const e=g;o.PTSKnown&&e<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=f+.05)}if(u>=d&&!this.switchingTrack&&p<h[h.length-1].start)return;let m=this.getNextFragment(p,o);if(m&&this.isLoopLoading(m,p)&&(m=this.getNextFragmentLoopLoading(m,o,c,qr,d)),!m)return void(this.bufferFlushed=!0);let v=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&xi(m)&&!m.endList&&(!o.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===fa&&(this.mainFragLoading=v=null),v&&xi(v))){if(m.start>v.end){const e=this.fragmentTracker.getFragAtPos(p,qr);e&&e.end>v.end&&(v=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(m.start>v.end)return}this.loadFragment(m,a,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,t){let{audioTracks:n}=t;this.resetTransmuxer(),this.levels=n.map(e=>new _s(e))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Zo&&(this.setInterval(100),this.state=el,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(Hr.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:i,id:s,groupId:a,track:o}=t;if(!r)return void this.warn("Audio tracks reset while loading track ".concat(s,' "').concat(o.name,'" of "').concat(a,'"'));const l=this.mainDetails;if(!l||i.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==Zo&&(this.state=il));this.cachedTrackLoadedData=null,this.log("Audio track ".concat(s,' "').concat(o.name,'" of "').concat(a,'" loaded [').concat(i.startSN,",").concat(i.endSN,"]").concat(i.lastPartSn?"[part-".concat(i.lastPartSn,"-").concat(i.lastPartIndex,"]"):"",",duration:").concat(i.totalduration));const c=r[s];let u=0;if(i.live||null!=(n=c.details)&&n.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;var d;if(c.details)u=this.alignPlaylists(i,c.details,null==(d=this.levelLastLoaded)?void 0:d.details);i.alignedSliding||(qo(i,l),i.alignedSliding||Qo(i,l),u=i.fragmentStart)}c.details=i,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,u),this.hls.trigger(Hr.AUDIO_TRACK_UPDATED,{details:i,id:s,groupId:t.groupId}),this.state!==il||this.waitForCdnTuneIn(i)||(this.state=el),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:i}=e,{config:s,trackId:a,levels:o}=this;if(!o)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const u=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new Kc(this.hls,Qr,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[n.cc],f=null==(t=n.initSegment)?void 0:t.data;if(void 0!==h){const e=!1,t=r?r.index:-1,s=-1!==t,a=new _a(n.level,n.sn,n.stats.chunkCount,i.byteLength,t,s);d.push(i,f,u,"",n,r,c.totalduration,e,a,h)}else{this.log("Unknown video PTS for cc ".concat(n.cc,", waiting for video PTS before demuxing audio frag ").concat(n.sn," of [").concat(c.startSN," ,").concat(c.endSN,"],track ").concat(a));const{cache:e}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new fl,complete:!1};e.push(new Uint8Array(i)),this.state!==Zo&&(this.state=cl)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===qr&&xi(t.frag)&&(this.mainFragLoading=t,this.state===el&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type===Qr)if(this.fragContextChanged(n))this.warn("Fragment ".concat(n.sn).concat(r?" p: "+r.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if(xi(n)){this.fragPrevious=n;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(Hr.AUDIO_TRACK_SWITCHED,ni({},e)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}else this.audioOnly||n.type!==qr||n.elementaryStreams.video||n.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var n;if(t.fatal)this.state=ll;else switch(t.details){case Kr.FRAG_GAP:case Kr.FRAG_PARSING_ERROR:case Kr.FRAG_DECRYPT_ERROR:case Kr.FRAG_LOAD_ERROR:case Kr.FRAG_LOAD_TIMEOUT:case Kr.KEY_LOAD_ERROR:case Kr.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Qr,t);break;case Kr.AUDIO_TRACK_LOAD_ERROR:case Kr.AUDIO_TRACK_LOAD_TIMEOUT:case Kr.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==il||(null==(n=t.context)?void 0:n.type)!==Wr||(this.state=el);break;case Kr.BUFFER_ADD_CODEC_ERROR:case Kr.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Kr.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Kr.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,t){let{type:n}=t;n!==Si&&(this.flushing=!0)}onBufferFlushed(e,t){let{type:n}=t;if(n!==Si){this.flushing=!1,this.bufferFlushed=!0,this.state===ol&&(this.state=el);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,n,Qr),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:i,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:c}=a,{details:u}=c,{audio:d,text:h,id3:f,initSegment:g}=i;if(!this.fragContextChanged(o)&&u){if(this.state=sl,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=g&&g.tracks){const e=o.initSegment||o;if(this.unhandledEncryptionError(g,o))return;this._bufferInitSegment(c,g.tracks,e,s),r.trigger(Hr.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:g.tracks})}if(d){const{startPTS:e,endPTS:t,startDTS:n,endDTS:r}=d;l&&(l.elementaryStreams[bi]={startPTS:e,endPTS:t,startDTS:n,endDTS:r}),o.setElementaryStreamInfo(bi,e,t,n,r),this.bufferFragmentData(d,o,l,s)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=ei({id:n,frag:o,details:u},f);r.trigger(Hr.FRAG_PARSING_METADATA,e)}if(h){const e=ei({id:n,frag:o,details:u},h);r.trigger(Hr.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,n,r){if(this.state!==sl)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const i=t.audio;i.id=Qr;const s=e.audioCodec;this.log("Init audio buffer, container:".concat(i.container,", codecs[level/parsed]=[").concat(s,"/").concat(i.codec,"]")),s&&1===s.split(",").length&&(i.levelCodec=s),this.hls.trigger(Hr.BUFFER_CODECS,t);const a=i.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:a};this.hls.trigger(Hr.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);var i;if(this.switchingTrack||r===ua||r===ha)if(xi(e))if(null!=(i=t.details)&&i.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=cl;const n=this.mainDetails;n&&n.fragmentStart!==t.details.fragmentStart&&Qo(t.details,n)}else super.loadFragment(e,t,n);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:i,audioCodec:s,channels:a}=this.bufferedTrack;Us({name:t,lang:n,assocLang:r,characteristics:i,audioCodec:s,channels:a},e,Bs)||(Gs(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(Hr.AUDIO_TRACK_SWITCHED,ni({},e))}},audioTrackController:class extends Hc{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hr.LEVEL_LOADING,this.onLevelLoading,this),e.on(Hr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Hr.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Hr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hr.LEVEL_LOADING,this.onLevelLoading,this),e.off(Hr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Hr.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Hr.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:i}=t,s=this.tracksInGroup[n];if(!s||s.groupId!==r)return void this.warn("Audio track with id:".concat(n," and group:").concat(r," not found in active group ").concat(null==s?void 0:s.groupId));const a=s.details;s.details=t.details,this.log("Audio track ".concat(n,' "').concat(s.name,'" lang:').concat(s.lang," group:").concat(r," loaded [").concat(i.startSN,"-").concat(i.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let i=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==r?void 0:r.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!i&&t){const n=Fs(t,e,Bs);if(n>-1)i=e[n];else{const e=Fs(t,this.tracks);i=this.tracks[e]}}let r=this.findTrackId(i);-1===r&&i&&(r=this.findTrackId(null));const a={audioTracks:e};this.log("Updating audio tracks, ".concat(e.length," track(s) found in group(s): ").concat(null==n?void 0:n.join(","))),this.hls.trigger(Hr.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==r&&-1===o)this.setAudioTrack(r);else if(e.length&&-1===o){var s;const t=new Error("No audio track selected for current audio group-ID(s): ".concat(null==(s=this.groupIds)?void 0:s.join(",")," track count: ").concat(e.length));this.warn(t.message),this.hls.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Wr||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&Us(e,r,Bs))return r;const i=Fs(e,this.tracksInGroup,Bs);if(i>-1){const e=this.tracksInGroup[i];return this.setAudioTrack(i),e}if(r){let r=t.loadLevel;-1===r&&(r=t.firstAutoLevel);const i=function(e,t,n,r,i){const s=t[r],a=t.reduce((e,t,n)=>{const r=t.uri;return(e[r]||(e[r]=[])).push(n),e},{})[s.uri];a.length>1&&(r=Math.max.apply(Math,a));const o=s.videoRange,l=s.frameRate,c=s.codecSet.substring(0,4),u=js(t,r,t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==c)return!1;const r=t.audioGroups,s=n.filter(e=>!r||-1!==r.indexOf(e.groupId));return Fs(e,s,i)>-1});return u>-1?u:js(t,r,t=>{const r=t.audioGroups,s=n.filter(e=>!r||-1!==r.indexOf(e.groupId));return Fs(e,s,i)>-1})}(e,t.levels,n,r,Bs);if(-1===i)return null;t.nextLoadLevel=i}if(e.channels||e.audioCodec){const t=Fs(e,n);if(t>-1)return n[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid audio track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],i=r.details&&!r.details.live;if(e===this.trackId&&r===n&&i)return;if(this.log("Switching to audio-track ".concat(e,' "').concat(r.name,'" lang:').concat(r.lang," group:").concat(r.groupId," channels:").concat(r.channels)),this.trackId=e,this.currentTrack=r,this.hls.trigger(Hr.AUDIO_TRACK_SWITCHING,ni({},r)),i)return;const s=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(s)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if((!this.selectDefaultTrack||r.default)&&(!e||Us(e,r,Bs)))return n}if(e){const{name:n,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){if(Us({name:n,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o},t[e],Bs))return e}for(let l=0;l<t.length;l++){const n=t[l];if(zc(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const n=t[l];if(zc(e.attrs,n.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Gs(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,i=this.getUrlWithDirectives(e.url,t),s=e.details,a=null==s?void 0:s.age;this.log("Loading audio-track ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""," ").concat(i)),this.hls.trigger(Hr.AUDIO_TRACK_LOADING,{url:i,id:n,groupId:r,deliveryDirectives:t||null,track:e})}},emeController:Qu,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:eu.MANIFEST,su:!this.initialized})}catch(t){this.hls.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const{frag:t,part:n}=e,r=this.hls.levels[t.level],i=this.getObjectType(t),s={d:1e3*(n||t).duration,ot:i};i!==eu.VIDEO&&i!==eu.AUDIO&&i!=eu.MUXED||(s.br=r.bitrate/1e3,s.tb=this.getTopBandwidth(i)/1e3,s.bl=this.getBufferLength(i));const a=n?this.getNextPart(n):this.getNextFrag(t);null!=a&&a.url&&a.url!==t.url&&(s.nor=a.url),this.apply(e,s)}catch(t){this.hls.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;null!=n&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hr.MEDIA_DETACHED,this.onMediaDetached,this),e.on(Hr.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hr.MEDIA_DETACHED,this.onMediaDetached,this),e.off(Hr.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:tu.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ei(t,this.createData());const n=t.ot===eu.INIT||t.ot===eu.VIDEO||t.ot===eu.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((e,n)=>(r.includes(n)&&(e[n]=t[n]),e),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Hu(e.headers,t,i)):e.url=Wu(e.url,t,i)}getNextFrag(e){var t;const n=null==(t=this.hls.levels[e.level])?void 0:t.details;if(n){const t=e.sn-n.startSN;return n.fragments[t+1]}}getNextPart(e){var t;const{index:n,fragment:r}=e,i=null==(t=this.hls.levels[r.level])||null==(t=t.details)?void 0:t.partList;if(i){const{sn:e}=r;for(let t=i.length-1;t>=0;t--){const r=i[t];if(r.index===n&&r.fragment.sn===e)return i[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?eu.TIMED_TEXT:"initSegment"===e.sn?eu.INIT:"audio"===t?eu.AUDIO:"main"===t?this.hls.audioTracks.length?eu.VIDEO:eu.MUXED:void 0}getTopBandwidth(e){let t,n=0;const r=this.hls;if(e===eu.AUDIO)t=r.audioTracks;else{const e=r.maxAutoLevel,n=e>-1?e+1:r.levels.length;t=r.levels.slice(0,n)}return t.forEach(e=>{e.bitrate>n&&(n=e.bitrate)}),n>0?n:NaN}getBufferLength(e){const t=this.media,n=e===eu.AUDIO?this.audioBuffer:this.videoBuffer;if(!n||!t)return NaN;return 1e3*Pa.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,r){t(e),this.loader.load(e,n,r)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,r){t(e),this.loader.load(e,n,r)}}}},contentSteeringController:class extends ri{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hr.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hr.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((null==n?void 0:n.action)===na&&n.flags===aa){const e=this.levels;let r=this._pathwayPriority,i=this.pathwayId;if(t.context){const{groupId:n,pathwayId:r,type:s}=t.context;n&&e?i=this.getPathwayForGroupId(n,s,i):r&&(i=r)}i in this.penalizedPathways||(this.penalizedPathways[i]=performance.now()),!r&&e&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==i),t.details!==Kr.BUFFER_APPEND_ERROR||t.fatal?n.resolved||this.warn("Could not resolve ".concat(t.details,' ("').concat(t.error.message,'") with content-steering for Pathway: ').concat(i," levels: ").concat(e?e.length:e," priorities: ").concat(Cs(r)," penalized: ").concat(Cs(this.penalizedPathways))):n.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const n=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(n,'"')),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(e=>{r-n[e]>3e5&&delete n[e]});for(let i=0;i<e.length;i++){const r=e[i];if(r in n)continue;if(r===this.pathwayId)return;const s=this.hls.nextLoadLevel,a=this.hls.levels[s];if(t=this.getLevelsForPathway(r),t.length>0){this.log('Setting Pathway to "'.concat(r,'"')),this.pathwayId=r,Ko(t),this.hls.trigger(Hr.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[s];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(a.bitrate," to ").concat(e.bitrate)),this.hls.nextLoadLevel=s);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let i=0;i<r.length;i++)if(t===Wr&&r[i].hasAudioGroup(e)||t===Yr&&r[i].hasSubtitleGroup(e))return r[i].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(e=>{const{ID:i,"BASE-ID":s,"URI-REPLACEMENT":a}=e;if(t.some(e=>e.pathwayId===i))return;const o=this.getLevelsForPathway(s).map(e=>{const t=new ja(e.attrs);t["PATHWAY-ID"]=i;const s=t.AUDIO&&"".concat(t.AUDIO,"_clone_").concat(i),o=t.SUBTITLES&&"".concat(t.SUBTITLES,"_clone_").concat(i);s&&(n[t.AUDIO]=s,t.AUDIO=s),o&&(r[t.SUBTITLES]=o,t.SUBTITLES=o);const l=qu(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),c=new _s({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let n=1;n<e.audioGroups.length;n++)c.addGroupId("audio","".concat(e.audioGroups[n],"_clone_").concat(i));if(e.subtitleGroups)for(let n=1;n<e.subtitleGroups.length;n++)c.addGroupId("text","".concat(e.subtitleGroups[n],"_clone_").concat(i));return c});t.push(...o),Yu(this.audioTracks,n,a,i),Yu(this.subtitleTracks,r,a,i)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;let r;this.loader&&this.loader.destroy(),this.loader=new n(t);try{r=new self.URL(e)}catch(c){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(e))}if("data:"!==r.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+e)}const i={responseType:"json",url:r.href},s=t.steeringManifestLoadPolicy.default,a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,n,i)=>{this.log('Loaded steering manifest: "'.concat(r,'"'));const s=e.data;if(1!==(null==s?void 0:s.VERSION))return void this.log("Steering VERSION ".concat(s.VERSION," not supported!"));this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=s;if(a)try{this.uri=new self.URL(a,r).href}catch(c){return this.enabled=!1,void this.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(a))}this.scheduleRefresh(this.uri||n.url),o&&this.clonePathways(o);const u={steeringManifest:s,url:r.toString()};this.hls.trigger(Hr.STEERING_MANIFEST_LOADED,u),l&&this.updatePathwayPriority(l)},onError:(e,t,n,r)=>{if(this.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log("Steering manifest ".concat(t.url," no longer available"));let i=1e3*this.timeToLoad;if(429===e.code){const e=this.loader;if("function"===typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(i=1e3*parseFloat(t))}return void this.log("Steering manifest ".concat(t.url," rate limited"))}this.scheduleRefresh(this.uri||t.url,i)},onTimeout:(e,t,n)=>{this.log("Timeout loading steering manifest (".concat(t.url,")")),this.scheduleRefresh(this.uri||t.url)}};this.log("Requesting steering manifest: ".concat(r)),this.loader.load(i,o,l)}scheduleRefresh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const n=null==(t=this.hls)?void 0:t.media;!n||n.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}},interstitialsController:class extends ri{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled||!this.schedule)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const n=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const r=this.playingItem;if(!r)return void this.checkBuffer();if(n){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(!0)}if(this.checkBuffer(),n&&e<r.start||e>=r.end){var i;const t=this.findItemIndex(r);let s=this.schedule.findItemIndexAtTime(e);if(-1===s&&(s=t+(n?-1:1),this.log("seeked ".concat(n?"back ":"","to position not covered by schedule ").concat(e," (resolving from ").concat(t," to ").concat(s,")"))),!this.isInterstitial(r)&&null!=(i=this.media)&&i.paused&&(this.shouldPlay=!1),!n&&s>t){const e=this.schedule.findJumpRestrictedIndex(t+1,s);if(e>t)return void this.setSchedulePosition(e)}return void this.setSchedulePosition(s)}const s=this.playingAsset;if(!s){if(this.playingLastItem&&this.isInterstitial(r)){const t=r.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const a=s.timelineStart,o=s.duration||0;var l;(n&&e<a||e>=a+o)&&(null!=(l=r.event)&&l.appendInPlace&&(this.clearAssetPlayers(r.event,r),this.flushFrontBuffer(e)),this.setScheduleToAssetAtTime(e,s))},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const n=this.playingAsset;if(!n)return;e>=n.timelineStart+(n.duration||0)&&this.setScheduleToAssetAtTime(e,n)},this.onScheduleUpdate=(e,t)=>{const n=this.schedule;if(!n)return;const r=this.playingItem,i=n.events||[],s=n.items||[],a=n.durations,o=e.map(e=>e.identifier),l=!(!i.length&&!o.length);(l||t)&&this.log("INTERSTITIALS_UPDATED (".concat(i.length,"): ").concat(i,"\nSchedule: ").concat(s.map(e=>md(e))," pos: ").concat(this.timelinePos)),o.length&&this.log("Removed events ".concat(o));let c=null,u=null;r&&(c=this.updateItem(r,this.timelinePos),this.itemsMatch(r,c)?this.playingItem=c:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const d=this.bufferingItem;if(d&&(u=this.updateItem(d,this.bufferedPos),this.itemsMatch(d,u)?this.bufferingItem=u:d.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(d.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){const t=e.assetItem.timelineStart,n=e.timelineOffset-t;if(n)try{e.timelineOffset=t}catch(rf){Math.abs(n)>ad&&this.warn("".concat(rf,' ("').concat(e.assetId,'" ').concat(e.timelineOffset,"->").concat(t,")"))}}}),l||t){if(this.hls.trigger(Hr.INTERSTITIALS_UPDATED,{events:i.slice(0),schedule:s.slice(0),durations:a,removedIds:o}),this.isInterstitial(r)&&o.includes(r.event.identifier))return this.warn('Interstitial "'.concat(r.event.identifier,'" removed while playing')),void this.primaryFallback(r.event);r&&this.trimInPlace(c,r),d&&u!==c&&this.trimInPlace(u,d),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new vd(e),this.schedule=new pd(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Hr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Hr.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(Hr.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Hr.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(Hr.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(Hr.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(Hr.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Hr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Hr.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(Hr.MEDIA_ENDED,this.onMediaEnded,this),e.on(Hr.ERROR,this.onError,this),e.on(Hr.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Hr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Hr.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(Hr.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Hr.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(Hr.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(Hr.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(Hr.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Hr.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Hr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Hr.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(Hr.MEDIA_ENDED,this.onMediaEnded,this),e.off(Hr.ERROR,this.onError,this),e.off(Hr.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){$o(e,"play",this.onPlay),$o(e,"pause",this.onPause),$o(e,"seeking",this.onSeeking),$o(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Xo(n,"seeking",this.onSeeking),Xo(n,"timeupdate",this.onTimeupdate),Xo(n,"play",this.onPlay),Xo(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,null===n)this.checkStart();else if(!r){this.clearScheduleState();const e=this.findItemIndex(n);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.log("Removing schedule state for detachedData and ".concat(e)),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=t=>t?e.getAssetPlayer(t.identifier):t,r=(t,r,s,a,o)=>{if(t){let l=t[r].start;const c=t.event;if(c){if("playout"===r||c.timelineOccupancy!==od.Point){const e=n(s);(null==e?void 0:e.interstitial)===c&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===a?i():e[a])-t.start}return l}return 0},i=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?s("primary"):Math.max(t,0)},s=t=>{var n,r;return null!=(n=e.primaryDetails)&&n.live?e.primaryDetails.edge:(null==(r=e.schedule)?void 0:r.durations[t])||0},a=(t,i)=>{var s,a;const o=e.effectivePlayingItem;if(null!=o&&null!=(s=o.event)&&s.restrictions.skip||!e.schedule)return;e.log("seek to ".concat(t,' "').concat(i,'"'));const l=e.effectivePlayingItem,c=e.schedule.findItemIndexAtTime(t,i),u=null==(a=e.schedule.items)?void 0:a[c],d=e.getBufferingPlayer(),h=null==d?void 0:d.interstitial,f=null==h?void 0:h.appendInPlace,g=l&&e.itemsMatch(l,u);if(l&&(f||g)){const s=n(e.playingAsset),a=(null==s?void 0:s.media)||e.primaryMedia;if(a){const n="primary"===i?a.currentTime:r(l,i,e.playingAsset,"timelinePos","currentTime"),o=t-n,c=(f?n:a.currentTime)+o;if(c>=0&&(!s||f||c<=s.duration))return void(a.currentTime=c)}}if(u){let n=t;if("primary"!==i){const e=t-u[i].start;n=u.start+e}const r=!e.isInterstitial(u);if(e.isInterstitial(l)&&!l.event.appendInPlace||!r&&!u.event.appendInPlace){if(l){const s=e.findItemIndex(l);if(c>s){const t=e.schedule.findJumpRestrictedIndex(s+1,c);if(t>s)return void e.setSchedulePosition(t)}let a=0;if(r)e.timelinePos=n,e.checkBuffer();else{const e=u.event.assetList,n=t-(u[i]||u).start;for(let t=e.length;t--;){const r=e[t];if(r.duration&&n>=r.startOffset&&n<r.startOffset+r.duration){a=t;break}}}e.setSchedulePosition(c,a)}}else{const t=e.media||(f?null==d?void 0:d.media:null);t&&(t.currentTime=n)}}},o=()=>{const n=e.effectivePlayingItem;if(e.isInterstitial(n))return n;const r=t();return e.isInterstitial(r)?r:null},l={get bufferedEnd(){const n=t(),i=e.bufferingItem;var s;return i&&i===n&&(r(i,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-i.playout.start||(null==(s=e.bufferingAsset)?void 0:s.startOffset))||0},get currentTime(){const t=o(),n=e.effectivePlayingItem;return n&&n===t?r(n,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-n.playout.start:0},set currentTime(t){const n=o(),r=e.effectivePlayingItem;r&&r===n&&a(t+r.playout.start,"playout")},get duration(){const e=o();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const n=null==(t=o())?void 0:t.event.assetList;return n?n.map(t=>e.getAssetPlayer(t.identifier)):[]},get playingIndex(){var t;const n=null==(t=o())?void 0:t.event;return n&&e.effectivePlayingAsset?n.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var t;return(null==(t=e.schedule)||null==(t=t.events)?void 0:t.slice(0))||[]},get schedule(){var t;return(null==(t=e.schedule)||null==(t=t.items)?void 0:t.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const n=t();return e.findItemIndex(n)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return i()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){a(e,"primary")},get duration(){return s("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){a(e,"integrated")},get duration(){return s("integrated")},get seekableStart(){var t;return((t,n)=>{var r;if(0!==t&&"primary"!==n&&null!=(r=e.schedule)&&r.length){var i;const r=e.schedule.findItemIndexAtTime(t),s=null==(i=e.schedule.items)?void 0:i[r];if(s)return t+(s[n].start-s.start)}return t})((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,n=null==t?void 0:t.event;if(n&&!n.restrictions.skip){const r=e.findItemIndex(t);if(n.appendInPlace){const e=t.playout.start+t.event.duration;a(e+.001,"playout")}else e.advanceAfterAssetEnded(n,r,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&n)&&this.findItemIndex(t)===n.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(r=this.primaryMedia);const i=null==(t=r)?void 0:t.currentTime;return void 0!==i&&Ur(i)?i:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r)return void(this.detachedData={media:r});const n=e.transferMedia();this.log("transfer MediaSource from ".concat(e," ").concat(Cs(n))),this.detachedData=n}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let i=null;const s=this.hls,a=e!==s,o=a&&e.interstitial.appendInPlace,l=null==(n=this.detachedData)?void 0:n.mediaSource;let c;if(s.media)o&&(i=s.transferMedia(),this.detachedData=i),c="Primary";else if(l){const e=this.getBufferingPlayer();e?(i=e.transferMedia(),c="".concat(e)):c="detached MediaSource"}else c="detached media";if(!i)if(l)i=this.detachedData,this.log("using detachedData: MediaSource ".concat(Cs(i)));else if(!this.detachedData||s.media===t){const e=this.playerQueue;e.length>1&&e.forEach(e=>{if(a&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn("Could not change append strategy for queued assets ".concat(t))}}),this.hls.detachMedia(),this.detachedData={media:t}}const u=i&&"mediaSource"in i&&"closed"!==(null==(r=i.mediaSource)?void 0:r.readyState),d=u&&i?i:t;this.log("".concat(u?"transfering MediaSource":"attaching media"," to ").concat(a?e:"Primary"," from ").concat(c," (media.currentTime: ").concat(t.currentTime,")"));const h=this.schedule;if(d===i&&h){const t=a&&e.assetId===h.assetIdAtEnd;d.overrides={duration:h.duration,endOfStream:!a||t,cueRemoval:!a}}e.attachMedia(d)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(-1===n){const n=this.hls.startPosition;if(this.log(Ed("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const n=e.findEventIndex(t[0].identifier);this.setSchedulePosition(n)}else if(n>=0||!this.primaryLive){const t=this.timelinePos=n>0?n:0,r=e.findItemIndexAtTime(t);this.setSchedulePosition(r)}}else if(r&&!this.playingItem){const t=e.findItemIndex(r);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){const n=e.event,r=n.findAssetIndex(t),i=hd(n,r);if(n.isAssetPastPlayoutLimit(i)){if(this.schedule){var s;const t=null==(s=this.schedule.items)?void 0:s[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,i)}advanceAfterAssetEnded(e,t,n){const r=hd(e,n);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const n=this.schedule.items;if(n){const r=t+1;if(r>=n.length)return void this.setSchedulePosition(-1);const i=e.resumeTime;this.timelinePos<i&&(this.log(Ed("advanceAfterAssetEnded",i)),this.timelinePos=i,e.appendInPlace&&this.advanceInPlace(i),this.checkBuffer(this.bufferedPos<i)),this.setSchedulePosition(r)}}}else{if(e.appendInPlace){const t=e.assetList[r];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const r=t.parentIdentifier,i=n.getEvent(r);if(i){const t=n.findEventIndex(r),s=n.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,t,s-1)}}setSchedulePosition(e,t){var n;const r=null==(n=this.schedule)?void 0:n.items;if(!r||this.playbackDisabled)return;const i=e>=0?r[e]:null;this.log("setSchedulePosition ".concat(e,", ").concat(t," (").concat(i?md(i):i,") pos: ").concat(this.timelinePos));const s=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(s)){const n=s.event,c=this.playingAsset,u=null==c?void 0:c.identifier,d=u?this.getAssetPlayer(u):null;if(d&&u&&(!this.eventItemsMatch(s,i)||void 0!==t&&u!==n.assetList[t].identifier)){var o;const t=n.findAssetIndex(c);if(this.log("INTERSTITIAL_ASSET_ENDED ".concat(t+1,"/").concat(n.assetList.length," ").concat(fd(c))),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(Hr.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:n,schedule:r.slice(0),scheduleIndex:e,player:d}),s!==this.playingItem)return void(this.itemsMatch(s,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(n,this.findItemIndex(this.playingItem),t));this.retreiveMediaSource(u,i),!d.media||null!=(o=this.detachedData)&&o.mediaSource||d.detachMedia()}if(!this.eventItemsMatch(s,i)&&(this.endedItem=s,this.playingItem=null,this.log("INTERSTITIAL_ENDED ".concat(n," ").concat(md(s))),n.hasPlayed=!0,this.hls.trigger(Hr.INTERSTITIAL_ENDED,{event:n,schedule:r.slice(0),scheduleIndex:e}),n.cue.once)){var l;this.updateSchedule();const e=null==(l=this.schedule)?void 0:l.items;if(i&&e){const n=this.findItemIndex(i);this.advanceSchedule(n,e,t,s,a)}return}}this.advanceSchedule(e,r,t,s,a)}advanceSchedule(e,t,n,r,i){const s=this.schedule;if(!s)return;const a=t[e]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{const n=t.interstitial,r=s.findEventIndex(n.identifier);(r<e||r>e+1)&&this.clearInterstitial(n,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const i=a.event;if(void 0===n){const t=hd(i,(n=s.findAssetIndex(i,this.timelinePos))-1);if(i.isAssetPastPlayoutLimit(t)||i.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(i,e,n);n=t}const l=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let c=this.preloadAssets(i,n);if(this.eventItemsMatch(a,l||r)||(this.waitingItem=a,this.log("INTERSTITIAL_STARTED ".concat(md(a)," ").concat(i.appendInPlace?"append in place":"")),this.hls.trigger(Hr.INTERSTITIAL_STARTED,{event:i,schedule:t.slice(0),scheduleIndex:e})),!i.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading ".concat(i));if(i.assetListLoader&&(i.assetListLoader.destroy(),i.assetListLoader=void 0),!o)return void this.log("Waiting for attachMedia to start Interstitial ".concat(i));this.waitingItem=this.endedItem=null,this.playingItem=a;const u=i.assetList[n];if(!u)return void this.advanceAfterAssetEnded(i,e,n||0);if(c||(c=this.getAssetPlayer(u.identifier)),null===c||c.destroyed){const e=i.assetList.length;this.warn("asset ".concat(n+1,"/").concat(e," player destroyed ").concat(i)),c=this.createAssetPlayer(i,u,n),c.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&i.appendInPlace&&this.isAssetBuffered(u))return;this.startAssetPlayer(c,n,t,e,o),this.shouldPlay&&yd(c.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&yd(this.hls.media)):i&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(s.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,n){var r,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming ".concat(md(e))),null==(r=this.detachedData)||!r.mediaSource){let n=this.timelinePos;(n<e.start||n>=e.end)&&(n=this.getPrimaryResumption(e,t),this.log(Ed("resumePrimary",n)),this.timelinePos=n),this.attachPrimary(n,e)}if(!n)return;const s=null==(i=this.schedule)?void 0:i.items;s&&(this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(md(e))),this.hls.trigger(Hr.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(n<e.fragmentStart||n>e.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return Pa.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Ed("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs(((null==(n=r.mainForwardBufferInfo)?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(Hr.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(Hr.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const r=ni(ni({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r)return void(this.altSelection=ni(ni({},this.altSelection),{},{audio:n}));const i=ni(ni({},r),{},{audio:n});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r)return void(this.altSelection=ni(ni({},this.altSelection),{},{subtitles:n}));const i=ni(ni({},r),{},{subtitles:n});this.mediaSelection=i}onAudioTrackSwitching(e,t){const n=Ms(t);this.playerQueue.forEach(e=>{let{hls:r}=e;return r&&(r.setAudioOption(t)||r.setAudioOption(n))})}onSubtitleTrackSwitch(e,t){const n=Ms(t);this.playerQueue.forEach(e=>{let{hls:r}=e;return r&&(r.setSubtitleOption(t)||-1!==t.id&&r.setSubtitleOption(n))})}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const r=t[e];if(r.cue.post){var n;const e=this.schedule.findEventIndex(r.identifier),t=null==(n=this.schedule.items)?void 0:n[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const r=null==(n=this.schedule)?void 0:n.items;if(e&&r){return r[this.findItemIndex(e,t)]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,n)=>{e.event.isAssetPastPlayoutLimit(n)&&this.clearAssetPlayer(t.identifier,null)});const n=e.end+.25,r=Pa.bufferInfo(this.primaryMedia,n,0);if(r.end>n||(r.nextStart||0)>n){this.log("trim buffered interstitial ".concat(md(e)," (was ").concat(md(t),")"));const r=!0;this.attachPrimary(n,null,r),this.flushFrontBuffer(n)}}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===(null==(n=t.event)?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const n=this.mediaSelection;n&&(null==(t=this.schedule)||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=null==(t=this.schedule)?void 0:t.items;if(!n)return;const r=Pa.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,n,e)}updateBufferedPos(e,t,n){const r=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(1===t.length&&this.itemsMatch(t[0],i))return void(this.bufferedPos=e);const s=this.playingItem,a=this.findItemIndex(s);let o=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const n=this.findItemIndex(i),r=Math.min(n+1,t.length-1),s=t[r];if((-1===o&&i&&e>=i.end||null!=(l=s.event)&&l.appendInPlace&&e+.01>=s.start)&&(o=r),this.isInterstitial(i)){const e=i.event;if(r-a>1&&!1===e.appendInPlace)return;if(0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>n&&o>a)this.bufferedToItem(s);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&s.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(s)&&this.preloadAssets(s.event,0)}}else n&&s&&!this.itemsMatch(s,i)&&(o===a?this.bufferedToItem(s):o===a+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{const n=this.getAssetPlayer(e.identifier);return!(null!=n&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:r,events:i}=n;if(!r||!i)return t;const s=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const o=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(md(e))+(t?" (".concat(o.toFixed(2)," remaining)"):"")),!this.playbackDisabled)if(s){const t=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,n)=>{const r=this.getAssetPlayer(e.identifier);r&&(n===t&&r.loadSource(),r.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(Hr.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==n){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=0===n.assetList.length&&!n.assetListLoader,i=n.cue.once;if(r||!i){const e=this.preloadAssets(n,t);if(null!=e&&e.interstitial.appendInPlace){const t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,i=0===r&&!e.assetListLoader,s=e.cue.once;if(i){const i=e.timelineStart;if(e.appendInPlace){var a;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(a=t.nextEvent)?void 0:a.identifier)!==e.identifier||this.flushFrontBuffer(i+.25)}let s,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-i;e>0&&(s=Math.round(1e3*e)/1e3)}if(this.log("Load interstitial asset ".concat(t+1,"/").concat(n?1:r," ").concat(e).concat(s?" live-start: ".concat(o," start-offset: ").concat(s):"")),n)return this.createAsset(e,0,0,i,e.duration,n);const l=this.assetListLoader.loadAssetList(e,s);l&&(e.assetListLoader=l)}else if(!s&&r){for(let i=t;i<r;i++){const t=e.assetList[i],n=this.getAssetPlayerQueueIndex(t.identifier);-1!==n&&!this.playerQueue[n].destroyed||t.error||this.createAssetPlayer(e,t,i)}const n=e.assetList[t];if(n){const e=this.getAssetPlayer(n.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log("Removing front buffer starting at ".concat(e));Object.keys(t).forEach(t=>{this.hls.trigger(Hr.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n];return null}createAsset(e,t,n,r,i,s){const a={parentIdentifier:e.identifier,identifier:ld(e,s,t),duration:i,startOffset:n,timelineStart:r,uri:s};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){const r=this.hls,i=r.userConfig;let s=i.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(s||a)&&(s=ei({},s),a.videoCodec&&(s.videoCodec=a.videoCodec),a.videoRange&&(s.allowedVideoRanges=[a.videoRange]));const o=r.audioTracks[r.audioTrack],l=r.subtitleTracks[r.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const n=t.duration;n&&e<n&&(c=e)}}const u=t.identifier,d=ni(ni({},i),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:u,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:s,audioPreference:o||i.audioPreference,subtitlePreference:l||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(d.timelineOffset=t.timelineStart));const h=d.cmcd;null!=h&&h.sessionId&&h.contentId&&(d.cmcd=ei({},h,{contentId:sd(t.uri)})),this.getAssetPlayer(u)&&this.warn("Duplicate date range identifier ".concat(e," and asset ").concat(u));const f=new gd(this.HlsPlayerClass,d,e,t);this.playerQueue.push(f),e.assetList[n]=t;let g=!0;const p=r=>{if(r.live){var i;const t=new Error("Interstitials MUST be VOD assets ".concat(e)),r={fatal:!0,type:Gr.OTHER_ERROR,details:Kr.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},s=(null==(i=this.schedule)?void 0:i.findEventIndex(e.identifier))||-1;return void this.handleAssetItemError(r,e,s,n,t.message)}const s=r.edge-r.fragmentStart,a=t.duration;(g||null===a||s>a)&&(g=!1,this.log('Interstitial asset "'.concat(u,'" duration change ').concat(a," > ").concat(s)),t.duration=s,this.updateSchedule())};f.on(Hr.LEVEL_UPDATED,(e,t)=>{let{details:n}=t;return p(n)}),f.on(Hr.LEVEL_PTS_UPDATED,(e,t)=>{let{details:n}=t;return p(n)}),f.on(Hr.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const m=(e,t)=>{const n=this.getAssetPlayer(u);if(n&&t.tracks){n.off(Hr.BUFFER_CODECS,m),n.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===n.assetItem&&e&&!n.media&&this.bufferAssetPlayer(n,e)}};f.on(Hr.BUFFER_CODECS,m);f.on(Hr.BUFFERED_TO_END,()=>{var n;const r=this.getAssetPlayer(u);if(this.log("buffered to end of asset ".concat(r)),!r||!this.schedule)return;const i=this.schedule.findEventIndex(e.identifier),s=null==(n=this.schedule.items)?void 0:n[i];this.isInterstitial(s)&&this.advanceAssetBuffering(s,t)});const v=t=>()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;this.shouldPlay=!0;const n=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,t)};return f.once(Hr.MEDIA_ENDED,v(n)),f.once(Hr.PLAYOUT_LIMIT_REACHED,v(1/0)),f.on(Hr.ERROR,(t,r)=>{if(!this.schedule)return;const i=this.getAssetPlayer(u);if(r.details===Kr.BUFFER_STALLED_ERROR)return null!=i&&i.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),n,"Asset player error ".concat(r.error," ").concat(e))}),f.on(Hr.DESTROYING,()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;const t=new Error("Asset player destroyed unexpectedly ".concat(u)),r={fatal:!0,type:Gr.OTHER_ERROR,details:Kr.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),n,t.message)}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(fd(t))),this.hls.trigger(Hr.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:f}),f}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log('reset asset player "'.concat(e,'" after error'));const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(-1!==n){const e=this.playerQueue[n];this.log("clear ".concat(e," toSegment: ").concat(t?md(t):t)),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(n,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,i){const{interstitial:s,assetItem:a,assetId:o}=e,l=s.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,n[r]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED ".concat(t+1,"/").concat(l," ").concat(fd(a))),this.hls.trigger(Hr.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:s,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var n,r;if(!this.schedule)return;const{interstitial:i,assetItem:s}=e,a=this.schedule.findEventIndex(i.identifier),o=null==(n=this.schedule.items)?void 0:n[a];if(!o)return;e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=s;const l=this.getBufferingPlayer();if(l===e)return;const c=i.appendInPlace;if(c&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const u=(null==l?void 0:l.tracks)||(null==(r=this.detachedData)?void 0:r.tracks)||this.requiredTracks;if(c&&s!==this.playingAsset){if(!e.tracks)return void this.log("Waiting for track info before buffering ".concat(e));if(u&&!di(u,e.tracks)){const t=new Error("Asset ".concat(fd(s)," SourceBuffer tracks ('").concat(Object.keys(e.tracks),"') are not compatible with primary content tracks ('").concat(Object.keys(u),"')")),n={fatal:!0,type:Gr.OTHER_ERROR,details:Kr.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},r=i.findAssetIndex(s);return void this.handleAssetItemError(n,i,a,r,t.message)}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const r=n.currentTime,i=t.findAssetIndex(e,r),s=e.assetList[i];if(s){const a=this.getAssetPlayer(s.identifier);if(a){const o=a.currentTime||r-s.timelineStart,l=a.duration-o;if(this.warn("Stalled at ".concat(o," of ").concat(o+l," in ").concat(a," ").concat(e," (media.currentTime: ").concat(r,")")),o&&(l/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const n=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,r,i){if(e.details===Kr.BUFFER_STALLED_ERROR)return;const s=t.assetList[r]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR ".concat(s?fd(s):s," ").concat(e.error)),!this.schedule)return;const a=(null==s?void 0:s.identifier)||"",o=this.getAssetPlayerQueueIndex(a),l=this.playerQueue[o]||null,c=this.schedule.items,u=ei({},e,{fatal:!1,errorAction:ca(!0),asset:s,assetListIndex:r,event:t,schedule:c,scheduleIndex:n,player:l});if(this.hls.trigger(Hr.INTERSTITIAL_ASSET_ERROR,u),!e.fatal)return;const d=this.playingAsset,h=this.bufferingAsset,f=new Error(i);if(s&&(this.clearAssetPlayer(a,null),s.error=f),t.assetList.some(e=>!e.error))for(let g=r;g<t.assetList.length;g++)this.resetAssetPlayer(t.assetList[g].identifier);else t.error=f;this.updateSchedule(!0),t.error?this.primaryFallback(t):d&&d.identifier===a?this.advanceAfterAssetEnded(t,n,r):h&&h.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let r=this.timelinePos;if(n){this.log('Fallback to primary from event "'.concat(e.identifier,'" start: ').concat(t," pos: ").concat(r," playing: ").concat(md(n)," error: ").concat(e.error)),-1===r&&(r=this.hls.startPosition);const i=this.updateItem(n,r);this.itemsMatch(n,i)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(-1===r)return void this.checkStart();if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var n,r;const i=t.event,s=i.identifier,a=t.assetListResponse.ASSETS;if(null==(n=this.schedule)||!n.hasEvent(s))return;const o=i.timelineStart,l=i.duration;let c=0;a.forEach((e,t)=>{const n=parseFloat(e.DURATION);this.createAsset(i,t,c,o+c,n,e.URI),c+=n}),i.duration=c,this.log("Loaded asset-list with duration: ".concat(c," (was: ").concat(l,") ").concat(i));const u=this.waitingItem,d=(null==u?void 0:u.event.identifier)===s;this.updateSchedule();const h=null==(r=this.bufferingItem)?void 0:r.event;if(d){var f;const e=this.schedule.findEventIndex(s),t=null==(f=this.schedule.items)?void 0:f[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return i.error=new Error("Interstitial ".concat(a.length?"no longer within playback range":"asset-list is empty"," ").concat(this.timelinePos," ").concat(i)),this.log(i.error.message),this.updateSchedule(!0),void this.primaryFallback(i)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==h?void 0:h.identifier)===s){const e=i.assetList[0];if(e){const t=this.getAssetPlayer(e.identifier);if(h.appendInPlace){const e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Kr.ASSET_LIST_PARSING_ERROR:case Kr.ASSET_LIST_LOAD_ERROR:case Kr.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case Kr.BUFFER_STALLED_ERROR:{const e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log("Primary player stall @".concat(this.timelinePos," bufferedPos: ").concat(this.bufferedPos)),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function xh(e){return e&&"object"===typeof e?Array.isArray(e)?e.map(xh):Object.keys(e).reduce((t,n)=>(t[n]=xh(e[n]),t),{}):e}function wh(e,t){const n=e.loader;if(n!==yh&&n!==Th)t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(rf){}return!1})()&&(e.loader=yh,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class Lh extends Ia{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(Hr.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hr.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hr.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const n=this.media=t.media;Xo(n,"playing",this.onMediaPlaying),Xo(n,"waiting",this.onMediaWaiting),Xo(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&($o(n,"playing",this.onMediaPlaying),$o(n,"waiting",this.onMediaWaiting),$o(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const i=null==(n=this.hls)?void 0:n.config;if(!i)return;const s=this.media;if(!s)return;const{seeking:a}=s,o=this.seeking&&!a,l=!this.seeking&&a,c=s.paused&&!a||s.ended||0===s.playbackRate;if(this.seeking=a,e!==t)return t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(l||o)return void(o&&this.stallResolved(e));if(c)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&s.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(Hr.MEDIA_ENDED,{stalled:!1})));if(!Pa.getBuffered(s).length)return void(this.nudgeRetry=0);const u=Pa.bufferInfo(s,e,0),d=u.nextStart||0,h=this.fragmentTracker;if(a&&h&&this.hls){const t=Ah(this.hls.inFlightFragments,e),n=u.len>2,r=!d||t||d-e>2&&!h.getPartialFragment(e);if(n||r)return;this.moved=!1}const f=null==(r=this.hls)?void 0:r.latestLevelDetails;if(!this.moved&&null!==this.stalled&&h){if(!(u.len>0)&&!d)return;const t=Math.max(d,u.start||0)-e,n=!(null==f||!f.live)?2*f.targetduration:2,r=Ih(e,h);if(t>0&&(t<=n||r))return void(s.paused||this._trySkipBufferHole(r))}const g=i.detectStallWithCurrentTimeMs,p=self.performance.now(),m=this.waiting;let v=this.stalled;if(null===v){if(!(m>0&&p-m<g))return void(this.stalled=p);v=this.stalled=m}const y=p-v;if(!a&&(y>=g||m)&&this.hls){var E;if("ended"===(null==(E=this.mediaSource)?void 0:E.readyState)&&(null==f||!f.live)&&Math.abs(e-((null==f?void 0:f.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(Hr.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(u),!this.media||!this.hls)return}const b=Pa.bufferInfo(s,e,i.maxBufferHole);this._tryFixBufferStall(b,y,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log("playback not stuck anymore @".concat(e,", after ").concat(Math.round(n),"ms")),this.stallReported=!1,this.waiting=0,this.hls.trigger(Hr.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(n=this.buffered.audio)&&n.length&&r&&r.length>1&&e>r.end(0)){const n=Pa.bufferedInfo(Pa.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const n=Pa.timeRangesToArray(r),i=Pa.bufferedInfo(n,t,0).bufferedIndex;if(i>-1&&i<n.length-1){const t=Pa.bufferedInfo(n,e,0).bufferedIndex,r=n[i].end,s=n[i+1].start;if((-1===t||t>i)&&s-r<1&&e-r<2){const n=new Error("nudging playhead to flush pipeline after video hole. currentTime: ".concat(e," hole: ").concat(r," -> ").concat(s," buffered index: ").concat(t));this.warn(n.message),this.media.currentTime+=1e-6;let i=Ih(e,this.fragmentTracker);i&&"fragment"in i?i=i.fragment:i||(i=void 0);const a=Pa.bufferInfo(this.media,e,0);this.hls.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,frag:i,buffer:a.len,bufferInfo:a})}}}}}_tryFixBufferStall(e,t,n){var r,i;const{fragmentTracker:s,media:a}=this,o=null==(r=this.hls)?void 0:r.config;if(!a||!s||!o)return;const l=null==(i=this.hls)?void 0:i.latestLevelDetails,c=Ih(n,s);if(c||null!=l&&l.live&&n<l.fragmentStart){if(this._trySkipBufferHole(c)||!this.media)return}const u=e.buffered,d=this.adjacentTraversal(e,n);(u&&u.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-n<o.maxBufferHole||d))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,r=e.nextStart;if(n&&r){const e=n.getFragAtPos(t,qr),i=n.getFragAtPos(r,qr);if(e&&i)return i.sn-e.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:i}=this;if(!r&&null!==i&&n&&t){this.stallReported=!0;const r=new Error("Playback stalling at @".concat(n.currentTime," due to low buffer (").concat(Cs(e),")"));this.warn(r.message),t.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,i=null==(t=this.hls)?void 0:t.config;if(!r||!n||!i)return 0;const s=r.currentTime,a=Pa.bufferInfo(r,s,0),o=s<a.start?a.start:a.nextStart;if(o&&this.hls){const t=a.len<=i.maxBufferHole,c=a.len>0&&a.len<1&&r.readyState<3,u=o-s;if(u>0&&(t||c)){if(u>i.maxBufferHole){let t=!1;if(0===s){const e=n.getAppendedFrag(0,qr);e&&o<e.end&&(t=!0)}if(!t&&e){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(Ah(this.hls.inFlightFragments,o))return 0;let t=!1,r=e.end;for(;r<o;){const e=Ih(r,n);if(!e){t=!0;break}r+=e.duration}if(t)return 0}}const t=Math.max(o+.05,s+.1);if(this.warn("skipping hole, adjusting currentTime from ".concat(s," to ").concat(t)),this.moved=!0,r.currentTime=t,null==e||!e.gap){const n=new Error("fragment loaded with buffer holes, seeking from ".concat(s," to ").concat(t)),r={type:Gr.MEDIA_ERROR,details:Kr.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?r.part=e:r.frag=e),this.hls.trigger(Hr.ERROR,r)}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,i=null==t?void 0:t.config;if(!n||!i)return 0;const s=n.currentTime;if(this.nudgeRetry++,r<i.nudgeMaxRetry){const a=s+(r+1)*i.nudgeOffset,o=new Error("Nudging 'currentTime' from ".concat(s," to ").concat(a));this.warn(o.message),n.currentTime=a,t.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const n=new Error("Playhead still not moving while enough data buffered @".concat(s," after ").concat(i.nudgeMaxRetry," nudges"));this.error(n.message),t.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.BUFFER_STALLED_ERROR,error:n,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Ah(e,t){const n=Rh(e.main);if(n&&n.start<=t)return n;const r=Rh(e.audio);return r&&r.start<=t?r:null}function Rh(e){if(!e)return null;switch(e.state){case el:case Zo:case ol:case ll:return null}return e.frag}function Ih(e,t){return t.getAppendedFrag(e,qr)||t.getPartialFragment(e)}function _h(){if("undefined"!==typeof self)return self.VTTCue||self.TextTrackCue}function Dh(e,t,n,r,i){let s=new e(t,n,"");try{s.value=r,i&&(s.type=i)}catch(rf){s=new e(t,n,Cs(i?ni({type:i},r):r))}return s}const Ph=(()=>{const e=_h();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(rf){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Ch{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(Hr.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Hr.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Hr.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(Hr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(Hr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Hr.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Hr.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,!1===(null==(n=t.overrides)?void 0:n.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var e;const t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&nd(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if("metadata"===n.kind&&"id3"===n.label)return ed(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:r}=this.hls.config;if(!n&&!r)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=_h();if(s)for(let a=0;a<i.length;a++){const e=i[a].type;if(e===Gl.emsg&&!n||!r)continue;const t=Fl(i[a].data),o=i[a].pts;let l=o+i[a].duration;l>Ph&&(l=Ph);l-o<=0&&(l=o+.25);for(let n=0;n<t.length;n++){const r=t[n];if(!Ul(r)){this.updateId3CueEnds(o,e);const t=Dh(s,o,l,r,e);t&&this.id3Track.addCue(t)}}}}updateId3CueEnds(e,t){var n;const r=null==(n=this.id3Track)?void 0:n.cues;if(r)for(let i=r.length;i--;){const n=r[i];n.type===t&&n.startTime<e&&n.endTime===Ph&&(n.endTime=e)}}onBufferFlushing(e,t){let{startOffset:n,endOffset:r,type:i}=t;const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let e;e="audio"===i?e=>e.type===Gl.audioId3&&l:"video"===i?e=>e.type===Gl.emsg&&o:e=>e.type===Gl.audioId3&&l||e.type===Gl.emsg&&o,rd(s,n,r,e)}}onLevelUpdated(e,t){let{details:n}=t;this.updateDateRangeCues(n,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:r,enableDateRangeMetadataCues:i,interstitialsController:s}=this.hls.config;if(!i)return;const a=_h();if(n&&r&&!s){const{fragmentStart:t,fragmentEnd:r}=e;let i=this.assetCue;i?(i.startTime=t,i.endTime=r):a&&(i=this.assetCue=Dh(a,t,r,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),i&&(i.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(i),i.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:l}=e,c=Object.keys(l);let u=this.dateRangeCuesAppended;var d;if(o&&t)if(null!=(d=o.cues)&&d.length){const e=Object.keys(u).filter(e=>!c.includes(e));for(let t=e.length;t--;){var h;const n=e[t],r=null==(h=u[n])?void 0:h.cues;delete u[n],r&&Object.keys(r).forEach(e=>{const t=r[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(t)}catch(rf){}}})}}else u=this.dateRangeCuesAppended={};const f=e.fragments[e.fragments.length-1];if(0!==c.length&&Ur(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<c.length;e++){const t=c[e],n=l[t],r=n.startTime,i=u[t],o=(null==i?void 0:i.cues)||{};let d=(null==i?void 0:i.durationKnown)||!1,h=Ph;const{duration:f,endDate:g}=n;if(g&&null!==f)h=r+f,d=!0;else if(n.endOnNext&&!d){const e=c.reduce((e,t)=>{if(t!==n.id){const r=l[t];if(r.class===n.class&&r.startDate>n.startDate&&(!e||n.startDate<e.startDate))return r}return e},null);e&&(h=e.startTime,d=!0)}const p=Object.keys(n.attr);for(let e=0;e<p.length;e++){const l=p[e];if(!Ga(l))continue;const c=o[l];if(c)!d||null!=i&&i.durationKnown?Math.abs(c.startTime-r)>.01&&(c.startTime=r,c.endTime=h):c.endTime=h;else if(a){let e=n.attr[l];Ka(l)&&(e=gi(e));const i=Dh(a,r,h,{key:l,data:e},Gl.dateRange);i&&(i.id=t,this.id3Track.addCue(i),o[l]=i,s&&("X-ASSET-LIST"!==l&&"X-ASSET-URL"!==l||i.addEventListener("enter",this.onEventCueEnter)))}}u[t]={cues:o,dateRange:n,durationKnown:d}}}}}class Oh{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:i}=this.config;if(!r||1===i||!t.live)return;const s=this.targetLatency;if(null===s)return;const a=n-s;if(a<Math.min(this.maxLatency,s+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,i)),n=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,r=Math.min(t,Math.max(1,n));this.changeMediaPlaybackRate(e,r)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:i,liveSyncDurationCount:s,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&n||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==i?i:s*r);const c=r;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const n=this.levelDetails;if(null===n)return null;const r=n.edge,i=e-t-this.edgeStalled,s=r-n.totalduration,a=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(s,i),a)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Hr.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Hr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Hr.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,t){let{details:n}=t;n.advanced&&this.onTimeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===Kr.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(n=this.levelDetails)&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&(null==(n=this.hls)||n.logger.debug("[latency-controller]: latency=".concat(this.latency.toFixed(3),", targetLatency=").concat(null==(r=this.targetLatency)?void 0:r.toFixed(3),", forwardBufferLength=").concat(this.forwardBufferLength.toFixed(3),": adjusting playback rate from ").concat(e.playbackRate," to ").concat(t)),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class Nh extends Hc{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Hr.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Hr.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Hr.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Hr.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],i={},s={};let a=!1,o=!1,l=!1;t.levels.forEach(e=>{const t=e.attrs;let{audioCodec:c,videoCodec:u}=e;c&&(e.audioCodec=c=us(c,n)||void 0),u&&(u=e.videoCodec=function(e){const t=e.split(",");for(let n=0;n<t.length;n++){const e=t[n].split(".");e.length>2&&"avc1"===e[0]&&(t[n]="avc1.".concat(parseInt(e[1]).toString(16)).concat(("000"+parseInt(e[2]).toString(16)).slice(-4)))}return t.join(",")}(u));const{width:d,height:h,unknownCodecs:f}=e,g=(null==f?void 0:f.length)||0;if(a||(a=!(!d||!h)),o||(o=!!u),l||(l=!!c),g||c&&!this.isAudioSupported(c)||u&&!this.isVideoSupported(u))return void this.log('Some or all CODECS not supported "'.concat(t.CODECS,'"'));const{CODECS:p,"FRAME-RATE":m,"HDCP-LEVEL":v,"PATHWAY-ID":y,RESOLUTION:E,"VIDEO-RANGE":b}=t,S="".concat(y||".","-"),T="".concat(S).concat(e.bitrate,"-").concat(E,"-").concat(m,"-").concat(p,"-").concat(b,"-").concat(v);if(i[T])if(i[T].uri===e.url||e.attrs["PATHWAY-ID"])i[T].addGroupId("audio",t.AUDIO),i[T].addGroupId("text",t.SUBTITLES);else{const t=s[T]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const n=this.createLevel(e);i[T]=n,r.push(n)}else{const t=this.createLevel(e);i[T]=t,s[T]=1,r.push(t)}}),this.filterAndSortMediaOptions(r,t,a,o,l)}createLevel(e){const t=new _s(e),n=e.supplemental;if(null!=n&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const e=new Error('SUPPLEMENTAL-CODECS not supported "'.concat(n.videoCodec,'"'));this.log(e.message),t.supportedResult=ys(e,[])}return t}isAudioSupported(e){return rs(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return rs(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,i){var s;let a=[],o=[],l=e;const c=(null==(s=t.stats)?void 0:s.parsing)||{};if((n||r)&&i&&(l=l.filter(e=>{let{videoCodec:t,videoRange:n,width:r,height:i}=e;return(!!t||!(!r||!i))&&(!!(s=n)&&xs.indexOf(s)>-1);var s})),0===l.length)return Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",n=e;t.levels.length&&(n="one or more CODECS in variant not supported: ".concat(Cs(t.levels.map(e=>e.attrs.CODECS).filter((e,t,n)=>n.indexOf(e)===t))),this.warn(n),e+=" (".concat(n,")"));const r=new Error(e);this.hls.trigger(Hr.ERROR,{type:Gr.MEDIA_ERROR,details:Kr.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:r,reason:n})}}),void(c.end=performance.now());t.audioTracks&&(a=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec)),Mh(a)),t.subtitles&&(o=t.subtitles,Mh(o));const u=l.slice(0);l.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return xs.indexOf(e.videoRange)-xs.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const n=as(e.videoCodec),r=as(t.videoCodec);if(n!==r)return r-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const n=os(e.codecSet),r=os(t.codecSet);if(n!==r)return r-n}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let d=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length))for(let v=0;v<u.length;v++)if(u[v].pathwayId===l[0].pathwayId){d=u[v];break}this._levels=l;for(let v=0;v<l.length;v++)if(l[v]===d){var h;this._firstLevel=v;const e=d.bitrate,t=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(l.length," level(s) found, first bitrate: ").concat(e)),void 0===(null==(h=this.hls.userConfig)?void 0:h.abrEwmaDefaultEstimate)){const n=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);n>t&&t===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=n)}break}const f=i&&!r,g=this.hls.config,p=!(!g.audioStreamController||!g.audioTrackController),m={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:r,altAudio:p&&!f&&a.some(e=>!!e.url)};c.end=performance.now(),this.hls.trigger(Hr.MANIFEST_PARSED,m)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const n=new Error("invalid level idx"),r=e<0;if(this.hls.trigger(Hr.ERROR,{type:Gr.OTHER_ERROR,details:Kr.LEVEL_SWITCH_ERROR,level:e,fatal:r,error:n,reason:n.message}),r)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,i=r?r.attrs["PATHWAY-ID"]:void 0,s=t[e],a=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,n===e&&r&&i===a)return;this.log("Switching to level ".concat(e," (").concat(s.height?s.height+"p ":"").concat(s.videoRange?s.videoRange+" ":"").concat(s.codecSet?s.codecSet+" ":"","@").concat(s.bitrate,")").concat(a?" with Pathway "+a:""," from level ").concat(n).concat(i?" with Pathway "+i:""));const o={level:e,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(Hr.LEVEL_SWITCHING,o);const l=s.details;if(!l||l.live){const e=this.switchParams(s.uri,null==r?void 0:r.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn("pathwayPriority ".concat(e," should contain at least one pathway from list: ").concat(t));this.steering.pathwayPriority=n}}onError(e,t){!t.fatal&&t.context&&t.context.type===zr&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,t){let{frag:n}=t;if(void 0!==n&&n.type===qr){const e=n.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const t=this._levels[n.level];null!=t&&t.loadError&&(this.log("Resetting level error count of ".concat(t.loadError," on frag buffered")),t.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:i}=t,s=t.levelInfo;var a;if(!s)return this.warn("Invalid level index ".concat(r)),void(null!=(a=t.deliveryDirectives)&&a.skip&&(i.deltaUpdateFailed=!0));if(s===this.currentLevel||t.withoutMultiVariant){0===s.fragmentError&&(s.loadError=0);let e=s.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(r,t,e)}else null!=(n=t.deliveryDirectives)&&n.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],s=e.details,a=null==s?void 0:s.age;this.log("Loading level index ".concat(r).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(i?" Pathway "+i:"").concat(a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""," ").concat(n)),this.hls.trigger(Hr.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const n=this._levels.filter((t,n)=>n!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));Ko(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(Hr.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,t){let{levels:n}=t;this._levels=n}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(Hr.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function Mh(e){const t={};e.forEach(e=>{const n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}function Fh(){return self.SourceBuffer||self.WebKitSourceBuffer}function Uh(){if(!ui())return!1;const e=Fh();return!e||e.prototype&&"function"===typeof e.prototype.appendBuffer&&"function"===typeof e.prototype.remove}class Bh extends dl{constructor(e,t,n){super(e,t,n,"stream-controller",qr),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!Ur(t))return;if(this.log("Media seeked to ".concat(t.toFixed(3))),!this.getBufferedFrag(t))return;const n=this.getFwdBufferInfoAtPos(e,t,qr,0);null!==n&&0!==n.len?this.tick():this.warn("Main forward buffer length at ".concat(t,' on "seeked" event ').concat(n?n.len:"empty",")"))},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hr.LEVEL_LOADING,this.onLevelLoading,this),e.on(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hr.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(Hr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Hr.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Hr.BUFFER_CREATED,this.onBufferCreated,this),e.on(Hr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Hr.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Hr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hr.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(Hr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Hr.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Hr.BUFFER_CREATED,this.onBufferCreated,this),e.off(Hr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Hr.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=r.startLevel;-1===e&&(r.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=r.firstAutoLevel),r.nextLoadLevel=e,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&-1===e&&!t&&(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n),this.state=el,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Zo}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ul:{const{levels:e,level:t}=this,n=null==e?void 0:e[t],r=null==n?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=el;break}if(this.hls.nextLoadLevel!==this.level){this.state=el;break}break}case rl:this.checkRetryDate()}this.state===el&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(null===t||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==n||!n[i])return;const s=n[i],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(Hr.BUFFER_EOS,e),void(this.state=ol)}if(!this.buffering)return;e.loadLevel!==i&&-1===e.manualLevel&&this.log("Adapting to level ".concat(i," from level ").concat(this.level)),this.level=e.nextLoadLevel=i;const l=s.details;if(!l||this.state===ul||this.waitForLive(s))return this.level=i,this.state=ul,void(this.startFragRequested=!1);const c=a.len,u=this.getMaxBufferLength(s.maxBitrate);if(c>=u)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(d,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&xi(h)&&this.fragmentTracker.getState(h)!==fa){var f;const e=(null!=(f=this.backtrackFragment)?f:h).sn-l.startSN,t=l.fragments[e-1];t&&h.cc===t.cc&&(h=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,d)){if(!h.gap){const e=this.audioOnly&&!this.altAudio?bi:Si,t=(e===Si?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,qr)}h=this.getNextFragmentLoopLoading(h,l,a,qr,u)}h&&(!h.initSegment||h.initSegment.data||this.bitrateTest||(h=h.initSegment),this.loadFragment(h,s,d))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===ua||r===ha?xi(e)?this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,qr)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const i=this.getLevelDetails();if(null!=i&&i.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*i.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],r=this.fragLastKbps;n=r&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*r)+1:0}else n=0;const s=this.getBufferedFrag(t.currentTime+n);if(s){const e=this.followingBufferedFrag(s);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,n=e.duration,r=Math.max(s.end,t+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case tl:case nl:case rl:case sl:case al:this.state=el}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Xo(n,"playing",this.onMediaPlaying),Xo(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&($o(n,"playing",this.onMediaPlaying),$o(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(Hr.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;for(let i=0;i<t.levels.length;i++){const e=t.levels[i].audioCodec;e&&(n=n||-1!==e.indexOf("mp4a.40.2"),r=r||-1!==e.indexOf("mp4a.40.5"))}this.audioCodecSwitch=n&&r&&!function(){var e;const t=Fh();return"function"===typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==el)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=ul)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:i}=this,s=t.level,a=t.details,o=a.totalduration;if(!r)return void this.warn("Levels were reset while loading level ".concat(s));this.log("Level ".concat(s," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",", cc [").concat(a.startCC,", ").concat(a.endCC,"] duration:").concat(o));const l=t.levelInfo,c=this.fragCurrent;!c||this.state!==nl&&this.state!==rl||c.level!==t.level&&c.loader&&this.abortCurrentFrag();let u=0;if(a.live||null!=(n=l.details)&&n.live){var d;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,l.details,null==(d=this.levelLastLoaded)?void 0:d.details)}if(l.details=a,this.levelLastLoaded=l,i||this.setStartPosition(a,u),this.hls.trigger(Hr.LEVEL_UPDATED,{details:a,level:s}),this.state===ul){if(this.waitForCdnTuneIn(a))return;this.state=el}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,i=this.getLoadPosition(),s=e.fragmentStart,a=e.edge,o=i>=s-t.maxFragLookUpTolerance&&i<=a;if(null!==r&&n.duration>r&&(i<r||!o)){const s=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&n.readyState<4||i<a-s)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState))if(this.warn("Playback: ".concat(i.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(a,", reset currentTime to : ").concat(r.toFixed(3))),"buffered"===this.config.liveSyncMode){var l;const e=Pa.bufferInfo(n,r,0);if(null==(l=e.buffered)||!l.length)return void(n.currentTime=r);if(e.start<=i)return void(n.currentTime=r);const{nextStart:t}=Pa.bufferedInfo(e.buffered,i,0);t&&(n.currentTime=t)}else n.currentTime=r}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:i}=e,{levels:s}=this;if(!s)return void this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const a=s[n.level];if(!a)return void this.warn("Level ".concat(n.level," not found on progress"));const o=a.details;if(!o)return this.warn("Dropping fragment ".concat(n.sn," of level ").concat(n.level," after level details were reset")),void this.fragmentTracker.removeFragment(n);const l=a.videoCodec,c=o.PTSKnown||!o.live,u=null==(t=n.initSegment)?void 0:t.data,d=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new Kc(this.hls,qr,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=r?r.index:-1,g=-1!==f,p=new _a(n.level,n.sn,n.stats.chunkCount,i.byteLength,f,g),m=this.initPTS[n.cc];h.push(i,u,d,l,n,r,o.totalduration,c,p,m)}onAudioTrackSwitching(e,t){const n=this.hls,r=0!==this.altAudio;if(Gs(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r)return this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(Hr.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(Hr.AUDIO_TRACK_SWITCHED,t)}),void n.trigger(Hr.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});n.trigger(Hr.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Gs(t.url,this.hls);if(n){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,i,s=!1;for(const a in n){const e=n[a];if("main"===e.id){if(i=a,r=e,"video"===a){const e=n[a];e&&(this.videoBuffer=e.buffer)}}else s=!0}s&&r?(this.log("Alternate track found, use ".concat(i,".buffered to schedule main fragment loading")),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,i=n.type===qr;if(i){if(this.fragContextChanged(n))return this.warn("Fragment ".concat(n.sn).concat(r?" p: "+r.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===al&&(this.state=el));const e=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),xi(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const s=this.media;s&&(!this._hasEnoughToStart&&Pa.getBuffered(s).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal)this.state=ll;else switch(t.details){case Kr.FRAG_GAP:case Kr.FRAG_PARSING_ERROR:case Kr.FRAG_DECRYPT_ERROR:case Kr.FRAG_LOAD_ERROR:case Kr.FRAG_LOAD_TIMEOUT:case Kr.KEY_LOAD_ERROR:case Kr.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(qr,t);break;case Kr.LEVEL_LOAD_ERROR:case Kr.LEVEL_LOAD_TIMEOUT:case Kr.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ul||(null==(n=t.context)?void 0:n.type)!==zr||(this.state=el);break;case Kr.BUFFER_ADD_CODEC_ERROR:case Kr.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Kr.BUFFER_FULL_ERROR:if("main"!==t.parent)return;if(this.reduceLengthAndFlushBuffer(t)){!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case Kr.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=el,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,t){let{type:n}=t;if(n!==bi||!this.altAudio){const e=(n===Si?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,n,qr),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log("could not seek to ".concat(n,", already seeking at ").concat(t));const r=this.timelineOffset;r&&n&&(n+=r);const i=this.getLevelDetails(),s=Pa.getBuffered(e),a=s.length?s.start(0):0,o=a-n,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==i?void 0:i.partTarget)||0)))&&(this.log("adjusting start position by ".concat(o," to match buffer start")),n+=o,this.startPosition=n),t<n&&(this.log("seek to target start position ".concat(n," from current time ").concat(t," buffer start ").concat(a)),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{const{hls:n}=this,r=null==e?void 0:e.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=el,this.startFragRequested=!1,this.bitrateTest=!1;const i=r.stats;i.parsing.start=i.parsing.end=i.buffering.start=i.buffering.end=self.performance.now(),n.trigger(Hr.FRAG_LOADED,e),r.bitrateTest=!1}).catch(t=>{this.state!==Zo&&this.state!==ll&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:i}=e,s=this.getCurrentContext(i);if(!s)return void this.resetWhenMissingContext(i);const{frag:a,part:o,level:l}=s,{video:c,text:u,id3:d,initSegment:h}=r,{details:f}=l,g=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=sl,h){const e=h.tracks;if(e){const r=a.initSegment||a;if(this.unhandledEncryptionError(h,a))return;this._bufferInitSegment(l,e,r,i),n.trigger(Hr.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:t,tracks:e})}const r=h.initPTS,s=h.timescale,o=this.initPTS[a.cc];if(Ur(r)&&(!o||o.baseTime!==r||o.timescale!==s)){const e=h.trackId;this.initPTS[a.cc]={baseTime:r,timescale:s,trackId:e},n.trigger(Hr.INIT_PTS_FOUND,{frag:a,id:t,initPTS:r,timescale:s,trackId:e})}}if(c&&f){g&&"audiovideo"===c.type&&this.logMuxedErr(a);const e=f.fragments[a.sn-1-f.startSN],t=a.sn===f.startSN,n=!e||a.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:r,startDTS:s,endDTS:l}=c;if(o)o.elementaryStreams[c.type]={startPTS:e,endPTS:r,startDTS:s,endDTS:l};else if(c.firstKeyFrame&&c.independent&&1===i.id&&!n&&(this.couldBacktrack=!0),c.dropped&&c.independent){const i=this.getMainFwdBufferInfo(),s=(i?i.end:this.getLoadPosition())+this.config.maxBufferHole,o=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&s<o-this.config.maxBufferHole&&!n)return void this.backtrack(a);n&&(a.gap=!0),a.setElementaryStreamInfo(c.type,a.start,r,a.start,l,!0)}else t&&e-(f.appliedTimelineOffset||0)>2&&(a.gap=!0);a.setElementaryStreamInfo(c.type,e,r,s,l),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,o,i,t||n)}else{if(!t&&!n)return void this.backtrack(a);a.gap=!0}}if(g){const{startPTS:e,endPTS:t,startDTS:n,endDTS:r}=g;o&&(o.elementaryStreams[bi]={startPTS:e,endPTS:t,startDTS:n,endDTS:r}),a.setElementaryStreamInfo(bi,e,t,n,r),this.bufferFragmentData(g,a,o,i)}if(f&&null!=d&&d.samples.length){const e={id:t,frag:a,details:f,samples:d.samples};n.trigger(Hr.FRAG_PARSING_METADATA,e)}if(f&&u){const e={id:t,frag:a,details:f,samples:u.samples};n.trigger(Hr.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn("".concat(xi(e)?"Media":"Init"," segment with muxed audiovideo where only video expected: ").concat(e.url))}_bufferInitSegment(e,t,n,r){if(this.state!==sl)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:i,video:s,audiovideo:a}=t;if(i){const n=e.audioCodec;let r=ds(i.codec,n);"mp4a"===r&&(r="mp4a.40.5");const s=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){r&&(r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=i.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===s.indexOf("firefox")&&(r="mp4a.40.5")}r&&-1!==r.indexOf("mp4a.40.5")&&-1!==s.indexOf("android")&&"audio/mpeg"!==i.container&&(r="mp4a.40.2",this.log("Android: force audio codec to ".concat(r))),n&&n!==r&&this.log('Swapping manifest audio codec "'.concat(n,'" for "').concat(r,'"')),i.levelCodec=r,i.id=qr,this.log("Init audio buffer, container:".concat(i.container,", codecs[selected/level/parsed]=[").concat(r||"","/").concat(n||"","/").concat(i.codec,"]")),delete t.audiovideo}if(s){s.levelCodec=e.videoCodec,s.id=qr;const n=s.codec;if(4===(null==n?void 0:n.length))switch(n){case"hvc1":case"hev1":s.codec="hvc1.1.6.L120.90";break;case"av01":s.codec="av01.0.04M.08";break;case"avc1":s.codec="avc1.42e01e"}this.log("Init video buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(n,"]").concat(s.codec!==n?" parsed-corrected="+s.codec:"").concat(s.supplemental?" supplemental="+s.supplemental:"")),delete t.audiovideo}a&&(this.log("Init audiovideo buffer, container:".concat(a.container,", codecs[level/parsed]=[").concat(e.codecs,"/").concat(a.codec,"]")),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(Hr.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{const i=t[e].initSegment;null!=i&&i.byteLength&&this.hls.trigger(Hr.BUFFER_APPENDING,{type:e,data:i,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,qr)}get maxBufferLength(){const{levels:e,level:t}=this,n=null==e?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=el}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const n=e.currentTime;if(Pa.isBuffered(e,n)?t=this.getAppendedFrag(n):Pa.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,n=t.level;e&&t.sn===e.sn&&e.level===n||(this.fragPlaying=t,this.hls.trigger(Hr.FRAG_CHANGED,{frag:t}),e&&e.level===n||this.hls.trigger(Hr.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return Ur(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(Ur(t)){const e=this.getLevelDetails(),n=this.currentFrag||(e?Hs(null,e.fragments,t):null);if(n){const e=n.programDateTime;if(null!==e){const r=e+1e3*(t-n.start);return new Date(r)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class jh extends ri{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[n].loader;if(r){var t;if(e&&e!==(null==(t=r.context)?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kr.KEY_LOAD_ERROR,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return new Ra({type:Gr.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:n,networkDetails:r})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,i=t.length;r<i;r++){const s=t[r];if(e.cc<=s.cc&&(!xi(e)||!xi(s)||e.sn<s.sn)||!n&&r==i-1)return this.emeController.selectKeySystemFormat(s).then(e=>{if(!this.emeController)return;s.setKeyFormat(e);const t=so(e);return t?this.emeController.getKeySystemAccess([t]):void 0})}if(this.config.requireKeySystemAccessOnStart){const e=oo(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const n=new Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(this.emeController&&this.config.emeEnabled,")"));return Promise.reject(this.createKeyLoadError(e,Kr.KEY_LOAD_ERROR,n))}const s=i.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,Kr.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(s,'"'))));const a=Gh(i);let o=this.keyIdToKeyInfo[a];if(null!=(n=o)&&n.decryptdata.key)return i.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(this.emeController&&null!=(r=o)&&r.keyLoadPromise){switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>{const{keyInfo:n}=t;return i.key=n.decryptdata.key,{frag:e,keyInfo:n}})}}switch(this.log("".concat(this.keyIdToKeyInfo[a]?"Rel":"L","oading").concat(i.keyId?" keyId: "+fi(i.keyId):""," URI: ").concat(i.uri," from ").concat(e.type," ").concat(e.level)),o=this.keyIdToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,Kr.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(i.method,'"'))))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&null!=(r=t.initSegment)&&r.data){const n=function(e){const t=[];return Vi(e,e=>t.push(e.subarray(8,24))),t}(t.initSegment.data);if(n.length){let t=n[0];t.some(e=>0!==e)?(this.log("Using keyId found in init segment ".concat(fi(t))),fo.setKeyIdForUri(e.decryptdata.uri,t)):(t=fo.addKeyIdForUri(e.decryptdata.uri),this.log("Generating keyId to patch media ".concat(fi(t)))),e.decryptdata.keyId=t}}if(!e.decryptdata.keyId&&!xi(t))return Promise.resolve(n);const i=this.emeController.loadKey(n);return(e.keyLoadPromise=i.then(t=>(e.mediaKeySessionContext=t,n))).catch(n=>{throw e.keyLoadPromise=null,"data"in n&&(n.data.frag=t),n})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=new(0,n.loader)(n);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((i,s)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=n.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{const{frag:a,keyInfo:o}=n,l=Gh(o.decryptdata);if(!a.decryptdata||o!==this.keyIdToKeyInfo[l])return s(this.createKeyLoadError(a,Kr.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,i({frag:a,keyInfo:o})},onError:(e,n,r,i)=>{this.resetLoader(n),s(this.createKeyLoadError(t,Kr.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),r,ni({url:a.url,data:void 0},e)))},onTimeout:(e,n,r)=>{this.resetLoader(n),s(this.createKeyLoadError(t,Kr.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:(e,n,r)=>{this.resetLoader(n),s(this.createKeyLoadError(t,Kr.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};r.load(a,l,c)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,i=n.loader;t.keyLoader===i&&(t.keyLoader=null,n.loader=null);const s=Gh(n.decryptdata)||r;delete this.keyIdToKeyInfo[s],i&&i.destroy()}}function Gh(e){if(e.keyFormat!==no){const t=e.keyId;if(t)return fi(t)}return e.uri}function Kh(e){const{type:t}=e;switch(t){case Wr:return Qr;case Yr:return Xr;default:return qr}}function Hh(e,t){let n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}class Vh{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hr.LEVEL_LOADING,this.onLevelLoading,this),e.on(Hr.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(Hr.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(Hr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hr.LEVEL_LOADING,this.onLevelLoading,this),e.off(Hr.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(Hr.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(Hr.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return this.loaders[e.type]=i,i}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Vr,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:i,url:s,deliveryDirectives:a,levelInfo:o}=t;this.load({id:n,level:r,pathwayId:i,responseType:"text",type:zr,url:s,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:i,deliveryDirectives:s,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:Wr,url:i,deliveryDirectives:s,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:i,deliveryDirectives:s,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:Yr,url:i,deliveryDirectives:s,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[zr];if(n){const e=n.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(n.abort(),delete this.loaders[zr])}}load(e){var t;const n=this.hls.config;let r,i=this.getInternalLoader(e);if(i){const t=this.hls.logger,n=i.context;if(n&&n.levelOrTrack===e.levelOrTrack&&(n.url===e.url||n.deliveryDirectives&&!e.deliveryDirectives))return void(n.url===e.url?t.log("[playlist-loader]: ignore ".concat(e.url," ongoing request")):t.log("[playlist-loader]: ignore ".concat(e.url," in favor of ").concat(n.url)));t.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),i.abort()}if(r=e.type===Vr?n.manifestLoadPolicy.default:ei({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Ur(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===zr&&null!==e.level?t=this.hls.levels[e.level].details:e.type===Wr&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===Yr&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,n=t.targetduration;if(e&&n){const t=1e3*Math.max(3*e,.8*n);r=ei({},r,{maxTimeToFirstByteMs:Math.min(t,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,r.maxTimeToFirstByteMs)})}}}const s=r.errorRetry||r.timeoutRetry||{},a={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},o={onSuccess:(e,t,n,r)=>{const i=this.getInternalLoader(n);this.resetInternalLoader(n.type);const s=e.data;t.parsing.start=performance.now(),bo.isMediaPlaylist(s)||n.type!==Vr?this.handleTrackOrLevelPlaylist(e,t,n,r||null,i):this.handleMasterPlaylist(e,t,n,r)},onError:(e,t,n,r)=>{this.handleNetworkError(t,n,!1,e,r)},onTimeout:(e,t,n)=>{this.handleNetworkError(t,n,!0,void 0,e)}};i.load(e,a,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log("".concat(e?"auto":"force"," startLoad with configured startPosition ").concat(t)),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const i=this.hls,s=e.data,a=Hh(e,n),o=bo.parseMasterPlaylist(s,a);if(o.playlistParsingError)return t.parsing.end=performance.now(),void this.handleManifestParsingError(e,n,o.playlistParsingError,r,t);const{contentSteering:l,levels:c,sessionData:u,sessionKeys:d,startTimeOffset:h,variableList:f}=o;this.variableList=f,c.forEach(e=>{const{unknownCodecs:t}=e;if(t){const{preferManagedMediaSource:n}=this.hls.config;let{audioCodec:r,videoCodec:i}=e;for(let s=t.length;s--;){const a=t[s];rs(a,"audio",n)?(e.audioCodec=r=r?"".concat(r,",").concat(a):a,ts.audio[r.substring(0,4)]=2,t.splice(s,1)):rs(a,"video",n)&&(e.videoCodec=i=i?"".concat(i,",").concat(a):a,ts.video[i.substring(0,4)]=2,t.splice(s,1))}}});const{AUDIO:g=[],SUBTITLES:p,"CLOSED-CAPTIONS":m}=bo.parseMasterPlaylistMedia(s,a,o);if(g.length){g.some(e=>!e.url)||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ja({}),bitrate:0,url:""}))}i.trigger(Hr.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:p,captions:m,contentSteering:l,url:a,stats:t,networkDetails:r,sessionData:u,sessionKeys:d,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,n,r,i){const s=this.hls,{id:a,level:o,type:l}=n,c=Hh(e,n),u=Ur(o)?o:Ur(a)?a:0,d=Kh(n),h=bo.parseLevelPlaylist(e.data,c,u,d,0,this.variableList);if(l===Vr){const e={attrs:new ja({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+Uo(h,0),s.trigger(Hr.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=h,this.handlePlaylistLoaded(h,e,t,n,r,i)}handleManifestParsingError(e,t,n,r,i){this.hls.trigger(Hr.ERROR,{type:Gr.NETWORK_ERROR,details:Kr.MANIFEST_PARSING_ERROR,fatal:t.type===Vr,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:i})}handleNetworkError(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,s="A network ".concat(n?"timeout":"error"+(r?" (status "+r.code+")":"")," occurred while loading ").concat(e.type);e.type===zr?s+=": ".concat(e.level," id: ").concat(e.id):e.type!==Wr&&e.type!==Yr||(s+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));const a=new Error(s);this.hls.logger.warn("[playlist-loader]: ".concat(s));let o=Kr.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case Vr:o=n?Kr.MANIFEST_LOAD_TIMEOUT:Kr.MANIFEST_LOAD_ERROR,l=!0;break;case zr:o=n?Kr.LEVEL_LOAD_TIMEOUT:Kr.LEVEL_LOAD_ERROR,l=!1;break;case Wr:o=n?Kr.AUDIO_TRACK_LOAD_TIMEOUT:Kr.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Yr:o=n?Kr.SUBTITLE_TRACK_LOAD_TIMEOUT:Kr.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const u={type:Gr.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:i};if(r){const n=(null==t?void 0:t.url)||e.url;u.response=ni({url:n,data:void 0},r)}this.hls.trigger(Hr.ERROR,u)}handlePlaylistLoaded(e,t,n,r,i,s){const a=this.hls,{type:o,level:l,levelOrTrack:c,id:u,groupId:d,deliveryDirectives:h}=r,f=Hh(t,r),g=Kh(r);let p="number"===typeof r.level&&g===qr?l:void 0;const m=e.playlistParsingError;if(m){if(this.hls.logger.warn("".concat(m," ").concat(e.url)),!a.config.ignorePlaylistParsingErrors)return void a.trigger(Hr.ERROR,{type:Gr.NETWORK_ERROR,details:Kr.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:m,reason:m.message,response:t,context:r,level:p,parent:g,networkDetails:i,stats:n});e.playlistParsingError=null}if(!e.fragments.length){const s=e.playlistParsingError=new Error("No Segments found in Playlist");return void a.trigger(Hr.ERROR,{type:Gr.NETWORK_ERROR,details:Kr.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:s,reason:s.message,response:t,context:r,level:p,parent:g,networkDetails:i,stats:n})}switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Vr:case zr:if(p)if(c){if(c!==a.levels[p]){const e=a.levels.indexOf(c);e>-1&&(p=e)}}else p=0;a.trigger(Hr.LEVEL_LOADED,{details:e,levelInfo:c||a.levels[0],level:p||0,id:u||0,stats:n,networkDetails:i,deliveryDirectives:h,withoutMultiVariant:o===Vr});break;case Wr:a.trigger(Hr.AUDIO_TRACK_LOADED,{details:e,track:c,id:u||0,groupId:d||"",stats:n,networkDetails:i,deliveryDirectives:h});break;case Yr:a.trigger(Hr.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:u||0,groupId:d||"",stats:n,networkDetails:i,deliveryDirectives:h})}}}class zh{static get version(){return yl}static isMSESupported(){return Uh()}static isSupported(){return function(){if(!Uh())return!1;const e=ui();return"function"===typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(ss(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(ss(t,"audio"))))}()}static getMediaSource(){return ui()}static get Events(){return Hr}static get MetadataSchema(){return Gl}static get ErrorTypes(){return Gr}static get ErrorDetails(){return Kr}static get DefaultConfig(){return zh.defaultConfig?zh.defaultConfig:kh}static set DefaultConfig(e){zh.defaultConfig=e}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new vl,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,n){const r=ai();if("object"===typeof console&&!0===e||"object"===typeof e){const i=["debug","log","info","warn","error"];i.forEach(t=>{r[t]=oi(t,e,n)});try{r.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.6.15"))}catch(rf){return ai()}i.forEach(t=>{li[t]=oi(t,e)})}else ei(li,r);return r}(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=function(e,t,n){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=xh(e),i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{const s="".concat("level"===e?"playlist":e,"LoadPolicy"),a=void 0===t[s],o=[];i.forEach(n=>{const i="".concat(e,"Loading").concat(n),l=t[i];if(void 0!==l&&a){o.push(i);const e=r[s].default;switch(t[s]={default:e},n){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&n.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(s,'": ').concat(Cs(t[s])))}),ni(ni({},r),t)}(zh.DefaultConfig,e,t);this.userConfig=e,n.progressive&&wh(n,t);const{abrController:r,bufferController:i,capLevelController:s,errorController:a,fpsController:o}=n,l=new a(this),c=this.abrController=new r(this),u=new ga(this),d=n.interstitialsController,h=d?this.interstitialsController=new d(this,zh):null,f=this.bufferController=new i(this,u),g=this.capLevelController=new s(this),p=new o(this),m=new Vh(this),v=n.contentSteeringController,y=v?new v(this):null,E=this.levelController=new Nh(this,y),b=new Ch(this),S=new jh(this.config,this.logger),T=this.streamController=new Bh(this,u,S),k=this.gapController=new Lh(this,u);g.setStreamController(T),p.setStreamController(T);const x=[m,E,T];h&&x.splice(1,0,h),y&&x.splice(1,0,y),this.networkControllers=x;const w=[c,f,k,g,p,b,u];this.audioTrackController=this.createController(n.audioTrackController,x);const L=n.audioStreamController;L&&x.push(this.audioStreamController=new L(this,u,S)),this.subtitleTrackController=this.createController(n.subtitleTrackController,x);const A=n.subtitleStreamController;A&&x.push(this.subtititleStreamController=new A(this,u,S)),this.createController(n.timelineController,w),S.emeController=this.emeController=this.createController(n.emeController,w),this.cmcdController=this.createController(n.cmcdController,w),this.latencyController=this.createController(Oh,w),this.coreComponents=w,x.push(l);const R=l.onErrorOut;"function"===typeof R&&this.on(Hr.ERROR,R,l),this.on(Hr.MANIFEST_LOADED,m.onManifestLoaded,m)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,n)}once(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,r=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const t=e===Hr.ERROR;this.trigger(Hr.ERROR,{type:Gr.OTHER_ERROR,details:Kr.INTERNAL_EXCEPTION,fatal:t,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(Hr.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error("attachMedia failed: invalid argument (".concat(e,")"));return void this.trigger(Hr.ERROR,{type:Gr.OTHER_ERROR,details:Kr.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(Hr.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(Hr.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(Hr.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=yi.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:".concat(r)),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(Hr.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;this.logger.log("startLoad(".concat(e+(t?", <skip seek to start>":""),")")),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),this.started&&this.networkControllers);n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[qr]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Qr]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Xr]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log("set currentLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return ks.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(r=-1===t&&null!=e&&e.length?e.length-1:t,n)for(let i=r;i--;){const t=e[i].attrs["HDCP-LEVEL"];if(t&&t<=n)return i}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e){return bs(e,Ns(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.allAudioTracks),navigator.mediaCapabilities)}}zh.defaultConfig=void 0;const Wh=()=>{var e;const{id:t}=oe(),[n,r]=Fe(),i=n.get("episode"),a=n.get("ep"),[o,l]=(0,s.useState)(null),[c,u]=(0,s.useState)([]),[d,h]=(0,s.useState)({sub:[],dub:[]}),[f,g]=(0,s.useState)("hd-1"),[p,m]=(0,s.useState)("sub"),[v,y]=(0,s.useState)(null),[E,b]=(0,s.useState)(!0),[S,T]=(0,s.useState)(!1),[k,x]=(0,s.useState)(mr),w=(0,s.useRef)(null),L=(0,s.useRef)(null);(0,s.useEffect)(()=>{A()},[t]),(0,s.useEffect)(()=>{i&&R()},[i,f,p,k]);const A=async()=>{try{var e;const[n,s]=await Promise.all([yr.details(t),yr.episodes(t)]);if(l(n),u(s.episodes||[]),!i&&(null===(e=s.episodes)||void 0===e?void 0:e.length)>0){const e=s.episodes[0];r({episode:e.id,ep:e.episodeNumber})}b(!1)}catch(n){console.error("Load anime error:",n),b(!1)}},R=async()=>{try{var e;b(!0);const[t,n]=await Promise.all([yr.servers(i),yr.stream(i,f,p)]);h(t),y(n),null!==n&&void 0!==n&&null!==(e=n.link)&&void 0!==e&&e.file&&I(n.link.file,n.tracks||[]),b(!1)}catch(t){console.error("Load episode error:",t),b(!1)}},I=(e,t)=>{const n=w.current;if(n){if(L.current&&L.current.destroy(),zh.isSupported()){const t=new zh({maxBufferLength:30,maxMaxBufferLength:60,enableWorker:!0});t.loadSource(e),t.attachMedia(n),t.on(zh.Events.MANIFEST_PARSED,()=>{n.play().catch(e=>console.log("Autoplay prevented")),T(!0)}),t.on(zh.Events.ERROR,(e,t)=>{t.fatal&&console.error("HLS error:",t)}),L.current=t}else n.canPlayType("application/vnd.apple.mpegurl")&&(n.src=e,n.addEventListener("loadedmetadata",()=>{n.play().catch(e=>console.log("Autoplay prevented")),T(!0)}));t.forEach((e,t)=>{if("captions"===e.kind||"subtitles"===e.kind){var r;const i=document.createElement("track");i.kind=e.kind,i.label=e.label||"Subtitle ".concat(t+1),i.srclang=(null===(r=e.label)||void 0===r?void 0:r.toLowerCase())||"en",i.src=e.file,e.default&&(i.default=!0),n.appendChild(i)}})}},_=e=>{(e=>{e>=0&&e<pr.length&&(mr=e)})(e),x(e),R()};if(E&&!o)return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20",children:(0,Ue.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-600"})});const D="sub"===p?d.sub:d.dub,P=pr;return(0,Ue.jsx)("div",{className:"min-h-screen pt-16 bg-gray-900",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,Ue.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden mb-6",children:[(0,Ue.jsx)("video",{ref:w,className:"w-full aspect-video",controls:!0,controlsList:"nodownload",playsInline:!0,children:"Your browser does not support the video tag."}),(null===v||void 0===v?void 0:v.intro)&&(0,Ue.jsx)("button",{onClick:()=>{w.current&&null!==v&&void 0!==v&&v.intro&&(w.current.currentTime=v.intro.end)},className:"absolute bottom-24 right-4 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-all",children:"Skip Intro \u2192"}),(null===v||void 0===v?void 0:v.outro)&&(0,Ue.jsx)("button",{onClick:()=>{w.current&&null!==v&&void 0!==v&&v.outro&&(w.current.currentTime=v.outro.end)},className:"absolute bottom-24 right-4 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-all",children:"Skip Outro \u2192"})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[(0,Ue.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:null===o||void 0===o?void 0:o.title}),(0,Ue.jsxs)("p",{className:"text-gray-400",children:["Episode ",a," ",(null===(e=c.find(e=>e.id===i))||void 0===e?void 0:e.title)&&"- ".concat(c.find(e=>e.id===i).title)]})]}),(0,Ue.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,Ue.jsx)("button",{onClick:()=>m("sub"),className:"px-6 py-2 rounded-lg font-semibold transition-colors ".concat("sub"===p?"bg-red-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"\ud83c\udf8c SUB"}),(0,Ue.jsx)("button",{onClick:()=>m("dub"),className:"px-6 py-2 rounded-lg font-semibold transition-colors ".concat("dub"===p?"bg-red-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"\ud83c\udf99\ufe0f DUB"})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[(0,Ue.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"\ud83c\udfac Streaming Servers"}),(0,Ue.jsx)("div",{className:"flex flex-wrap gap-2",children:D.map((e,t)=>(0,Ue.jsxs)("button",{onClick:()=>{return t=e.serverName.toLowerCase(),void g(t);var t},className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat(f===e.serverName.toLowerCase()?"bg-yellow-500 text-black":"bg-gray-700 text-white hover:bg-gray-600"),children:["\ud83d\udce1 ",e.serverName]},t))})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[(0,Ue.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"\ud83c\udf10 API Servers"}),(0,Ue.jsx)("p",{className:"text-sm text-gray-400 mb-3",children:"If the current server is not working, please try switching to other servers."}),(0,Ue.jsx)("div",{className:"flex flex-wrap gap-2",children:P.map((e,t)=>(0,Ue.jsxs)("button",{onClick:()=>_(t),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat(k===t?"bg-yellow-500 text-black":"bg-gray-700 text-white hover:bg-gray-600"),children:["\ud83d\udce1 Server ",t+1]},t))})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Ue.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"\ud83d\udcfa Episodes"}),(0,Ue.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-2 max-h-96 overflow-y-auto",children:c.map(e=>(0,Ue.jsx)("button",{onClick:()=>(e=>{r({episode:e.id,ep:e.episodeNumber})})(e),className:"aspect-square rounded-lg font-semibold transition-all ".concat(i===e.id?"bg-red-600 text-white scale-110":"bg-gray-700 text-gray-300 hover:bg-gray-600"," ").concat(e.isFiller?"border-2 border-yellow-500":""),title:e.title||"Episode ".concat(e.episodeNumber),children:e.episodeNumber},e.id))})]})]})})},Yh=()=>{const e=ae(),[t,n]=(0,s.useState)({username:"",password:""}),[r,i]=(0,s.useState)(""),[a,o]=(0,s.useState)(!1),l=e=>{n(Ve(Ve({},t),{},{[e.target.name]:e.target.value})),i("")};return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20 pb-10",children:(0,Ue.jsx)("div",{className:"w-full max-w-md px-6",children:(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-2xl p-8",children:[(0,Ue.jsxs)("div",{className:"text-center mb-8",children:[(0,Ue.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"\ud83c\udfac Login"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Welcome back to Khopadi!"})]}),r&&(0,Ue.jsx)("div",{className:"bg-red-500/10 border border-red-500 text-red-500 rounded-lg p-3 mb-6 text-sm",children:r}),(0,Ue.jsxs)("form",{onSubmit:async n=>{if(n.preventDefault(),o(!0),i(""),!t.username||!t.password)return i("Please enter both username and password"),void o(!1);try{const n=JSON.parse(localStorage.getItem("users")||"[]").find(e=>e.username===t.username&&e.password===t.password);if(n){const t={username:n.username,loginTime:(new Date).toISOString()};localStorage.setItem("currentUser",JSON.stringify(t)),e("/")}else i("Invalid username or password")}catch(r){i("Login failed. Please try again.")}finally{o(!1)}},className:"space-y-4",children:[(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Username"}),(0,Ue.jsx)("input",{type:"text",name:"username",value:t.username,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Enter your username"})]}),(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Password"}),(0,Ue.jsx)("input",{type:"password",name:"password",value:t.password,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Enter your password"})]}),(0,Ue.jsx)("button",{type:"submit",disabled:a,className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Logging in...":"Login"})]}),(0,Ue.jsxs)("div",{className:"relative my-6",children:[(0,Ue.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,Ue.jsx)("div",{className:"w-full border-t border-gray-600"})}),(0,Ue.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,Ue.jsx)("span",{className:"px-4 bg-gray-800 text-gray-400",children:"OR"})})]}),(0,Ue.jsx)("button",{onClick:()=>{const t={username:"Guest",loginTime:(new Date).toISOString()};localStorage.setItem("currentUser",JSON.stringify(t)),e("/")},className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 rounded-lg transition-colors mb-4",children:"\ud83d\udc64 Continue as Guest"}),(0,Ue.jsxs)("p",{className:"text-center text-gray-400 text-sm",children:["Don't have an account?"," ",(0,Ue.jsx)(Oe,{to:"/register",className:"text-red-500 hover:text-red-400 font-semibold",children:"Create Account"})]})]})})})},qh=()=>{const e=ae(),[t,n]=(0,s.useState)({username:"",password:"",confirmPassword:""}),[r,i]=(0,s.useState)(""),[a,o]=(0,s.useState)(!1),l=e=>{n(Ve(Ve({},t),{},{[e.target.name]:e.target.value})),i("")};return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20 pb-10",children:(0,Ue.jsx)("div",{className:"w-full max-w-md px-6",children:(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-2xl p-8",children:[(0,Ue.jsxs)("div",{className:"text-center mb-8",children:[(0,Ue.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"\u2728 Create Account"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Join Khopadi Entertainment Hub!"})]}),r&&(0,Ue.jsx)("div",{className:"bg-red-500/10 border border-red-500 text-red-500 rounded-lg p-3 mb-6 text-sm",children:r}),(0,Ue.jsxs)("form",{onSubmit:async n=>{if(n.preventDefault(),o(!0),i(""),!t.username||!t.password||!t.confirmPassword)return i("Please fill all fields"),void o(!1);if(t.username.length<3)return i("Username must be at least 3 characters"),void o(!1);if(t.password.length<6)return i("Password must be at least 6 characters"),void o(!1);if(t.password!==t.confirmPassword)return i("Passwords do not match"),void o(!1);try{const n=JSON.parse(localStorage.getItem("users")||"[]");if(n.find(e=>e.username===t.username))return i("Username already exists"),void o(!1);const r={username:t.username,password:t.password,createdAt:(new Date).toISOString()};n.push(r),localStorage.setItem("users",JSON.stringify(n));const s={username:r.username,loginTime:(new Date).toISOString()};localStorage.setItem("currentUser",JSON.stringify(s)),e("/")}catch(r){i("Registration failed. Please try again.")}finally{o(!1)}},className:"space-y-4",children:[(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Username"}),(0,Ue.jsx)("input",{type:"text",name:"username",value:t.username,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Choose a username (min 3 characters)"})]}),(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Password"}),(0,Ue.jsx)("input",{type:"password",name:"password",value:t.password,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Create a password (min 6 characters)"})]}),(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Confirm Password"}),(0,Ue.jsx)("input",{type:"password",name:"confirmPassword",value:t.confirmPassword,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Confirm your password"})]}),(0,Ue.jsx)("button",{type:"submit",disabled:a,className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Creating Account...":"Create Account"})]}),(0,Ue.jsxs)("p",{className:"text-center text-gray-400 text-sm mt-6",children:["Already have an account?"," ",(0,Ue.jsx)(Oe,{to:"/login",className:"text-red-500 hover:text-red-400 font-semibold",children:"Login"})]}),(0,Ue.jsx)("div",{className:"mt-6 p-4 bg-gray-700/50 rounded-lg",children:(0,Ue.jsx)("p",{className:"text-xs text-gray-400 text-center",children:"\ud83d\udd12 Your account is stored locally on your device"})})]})})})},Qh=()=>{const e=ae(),[t,n]=(0,s.useState)(null);(0,s.useEffect)(()=>{const t=JSON.parse(localStorage.getItem("currentUser")||"null");t?n(t):e("/login")},[e]);if(!t)return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20",children:(0,Ue.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-600"})});const r="Guest"===t.username,i=new Date(t.loginTime).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsx)("div",{className:"container mx-auto px-4",children:(0,Ue.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-2xl p-8",children:[(0,Ue.jsxs)("div",{className:"flex flex-col items-center mb-8",children:[(0,Ue.jsx)("div",{className:"w-32 h-32 bg-gradient-to-br from-red-600 to-red-800 rounded-full flex items-center justify-center text-5xl font-bold text-white mb-4",children:t.username.charAt(0).toUpperCase()}),(0,Ue.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:t.username}),r&&(0,Ue.jsx)("span",{className:"bg-gray-700 text-gray-300 px-3 py-1 rounded-full text-sm",children:"\ud83d\udc64 Guest User"})]}),(0,Ue.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,Ue.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Ue.jsx)("p",{className:"text-gray-400 text-sm mb-1",children:"Login Time"}),(0,Ue.jsxs)("p",{className:"text-white font-semibold",children:["\ud83d\udd52 ",i]})]}),(0,Ue.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Ue.jsx)("p",{className:"text-gray-400 text-sm mb-1",children:"Account Type"}),(0,Ue.jsx)("p",{className:"text-white font-semibold",children:r?"\ud83d\udc64 Guest Account":"\u2b50 Registered User"})]})]}),r&&(0,Ue.jsx)("div",{className:"bg-yellow-500/10 border border-yellow-500 rounded-lg p-4 mb-6",children:(0,Ue.jsx)("p",{className:"text-yellow-500 text-sm",children:"\u26a0\ufe0f You're browsing as a guest. Create an account to save your preferences!"})}),(0,Ue.jsxs)("div",{className:"space-y-3",children:[r?(0,Ue.jsx)("button",{onClick:()=>e("/register"),className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-colors",children:"\u2728 Create Account"}):(0,Ue.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Ue.jsx)("p",{className:"text-gray-400 text-sm mb-2",children:"\ud83d\udd12 Account Security"}),(0,Ue.jsx)("p",{className:"text-white text-sm",children:"Your account is stored locally on this device"})]}),(0,Ue.jsx)("button",{onClick:()=>{localStorage.removeItem("currentUser"),e("/login")},className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 rounded-lg transition-colors",children:"\ud83d\udeaa Logout"}),(0,Ue.jsx)("button",{onClick:()=>e("/"),className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 rounded-lg transition-colors",children:"\ud83c\udfe0 Back to Home"})]})]}),(0,Ue.jsxs)("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[(0,Ue.jsx)("p",{className:"text-3xl mb-2",children:"\ud83c\udfac"}),(0,Ue.jsx)("p",{className:"text-gray-400 text-sm",children:"Movies"})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[(0,Ue.jsx)("p",{className:"text-3xl mb-2",children:"\ud83d\udcfa"}),(0,Ue.jsx)("p",{className:"text-gray-400 text-sm",children:"TV Shows"})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[(0,Ue.jsx)("p",{className:"text-3xl mb-2",children:"\u2728"}),(0,Ue.jsx)("p",{className:"text-gray-400 text-sm",children:"Anime"})]})]})]})})})},Xh=()=>{const[e,t]=(0,s.useState)({quote:"Loading...",role:""}),[n,r]=(0,s.useState)(!0);(0,s.useEffect)(()=>{i()},[]);const i=async()=>{r(!0);const e=await Rr.random();t(e),r(!1)};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10 flex items-center justify-center",children:(0,Ue.jsx)("div",{className:"container mx-auto px-4",children:(0,Ue.jsxs)("div",{className:"max-w-3xl mx-auto text-center",children:[(0,Ue.jsx)("h1",{className:"mb-8 text-4xl font-bold",children:"Movie Quotes"}),n?(0,Ue.jsxs)("div",{className:"animate-pulse",children:[(0,Ue.jsx)("div",{className:"h-32 bg-gray-800 rounded-lg mb-4"}),(0,Ue.jsx)("div",{className:"h-8 bg-gray-800 rounded-lg w-1/3 mx-auto"})]}):(0,Ue.jsxs)("div",{className:"bg-gradient-to-br from-red-900/20 to-gray-900 p-8 rounded-xl shadow-2xl border border-red-900/30",children:[(0,Ue.jsx)("svg",{className:"w-12 h-12 text-red-500 mb-4 mx-auto",fill:"currentColor",viewBox:"0 0 24 24",children:(0,Ue.jsx)("path",{d:"M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"})}),(0,Ue.jsxs)("p",{className:"text-2xl italic mb-6 text-gray-200",children:['"',e.quote,'"']}),(0,Ue.jsxs)("p",{className:"text-lg text-red-400 font-semibold",children:["- ",e.role]}),(0,Ue.jsx)("button",{onClick:i,className:"mt-8 px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors",children:"Get New Quote"})]})]})})})},$h=(0,s.createContext)(),Jh=()=>{const e=(0,s.useContext)($h);if(!e)throw new Error("useTheme must be used within ThemeProvider");return e};const Zh=function(){const[e,t]=(0,s.useState)(!0);(0,s.useEffect)(()=>{const e=localStorage.getItem("theme");e&&t("dark"===e)},[]);const n=e?{bg:"bg-gray-900",text:"text-white",cardBg:"bg-gray-800",border:"border-gray-700"}:{bg:"bg-white",text:"text-gray-900",cardBg:"bg-gray-100",border:"border-gray-300"};return(0,Ue.jsx)($h.Provider,{value:{isDarkMode:e,toggleTheme:()=>{const n=!e;t(n),localStorage.setItem("theme",n?"dark":"light")},colors:n},children:(0,Ue.jsx)(De,{basename:"/khopadi.github.io",children:(0,Ue.jsxs)("div",{className:"min-h-screen ".concat(n.bg," ").concat(n.text),children:[(0,Ue.jsx)(Be,{}),(0,Ue.jsxs)(xe,{children:[(0,Ue.jsx)(Te,{path:"/",element:(0,Ue.jsx)(Dr,{})}),(0,Ue.jsx)(Te,{path:"/movies",element:(0,Ue.jsx)(Pr,{})}),(0,Ue.jsx)(Te,{path:"/tv-shows",element:(0,Ue.jsx)(Cr,{})}),(0,Ue.jsx)(Te,{path:"/anime",element:(0,Ue.jsx)(Nr,{})}),(0,Ue.jsx)(Te,{path:"/anime/watch/:id",element:(0,Ue.jsx)(Wh,{})}),(0,Ue.jsx)(Te,{path:"/upcoming",element:(0,Ue.jsx)(Mr,{})}),(0,Ue.jsx)(Te,{path:"/movie/:id",element:(0,Ue.jsx)(Fr,{})}),(0,Ue.jsx)(Te,{path:"/tv/:id",element:(0,Ue.jsx)(Fr,{})}),(0,Ue.jsx)(Te,{path:"/login",element:(0,Ue.jsx)(Yh,{})}),(0,Ue.jsx)(Te,{path:"/register",element:(0,Ue.jsx)(qh,{})}),(0,Ue.jsx)(Te,{path:"/profile",element:(0,Ue.jsx)(Qh,{})}),(0,Ue.jsx)(Te,{path:"/quotes",element:(0,Ue.jsx)(Xh,{})})]})]})})})};class ef extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error caught by boundary:",e,t)}render(){return this.state.hasError?(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:(0,Ue.jsxs)("div",{className:"max-w-md w-full bg-gray-800 rounded-lg shadow-xl p-8 text-center",children:[(0,Ue.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\u26a0"}),(0,Ue.jsx)("h1",{className:"text-2xl font-bold text-white mb-4",children:"Oops! Something went wrong"}),(0,Ue.jsx)("p",{className:"text-gray-400 mb-6",children:"We encountered an unexpected error. Please try refreshing the page."}),(0,Ue.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-3 rounded-lg transition-colors",children:"Refresh Page"}),!1]})}):this.props.children}}const tf=ef,nf=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,453)).then(t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:s,getTTFB:a}=t;n(e),r(e),i(e),s(e),a(e)})};o.createRoot(document.getElementById("root")).render((0,Ue.jsx)(s.StrictMode,{children:(0,Ue.jsx)(tf,{children:(0,Ue.jsx)(Zh,{})})})),nf()})();
//# sourceMappingURL=main.d654a414.js.map