/*! For license information please see main.1949855f.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{e.exports=n(202)},153:(e,t,n)=>{var r=n(43),s=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:s,type:e,key:c,ref:u,props:i,_owner:o.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},202:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,p={};function v(e,t,n){this.props=e,this.context=t,this.refs=p,this.updater=n||g}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=p,this.updater=n||g}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var E=b.prototype=new y;E.constructor=b,m(E,v.prototype),E.isPureReactComponent=!0;var S=Array.isArray,T=Object.prototype.hasOwnProperty,x={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,r){var s,i={},a=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)T.call(t,s)&&!k.hasOwnProperty(s)&&(i[s]=t[s]);var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===i[s]&&(i[s]=l[s]);return{$$typeof:n,type:e,key:a,ref:o,props:i,_owner:x.current}}function L(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var A=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,s,i,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return a=a(l=e),e=""===i?"."+R(l,0):i,S(a)?(s="",null!=e&&(s=e.replace(A,"$&/")+"/"),I(a,t,s,"",function(e){return e})):null!=a&&(L(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(A,"$&/")+"/")+e)),t.push(a)),1;if(l=0,i=""===i?".":i+":",S(e))for(var c=0;c<e.length;c++){var u=i+R(o=e[c],c);l+=I(o,t,s,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=I(o=o.value,t,s,u=i+R(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function _(e,t,n){if(null==e)return e;var r=[],s=0;return I(e,r,"","",function(e){return t.call(n,e,s++)}),r}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},C={transition:null},O={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:C,ReactCurrentOwner:x};function N(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:_,forEach:function(e,t,n){_(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return _(e,function(){t++}),t},toArray:function(e){return _(e,function(e){return e})||[]},only:function(e){if(!L(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=s,t.Profiler=a,t.PureComponent=b,t.StrictMode=i,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.act=N,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=m({},e.props),i=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=x.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)T.call(t,c)&&!k.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:n,type:e.type,key:i,ref:a,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=L,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=C.transition;C.transition={};try{e()}finally{C.transition=t}},t.unstable_act=N,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,s=e[r];if(!(0<i(s,t)))break e;e[r]=t,e[n]=s,n=r}}function r(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>i(l,n))c<s&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<s&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,f=3,g=!1,m=!1,p=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function E(e){for(var t=r(u);null!==t;){if(null===t.callback)s(u);else{if(!(t.startTime<=e))break;s(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function S(e){if(p=!1,E(e),!m)if(null!==r(c))m=!0,C(T);else{var t=r(u);null!==t&&O(S,t.startTime-e)}}function T(e,n){m=!1,p&&(p=!1,y(L),L=-1),g=!0;var i=f;try{for(E(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!I());){var a=h.callback;if("function"===typeof a){h.callback=null,f=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===r(c)&&s(c),E(n)}else s(c);h=r(c)}if(null!==h)var l=!0;else{var d=r(u);null!==d&&O(S,d.startTime-n),l=!1}return l}finally{h=null,f=i,g=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var x,k=!1,w=null,L=-1,A=5,R=-1;function I(){return!(t.unstable_now()-R<A)}function _(){if(null!==w){var e=t.unstable_now();R=e;var n=!0;try{n=w(!0,e)}finally{n?x():(k=!1,w=null)}}else k=!1}if("function"===typeof b)x=function(){b(_)};else if("undefined"!==typeof MessageChannel){var D=new MessageChannel,P=D.port2;D.port1.onmessage=_,x=function(){P.postMessage(null)}}else x=function(){v(_,0)};function C(e){w=e,k||(k=!0,x())}function O(e,n){L=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||g||(m=!0,C(T))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,s,i){var a=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?a+i:a:i=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:s,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>a?(e.sortIndex=i,n(u,e),null===r(c)&&e===r(u)&&(p?(y(L),L=-1):p=!0,O(S,i-a))):(e.sortIndex=o,n(c,e),m||g||(m=!0,C(T))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},391:(e,t,n)=>{var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},579:(e,t,n)=>{e.exports=n(153)},730:(e,t,n)=>{var r=n(43),s=n(853);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},g={};function m(e,t,n,r,s,i,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var p={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){p[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];p[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){p[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){p[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){p[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){p[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){p[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){p[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){p[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var s=p.hasOwnProperty(t)?p[t]:null;(null!==s?0!==s.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,s,r)&&(n=null),r||null===s?function(e){return!!d.call(g,e)||!d.call(f,e)&&(h.test(e)?g[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=null===n?3!==s.type&&"":n:(t=s.attributeName,r=s.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(s=s.type)||4===s&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);p[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);p[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);p[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){p[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),p.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){p[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var E=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=Symbol.for("react.element"),T=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),A=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var C=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function N(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var M,F=Object.assign;function U(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var B=!1;function j(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var s=c.stack.split("\n"),i=r.stack.split("\n"),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(1!==a||1!==o)do{if(a--,0>--o||s[a]!==i[o]){var l="\n"+s[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function G(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function K(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case x:return"Fragment";case T:return"Portal";case w:return"Profiler";case k:return"StrictMode";case I:return"Suspense";case _:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case L:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case D:return null!==(t=e.displayName||null)?t:K(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return K(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return K(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=z(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=z(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){$(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(r&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ie(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function pe(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),s=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,s):e[n]=s}}Object.keys(fe).forEach(function(e){ge.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ve=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ee=null;function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Te=null,xe=null,ke=null;function we(e){if(e=bs(e)){if("function"!==typeof Te)throw Error(i(280));var t=e.stateNode;t&&(t=Ss(t),Te(e.stateNode,e.type,t))}}function Le(e){xe?ke?ke.push(e):ke=[e]:xe=e}function Ae(){if(xe){var e=xe,t=ke;if(ke=xe=null,we(e),t)for(e=0;e<t.length;e++)we(t[e])}}function Re(e,t){return e(t)}function Ie(){}var _e=!1;function De(e,t,n){if(_e)return e(t,n);_e=!0;try{return Re(e,t,n)}finally{_e=!1,(null!==xe||null!==ke)&&(Ie(),Ae())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=Ss(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Ce=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){Ce=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){Ce=!1}function Ne(e,t,n,r,s,i,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Me=!1,Fe=null,Ue=!1,Be=null,je={onError:function(e){Me=!0,Fe=e}};function Ge(e,t,n,r,s,i,a,o,l){Me=!1,Fe=null,Ne.apply(je,arguments)}function Ke(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(Ke(e)!==e)throw Error(i(188))}function ze(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ke(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var s=n.return;if(null===s)break;var a=s.alternate;if(null===a){if(null!==(r=s.return)){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return Ve(s),e;if(a===r)return Ve(s),t;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=s,r=a;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=a;break}if(l===r){o=!0,r=s,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,r=s;break}if(l===r){o=!0,r=a,n=s;break}l=l.sibling}if(!o)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ye=s.unstable_scheduleCallback,qe=s.unstable_cancelCallback,Qe=s.unstable_shouldYield,Xe=s.unstable_requestPaint,$e=s.unstable_now,Je=s.unstable_getCurrentPriorityLevel,Ze=s.unstable_ImmediatePriority,et=s.unstable_UserBlockingPriority,tt=s.unstable_NormalPriority,nt=s.unstable_LowPriority,rt=s.unstable_IdlePriority,st=null,it=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,s=e.suspendedLanes,i=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~s;0!==o?r=dt(o):0!==(i&=a)&&(r=dt(i))}else 0!==(a=n&~s)?r=dt(a):0!==i&&(r=dt(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&s)&&((s=r&-r)>=(i=t&-t)||16===s&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)s=1<<(n=31-at(t)),r|=e[n],t&=~s;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function gt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function pt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),s=1<<r;s&t|e[r]&t&&(e[r]|=t),n&=~s}}var bt=0;function Et(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var St,Tt,xt,kt,wt,Lt=!1,At=[],Rt=null,It=null,_t=null,Dt=new Map,Pt=new Map,Ct=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":_t=null;break;case"pointerover":case"pointerout":Dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Mt(e,t,n,r,s,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},null!==t&&(null!==(t=bs(t))&&Tt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Ft(e){var t=ys(e.target);if(null!==t){var n=Ke(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void wt(e.priority,function(){xt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bs(n))&&Tt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Ee=r,n.target.dispatchEvent(r),Ee=null,t.shift()}return!0}function Bt(e,t,n){Ut(e)&&n.delete(t)}function jt(){Lt=!1,null!==Rt&&Ut(Rt)&&(Rt=null),null!==It&&Ut(It)&&(It=null),null!==_t&&Ut(_t)&&(_t=null),Dt.forEach(Bt),Pt.forEach(Bt)}function Gt(e,t){e.blockedOn===t&&(e.blockedOn=null,Lt||(Lt=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,jt)))}function Kt(e){function t(t){return Gt(t,e)}if(0<At.length){Gt(At[0],e);for(var n=1;n<At.length;n++){var r=At[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Rt&&Gt(Rt,e),null!==It&&Gt(It,e),null!==_t&&Gt(_t,e),Dt.forEach(t),Pt.forEach(t),n=0;n<Ct.length;n++)(r=Ct[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ct.length&&null===(n=Ct[0]).blockedOn;)Ft(n),null===n.blockedOn&&Ct.shift()}var Ht=E.ReactCurrentBatchConfig,Vt=!0;function zt(e,t,n,r){var s=bt,i=Ht.transition;Ht.transition=null;try{bt=1,Yt(e,t,n,r)}finally{bt=s,Ht.transition=i}}function Wt(e,t,n,r){var s=bt,i=Ht.transition;Ht.transition=null;try{bt=4,Yt(e,t,n,r)}finally{bt=s,Ht.transition=i}}function Yt(e,t,n,r){if(Vt){var s=Qt(e,t,n,r);if(null===s)Vr(e,t,r,qt,n),Nt(e,r);else if(function(e,t,n,r,s){switch(t){case"focusin":return Rt=Mt(Rt,e,t,n,r,s),!0;case"dragenter":return It=Mt(It,e,t,n,r,s),!0;case"mouseover":return _t=Mt(_t,e,t,n,r,s),!0;case"pointerover":var i=s.pointerId;return Dt.set(i,Mt(Dt.get(i)||null,e,t,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Pt.set(i,Mt(Pt.get(i)||null,e,t,n,r,s)),!0}return!1}(s,e,t,n,r))r.stopPropagation();else if(Nt(e,r),4&t&&-1<Ot.indexOf(e)){for(;null!==s;){var i=bs(s);if(null!==i&&St(i),null===(i=Qt(e,t,n,r))&&Vr(e,t,r,qt,n),i===s)break;s=i}null!==s&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var qt=null;function Qt(e,t,n,r){if(qt=null,null!==(e=ys(e=Se(r))))if(null===(t=Ke(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var $t=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,r=n.length,s="value"in $t?$t.value:$t.textContent,i=s.length;for(e=0;e<r&&n[e]===s[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===s[i-t];t++);return Zt=s.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,r,s,i){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=s,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(cn),dn=F({},cn,{view:0,detail:0}),hn=sn(dn),fn=F({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),gn=sn(fn),mn=sn(F({},fn,{dataTransfer:0})),pn=sn(F({},dn,{relatedTarget:0})),vn=sn(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=sn(yn),En=sn(F({},cn,{data:0})),Sn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=xn[e])&&!!t[e]}function wn(){return kn}var Ln=F({},dn,{key:function(e){if(e.key){var t=Sn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Tn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),An=sn(Ln),Rn=sn(F({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=sn(F({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wn})),_n=sn(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Dn=F({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=sn(Dn),Cn=[9,13,27,32],On=u&&"CompositionEvent"in window,Nn=null;u&&"documentMode"in document&&(Nn=document.documentMode);var Mn=u&&"TextEvent"in window&&!Nn,Fn=u&&(!On||Nn&&8<Nn&&11>=Nn),Un=String.fromCharCode(32),Bn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Cn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Kn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function zn(e,t,n,r){Le(r),0<(t=Wr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,Yn=null;function qn(e){Ur(e,0)}function Qn(e){if(Y(Es(e)))return e}function Xn(e,t){if("change"===e)return t}var $n=!1;if(u){var Jn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Jn=Zn}else Jn=!1;$n=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),Yn=Wn=null)}function nr(e){if("value"===e.propertyName&&Qn(Yn)){var t=[];zn(t,Yn,e,Se(e)),De(qn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Yn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function sr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Yn)}function ir(e,t){if("click"===e)return Qn(t)}function ar(e,t){if("input"===e||"change"===e)return Qn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!d.call(t,s)||!or(e[s],t[s]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=void 0===r.end?i:Math.min(r.end,s),!e.extend&&i>r&&(s=r,r=i,i=s),s=ur(n,i);var a=ur(n,r);s&&a&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,pr=null,vr=null,yr=null,br=!1;function Er(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==pr||pr!==q(r)||("selectionStart"in(r=pr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&lr(yr,r)||(yr=r,0<(r=Wr(vr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=pr)))}function Sr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Tr={animationend:Sr("Animation","AnimationEnd"),animationiteration:Sr("Animation","AnimationIteration"),animationstart:Sr("Animation","AnimationStart"),transitionend:Sr("Transition","TransitionEnd")},xr={},kr={};function wr(e){if(xr[e])return xr[e];if(!Tr[e])return e;var t,n=Tr[e];for(t in n)if(n.hasOwnProperty(t)&&t in kr)return xr[e]=n[t];return e}u&&(kr=document.createElement("div").style,"AnimationEvent"in window||(delete Tr.animationend.animation,delete Tr.animationiteration.animation,delete Tr.animationstart.animation),"TransitionEvent"in window||delete Tr.transitionend.transition);var Lr=wr("animationend"),Ar=wr("animationiteration"),Rr=wr("animationstart"),Ir=wr("transitionend"),_r=new Map,Dr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){_r.set(e,t),l(t,[e])}for(var Cr=0;Cr<Dr.length;Cr++){var Or=Dr[Cr];Pr(Or.toLowerCase(),"on"+(Or[0].toUpperCase()+Or.slice(1)))}Pr(Lr,"onAnimationEnd"),Pr(Ar,"onAnimationIteration"),Pr(Rr,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Ir,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nr));function Fr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,s,a,o,l,c){if(Ge.apply(this,arguments),Me){if(!Me)throw Error(i(198));var u=Fe;Me=!1,Fe=null,Ue||(Ue=!0,Be=u)}}(r,t,void 0,e),e.currentTarget=null}function Ur(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],s=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;Fr(s,o,c),i=l}else for(a=0;a<r.length;a++){if(l=(o=r[a]).instance,c=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;Fr(s,o,c),i=l}}}if(Ue)throw e=Be,Ue=!1,Be=null,e}function Br(e,t){var n=t[ms];void 0===n&&(n=t[ms]=new Set);var r=e+"__bubble";n.has(r)||(Hr(t,e,2,!1),n.add(r))}function jr(e,t,n){var r=0;t&&(r|=4),Hr(n,e,r,t)}var Gr="_reactListening"+Math.random().toString(36).slice(2);function Kr(e){if(!e[Gr]){e[Gr]=!0,a.forEach(function(t){"selectionchange"!==t&&(Mr.has(t)||jr(t,!1,e),jr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Gr]||(t[Gr]=!0,jr("selectionchange",!1,t))}}function Hr(e,t,n,r){switch(Xt(t)){case 1:var s=zt;break;case 4:s=Wt;break;default:s=Yt}n=s.bind(null,t,n,e),s=void 0,!Ce||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),r?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,s){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var o=r.stateNode.containerInfo;if(o===s||8===o.nodeType&&o.parentNode===s)break;if(4===a)for(a=r.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;a=a.return}for(;null!==o;){if(null===(a=ys(o)))return;if(5===(l=a.tag)||6===l){r=i=a;continue e}o=o.parentNode}}r=r.return}De(function(){var r=i,s=Se(n),a=[];e:{var o=_r.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=An;break;case"focusin":c="focus",l=pn;break;case"focusout":c="blur",l=pn;break;case"beforeblur":case"afterblur":l=pn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=gn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Lr:case Ar:case Rr:l=vn;break;case Ir:l=_n;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Rn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==o?o+"Capture":null:o;u=[];for(var f,g=r;null!==g;){var m=(f=g).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==h&&(null!=(m=Pe(g,h))&&u.push(zr(g,m,f)))),d)break;g=g.return}0<u.length&&(o=new l(o,c,null,n,s),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===Ee||!(c=n.relatedTarget||n.fromElement)||!ys(c)&&!c[gs])&&(l||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?ys(c):null)&&(c!==(d=Ke(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=gn,m="onMouseLeave",h="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=Rn,m="onPointerLeave",h="onPointerEnter",g="pointer"),d=null==l?o:Es(l),f=null==c?o:Es(c),(o=new u(m,g+"leave",l,n,s)).target=d,o.relatedTarget=f,m=null,ys(s)===r&&((u=new u(h,g+"enter",c,n,s)).target=f,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,g=0,f=u=l;f;f=Yr(f))g++;for(f=0,m=h;m;m=Yr(m))f++;for(;0<g-f;)u=Yr(u),g--;for(;0<f-g;)h=Yr(h),f--;for(;g--;){if(u===h||null!==h&&u===h.alternate)break e;u=Yr(u),h=Yr(h)}u=null}else u=null;null!==l&&qr(a,o,l,u,!1),null!==c&&null!==d&&qr(a,d,c,u,!0)}if("select"===(l=(o=r?Es(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var p=Xn;else if(Vn(o))if($n)p=ar;else{p=sr;var v=rr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(p=ir);switch(p&&(p=p(e,r))?zn(a,p,n,s):(v&&v(e,o,r),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=r?Es(r):window,e){case"focusin":(Vn(v)||"true"===v.contentEditable)&&(pr=v,vr=r,yr=null);break;case"focusout":yr=vr=pr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,Er(a,n,s);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":Er(a,n,s)}var y;if(On)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Kn?jn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Fn&&"ko"!==n.locale&&(Kn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Kn&&(y=en()):(Jt="value"in($t=s)?$t.value:$t.textContent,Kn=!0)),0<(v=Wr(r,b)).length&&(b=new En(b,e,null,n,s),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=Gn(n))&&(b.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Gn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Un);case"textInput":return(e=t.data)===Un&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Kn)return"compositionend"===e||!On&&jn(e,t)?(e=en(),Zt=Jt=$t=null,Kn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Wr(r,"onBeforeInput")).length&&(s=new En("onBeforeInput","beforeinput",null,n,s),a.push({event:s,listeners:r}),s.data=y))}Ur(a,t)})}function zr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var s=e,i=s.stateNode;5===s.tag&&null!==i&&(s=i,null!=(i=Pe(e,n))&&r.unshift(zr(e,i,s)),null!=(i=Pe(e,t))&&r.push(zr(e,i,s))),e=e.return}return r}function Yr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qr(e,t,n,r,s){for(var i=t._reactName,a=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,s?null!=(l=Pe(n,i))&&a.unshift(zr(n,l,o)):s||null!=(l=Pe(n,i))&&a.push(zr(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Qr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function $r(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace(Xr,"")}function Jr(e,t,n){if(t=$r(t),$r(e)!==t&&n)throw Error(i(425))}function Zr(){}var es=null,ts=null;function ns(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var rs="function"===typeof setTimeout?setTimeout:void 0,ss="function"===typeof clearTimeout?clearTimeout:void 0,is="function"===typeof Promise?Promise:void 0,as="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof is?function(e){return is.resolve(null).then(e).catch(os)}:rs;function os(e){setTimeout(function(){throw e})}function ls(e,t){var n=t,r=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0===r)return e.removeChild(s),void Kt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=s}while(n);Kt(t)}function cs(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function us(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ds=Math.random().toString(36).slice(2),hs="__reactFiber$"+ds,fs="__reactProps$"+ds,gs="__reactContainer$"+ds,ms="__reactEvents$"+ds,ps="__reactListeners$"+ds,vs="__reactHandles$"+ds;function ys(e){var t=e[hs];if(t)return t;for(var n=e.parentNode;n;){if(t=n[gs]||n[hs]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=us(e);null!==e;){if(n=e[hs])return n;e=us(e)}return t}n=(e=n).parentNode}return null}function bs(e){return!(e=e[hs]||e[gs])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Es(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function Ss(e){return e[fs]||null}var Ts=[],xs=-1;function ks(e){return{current:e}}function ws(e){0>xs||(e.current=Ts[xs],Ts[xs]=null,xs--)}function Ls(e,t){xs++,Ts[xs]=e.current,e.current=t}var As={},Rs=ks(As),Is=ks(!1),_s=As;function Ds(e,t){var n=e.type.contextTypes;if(!n)return As;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var s,i={};for(s in n)i[s]=t[s];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Ps(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Cs(){ws(Is),ws(Rs)}function Os(e,t,n){if(Rs.current!==As)throw Error(i(168));Ls(Rs,t),Ls(Is,n)}function Ns(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var s in r=r.getChildContext())if(!(s in t))throw Error(i(108,H(e)||"Unknown",s));return F({},n,r)}function Ms(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||As,_s=Rs.current,Ls(Rs,e),Ls(Is,Is.current),!0}function Fs(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Ns(e,t,_s),r.__reactInternalMemoizedMergedChildContext=e,ws(Is),ws(Rs),Ls(Rs,e)):ws(Is),Ls(Is,n)}var Us=null,Bs=!1,js=!1;function Gs(e){null===Us?Us=[e]:Us.push(e)}function Ks(){if(!js&&null!==Us){js=!0;var e=0,t=bt;try{var n=Us;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Us=null,Bs=!1}catch(s){throw null!==Us&&(Us=Us.slice(e+1)),Ye(Ze,Ks),s}finally{bt=t,js=!1}}return null}var Hs=[],Vs=0,zs=null,Ws=0,Ys=[],qs=0,Qs=null,Xs=1,$s="";function Js(e,t){Hs[Vs++]=Ws,Hs[Vs++]=zs,zs=e,Ws=t}function Zs(e,t,n){Ys[qs++]=Xs,Ys[qs++]=$s,Ys[qs++]=Qs,Qs=e;var r=Xs;e=$s;var s=32-at(r)-1;r&=~(1<<s),n+=1;var i=32-at(t)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,Xs=1<<32-at(t)+s|n<<s|r,$s=i+e}else Xs=1<<i|n<<s|r,$s=e}function ei(e){null!==e.return&&(Js(e,1),Zs(e,1,0))}function ti(e){for(;e===zs;)zs=Hs[--Vs],Hs[Vs]=null,Ws=Hs[--Vs],Hs[Vs]=null;for(;e===Qs;)Qs=Ys[--qs],Ys[qs]=null,$s=Ys[--qs],Ys[qs]=null,Xs=Ys[--qs],Ys[qs]=null}var ni=null,ri=null,si=!1,ii=null;function ai(e,t){var n=Dc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function oi(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=cs(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qs?{id:Xs,overflow:$s}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Dc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function li(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(si){var t=ri;if(t){var n=t;if(!oi(e,t)){if(li(e))throw Error(i(418));t=cs(n.nextSibling);var r=ni;t&&oi(e,t)?ai(r,n):(e.flags=-4097&e.flags|2,si=!1,ni=e)}}else{if(li(e))throw Error(i(418));e.flags=-4097&e.flags|2,si=!1,ni=e}}}function ui(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function di(e){if(e!==ni)return!1;if(!si)return ui(e),si=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ns(e.type,e.memoizedProps)),t&&(t=ri)){if(li(e))throw hi(),Error(i(418));for(;t;)ai(e,t),t=cs(t.nextSibling)}if(ui(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=cs(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?cs(e.stateNode.nextSibling):null;return!0}function hi(){for(var e=ri;e;)e=cs(e.nextSibling)}function fi(){ri=ni=null,si=!1}function gi(e){null===ii?ii=[e]:ii.push(e)}var mi=E.ReactCurrentBatchConfig;function pi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var s=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=s.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function vi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yi(e){return(0,e._init)(e._payload)}function bi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Cc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Fc(n,e.mode,r)).return=e,t):((t=s(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===x?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===P&&yi(i)===t.type)?((r=s(t,n.props)).ref=pi(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=pi(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,r)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function d(e,t,n,r,i){return null===t||7!==t.tag?((t=Nc(n,e.mode,r,i)).return=e,t):((t=s(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case S:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=pi(e,null,t),n.return=e,n;case T:return(t=Uc(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=Nc(t,e.mode,n,null)).return=e,t;vi(e,t)}return null}function f(e,t,n,r){var s=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==s?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case S:return n.key===s?c(e,t,n,r):null;case T:return n.key===s?u(e,t,n,r):null;case P:return f(e,t,(s=n._init)(n._payload),r)}if(te(n)||N(n))return null!==s?null:d(e,t,n,r,null);vi(e,n)}return null}function g(e,t,n,r,s){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,s);if("object"===typeof r&&null!==r){switch(r.$$typeof){case S:return c(t,e=e.get(null===r.key?n:r.key)||null,r,s);case T:return u(t,e=e.get(null===r.key?n:r.key)||null,r,s);case P:return g(e,t,n,(0,r._init)(r._payload),s)}if(te(r)||N(r))return d(t,e=e.get(n)||null,r,s,null);vi(t,r)}return null}function m(s,i,o,l){for(var c=null,u=null,d=i,m=i=0,p=null;null!==d&&m<o.length;m++){d.index>m?(p=d,d=null):p=d.sibling;var v=f(s,d,o[m],l);if(null===v){null===d&&(d=p);break}e&&d&&null===v.alternate&&t(s,d),i=a(v,i,m),null===u?c=v:u.sibling=v,u=v,d=p}if(m===o.length)return n(s,d),si&&Js(s,m),c;if(null===d){for(;m<o.length;m++)null!==(d=h(s,o[m],l))&&(i=a(d,i,m),null===u?c=d:u.sibling=d,u=d);return si&&Js(s,m),c}for(d=r(s,d);m<o.length;m++)null!==(p=g(d,s,m,o[m],l))&&(e&&null!==p.alternate&&d.delete(null===p.key?m:p.key),i=a(p,i,m),null===u?c=p:u.sibling=p,u=p);return e&&d.forEach(function(e){return t(s,e)}),si&&Js(s,m),c}function p(s,o,l,c){var u=N(l);if("function"!==typeof u)throw Error(i(150));if(null==(l=u.call(l)))throw Error(i(151));for(var d=u=null,m=o,p=o=0,v=null,y=l.next();null!==m&&!y.done;p++,y=l.next()){m.index>p?(v=m,m=null):v=m.sibling;var b=f(s,m,y.value,c);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(s,m),o=a(b,o,p),null===d?u=b:d.sibling=b,d=b,m=v}if(y.done)return n(s,m),si&&Js(s,p),u;if(null===m){for(;!y.done;p++,y=l.next())null!==(y=h(s,y.value,c))&&(o=a(y,o,p),null===d?u=y:d.sibling=y,d=y);return si&&Js(s,p),u}for(m=r(s,m);!y.done;p++,y=l.next())null!==(y=g(m,s,p,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?p:y.key),o=a(y,o,p),null===d?u=y:d.sibling=y,d=y);return e&&m.forEach(function(e){return t(s,e)}),si&&Js(s,p),u}return function e(r,i,a,l){if("object"===typeof a&&null!==a&&a.type===x&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case S:e:{for(var c=a.key,u=i;null!==u;){if(u.key===c){if((c=a.type)===x){if(7===u.tag){n(r,u.sibling),(i=s(u,a.props.children)).return=r,r=i;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&yi(c)===u.type){n(r,u.sibling),(i=s(u,a.props)).ref=pi(r,u,a),i.return=r,r=i;break e}n(r,u);break}t(r,u),u=u.sibling}a.type===x?((i=Nc(a.props.children,r.mode,l,a.key)).return=r,r=i):((l=Oc(a.type,a.key,a.props,null,r.mode,l)).ref=pi(r,i,a),l.return=r,r=l)}return o(r);case T:e:{for(u=a.key;null!==i;){if(i.key===u){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){n(r,i.sibling),(i=s(i,a.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Uc(a,r.mode,l)).return=r,r=i}return o(r);case P:return e(r,i,(u=a._init)(a._payload),l)}if(te(a))return m(r,i,a,l);if(N(a))return p(r,i,a,l);vi(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==i&&6===i.tag?(n(r,i.sibling),(i=s(i,a)).return=r,r=i):(n(r,i),(i=Fc(a,r.mode,l)).return=r,r=i),o(r)):n(r,i)}}var Ei=bi(!0),Si=bi(!1),Ti=ks(null),xi=null,ki=null,wi=null;function Li(){wi=ki=xi=null}function Ai(e){var t=Ti.current;ws(Ti),e._currentValue=t}function Ri(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ii(e,t){xi=e,wi=ki=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function _i(e){var t=e._currentValue;if(wi!==e)if(e={context:e,memoizedValue:t,next:null},null===ki){if(null===xi)throw Error(i(308));ki=e,xi.dependencies={lanes:0,firstContext:e}}else ki=ki.next=e;return t}var Di=null;function Pi(e){null===Di?Di=[e]:Di.push(e)}function Ci(e,t,n,r){var s=t.interleaved;return null===s?(n.next=n,Pi(t)):(n.next=s.next,s.next=n),t.interleaved=n,Oi(e,r)}function Oi(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ni=!1;function Mi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ui(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Bi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Rl)){var s=r.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),r.pending=t,Oi(e,n)}return null===(s=r.interleaved)?(t.next=t,Pi(r)):(t.next=s.next,s.next=t),r.interleaved=t,Oi(e,n)}function ji(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Gi(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var s=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?s=i=a:i=i.next=a,n=n.next}while(null!==n);null===i?s=i=t:i=i.next=t}else s=i=t;return n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ki(e,t,n,r){var s=e.updateQueue;Ni=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?i=c:a.next=c,a=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==i){var d=s.baseState;for(a=0,u=c=l=null,o=i;;){var h=o.lane,f=o.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=e,m=o;switch(h=t,f=n,m.tag){case 1:if("function"===typeof(g=m.payload)){d=g.call(f,d,h);break e}d=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null===(h="function"===typeof(g=m.payload)?g.call(f,d,h):g)||void 0===h)break e;d=F({},d,h);break e;case 2:Ni=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=s.effects)?s.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,a|=h;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(h=o).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}if(null===u&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,null!==(t=s.shared.interleaved)){s=t;do{a|=s.lane,s=s.next}while(s!==t)}else null===i&&(s.shared.lanes=0);Ml|=a,e.lanes=a,e.memoizedState=d}}function Hi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],s=r.callback;if(null!==s){if(r.callback=null,r=n,"function"!==typeof s)throw Error(i(191,s));s.call(r)}}}var Vi={},zi=ks(Vi),Wi=ks(Vi),Yi=ks(Vi);function qi(e){if(e===Vi)throw Error(i(174));return e}function Qi(e,t){switch(Ls(Yi,t),Ls(Wi,e),Ls(zi,Vi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ws(zi),Ls(zi,t)}function Xi(){ws(zi),ws(Wi),ws(Yi)}function $i(e){qi(Yi.current);var t=qi(zi.current),n=le(t,e.type);t!==n&&(Ls(Wi,e),Ls(zi,n))}function Ji(e){Wi.current===e&&(ws(zi),ws(Wi))}var Zi=ks(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function na(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ra=E.ReactCurrentDispatcher,sa=E.ReactCurrentBatchConfig,ia=0,aa=null,oa=null,la=null,ca=!1,ua=!1,da=0,ha=0;function fa(){throw Error(i(321))}function ga(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function ma(e,t,n,r,s,a){if(ia=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ra.current=null===e||null===e.memoizedState?Ja:Za,e=n(r,s),ua){a=0;do{if(ua=!1,da=0,25<=a)throw Error(i(301));a+=1,la=oa=null,t.updateQueue=null,ra.current=eo,e=n(r,s)}while(ua)}if(ra.current=$a,t=null!==oa&&null!==oa.next,ia=0,la=oa=aa=null,ca=!1,t)throw Error(i(300));return e}function pa(){var e=0!==da;return da=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(i(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function ba(e,t){return"function"===typeof t?t(e):t}function Ea(e){var t=ya(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=oa,s=r.baseQueue,a=n.pending;if(null!==a){if(null!==s){var o=s.next;s.next=a.next,a.next=o}r.baseQueue=s=a,n.pending=null}if(null!==s){a=s.next,r=r.baseState;var l=o=null,c=null,u=a;do{var d=u.lane;if((ia&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,o=r):c=c.next=h,aa.lanes|=d,Ml|=d}u=u.next}while(null!==u&&u!==a);null===c?o=r:c.next=l,or(r,t.memoizedState)||(bo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){s=e;do{a=s.lane,aa.lanes|=a,Ml|=a,s=s.next}while(s!==e)}else null===s&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Sa(e){var t=ya(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,s=n.pending,a=t.memoizedState;if(null!==s){n.pending=null;var o=s=s.next;do{a=e(a,o.action),o=o.next}while(o!==s);or(a,t.memoizedState)||(bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Ta(){}function xa(e,t){var n=aa,r=ya(),s=t(),a=!or(r.memoizedState,s);if(a&&(r.memoizedState=s,bo=!0),r=r.queue,Na(La.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,_a(9,wa.bind(null,n,r,s,t),void 0,null),null===Il)throw Error(i(349));0!==(30&ia)||ka(n,t,s)}return s}function ka(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function wa(e,t,n,r){t.value=n,t.getSnapshot=r,Aa(t)&&Ra(e)}function La(e,t,n){return n(function(){Aa(t)&&Ra(e)})}function Aa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function Ra(e){var t=Oi(e,1);null!==t&&nc(t,e,1,-1)}function Ia(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:e},t.queue=e,e=e.dispatch=Ya.bind(null,aa,e),[t.memoizedState,e]}function _a(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Da(){return ya().memoizedState}function Pa(e,t,n,r){var s=va();aa.flags|=e,s.memoizedState=_a(1|t,n,void 0,void 0===r?null:r)}function Ca(e,t,n,r){var s=ya();r=void 0===r?null:r;var i=void 0;if(null!==oa){var a=oa.memoizedState;if(i=a.destroy,null!==r&&ga(r,a.deps))return void(s.memoizedState=_a(t,n,i,r))}aa.flags|=e,s.memoizedState=_a(1|t,n,i,r)}function Oa(e,t){return Pa(8390656,8,e,t)}function Na(e,t){return Ca(2048,8,e,t)}function Ma(e,t){return Ca(4,2,e,t)}function Fa(e,t){return Ca(4,4,e,t)}function Ua(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ba(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ca(4,4,Ua.bind(null,t,e),n)}function ja(){}function Ga(e,t){var n=ya();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ga(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ka(e,t){var n=ya();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ga(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ha(e,t,n){return 0===(21&ia)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=n):(or(n,t)||(n=mt(),aa.lanes|=n,Ml|=n,e.baseState=!0),t)}function Va(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=sa.transition;sa.transition={};try{e(!1),t()}finally{bt=n,sa.transition=r}}function za(){return ya().memoizedState}function Wa(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},qa(e))Qa(t,n);else if(null!==(n=Ci(e,t,n,r))){nc(n,e,r,ec()),Xa(n,t,r)}}function Ya(e,t,n){var r=tc(e),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(qa(e))Qa(t,s);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=i(a,n);if(s.hasEagerState=!0,s.eagerState=o,or(o,a)){var l=t.interleaved;return null===l?(s.next=s,Pi(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(c){}null!==(n=Ci(e,t,s,r))&&(nc(n,e,r,s=ec()),Xa(n,t,r))}}function qa(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Qa(e,t){ua=ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Xa(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var $a={readContext:_i,useCallback:fa,useContext:fa,useEffect:fa,useImperativeHandle:fa,useInsertionEffect:fa,useLayoutEffect:fa,useMemo:fa,useReducer:fa,useRef:fa,useState:fa,useDebugValue:fa,useDeferredValue:fa,useTransition:fa,useMutableSource:fa,useSyncExternalStore:fa,useId:fa,unstable_isNewReconciler:!1},Ja={readContext:_i,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:_i,useEffect:Oa,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pa(4194308,4,Ua.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pa(4,2,e,t)},useMemo:function(e,t){var n=va();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=va();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Wa.bind(null,aa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Ia,useDebugValue:ja,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Ia(!1),t=e[0];return e=Va.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=aa,s=va();if(si){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Il)throw Error(i(349));0!==(30&ia)||ka(r,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,Oa(La.bind(null,r,a,e),[e]),r.flags|=2048,_a(9,wa.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=va(),t=Il.identifierPrefix;if(si){var n=$s;t=":"+t+"R"+(n=(Xs&~(1<<32-at(Xs)-1)).toString(32)+n),0<(n=da++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ha++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Za={readContext:_i,useCallback:Ga,useContext:_i,useEffect:Na,useImperativeHandle:Ba,useInsertionEffect:Ma,useLayoutEffect:Fa,useMemo:Ka,useReducer:Ea,useRef:Da,useState:function(){return Ea(ba)},useDebugValue:ja,useDeferredValue:function(e){return Ha(ya(),oa.memoizedState,e)},useTransition:function(){return[Ea(ba)[0],ya().memoizedState]},useMutableSource:Ta,useSyncExternalStore:xa,useId:za,unstable_isNewReconciler:!1},eo={readContext:_i,useCallback:Ga,useContext:_i,useEffect:Na,useImperativeHandle:Ba,useInsertionEffect:Ma,useLayoutEffect:Fa,useMemo:Ka,useReducer:Sa,useRef:Da,useState:function(){return Sa(ba)},useDebugValue:ja,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:Ha(t,oa.memoizedState,e)},useTransition:function(){return[Sa(ba)[0],ya().memoizedState]},useMutableSource:Ta,useSyncExternalStore:xa,useId:za,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ro={isMounted:function(e){return!!(e=e._reactInternals)&&Ke(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),s=tc(e),i=Ui(r,s);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Bi(e,i,s))&&(nc(t,e,s,r),ji(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),s=tc(e),i=Ui(r,s);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Bi(e,i,s))&&(nc(t,e,s,r),ji(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),s=Ui(n,r);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Bi(e,s,r))&&(nc(t,e,r,n),ji(t,e,r))}};function so(e,t,n,r,s,i,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(s,i))}function io(e,t,n){var r=!1,s=As,i=t.contextType;return"object"===typeof i&&null!==i?i=_i(i):(s=Ps(t)?_s:Rs.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ds(e,s):As),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ro,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=i),t}function ao(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,r){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},Mi(e);var i=t.contextType;"object"===typeof i&&null!==i?s.context=_i(i):(i=Ps(t)?_s:Rs.current,s.context=Ds(e,i)),s.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(no(e,t,i,n),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&ro.enqueueReplaceState(s,s.state,null),Ki(e,n,s,r),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",r=t;do{n+=G(r),r=r.return}while(r);var s=n}catch(i){s="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:s,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function fo(e,t,n){(n=Ui(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vl||(Vl=!0,zl=r),uo(0,t)},n}function go(e,t,n){(n=Ui(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var s=t.value;n.payload=function(){return r(s)},n.callback=function(){uo(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof r&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function mo(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var s=new Set;r.set(t,s)}else void 0===(s=r.get(t))&&(s=new Set,r.set(t,s));s.has(n)||(s.add(n),e=wc.bind(null,e,t,n),t.then(e,e))}function po(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,r,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ui(-1,1)).tag=2,Bi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var yo=E.ReactCurrentOwner,bo=!1;function Eo(e,t,n,r){t.child=null===e?Si(t,null,n,r):Ei(t,e.child,n,r)}function So(e,t,n,r,s){n=n.render;var i=t.ref;return Ii(t,s),r=ma(e,t,n,r,i,s),n=pa(),null===e||bo?(si&&n&&ei(t),t.flags|=1,Eo(e,t,r,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Vo(e,t,s))}function To(e,t,n,r,s){if(null===e){var i=n.type;return"function"!==typeof i||Pc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,xo(e,t,i,r,s))}if(i=e.child,0===(e.lanes&s)){var a=i.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(a,r)&&e.ref===t.ref)return Vo(e,t,s)}return t.flags|=1,(e=Cc(i,r)).ref=t.ref,e.return=t,t.child=e}function xo(e,t,n,r,s){if(null!==e){var i=e.memoizedProps;if(lr(i,r)&&e.ref===t.ref){if(bo=!1,t.pendingProps=r=i,0===(e.lanes&s))return t.lanes=e.lanes,Vo(e,t,s);0!==(131072&e.flags)&&(bo=!0)}}return Lo(e,t,n,r,s)}function ko(e,t,n){var r=t.pendingProps,s=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ls(Cl,Pl),Pl|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ls(Cl,Pl),Pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ls(Cl,Pl),Pl|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ls(Cl,Pl),Pl|=r;return Eo(e,t,s,n),t.child}function wo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Lo(e,t,n,r,s){var i=Ps(n)?_s:Rs.current;return i=Ds(t,i),Ii(t,s),n=ma(e,t,n,r,i,s),r=pa(),null===e||bo?(si&&r&&ei(t),t.flags|=1,Eo(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Vo(e,t,s))}function Ao(e,t,n,r,s){if(Ps(n)){var i=!0;Ms(t)}else i=!1;if(Ii(t,s),null===t.stateNode)Ho(e,t),io(t,n,r),oo(t,n,r,s),r=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=_i(c):c=Ds(t,c=Ps(n)?_s:Rs.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==r||l!==c)&&ao(t,a,r,c),Ni=!1;var h=t.memoizedState;a.state=h,Ki(t,r,a,s),l=t.memoizedState,o!==r||h!==l||Is.current||Ni?("function"===typeof u&&(no(t,n,u,r),l=t.memoizedState),(o=Ni||so(t,n,o,r,h,l,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Fi(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,d=t.pendingProps,h=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=_i(l):l=Ds(t,l=Ps(n)?_s:Rs.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==d||h!==l)&&ao(t,a,r,l),Ni=!1,h=t.memoizedState,a.state=h,Ki(t,r,a,s);var g=t.memoizedState;o!==d||h!==g||Is.current||Ni?("function"===typeof f&&(no(t,n,f,r),g=t.memoizedState),(c=Ni||so(t,n,c,r,h,g,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,g,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,g,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=g),a.props=r,a.state=g,a.context=l,r=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ro(e,t,n,r,i,s)}function Ro(e,t,n,r,s,i){wo(e,t);var a=0!==(128&t.flags);if(!r&&!a)return s&&Fs(t,n,!1),Vo(e,t,i);r=t.stateNode,yo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=Ei(t,e.child,null,i),t.child=Ei(t,null,o,i)):Eo(e,t,o,i),t.memoizedState=r.state,s&&Fs(t,n,!0),t.child}function Io(e){var t=e.stateNode;t.pendingContext?Os(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Os(0,t.context,!1),Qi(e,t.containerInfo)}function _o(e,t,n,r,s){return fi(),gi(s),t.flags|=256,Eo(e,t,n,r),t.child}var Do,Po,Co,Oo,No={dehydrated:null,treeContext:null,retryLane:0};function Mo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fo(e,t,n){var r,s=t.pendingProps,a=Zi.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ls(Zi,1&a),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Mc(l,s,0,null),e=Nc(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Mo(n),t.memoizedState=No,e):Uo(t,l));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,s,a,o){if(n)return 256&t.flags?(t.flags&=-257,Bo(e,t,o,r=co(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,s=t.mode,r=Mc({mode:"visible",children:r.children},s,0,null),(a=Nc(a,s,o,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&Ei(t,e.child,null,o),t.child.memoizedState=Mo(o),t.memoizedState=No,a);if(0===(1&t.mode))return Bo(e,t,o,null);if("$!"===s.data){if(r=s.nextSibling&&s.nextSibling.dataset)var l=r.dgst;return r=l,Bo(e,t,o,r=co(a=Error(i(419)),r,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(r=Il)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(r.suspendedLanes|o))?0:s)&&s!==a.retryLane&&(a.retryLane=s,Oi(e,s),nc(r,e,s,-1))}return mc(),Bo(e,t,o,r=co(Error(i(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Ac.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,ri=cs(s.nextSibling),ni=t,si=!0,ii=null,null!==e&&(Ys[qs++]=Xs,Ys[qs++]=$s,Ys[qs++]=Qs,Xs=e.id,$s=e.overflow,Qs=t),t=Uo(t,r.children),t.flags|=4096,t)}(e,t,l,s,r,a,n);if(o){o=s.fallback,l=t.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==a?((s=t.child).childLanes=0,s.pendingProps=c,t.deletions=null):(s=Cc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?o=Cc(r,o):(o=Nc(o,l,n,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=null===(l=e.child.memoizedState)?Mo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=No,s}return e=(o=e.child).sibling,s=Cc(o,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=n),s.return=t,s.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Uo(e,t){return(t=Mc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bo(e,t,n,r){return null!==r&&gi(r),Ei(t,e.child,null,n),(e=Uo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function jo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ri(e.return,t,n)}function Go(e,t,n,r,s){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function Ko(e,t,n){var r=t.pendingProps,s=r.revealOrder,i=r.tail;if(Eo(e,t,r.children,n),0!==(2&(r=Zi.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&jo(e,n,t);else if(19===e.tag)jo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ls(Zi,r),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===ea(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),Go(t,!1,s,n,i);break;case"backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===ea(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}Go(t,!0,n,null,i);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ho(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ml|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Cc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Cc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function zo(e,t){if(!si)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Wo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,r|=14680064&s.subtreeFlags,r|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Yo(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wo(t),null;case 1:case 17:return Ps(t.type)&&Cs(),Wo(t),null;case 3:return r=t.stateNode,Xi(),ws(Is),ws(Rs),na(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(di(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(ac(ii),ii=null))),Po(e,t),Wo(t),null;case 5:Ji(t);var s=qi(Yi.current);if(n=t.type,null!==e&&null!=t.stateNode)Co(e,t,n,r,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Wo(t),null}if(e=qi(zi.current),di(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[hs]=t,r[fs]=a,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(s=0;s<Nr.length;s++)Br(Nr[s],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":X(r,a),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Br("invalid",r);break;case"textarea":se(r,a),Br("invalid",r)}for(var l in ye(n,a),s=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Jr(r.textContent,c,e),s=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Jr(r.textContent,c,e),s=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Br("scroll",r)}switch(n){case"input":W(r),Z(r,a,!0);break;case"textarea":W(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=Zr)}r=s,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[hs]=t,e[fs]=r,Do(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,r),n){case"dialog":Br("cancel",e),Br("close",e),s=r;break;case"iframe":case"object":case"embed":Br("load",e),s=r;break;case"video":case"audio":for(s=0;s<Nr.length;s++)Br(Nr[s],e);s=r;break;case"source":Br("error",e),s=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),s=r;break;case"details":Br("toggle",e),s=r;break;case"input":X(e,r),s=Q(e,r),Br("invalid",e);break;case"option":default:s=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},s=F({},r,{value:void 0}),Br("invalid",e);break;case"textarea":se(e,r),s=re(e,r),Br("invalid",e)}for(a in ye(n,s),c=s)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?pe(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Br("scroll",e):null!=u&&b(e,a,u,l))}switch(n){case"input":W(e),Z(e,r,!1);break;case"textarea":W(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Wo(t),null;case 6:if(e&&null!=t.stateNode)Oo(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=qi(Yi.current),qi(zi.current),di(t)){if(r=t.stateNode,n=t.memoizedProps,r[hs]=t,(a=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hs]=t,t.stateNode=r}return Wo(t),null;case 13:if(ws(Zi),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(si&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))hi(),fi(),t.flags|=98560,a=!1;else if(a=di(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(i(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(i(317));a[hs]=t}else fi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wo(t),a=!1}else null!==ii&&(ac(ii),ii=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zi.current)?0===Ol&&(Ol=3):mc())),null!==t.updateQueue&&(t.flags|=4),Wo(t),null);case 4:return Xi(),Po(e,t),null===e&&Kr(t.stateNode.containerInfo),Wo(t),null;case 10:return Ai(t.type._context),Wo(t),null;case 19:if(ws(Zi),null===(a=t.memoizedState))return Wo(t),null;if(r=0!==(128&t.flags),null===(l=a.rendering))if(r)zo(a,!1);else{if(0!==Ol||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,zo(a,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ls(Zi,1&Zi.current|2),t.child}e=e.sibling}null!==a.tail&&$e()>Kl&&(t.flags|=128,r=!0,zo(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ea(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),zo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!si)return Wo(t),null}else 2*$e()-a.renderingStartTime>Kl&&1073741824!==n&&(t.flags|=128,r=!0,zo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=$e(),t.sibling=null,n=Zi.current,Ls(Zi,r?1&n|2:1&n),t):(Wo(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Pl)&&(Wo(t),6&t.subtreeFlags&&(t.flags|=8192)):Wo(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function qo(e,t){switch(ti(t),t.tag){case 1:return Ps(t.type)&&Cs(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Xi(),ws(Is),ws(Rs),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Ji(t),null;case 13:if(ws(Zi),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));fi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ws(Zi),null;case 4:return Xi(),null;case 10:return Ai(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Do=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(){},Co=function(e,t,n,r){var s=e.memoizedProps;if(s!==r){e=t.stateNode,qi(zi.current);var i,a=null;switch(n){case"input":s=Q(e,s),r=Q(e,r),a=[];break;case"select":s=F({},s,{value:void 0}),r=F({},r,{value:void 0}),a=[];break;case"textarea":s=re(e,s),r=re(e,r),a=[];break;default:"function"!==typeof s.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(u in ye(n,r),n=null,s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&null!=s[u])if("style"===u){var l=s[u];for(i in l)l.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=s?s[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Br("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Oo=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qo=!1,Xo=!1,$o="function"===typeof WeakSet?WeakSet:Set,Jo=null;function Zo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){kc(e,t,r)}else n.current=null}function el(e,t,n){try{n()}catch(r){kc(e,t,r)}}var tl=!1;function nl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var s=r=r.next;do{if((s.tag&e)===e){var i=s.destroy;s.destroy=void 0,void 0!==i&&el(t,n,i)}s=s.next}while(s!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function sl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hs],delete t[fs],delete t[ms],delete t[ps],delete t[vs])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,dl=!1;function hl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(st,n)}catch(o){}switch(n.tag){case 5:Xo||Zo(n,t);case 6:var r=ul,s=dl;ul=null,hl(e,t,n),dl=s,null!==(ul=r)&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?ls(e.parentNode,n):1===e.nodeType&&ls(e,n),Kt(e)):ls(ul,n.stateNode));break;case 4:r=ul,s=dl,ul=n.stateNode.containerInfo,dl=!0,hl(e,t,n),ul=r,dl=s;break;case 0:case 11:case 14:case 15:if(!Xo&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,void 0!==a&&(0!==(2&i)||0!==(4&i))&&el(n,t,a),s=s.next}while(s!==r)}hl(e,t,n);break;case 1:if(!Xo&&(Zo(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){kc(n,t,o)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Xo=(r=Xo)||null!==n.memoizedState,hl(e,t,n),Xo=r):hl(e,t,n);break;default:hl(e,t,n)}}function gl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new $o),t.forEach(function(t){var r=Rc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function ml(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var s=n[r];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,dl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===ul)throw Error(i(160));fl(a,o,s),ul=null,dl=!1;var c=s.alternate;null!==c&&(c.return=null),s.return=null}catch(u){kc(s,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)pl(t,e),t=t.sibling}function pl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(p){kc(e,e.return,p)}try{nl(5,e,e.return)}catch(p){kc(e,e.return,p)}}break;case 1:ml(t,e),vl(e),512&r&&null!==n&&Zo(n,n.return);break;case 5:if(ml(t,e),vl(e),512&r&&null!==n&&Zo(n,n.return),32&e.flags){var s=e.stateNode;try{he(s,"")}catch(p){kc(e,e.return,p)}}if(4&r&&null!=(s=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&$(s,a),be(l,o);var u=be(l,a);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];"style"===d?pe(s,h):"dangerouslySetInnerHTML"===d?de(s,h):"children"===d?he(s,h):b(s,d,h,u)}switch(l){case"input":J(s,a);break;case"textarea":ie(s,a);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var g=a.value;null!=g?ne(s,!!a.multiple,g,!1):f!==!!a.multiple&&(null!=a.defaultValue?ne(s,!!a.multiple,a.defaultValue,!0):ne(s,!!a.multiple,a.multiple?[]:"",!1))}s[fs]=a}catch(p){kc(e,e.return,p)}}break;case 6:if(ml(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(i(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(p){kc(e,e.return,p)}}break;case 3:if(ml(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Kt(t.containerInfo)}catch(p){kc(e,e.return,p)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(s=e.child).flags&&(a=null!==s.memoizedState,s.stateNode.isHidden=a,!a||null!==s.alternate&&null!==s.alternate.memoizedState||(Gl=$e())),4&r&&gl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Xo=(u=Xo)||d,ml(t,e),Xo=u):ml(t,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Jo=e,d=e.child;null!==d;){for(h=Jo=d;null!==Jo;){switch(g=(f=Jo).child,f.tag){case 0:case 11:case 14:case 15:nl(4,f,f.return);break;case 1:Zo(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(p){kc(r,n,p)}}break;case 5:Zo(f,f.return);break;case 22:if(null!==f.memoizedState){Sl(h);continue}}null!==g?(g.return=f,Jo=g):Sl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{s=h.stateNode,u?"function"===typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",o))}catch(p){kc(e,e.return,p)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(p){kc(e,e.return,p)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ml(t,e),vl(e),4&r&&gl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var s=r.stateNode;32&r.flags&&(he(s,""),r.flags&=-33),cl(e,ol(e),s);break;case 3:case 4:var a=r.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(i(161))}}catch(o){kc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Jo=e,bl(e,t,n)}function bl(e,t,n){for(var r=0!==(1&e.mode);null!==Jo;){var s=Jo,i=s.child;if(22===s.tag&&r){var a=null!==s.memoizedState||Qo;if(!a){var o=s.alternate,l=null!==o&&null!==o.memoizedState||Xo;o=Qo;var c=Xo;if(Qo=a,(Xo=l)&&!c)for(Jo=s;null!==Jo;)l=(a=Jo).child,22===a.tag&&null!==a.memoizedState?Tl(s):null!==l?(l.return=a,Jo=l):Tl(s);for(;null!==i;)Jo=i,bl(i,t,n),i=i.sibling;Jo=s,Qo=o,Xo=c}El(e)}else 0!==(8772&s.subtreeFlags)&&null!==i?(i.return=s,Jo=i):El(e)}}function El(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xo||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xo)if(null===n)r.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Hi(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Hi(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Kt(h)}}}break;default:throw Error(i(163))}Xo||512&t.flags&&sl(t)}catch(f){kc(t,t.return,f)}}if(t===e){Jo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Jo=n;break}Jo=t.return}}function Sl(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Jo=n;break}Jo=t.return}}function Tl(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){kc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var s=t.return;try{r.componentDidMount()}catch(l){kc(t,s,l)}}var i=t.return;try{sl(t)}catch(l){kc(t,i,l)}break;case 5:var a=t.return;try{sl(t)}catch(l){kc(t,a,l)}}}catch(l){kc(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var xl,kl=Math.ceil,wl=E.ReactCurrentDispatcher,Ll=E.ReactCurrentOwner,Al=E.ReactCurrentBatchConfig,Rl=0,Il=null,_l=null,Dl=0,Pl=0,Cl=ks(0),Ol=0,Nl=null,Ml=0,Fl=0,Ul=0,Bl=null,jl=null,Gl=0,Kl=1/0,Hl=null,Vl=!1,zl=null,Wl=null,Yl=!1,ql=null,Ql=0,Xl=0,$l=null,Jl=-1,Zl=0;function ec(){return 0!==(6&Rl)?$e():-1!==Jl?Jl:Jl=$e()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Rl)&&0!==Dl?Dl&-Dl:null!==mi.transition?(0===Zl&&(Zl=mt()),Zl):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function nc(e,t,n,r){if(50<Xl)throw Xl=0,$l=null,Error(i(185));vt(e,n,r),0!==(2&Rl)&&e===Il||(e===Il&&(0===(2&Rl)&&(Fl|=n),4===Ol&&oc(e,Dl)),rc(e,r),1===n&&0===Rl&&0===(1&t.mode)&&(Kl=$e()+500,Bs&&Ks()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,s=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-at(i),o=1<<a,l=s[a];-1===l?0!==(o&n)&&0===(o&r)||(s[a]=ft(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}}(e,t);var r=ht(e,e===Il?Dl:0);if(0===r)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){Bs=!0,Gs(e)}(lc.bind(null,e)):Gs(lc.bind(null,e)),as(function(){0===(6&Rl)&&Ks()}),n=null;else{switch(Et(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ic(n,sc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sc(e,t){if(Jl=-1,Zl=0,0!==(6&Rl))throw Error(i(327));var n=e.callbackNode;if(Tc()&&e.callbackNode!==n)return null;var r=ht(e,e===Il?Dl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=pc(e,r);else{t=r;var s=Rl;Rl|=2;var a=gc();for(Il===e&&Dl===t||(Hl=null,Kl=$e()+500,hc(e,t));;)try{yc();break}catch(l){fc(e,l)}Li(),wl.current=a,Rl=s,null!==_l?t=0:(Il=null,Dl=0,t=Ol)}if(0!==t){if(2===t&&(0!==(s=gt(e))&&(r=s,t=ic(e,s))),1===t)throw n=Nl,hc(e,0),oc(e,r),rc(e,$e()),n;if(6===t)oc(e,r);else{if(s=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!or(i(),s))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=pc(e,r))&&(0!==(a=gt(e))&&(r=a,t=ic(e,a))),1===t))throw n=Nl,hc(e,0),oc(e,r),rc(e,$e()),n;switch(e.finishedWork=s,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:Sc(e,jl,Hl);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(t=Gl+500-$e())){if(0!==ht(e,0))break;if(((s=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=rs(Sc.bind(null,e,jl,Hl),t);break}Sc(e,jl,Hl);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,s=-1;0<r;){var o=31-at(r);a=1<<o,(o=t[o])>s&&(s=o),r&=~a}if(r=s,10<(r=(120>(r=$e()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*kl(r/1960))-r)){e.timeoutHandle=rs(Sc.bind(null,e,jl,Hl),r);break}Sc(e,jl,Hl);break;default:throw Error(i(329))}}}return rc(e,$e()),e.callbackNode===n?sc.bind(null,e):null}function ic(e,t){var n=Bl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=pc(e,t))&&(t=jl,jl=n,null!==t&&ac(t)),e}function ac(e){null===jl?jl=e:jl.push.apply(jl,e)}function oc(e,t){for(t&=~Ul,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&Rl))throw Error(i(327));Tc();var t=ht(e,0);if(0===(1&t))return rc(e,$e()),null;var n=pc(e,t);if(0!==e.tag&&2===n){var r=gt(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Nl,hc(e,0),oc(e,t),rc(e,$e()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,jl,Hl),rc(e,$e()),null}function cc(e,t){var n=Rl;Rl|=1;try{return e(t)}finally{0===(Rl=n)&&(Kl=$e()+500,Bs&&Ks())}}function uc(e){null!==ql&&0===ql.tag&&0===(6&Rl)&&Tc();var t=Rl;Rl|=1;var n=Al.transition,r=bt;try{if(Al.transition=null,bt=1,e)return e()}finally{bt=r,Al.transition=n,0===(6&(Rl=t))&&Ks()}}function dc(){Pl=Cl.current,ws(Cl)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ss(n)),null!==_l)for(n=_l.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Cs();break;case 3:Xi(),ws(Is),ws(Rs),na();break;case 5:Ji(r);break;case 4:Xi();break;case 13:case 19:ws(Zi);break;case 10:Ai(r.type._context);break;case 22:case 23:dc()}n=n.return}if(Il=e,_l=e=Cc(e.current,null),Dl=Pl=t,Ol=0,Nl=null,Ul=Fl=Ml=0,jl=Bl=null,null!==Di){for(t=0;t<Di.length;t++)if(null!==(r=(n=Di[t]).interleaved)){n.interleaved=null;var s=r.next,i=n.pending;if(null!==i){var a=i.next;i.next=s,r.next=a}n.pending=r}Di=null}return e}function fc(e,t){for(;;){var n=_l;try{if(Li(),ra.current=$a,ca){for(var r=aa.memoizedState;null!==r;){var s=r.queue;null!==s&&(s.pending=null),r=r.next}ca=!1}if(ia=0,la=oa=aa=null,ua=!1,da=0,Ll.current=null,null===n||null===n.return){Ol=1,Nl=t,_l=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Dl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var g=po(o);if(null!==g){g.flags&=-257,vo(g,o,l,0,t),1&g.mode&&mo(a,u,t),c=u;var m=(t=g).updateQueue;if(null===m){var p=new Set;p.add(c),t.updateQueue=p}else m.add(c);break e}if(0===(1&t)){mo(a,u,t),mc();break e}c=Error(i(426))}else if(si&&1&l.mode){var v=po(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),gi(lo(c,l));break e}}a=c=lo(c,l),4!==Ol&&(Ol=2),null===Bl?Bl=[a]:Bl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Gi(a,fo(0,c,t));break e;case 1:l=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Wl||!Wl.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,Gi(a,go(a,l,t));break e}}a=a.return}while(null!==a)}Ec(n)}catch(E){t=E,_l===n&&null!==n&&(_l=n=n.return);continue}break}}function gc(){var e=wl.current;return wl.current=$a,null===e?$a:e}function mc(){0!==Ol&&3!==Ol&&2!==Ol||(Ol=4),null===Il||0===(268435455&Ml)&&0===(268435455&Fl)||oc(Il,Dl)}function pc(e,t){var n=Rl;Rl|=2;var r=gc();for(Il===e&&Dl===t||(Hl=null,hc(e,t));;)try{vc();break}catch(s){fc(e,s)}if(Li(),Rl=n,wl.current=r,null!==_l)throw Error(i(261));return Il=null,Dl=0,Ol}function vc(){for(;null!==_l;)bc(_l)}function yc(){for(;null!==_l&&!Qe();)bc(_l)}function bc(e){var t=xl(e.alternate,e,Pl);e.memoizedProps=e.pendingProps,null===t?Ec(e):_l=t,Ll.current=null}function Ec(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Yo(n,t,Pl)))return void(_l=n)}else{if(null!==(n=qo(n,t)))return n.flags&=32767,void(_l=n);if(null===e)return Ol=6,void(_l=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(_l=t);_l=t=e}while(null!==t);0===Ol&&(Ol=5)}function Sc(e,t,n){var r=bt,s=Al.transition;try{Al.transition=null,bt=1,function(e,t,n,r){do{Tc()}while(null!==ql);if(0!==(6&Rl))throw Error(i(327));n=e.finishedWork;var s=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-at(n),i=1<<s;t[s]=0,r[s]=-1,e[s]=-1,n&=~i}}(e,a),e===Il&&(_l=Il=null,Dl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yl||(Yl=!0,Ic(tt,function(){return Tc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Al.transition,Al.transition=null;var o=bt;bt=1;var l=Rl;Rl|=4,Ll.current=null,function(e,t){if(es=Vt,fr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(S){n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var g;h!==n||0!==s&&3!==h.nodeType||(l=o+s),h!==a||0!==r&&3!==h.nodeType||(c=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(g=h.firstChild);)f=h,h=g;for(;;){if(h===e)break t;if(f===n&&++u===s&&(l=o),f===a&&++d===r&&(c=o),null!==(g=h.nextSibling))break;f=(h=f).parentNode}h=g}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ts={focusedElem:e,selectionRange:n},Vt=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var p=m.memoizedProps,v=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?p:to(t.type,p),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(i(163))}}catch(S){kc(t,t.return,S)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}m=tl,tl=!1}(e,n),pl(n,e),gr(ts),Vt=!!es,ts=es=null,e.current=n,yl(n,e,s),Xe(),Rl=l,bt=o,Al.transition=a}else e.current=n;if(Yl&&(Yl=!1,ql=e,Ql=s),a=e.pendingLanes,0===a&&(Wl=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(st,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,$e()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Vl)throw Vl=!1,e=zl,zl=null,e;0!==(1&Ql)&&0!==e.tag&&Tc(),a=e.pendingLanes,0!==(1&a)?e===$l?Xl++:(Xl=0,$l=e):Xl=0,Ks()}(e,t,n,r)}finally{Al.transition=s,bt=r}return null}function Tc(){if(null!==ql){var e=Et(Ql),t=Al.transition,n=bt;try{if(Al.transition=null,bt=16>e?16:e,null===ql)var r=!1;else{if(e=ql,ql=null,Ql=0,0!==(6&Rl))throw Error(i(331));var s=Rl;for(Rl|=4,Jo=e.current;null!==Jo;){var a=Jo,o=a.child;if(0!==(16&Jo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Jo=u;null!==Jo;){var d=Jo;switch(d.tag){case 0:case 11:case 15:nl(8,d,a)}var h=d.child;if(null!==h)h.return=d,Jo=h;else for(;null!==Jo;){var f=(d=Jo).sibling,g=d.return;if(il(d),d===u){Jo=null;break}if(null!==f){f.return=g,Jo=f;break}Jo=g}}}var m=a.alternate;if(null!==m){var p=m.child;if(null!==p){m.child=null;do{var v=p.sibling;p.sibling=null,p=v}while(null!==p)}}Jo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(a=Jo).flags))switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Jo=y;break e}Jo=a.return}}var b=e.current;for(Jo=b;null!==Jo;){var E=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==E)E.return=o,Jo=E;else e:for(o=b;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(T){kc(l,l.return,T)}if(l===o){Jo=null;break e}var S=l.sibling;if(null!==S){S.return=l.return,Jo=S;break e}Jo=l.return}}if(Rl=s,Ks(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(st,e)}catch(T){}r=!0}return r}finally{bt=n,Al.transition=t}}return!1}function xc(e,t,n){e=Bi(e,t=fo(0,t=lo(n,t),1),1),t=ec(),null!==e&&(vt(e,1,t),rc(e,t))}function kc(e,t,n){if(3===e.tag)xc(e,e,n);else for(;null!==t;){if(3===t.tag){xc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Wl||!Wl.has(r))){t=Bi(t,e=go(t,e=lo(n,e),1),1),e=ec(),null!==t&&(vt(t,1,e),rc(t,e));break}}t=t.return}}function wc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(Dl&n)===n&&(4===Ol||3===Ol&&(130023424&Dl)===Dl&&500>$e()-Gl?hc(e,0):Ul|=n),rc(e,t)}function Lc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Oi(e,t))&&(vt(e,t,n),rc(e,n))}function Ac(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Lc(e,n)}function Rc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Lc(e,n)}function Ic(e,t){return Ye(e,t)}function _c(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dc(e,t,n,r){return new _c(e,t,n,r)}function Pc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Cc(e,t){var n=e.alternate;return null===n?((n=Dc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,s,a){var o=2;if(r=e,"function"===typeof e)Pc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case x:return Nc(n.children,s,a,t);case k:o=8,s|=8;break;case w:return(e=Dc(12,n,t,2|s)).elementType=w,e.lanes=a,e;case I:return(e=Dc(13,n,t,s)).elementType=I,e.lanes=a,e;case _:return(e=Dc(19,n,t,s)).elementType=_,e.lanes=a,e;case C:return Mc(n,s,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case L:o=10;break e;case A:o=9;break e;case R:o=11;break e;case D:o=14;break e;case P:o=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Dc(o,n,t,s)).elementType=e,t.type=r,t.lanes=a,t}function Nc(e,t,n,r){return(e=Dc(7,e,r,t)).lanes=n,e}function Mc(e,t,n,r){return(e=Dc(22,e,r,t)).elementType=C,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=Dc(6,e,null,t)).lanes=n,e}function Uc(e,t,n){return(t=Dc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,r,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pt(0),this.expirationTimes=pt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pt(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function jc(e,t,n,r,s,i,a,o,l){return e=new Bc(e,t,n,o,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Dc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mi(i),e}function Gc(e){if(!e)return As;e:{if(Ke(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ps(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Ps(n))return Ns(e,n,t)}return t}function Kc(e,t,n,r,s,i,a,o,l){return(e=jc(n,r,!0,e,0,i,0,o,l)).context=Gc(null),n=e.current,(i=Ui(r=ec(),s=tc(n))).callback=void 0!==t&&null!==t?t:null,Bi(n,i,s),e.current.lanes=s,vt(e,s,r),rc(e,r),e}function Hc(e,t,n,r){var s=t.current,i=ec(),a=tc(s);return n=Gc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ui(i,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Bi(s,t,a))&&(nc(e,s,a,i),ji(e,s,a)),a}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function zc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){zc(e,t),(e=e.alternate)&&zc(e,t)}xl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Is.current)bo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bo=!1,function(e,t,n){switch(t.tag){case 3:Io(t),fi();break;case 5:$i(t);break;case 1:Ps(t.type)&&Ms(t);break;case 4:Qi(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,s=t.memoizedProps.value;Ls(Ti,r._currentValue),r._currentValue=s;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ls(Zi,1&Zi.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fo(e,t,n):(Ls(Zi,1&Zi.current),null!==(e=Vo(e,t,n))?e.sibling:null);Ls(Zi,1&Zi.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ko(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ls(Zi,Zi.current),r)break;return null;case 22:case 23:return t.lanes=0,ko(e,t,n)}return Vo(e,t,n)}(e,t,n);bo=0!==(131072&e.flags)}else bo=!1,si&&0!==(1048576&t.flags)&&Zs(t,Ws,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ho(e,t),e=t.pendingProps;var s=Ds(t,Rs.current);Ii(t,n),s=ma(null,t,r,e,s,n);var a=pa();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ps(r)?(a=!0,Ms(t)):a=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Mi(t),s.updater=ro,t.stateNode=s,s._reactInternals=t,oo(t,r,e,n),t=Ro(null,t,r,!0,a,n)):(t.tag=0,si&&a&&ei(t),Eo(null,t,s,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ho(e,t),e=t.pendingProps,r=(s=r._init)(r._payload),t.type=r,s=t.tag=function(e){if("function"===typeof e)return Pc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===D)return 14}return 2}(r),e=to(r,e),s){case 0:t=Lo(null,t,r,e,n);break e;case 1:t=Ao(null,t,r,e,n);break e;case 11:t=So(null,t,r,e,n);break e;case 14:t=To(null,t,r,to(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,s=t.pendingProps,Lo(e,t,r,s=t.elementType===r?s:to(r,s),n);case 1:return r=t.type,s=t.pendingProps,Ao(e,t,r,s=t.elementType===r?s:to(r,s),n);case 3:e:{if(Io(t),null===e)throw Error(i(387));r=t.pendingProps,s=(a=t.memoizedState).element,Fi(e,t),Ki(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=_o(e,t,r,n,s=lo(Error(i(423)),t));break e}if(r!==s){t=_o(e,t,r,n,s=lo(Error(i(424)),t));break e}for(ri=cs(t.stateNode.containerInfo.firstChild),ni=t,si=!0,ii=null,n=Si(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fi(),r===s){t=Vo(e,t,n);break e}Eo(e,t,r,n)}t=t.child}return t;case 5:return $i(t),null===e&&ci(t),r=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,o=s.children,ns(r,s)?o=null:null!==a&&ns(r,a)&&(t.flags|=32),wo(e,t),Eo(e,t,o,n),t.child;case 6:return null===e&&ci(t),null;case 13:return Fo(e,t,n);case 4:return Qi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ei(t,null,r,n):Eo(e,t,r,n),t.child;case 11:return r=t.type,s=t.pendingProps,So(e,t,r,s=t.elementType===r?s:to(r,s),n);case 7:return Eo(e,t,t.pendingProps,n),t.child;case 8:case 12:return Eo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,s=t.pendingProps,a=t.memoizedProps,o=s.value,Ls(Ti,r._currentValue),r._currentValue=o,null!==a)if(or(a.value,o)){if(a.children===s.children&&!Is.current){t=Vo(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=Ui(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Ri(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(i(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ri(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}Eo(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,r=t.pendingProps.children,Ii(t,n),r=r(s=_i(s)),t.flags|=1,Eo(e,t,r,n),t.child;case 14:return s=to(r=t.type,t.pendingProps),To(e,t,r,s=to(r.type,s),n);case 15:return xo(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:to(r,s),Ho(e,t),t.tag=1,Ps(r)?(e=!0,Ms(t)):e=!1,Ii(t,n),io(t,r,s),oo(t,r,s,n),Ro(null,t,r,!0,e,n);case 19:return Ko(e,t,n);case 22:return ko(e,t,n)}throw Error(i(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function qc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function Zc(e,t,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if("function"===typeof s){var o=s;s=function(){var e=Vc(a);o.call(e)}}Hc(t,a,e,s)}else a=function(e,t,n,r,s){if(s){if("function"===typeof r){var i=r;r=function(){var e=Vc(a);i.call(e)}}var a=Kc(t,r,e,0,null,!1,0,"",Jc);return e._reactRootContainer=a,e[gs]=a.current,Kr(8===e.nodeType?e.parentNode:e),uc(),a}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof r){var o=r;r=function(){var e=Vc(l);o.call(e)}}var l=jc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[gs]=l.current,Kr(8===e.nodeType?e.parentNode:e),uc(function(){Hc(t,l,n,r)}),l}(n,t,e,s,r);return Vc(a)}Qc.prototype.render=qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Hc(e,t,null,null)},Qc.prototype.unmount=qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){Hc(null,e,null,null)}),t[gs]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=kt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ct.length&&0!==t&&t<Ct[n].priority;n++);Ct.splice(n,0,e),0===n&&Ft(e)}},St=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,$e()),0===(6&Rl)&&(Kl=$e()+500,Ks()))}break;case 13:uc(function(){var t=Oi(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Wc(e,1)}},Tt=function(e){if(13===e.tag){var t=Oi(e,134217728);if(null!==t)nc(t,e,134217728,ec());Wc(e,134217728)}},xt=function(e){if(13===e.tag){var t=tc(e),n=Oi(e,t);if(null!==n)nc(n,e,t,ec());Wc(e,t)}},kt=function(){return bt},wt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Te=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var s=Ss(r);if(!s)throw Error(i(90));Y(r),J(r,s)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Re=cc,Ie=uc;var eu={usingClientEntryPoint:!1,Events:[bs,Es,Ss,Le,Ae,cc]},tu={findFiberByHostInstance:ys,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=ze(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{st=ru.inject(nu),it=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xc(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:T,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xc(e))throw Error(i(299));var n=!1,r="",s=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=jc(e,1,!1,null,0,n,0,r,s),e[gs]=t.current,Kr(8===e.nodeType?e.parentNode:e),new qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=ze(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!$c(t))throw Error(i(200));return Zc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,s=!1,a="",o=Yc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Kc(t,null,e,1,null!=n?n:null,s,0,a,o),e[gs]=t.current,Kr(e),r)for(e=0;e<r.length;e++)s=(s=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Qc(t)},t.render=function(e,t,n){if(!$c(t))throw Error(i(200));return Zc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!$c(e))throw Error(i(40));return!!e._reactRootContainer&&(uc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[gs]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!$c(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return Zc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{e.exports=n(234)},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.m=e,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"===typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&s&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>r[e]);return a.default=()=>r,n.d(i,a),i}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+".293b5985.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="khopadi-movies-frontend:";n.l=(r,s,i,a)=>{if(e[r])e[r].push(s);else{var o,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+i){o=d;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+i),o.src=r),e[r]=[s];var h=(t,n)=>{o.onerror=o.onload=null,clearTimeout(f);var s=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach(e=>e(n)),t)return t(n)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/khopadi.github.io/",(()=>{var e={792:0};n.f.j=(t,r)=>{var s=n.o(e,t)?e[t]:void 0;if(0!==s)if(s)r.push(s[2]);else{var i=new Promise((n,r)=>s=e[t]=[n,r]);r.push(s[2]=i);var a=n.p+n.u(t),o=new Error;n.l(a,r=>{if(n.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var i=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",o.name="ChunkLoadError",o.type=i,o.request=a,s[1](o)}},"chunk-"+t,t)}};var t=(t,r)=>{var s,i,[a,o,l]=r,c=0;if(a.some(t=>0!==e[t])){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(l)l(n)}for(t&&t(r);c<a.length;c++)i=a[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkkhopadi_movies_frontend=self.webpackChunkkhopadi_movies_frontend||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r={};n.r(r),n.d(r,{hasBrowserEnv:()=>Xt,hasStandardBrowserEnv:()=>Jt,hasStandardBrowserWebWorkerEnv:()=>Zt,navigator:()=>$t,origin:()=>en});var s,i=n(43),a=n.t(i,2),o=n(391),l=n(950),c=n.t(l,2);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(s||(s={}));const d="popstate";function h(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function f(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function g(e,t){return{usr:e.state,key:e.key,idx:t}}function m(e,t,n,r){return void 0===n&&(n=null),u({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?v(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function p(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function v(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function y(e,t,n,r){void 0===r&&(r={});let{window:i=document.defaultView,v5Compat:a=!1}=r,o=i.history,l=s.Pop,c=null,f=v();function v(){return(o.state||{idx:null}).idx}function y(){l=s.Pop;let e=v(),t=null==e?null:e-f;f=e,c&&c({action:l,location:E.location,delta:t})}function b(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,n="string"===typeof e?e:p(e);return n=n.replace(/ $/,"%20"),h(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==f&&(f=0,o.replaceState(u({},o.state,{idx:f}),""));let E={get action(){return l},get location(){return e(i,o)},listen(e){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(d,y),c=e,()=>{i.removeEventListener(d,y),c=null}},createHref:e=>t(i,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){l=s.Push;let r=m(E.location,e,t);n&&n(r,e),f=v()+1;let u=g(r,f),d=E.createHref(r);try{o.pushState(u,"",d)}catch(h){if(h instanceof DOMException&&"DataCloneError"===h.name)throw h;i.location.assign(d)}a&&c&&c({action:l,location:E.location,delta:1})},replace:function(e,t){l=s.Replace;let r=m(E.location,e,t);n&&n(r,e),f=v();let i=g(r,f),u=E.createHref(r);o.replaceState(i,"",u),a&&c&&c({action:l,location:E.location,delta:0})},go:e=>o.go(e)};return E}var b;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(b||(b={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function E(e,t,n){return void 0===n&&(n="/"),S(e,t,n,!1)}function S(e,t,n,r){let s=N(("string"===typeof t?v(t):t).pathname||"/",n);if(null==s)return null;let i=T(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(i);let a=null;for(let o=0;null==a&&o<i.length;++o){let e=O(s);a=P(i[o],e,r)}return a}function T(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let s=(e,s,i)=>{let a={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:s,route:e};a.relativePath.startsWith("/")&&(h(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let o=H([r,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(h(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),T(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:D(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of x(e.path))s(e,t,r);else s(e,t)}),t}function x(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===r.length)return s?[i,""]:[i];let a=x(r.join("/")),o=[];return o.push(...a.map(e=>""===e?i:[i,e].join("/"))),s&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const k=/^:[\w-]+$/,w=3,L=2,A=1,R=10,I=-2,_=e=>"*"===e;function D(e,t){let n=e.split("/"),r=n.length;return n.some(_)&&(r+=I),t&&(r+=L),n.filter(e=>!_(e)).reduce((e,t)=>e+(k.test(t)?w:""===t?A:R),r)}function P(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,s={},i="/",a=[];for(let o=0;o<r.length;++o){let e=r[o],l=o===r.length-1,c="/"===i?t:t.slice(i.length)||"/",u=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),d=e.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(s,u.params),a.push({params:s,pathname:H([i,u.pathname]),pathnameBase:V(H([i,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(i=H([i,u.pathnameBase]))}return a}function C(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);f("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),s+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":""!==e&&"/"!==e&&(s+="(?:(?=\\/|$))");let i=new RegExp(s,t?void 0:"i");return[i,r]}(e.path,e.caseSensitive,e.end),s=t.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:s}=t;if("*"===r){let e=o[n]||"";a=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[r]=s&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:i,pathnameBase:a,pattern:e}}function O(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return f(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function N(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}const M=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function F(e,t){void 0===t&&(t="/");let n,{pathname:r,search:s="",hash:i=""}="string"===typeof e?v(e):e;if(r)if(a=r,M.test(a))n=r;else{if(r.includes("//")){let e=r;r=r.replace(/\/\/+/g,"/"),f(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+r)}n=r.startsWith("/")?U(r.substring(1),"/"):U(r,t)}else n=t;var a;return{pathname:n,search:z(s),hash:W(i)}}function U(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function B(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function j(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function G(e,t){let n=j(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function K(e,t,n,r){let s;void 0===r&&(r=!1),"string"===typeof e?s=v(e):(s=u({},e),h(!s.pathname||!s.pathname.includes("?"),B("?","pathname","search",s)),h(!s.pathname||!s.pathname.includes("#"),B("#","pathname","hash",s)),h(!s.search||!s.search.includes("#"),B("#","search","hash",s)));let i,a=""===e||""===s.pathname,o=a?"/":s.pathname;if(null==o)i=n;else{let e=t.length-1;if(!r&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;s.pathname=t.join("/")}i=e>=0?t[e]:"/"}let l=F(s,i),c=o&&"/"!==o&&o.endsWith("/"),d=(a||"."===o)&&n.endsWith("/");return l.pathname.endsWith("/")||!c&&!d||(l.pathname+="/"),l}const H=e=>e.join("/").replace(/\/\/+/g,"/"),V=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),z=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",W=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function Y(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const q=["post","put","patch","delete"],Q=(new Set(q),["get",...q]);new Set(Q),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function X(){return X=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},X.apply(this,arguments)}const $=i.createContext(null);const J=i.createContext(null);const Z=i.createContext(null);const ee=i.createContext(null);const te=i.createContext({outlet:null,matches:[],isDataRoute:!1});const ne=i.createContext(null);function re(){return null!=i.useContext(ee)}function se(){return re()||h(!1),i.useContext(ee).location}function ie(e){i.useContext(Z).static||i.useLayoutEffect(e)}function ae(){let{isDataRoute:e}=i.useContext(te);return e?function(){let{router:e}=ve(me.UseNavigateStable),t=be(pe.UseNavigateStable),n=i.useRef(!1);return ie(()=>{n.current=!0}),i.useCallback(function(r,s){void 0===s&&(s={}),n.current&&("number"===typeof r?e.navigate(r):e.navigate(r,X({fromRouteId:t},s)))},[e,t])}():function(){re()||h(!1);let e=i.useContext($),{basename:t,future:n,navigator:r}=i.useContext(Z),{matches:s}=i.useContext(te),{pathname:a}=se(),o=JSON.stringify(G(s,n.v7_relativeSplatPath)),l=i.useRef(!1);return ie(()=>{l.current=!0}),i.useCallback(function(n,s){if(void 0===s&&(s={}),!l.current)return;if("number"===typeof n)return void r.go(n);let i=K(n,JSON.parse(o),a,"path"===s.relative);null==e&&"/"!==t&&(i.pathname="/"===i.pathname?t:H([t,i.pathname])),(s.replace?r.replace:r.push)(i,s.state,s)},[t,r,o,a,e])}()}function oe(){let{matches:e}=i.useContext(te),t=e[e.length-1];return t?t.params:{}}function le(e,t){let{relative:n}=void 0===t?{}:t,{future:r}=i.useContext(Z),{matches:s}=i.useContext(te),{pathname:a}=se(),o=JSON.stringify(G(s,r.v7_relativeSplatPath));return i.useMemo(()=>K(e,JSON.parse(o),a,"path"===n),[e,o,a,n])}function ce(e,t,n,r){re()||h(!1);let{navigator:a}=i.useContext(Z),{matches:o}=i.useContext(te),l=o[o.length-1],c=l?l.params:{},u=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let d,f=se();if(t){var g;let e="string"===typeof t?v(t):t;"/"===u||(null==(g=e.pathname)?void 0:g.startsWith(u))||h(!1),d=e}else d=f;let m=d.pathname||"/",p=m;if("/"!==u){let e=u.replace(/^\//,"").split("/");p="/"+m.replace(/^\//,"").split("/").slice(e.length).join("/")}let y=E(e,{pathname:p});let b=ge(y&&y.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:H([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:H([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,n,r);return t&&b?i.createElement(ee.Provider,{value:{location:X({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:s.Pop}},b):b}function ue(){let e=function(){var e;let t=i.useContext(ne),n=ye(pe.UseRouteError),r=be(pe.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=Y(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r};return i.createElement(i.Fragment,null,i.createElement("h2",null,"Unexpected Application Error!"),i.createElement("h3",{style:{fontStyle:"italic"}},t),n?i.createElement("pre",{style:s},n):null,null)}const de=i.createElement(ue,null);class he extends i.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?i.createElement(te.Provider,{value:this.props.routeContext},i.createElement(ne.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function fe(e){let{routeContext:t,match:n,children:r}=e,s=i.useContext($);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),i.createElement(te.Provider,{value:t},r)}function ge(e,t,n,r){var s;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var a;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(a=r)&&a.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let o=e,l=null==(s=n)?void 0:s.errors;if(null!=l){let e=o.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||h(!1),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let i=0;i<o.length;i++){let e=o[i];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=i),e.route.id){let{loaderData:t,errors:r}=n,s=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||s){c=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,r,s)=>{let a,d=!1,h=null,f=null;var g;n&&(a=l&&r.route.id?l[r.route.id]:void 0,h=r.route.errorElement||de,c&&(u<0&&0===s?(g="route-fallback",!1||Ee[g]||(Ee[g]=!0),d=!0,f=null):u===s&&(d=!0,f=r.route.hydrateFallbackElement||null)));let m=t.concat(o.slice(0,s+1)),p=()=>{let t;return t=a?h:d?f:r.route.Component?i.createElement(r.route.Component,null):r.route.element?r.route.element:e,i.createElement(fe,{match:r,routeContext:{outlet:e,matches:m,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===s)?i.createElement(he,{location:n.location,revalidation:n.revalidation,component:h,error:a,children:p(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):p()},null)}var me=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(me||{}),pe=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(pe||{});function ve(e){let t=i.useContext($);return t||h(!1),t}function ye(e){let t=i.useContext(J);return t||h(!1),t}function be(e){let t=function(){let e=i.useContext(te);return e||h(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||h(!1),n.route.id}const Ee={};function Se(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}a.startTransition;function Te(e){h(!1)}function xe(e){let{basename:t="/",children:n=null,location:r,navigationType:a=s.Pop,navigator:o,static:l=!1,future:c}=e;re()&&h(!1);let u=t.replace(/^\/*/,"/"),d=i.useMemo(()=>({basename:u,navigator:o,static:l,future:X({v7_relativeSplatPath:!1},c)}),[u,c,o,l]);"string"===typeof r&&(r=v(r));let{pathname:f="/",search:g="",hash:m="",state:p=null,key:y="default"}=r,b=i.useMemo(()=>{let e=N(f,u);return null==e?null:{location:{pathname:e,search:g,hash:m,state:p,key:y},navigationType:a}},[u,f,g,m,p,y,a]);return null==b?null:i.createElement(Z.Provider,{value:d},i.createElement(ee.Provider,{children:n,value:b}))}function ke(e){let{children:t,location:n}=e;return ce(we(t),n)}new Promise(()=>{});i.Component;function we(e,t){void 0===t&&(t=[]);let n=[];return i.Children.forEach(e,(e,r)=>{if(!i.isValidElement(e))return;let s=[...t,r];if(e.type===i.Fragment)return void n.push.apply(n,we(e.props.children,s));e.type!==Te&&h(!1),e.props.index&&e.props.children&&h(!1);let a={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=we(e.props.children,s)),n.push(a)}),n}function Le(){return Le=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Le.apply(this,arguments)}function Ae(e,t){if(null==e)return{};var n,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}function Re(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(e=>[n,e]):[[n,r]])},[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Ie=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(cf){}new Map;const _e=a.startTransition;c.flushSync,a.useId;function De(e){let{basename:t,children:n,future:r,window:s}=e,a=i.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:s,v5Compat:!0})&&(o={}),y(function(e,t){let{pathname:n,search:r,hash:s}=e.location;return m("",{pathname:n,search:r,hash:s},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:p(t)},null,o)));let l=a.current,[c,u]=i.useState({action:l.action,location:l.location}),{v7_startTransition:d}=r||{},h=i.useCallback(e=>{d&&_e?_e(()=>u(e)):u(e)},[u,d]);return i.useLayoutEffect(()=>l.listen(h),[l,h]),i.useEffect(()=>Se(r),[r]),i.createElement(xe,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:l,future:r})}const Pe="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Oe=i.forwardRef(function(e,t){let n,{onClick:r,relative:s,reloadDocument:a,replace:o,state:l,target:c,to:u,preventScrollReset:d,viewTransition:f}=e,g=Ae(e,Ie),{basename:m}=i.useContext(Z),v=!1;if("string"===typeof u&&Ce.test(u)&&(n=u,Pe))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),n=N(t.pathname,m);t.origin===e.origin&&null!=n?u=n+t.search+t.hash:v=!0}catch(cf){}let y=function(e,t){let{relative:n}=void 0===t?{}:t;re()||h(!1);let{basename:r,navigator:s}=i.useContext(Z),{hash:a,pathname:o,search:l}=le(e,{relative:n}),c=o;return"/"!==r&&(c="/"===o?r:H([r,o])),s.createHref({pathname:c,search:l,hash:a})}(u,{relative:s}),b=function(e,t){let{target:n,replace:r,state:s,preventScrollReset:a,relative:o,viewTransition:l}=void 0===t?{}:t,c=ae(),u=se(),d=le(e,{relative:o});return i.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:p(u)===p(d);c(e,{replace:n,state:s,preventScrollReset:a,relative:o,viewTransition:l})}},[u,c,d,r,s,n,e,a,o,l])}(u,{replace:o,state:l,target:c,preventScrollReset:d,relative:s,viewTransition:f});return i.createElement("a",Le({},g,{href:n||y,onClick:v||a?r:function(e){r&&r(e),e.defaultPrevented||b(e)},ref:t,target:c}))});var Ne,Me;function Fe(e){let t=i.useRef(Re(e)),n=i.useRef(!1),r=se(),s=i.useMemo(()=>function(e,t){let n=Re(e);return t&&t.forEach((e,r)=>{n.has(r)||t.getAll(r).forEach(e=>{n.append(r,e)})}),n}(r.search,n.current?null:t.current),[r.search]),a=ae(),o=i.useCallback((e,t)=>{const r=Re("function"===typeof e?e(s):e);n.current=!0,a("?"+r,t)},[a,s]);return[s,o]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ne||(Ne={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Me||(Me={}));var Ue=n(579);const Be=()=>{const{isDarkMode:e,toggleTheme:t,colors:n}=rf(),[r,s]=(0,i.useState)(!1),[a,o]=(0,i.useState)(!0),[l,c]=(0,i.useState)(""),[u,d]=(0,i.useState)(null),[h,f]=(0,i.useState)(!1),g=ae();(0,i.useEffect)(()=>{const e=()=>{const e=JSON.parse(localStorage.getItem("currentUser")||"null");d(e)};return e(),window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);const m=()=>{localStorage.removeItem("currentUser"),d(null),f(!1),g("/login")},p=e=>{e.preventDefault(),l.trim()&&(g("/?search=".concat(encodeURIComponent(l))),o(!1),c(""))};return(0,Ue.jsxs)("nav",{className:"fixed w-full z-50 ".concat(n.bg," ").concat(n.text," shadow-lg"),children:[(0,Ue.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Ue.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,Ue.jsxs)(Oe,{to:"/",className:"flex items-center space-x-2",children:[(0,Ue.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-red-600 to-orange-500 rounded-lg flex items-center justify-center",children:(0,Ue.jsx)("span",{className:"text-2xl font-bold text-white",children:"K"})}),(0,Ue.jsx)("span",{className:"text-xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent",children:"KHOPADI"})]}),(0,Ue.jsxs)("div",{className:"hidden md:flex items-center space-x-8",children:[(0,Ue.jsx)(Oe,{to:"/",className:"hover:text-red-500 transition-colors",children:"Home"}),(0,Ue.jsx)(Oe,{to:"/movies",className:"hover:text-red-500 transition-colors",children:"Movies"}),(0,Ue.jsx)(Oe,{to:"/tv-shows",className:"hover:text-red-500 transition-colors",children:"TV Shows"}),(0,Ue.jsx)(Oe,{to:"/anime",className:"hover:text-red-500 transition-colors",children:"Anime"}),(0,Ue.jsx)(Oe,{to:"/upcoming",className:"hover:text-red-500 transition-colors",children:"Upcoming"})]}),(0,Ue.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Ue.jsx)("button",{onClick:()=>o(!a),className:"p-2 rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Search",children:(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Ue.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,Ue.jsx)("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Toggle theme",children:e?(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ue.jsx)("path",{d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"})}):(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ue.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}),(0,Ue.jsxs)("div",{className:"hidden md:block relative",children:[(0,Ue.jsx)("button",{onClick:()=>f(!h),className:"w-10 h-10 rounded-full bg-gray-700 hover:bg-gray-600 flex items-center justify-center transition-colors",children:u?(0,Ue.jsx)("span",{className:"text-lg font-bold text-white",children:u.username.charAt(0).toUpperCase()}):(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ue.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),h&&(0,Ue.jsx)("div",{className:"absolute right-0 mt-2 w-56 bg-gray-800 rounded-lg shadow-xl py-2 border border-gray-700",children:u?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsxs)("div",{className:"px-4 py-3 border-b border-gray-700",children:[(0,Ue.jsx)("p",{className:"text-sm font-semibold text-white",children:u.username}),(0,Ue.jsx)("p",{className:"text-xs text-gray-400",children:"Guest"===u.username?"Guest User":"Registered User"})]}),(0,Ue.jsx)(Oe,{to:"/profile",onClick:()=>f(!1),className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 transition-colors",children:"\ud83d\udc64 My Profile"}),(0,Ue.jsx)("button",{onClick:m,className:"block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700 transition-colors",children:"\ud83d\udeaa Logout"})]}):(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)(Oe,{to:"/login",onClick:()=>f(!1),className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 transition-colors",children:"\ud83d\udd11 Login"}),(0,Ue.jsx)(Oe,{to:"/register",onClick:()=>f(!1),className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 transition-colors",children:"\u2728 Create Account"}),(0,Ue.jsx)("div",{className:"border-t border-gray-700 my-2"}),(0,Ue.jsx)("button",{onClick:()=>{const e={username:"Guest",loginTime:(new Date).toISOString()};localStorage.setItem("currentUser",JSON.stringify(e)),d(e),f(!1)},className:"block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 transition-colors",children:"\ud83d\udc64 Continue as Guest"})]})})]}),(0,Ue.jsx)("button",{onClick:()=>s(!r),className:"md:hidden p-2 rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Toggle menu",children:r?(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Ue.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Ue.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]}),a&&(0,Ue.jsxs)("div",{className:"pb-4 animate-slide-down",children:[(0,Ue.jsxs)("form",{onSubmit:p,className:"flex gap-2",children:[(0,Ue.jsx)("input",{type:"text",placeholder:"Search movies, TV shows, anime...",value:l,onChange:e=>c(e.target.value),className:"flex-1 px-4 py-2 bg-gray-800 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-500",autoFocus:!0}),(0,Ue.jsx)("button",{type:"submit",className:"px-6 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors",children:"\ud83d\udd0d Search"})]}),(0,Ue.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:["one piece","jujutsu kaisen","attack on titan","demon slayer","naruto"].map(e=>(0,Ue.jsx)("button",{onClick:()=>c(e),className:"px-3 py-1 bg-gray-700 rounded-full text-sm hover:bg-gray-600 transition-colors",children:e},e))})]})]}),r&&(0,Ue.jsx)("div",{className:"md:hidden",children:(0,Ue.jsxs)("div",{className:"px-2 pt-2 pb-3 space-y-1 bg-gray-800",children:[(0,Ue.jsx)(Oe,{to:"/",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>s(!1),children:"Home"}),(0,Ue.jsx)(Oe,{to:"/movies",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>s(!1),children:"Movies"}),(0,Ue.jsx)(Oe,{to:"/tv-shows",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>s(!1),children:"TV Shows"}),(0,Ue.jsx)(Oe,{to:"/anime",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>s(!1),children:"Anime"}),(0,Ue.jsx)(Oe,{to:"/upcoming",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>s(!1),children:"Upcoming"}),(0,Ue.jsx)("form",{onSubmit:p,className:"px-3 py-2",children:(0,Ue.jsx)("input",{type:"text",placeholder:"Search...",value:l,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-500"})}),(0,Ue.jsx)("div",{className:"border-t border-gray-700 mt-2 pt-2",children:u?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsxs)("div",{className:"px-3 py-2 text-sm",children:[(0,Ue.jsx)("p",{className:"font-semibold text-white",children:u.username}),(0,Ue.jsx)("p",{className:"text-xs text-gray-400",children:"Guest"===u.username?"Guest User":"Registered User"})]}),(0,Ue.jsx)(Oe,{to:"/profile",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>s(!1),children:"\ud83d\udc64 Profile"}),(0,Ue.jsx)("button",{onClick:()=>{m(),s(!1)},className:"w-full text-left px-3 py-2 rounded-md text-red-400 hover:bg-gray-700",children:"\ud83d\udeaa Logout"})]}):(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)(Oe,{to:"/login",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>s(!1),children:"\ud83d\udd11 Login"}),(0,Ue.jsx)(Oe,{to:"/register",className:"block px-3 py-2 rounded-md hover:bg-gray-700",onClick:()=>s(!1),children:"\u2728 Register"}),(0,Ue.jsx)("button",{onClick:()=>{const e={username:"Guest",loginTime:(new Date).toISOString()};localStorage.setItem("currentUser",JSON.stringify(e)),d(e),s(!1)},className:"w-full text-left px-3 py-2 rounded-md hover:bg-gray-700",children:"\ud83d\udc64 Guest"})]})})]})})]})};function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ge(e){var t=function(e,t){if("object"!=je(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==je(t)?t:t+""}function Ke(e,t,n){return(t=Ge(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(Object(n),!0).forEach(function(t){Ke(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ze(e,t){return function(){return e.apply(t,arguments)}}const{toString:We}=Object.prototype,{getPrototypeOf:Ye}=Object,{iterator:qe,toStringTag:Qe}=Symbol,Xe=($e=Object.create(null),e=>{const t=We.call(e);return $e[t]||($e[t]=t.slice(8,-1).toLowerCase())});var $e;const Je=e=>(e=e.toLowerCase(),t=>Xe(t)===e),Ze=e=>t=>typeof t===e,{isArray:et}=Array,tt=Ze("undefined");function nt(e){return null!==e&&!tt(e)&&null!==e.constructor&&!tt(e.constructor)&&it(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const rt=Je("ArrayBuffer");const st=Ze("string"),it=Ze("function"),at=Ze("number"),ot=e=>null!==e&&"object"===typeof e,lt=e=>{if("object"!==Xe(e))return!1;const t=Ye(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Qe in e)&&!(qe in e)},ct=Je("Date"),ut=Je("File"),dt=Je("Blob"),ht=Je("FileList"),ft=Je("URLSearchParams"),[gt,mt,pt,vt]=["ReadableStream","Request","Response","Headers"].map(Je);function yt(e,t){let n,r,{allOwnKeys:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),et(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{if(nt(e))return;const r=s?Object.getOwnPropertyNames(e):Object.keys(e),i=r.length;let a;for(n=0;n<i;n++)a=r[n],t.call(null,e[a],a,e)}}function bt(e,t){if(nt(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r,s=n.length;for(;s-- >0;)if(r=n[s],t===r.toLowerCase())return r;return null}const Et="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,St=e=>!tt(e)&&e!==Et;const Tt=(xt="undefined"!==typeof Uint8Array&&Ye(Uint8Array),e=>xt&&e instanceof xt);var xt;const kt=Je("HTMLFormElement"),wt=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),Lt=Je("RegExp"),At=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};yt(n,(n,s)=>{let i;!1!==(i=t(n,s,e))&&(r[s]=i||n)}),Object.defineProperties(e,r)};const Rt=Je("AsyncFunction"),It=((e,t)=>{return e?setImmediate:t?(n="axios@".concat(Math.random()),r=[],Et.addEventListener("message",e=>{let{source:t,data:s}=e;t===Et&&s===n&&r.length&&r.shift()()},!1),e=>{r.push(e),Et.postMessage(n,"*")}):e=>setTimeout(e);var n,r})("function"===typeof setImmediate,it(Et.postMessage)),_t="undefined"!==typeof queueMicrotask?queueMicrotask.bind(Et):"undefined"!==typeof process&&process.nextTick||It,Dt={isArray:et,isArrayBuffer:rt,isBuffer:nt,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||it(e.append)&&("formdata"===(t=Xe(e))||"object"===t&&it(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&rt(e.buffer),t},isString:st,isNumber:at,isBoolean:e=>!0===e||!1===e,isObject:ot,isPlainObject:lt,isEmptyObject:e=>{if(!ot(e)||nt(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(cf){return!1}},isReadableStream:gt,isRequest:mt,isResponse:pt,isHeaders:vt,isUndefined:tt,isDate:ct,isFile:ut,isBlob:dt,isRegExp:Lt,isFunction:it,isStream:e=>ot(e)&&it(e.pipe),isURLSearchParams:ft,isTypedArray:Tt,isFileList:ht,forEach:yt,merge:function e(){const{caseless:t,skipUndefined:n}=St(this)&&this||{},r={},s=(s,i)=>{const a=t&&bt(r,i)||i;lt(r[a])&&lt(s)?r[a]=e(r[a],s):lt(s)?r[a]=e({},s):et(s)?r[a]=s.slice():n&&tt(s)||(r[a]=s)};for(let i=0,a=arguments.length;i<a;i++)arguments[i]&&yt(arguments[i],s);return r},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return yt(t,(t,r)=>{n&&it(t)?e[r]=ze(t,n):e[r]=t},{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let s,i,a;const o={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),i=s.length;i-- >0;)a=s[i],r&&!r(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==n&&Ye(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Xe,kindOfTest:Je,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(et(e))return e;let t=e.length;if(!at(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[qe]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:kt,hasOwnProperty:wt,hasOwnProp:wt,reduceDescriptors:At,freezeMethods:e=>{At(e,(t,n)=>{if(it(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];it(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return et(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:bt,global:Et,isContextDefined:St,isSpecCompliantForm:function(e){return!!(e&&it(e.append)&&"FormData"===e[Qe]&&e[qe])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(ot(e)){if(t.indexOf(e)>=0)return;if(nt(e))return e;if(!("toJSON"in e)){t[r]=e;const s=et(e)?[]:{};return yt(e,(e,t)=>{const i=n(e,r+1);!tt(i)&&(s[t]=i)}),t[r]=void 0,s}}return e};return n(e,0)},isAsyncFn:Rt,isThenable:e=>e&&(ot(e)||it(e))&&it(e.then)&&it(e.catch),setImmediate:It,asap:_t,isIterable:e=>null!=e&&it(e[qe])};function Pt(e,t,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}Dt.inherits(Pt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Dt.toJSONObject(this.config),code:this.code,status:this.status}}});const Ct=Pt.prototype,Ot={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Ot[e]={value:e}}),Object.defineProperties(Pt,Ot),Object.defineProperty(Ct,"isAxiosError",{value:!0}),Pt.from=(e,t,n,r,s,i)=>{const a=Object.create(Ct);Dt.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const o=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return Pt.call(a,o,l,n,r,s),e&&null==a.cause&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",i&&Object.assign(a,i),a};const Nt=Pt;function Mt(e){return Dt.isPlainObject(e)||Dt.isArray(e)}function Ft(e){return Dt.endsWith(e,"[]")?e.slice(0,-2):e}function Ut(e,t,n){return e?e.concat(t).map(function(e,t){return e=Ft(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const Bt=Dt.toFlatObject(Dt,{},null,function(e){return/^is[A-Z]/.test(e)});const jt=function(e,t,n){if(!Dt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Dt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Dt.isUndefined(t[e])})).metaTokens,s=n.visitor||c,i=n.dots,a=n.indexes,o=(n.Blob||"undefined"!==typeof Blob&&Blob)&&Dt.isSpecCompliantForm(t);if(!Dt.isFunction(s))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Dt.isDate(e))return e.toISOString();if(Dt.isBoolean(e))return e.toString();if(!o&&Dt.isBlob(e))throw new Nt("Blob is not supported. Use a Buffer instead.");return Dt.isArrayBuffer(e)||Dt.isTypedArray(e)?o&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,s){let o=e;if(e&&!s&&"object"===typeof e)if(Dt.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(Dt.isArray(e)&&function(e){return Dt.isArray(e)&&!e.some(Mt)}(e)||(Dt.isFileList(e)||Dt.endsWith(n,"[]"))&&(o=Dt.toArray(e)))return n=Ft(n),o.forEach(function(e,r){!Dt.isUndefined(e)&&null!==e&&t.append(!0===a?Ut([n],r,i):null===a?n:n+"[]",l(e))}),!1;return!!Mt(e)||(t.append(Ut(s,n,i),l(e)),!1)}const u=[],d=Object.assign(Bt,{defaultVisitor:c,convertValue:l,isVisitable:Mt});if(!Dt.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!Dt.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),Dt.forEach(n,function(n,i){!0===(!(Dt.isUndefined(n)||null===n)&&s.call(t,n,Dt.isString(i)?i.trim():i,r,d))&&e(n,r?r.concat(i):[i])}),u.pop()}}(e),t};function Gt(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Kt(e,t){this._pairs=[],e&&jt(e,this,t)}const Ht=Kt.prototype;Ht.append=function(e,t){this._pairs.push([e,t])},Ht.toString=function(e){const t=e?function(t){return e.call(this,t,Gt)}:Gt;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const Vt=Kt;function zt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Wt(e,t,n){if(!t)return e;const r=n&&n.encode||zt;Dt.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let i;if(i=s?s(t,n):Dt.isURLSearchParams(t)?t.toString():new Vt(t,n).toString(r),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}const Yt=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Dt.forEach(this.handlers,function(t){null!==t&&e(t)})}},qt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qt={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Vt,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Xt="undefined"!==typeof window&&"undefined"!==typeof document,$t="object"===typeof navigator&&navigator||void 0,Jt=Xt&&(!$t||["ReactNative","NativeScript","NS"].indexOf($t.product)<0),Zt="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,en=Xt&&window.location.href||"http://localhost",tn=Ve(Ve({},r),Qt);const nn=function(e){function t(e,n,r,s){let i=e[s++];if("__proto__"===i)return!0;const a=Number.isFinite(+i),o=s>=e.length;if(i=!i&&Dt.isArray(r)?r.length:i,o)return Dt.hasOwnProp(r,i)?r[i]=[r[i],n]:r[i]=n,!a;r[i]&&Dt.isObject(r[i])||(r[i]=[]);return t(e,n,r[i],s)&&Dt.isArray(r[i])&&(r[i]=function(e){const t={},n=Object.keys(e);let r;const s=n.length;let i;for(r=0;r<s;r++)i=n[r],t[i]=e[i];return t}(r[i])),!a}if(Dt.isFormData(e)&&Dt.isFunction(e.entries)){const n={};return Dt.forEachEntry(e,(e,r)=>{t(function(e){return Dt.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null};const rn={transitional:qt,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,s=Dt.isObject(e);s&&Dt.isHTMLForm(e)&&(e=new FormData(e));if(Dt.isFormData(e))return r?JSON.stringify(nn(e)):e;if(Dt.isArrayBuffer(e)||Dt.isBuffer(e)||Dt.isStream(e)||Dt.isFile(e)||Dt.isBlob(e)||Dt.isReadableStream(e))return e;if(Dt.isArrayBufferView(e))return e.buffer;if(Dt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return jt(e,new tn.classes.URLSearchParams,Ve({visitor:function(e,t,n,r){return tn.isNode&&Dt.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=Dt.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return jt(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),function(e,t,n){if(Dt.isString(e))try{return(t||JSON.parse)(e),Dt.trim(e)}catch(cf){if("SyntaxError"!==cf.name)throw cf}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||rn.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(Dt.isResponse(e)||Dt.isReadableStream(e))return e;if(e&&Dt.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(cf){if(n){if("SyntaxError"===cf.name)throw Nt.from(cf,Nt.ERR_BAD_RESPONSE,this,null,this.response);throw cf}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:tn.classes.FormData,Blob:tn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Dt.forEach(["delete","get","head","post","put","patch"],e=>{rn.headers[e]={}});const sn=rn,an=Dt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),on=Symbol("internals");function ln(e){return e&&String(e).trim().toLowerCase()}function cn(e){return!1===e||null==e?e:Dt.isArray(e)?e.map(cn):String(e)}function un(e,t,n,r,s){return Dt.isFunction(r)?r.call(this,t,n):(s&&(t=n),Dt.isString(t)?Dt.isString(r)?-1!==t.indexOf(r):Dt.isRegExp(r)?r.test(t):void 0:void 0)}class dn{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function s(e,t,n){const s=ln(t);if(!s)throw new Error("header name must be a non-empty string");const i=Dt.findKey(r,s);(!i||void 0===r[i]||!0===n||void 0===n&&!1!==r[i])&&(r[i||t]=cn(e))}const i=(e,t)=>Dt.forEach(e,(e,n)=>s(e,n,t));if(Dt.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(Dt.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))i((e=>{const t={};let n,r,s;return e&&e.split("\n").forEach(function(e){s=e.indexOf(":"),n=e.substring(0,s).trim().toLowerCase(),r=e.substring(s+1).trim(),!n||t[n]&&an[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(Dt.isObject(e)&&Dt.isIterable(e)){let n,r,s={};for(const t of e){if(!Dt.isArray(t))throw TypeError("Object iterator must return a key-value pair");s[r=t[0]]=(n=s[r])?Dt.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}i(s,t)}else null!=e&&s(t,e,n);return this}get(e,t){if(e=ln(e)){const n=Dt.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(Dt.isFunction(t))return t.call(this,e,n);if(Dt.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ln(e)){const n=Dt.findKey(this,e);return!(!n||void 0===this[n]||t&&!un(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function s(e){if(e=ln(e)){const s=Dt.findKey(n,e);!s||t&&!un(0,n[s],s,t)||(delete n[s],r=!0)}}return Dt.isArray(e)?e.forEach(s):s(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const s=t[n];e&&!un(0,this[s],s,e,!0)||(delete this[s],r=!0)}return r}normalize(e){const t=this,n={};return Dt.forEach(this,(r,s)=>{const i=Dt.findKey(n,s);if(i)return t[i]=cn(r),void delete t[s];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(s):String(s).trim();a!==s&&delete t[s],t[a]=cn(r),n[a]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return Dt.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&Dt.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[on]=this[on]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=ln(e);t[r]||(!function(e,t){const n=Dt.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,s){return this[r].call(this,t,e,n,s)},configurable:!0})})}(n,e),t[r]=!0)}return Dt.isArray(e)?e.forEach(r):r(e),this}}dn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Dt.reduceDescriptors(dn.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}}),Dt.freezeMethods(dn);const hn=dn;function fn(e,t){const n=this||sn,r=t||n,s=hn.from(r.headers);let i=r.data;return Dt.forEach(e,function(e){i=e.call(n,i,s.normalize(),t?t.status:void 0)}),s.normalize(),i}function gn(e){return!(!e||!e.__CANCEL__)}function mn(e,t,n){Nt.call(this,null==e?"canceled":e,Nt.ERR_CANCELED,t,n),this.name="CanceledError"}Dt.inherits(mn,Nt,{__CANCEL__:!0});const pn=mn;function vn(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Nt("Request failed with status code "+n.status,[Nt.ERR_BAD_REQUEST,Nt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const yn=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let s,i=0,a=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),c=r[a];s||(s=l),n[i]=o,r[i]=l;let u=a,d=0;for(;u!==i;)d+=n[u++],u%=e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),l-s<t)return;const h=c&&l-c;return h?Math.round(1e3*d/h):void 0}};const bn=function(e,t){let n,r,s=0,i=1e3/t;const a=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();s=i,n=null,r&&(clearTimeout(r),r=null),e(...t)};return[function(){const e=Date.now(),t=e-s;for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];t>=i?a(l,e):(n=l,r||(r=setTimeout(()=>{r=null,a(n)},i-t)))},()=>n&&a(n)]},En=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const s=yn(50,250);return bn(n=>{const i=n.loaded,a=n.lengthComputable?n.total:void 0,o=i-r,l=s(o);r=i;e({loaded:i,total:a,progress:a?i/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&i<=a?(a-i)/l:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})},n)},Sn=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Tn=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Dt.asap(()=>e(...n))},xn=tn.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,tn.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(tn.origin),tn.navigator&&/(msie|trident)/i.test(tn.navigator.userAgent)):()=>!0,kn=tn.hasStandardBrowserEnv?{write(e,t,n,r,s,i,a){if("undefined"===typeof document)return;const o=["".concat(e,"=").concat(encodeURIComponent(t))];Dt.isNumber(n)&&o.push("expires=".concat(new Date(n).toUTCString())),Dt.isString(r)&&o.push("path=".concat(r)),Dt.isString(s)&&o.push("domain=".concat(s)),!0===i&&o.push("secure"),Dt.isString(a)&&o.push("SameSite=".concat(a)),document.cookie=o.join("; ")},read(e){if("undefined"===typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function wn(e,t,n){let r=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Ln=e=>e instanceof hn?Ve({},e):e;function An(e,t){t=t||{};const n={};function r(e,t,n,r){return Dt.isPlainObject(e)&&Dt.isPlainObject(t)?Dt.merge.call({caseless:r},e,t):Dt.isPlainObject(t)?Dt.merge({},t):Dt.isArray(t)?t.slice():t}function s(e,t,n,s){return Dt.isUndefined(t)?Dt.isUndefined(e)?void 0:r(void 0,e,0,s):r(e,t,0,s)}function i(e,t){if(!Dt.isUndefined(t))return r(void 0,t)}function a(e,t){return Dt.isUndefined(t)?Dt.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function o(n,s,i){return i in t?r(n,s):i in e?r(void 0,n):void 0}const l={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,n)=>s(Ln(e),Ln(t),0,!0)};return Dt.forEach(Object.keys(Ve(Ve({},e),t)),function(r){const i=l[r]||s,a=i(e[r],t[r],r);Dt.isUndefined(a)&&i!==o||(n[r]=a)}),n}const Rn=e=>{const t=An({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:a,auth:o}=t;if(t.headers=a=hn.from(a),t.url=Wt(wn(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),Dt.isFormData(n))if(tn.hasStandardBrowserEnv||tn.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(Dt.isFunction(n.getHeaders)){const e=n.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(e=>{let[n,r]=e;t.includes(n.toLowerCase())&&a.set(n,r)})}if(tn.hasStandardBrowserEnv&&(r&&Dt.isFunction(r)&&(r=r(t)),r||!1!==r&&xn(t.url))){const e=s&&i&&kn.read(i);e&&a.set(s,e)}return t},In="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const r=Rn(e);let s=r.data;const i=hn.from(r.headers).normalize();let a,o,l,c,u,{responseType:d,onUploadProgress:h,onDownloadProgress:f}=r;function g(){c&&c(),u&&u(),r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let m=new XMLHttpRequest;function p(){if(!m)return;const r=hn.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());vn(function(e){t(e),g()},function(e){n(e),g()},{data:d&&"text"!==d&&"json"!==d?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:r,config:e,request:m}),m=null}m.open(r.method.toUpperCase(),r.url,!0),m.timeout=r.timeout,"onloadend"in m?m.onloadend=p:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(p)},m.onabort=function(){m&&(n(new Nt("Request aborted",Nt.ECONNABORTED,e,m)),m=null)},m.onerror=function(t){const r=t&&t.message?t.message:"Network Error",s=new Nt(r,Nt.ERR_NETWORK,e,m);s.event=t||null,n(s),m=null},m.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const s=r.transitional||qt;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new Nt(t,s.clarifyTimeoutError?Nt.ETIMEDOUT:Nt.ECONNABORTED,e,m)),m=null},void 0===s&&i.setContentType(null),"setRequestHeader"in m&&Dt.forEach(i.toJSON(),function(e,t){m.setRequestHeader(t,e)}),Dt.isUndefined(r.withCredentials)||(m.withCredentials=!!r.withCredentials),d&&"json"!==d&&(m.responseType=r.responseType),f&&([l,u]=En(f,!0),m.addEventListener("progress",l)),h&&m.upload&&([o,c]=En(h),m.upload.addEventListener("progress",o),m.upload.addEventListener("loadend",c)),(r.cancelToken||r.signal)&&(a=t=>{m&&(n(!t||t.type?new pn(null,e,m):t),m.abort(),m=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);v&&-1===tn.protocols.indexOf(v)?n(new Nt("Unsupported protocol "+v+":",Nt.ERR_BAD_REQUEST,e)):m.send(s||null)})},_n=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const s=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;r.abort(t instanceof Nt?t:new pn(t instanceof Error?t.message:t))}};let i=t&&setTimeout(()=>{i=null,s(new Nt("timeout ".concat(t," of ms exceeded"),Nt.ETIMEDOUT))},t);const a=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(s):e.removeEventListener("abort",s)}),e=null)};e.forEach(e=>e.addEventListener("abort",s));const{signal:o}=r;return o.unsubscribe=()=>Dt.asap(a),o}};function Dn(e,t){this.v=e,this.k=t}function Pn(e){return function(){return new Cn(e.apply(this,arguments))}}function Cn(e){var t,n;function r(t,n){try{var i=e[t](n),a=i.value,o=a instanceof Dn;Promise.resolve(o?a.v:a).then(function(n){if(o){var l="return"===t?"return":"next";if(!a.k||n.done)return r(l,n);n=e[l](n).value}s(i.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){s("throw",e)}}function s(e,s){switch(e){case"return":t.resolve({value:s,done:!0});break;case"throw":t.reject(s);break;default:t.resolve({value:s,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,s){return new Promise(function(i,a){var o={key:e,arg:s,resolve:i,reject:a,next:null};n?n=n.next=o:(t=n=o,r(e,s))})},"function"!=typeof e.return&&(this.return=void 0)}function On(e){return new Dn(e,0)}function Nn(e){var t={},n=!1;function r(t,r){return n=!0,r=new Promise(function(n){n(e[t](r))}),{done:!1,value:new Dn(r,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}function Mn(e){var t,n,r,s=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);s--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new Fn(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Fn(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Fn=function(e){this.s=e,this.n=e.next},Fn.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Fn(e)}Cn.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Cn.prototype.next=function(e){return this._invoke("next",e)},Cn.prototype.throw=function(e){return this._invoke("throw",e)},Cn.prototype.return=function(e){return this._invoke("return",e)};const Un=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,s=0;for(;s<n;)r=s+t,yield e.slice(s,r),s=r},Bn=function(){var e=Pn(function*(e,t){var n,r=!1,s=!1;try{for(var i,a=Mn(jn(e));r=!(i=yield On(a.next())).done;r=!1){const e=i.value;yield*Nn(Mn(Un(e,t)))}}catch(o){s=!0,n=o}finally{try{r&&null!=a.return&&(yield On(a.return()))}finally{if(s)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),jn=function(){var e=Pn(function*(e){if(e[Symbol.asyncIterator])return void(yield*Nn(Mn(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield On(t.read());if(e)break;yield n}}finally{yield On(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),Gn=(e,t,n,r)=>{const s=Bn(e,t);let i,a=0,o=e=>{i||(i=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await s.next();if(t)return o(),void e.close();let i=r.byteLength;if(n){let e=a+=i;n(e)}e.enqueue(new Uint8Array(r))}catch(t){throw o(t),t}},cancel:e=>(o(e),s.return())},{highWaterMark:2})},{isFunction:Kn}=Dt,Hn=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(Dt.global),{ReadableStream:Vn,TextEncoder:zn}=Dt.global,Wn=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(cf){return!1}},Yn=e=>{e=Dt.merge.call({skipUndefined:!0},Hn,e);const{fetch:t,Request:n,Response:r}=e,s=t?Kn(t):"function"===typeof fetch,i=Kn(n),a=Kn(r);if(!s)return!1;const o=s&&Kn(Vn),l=s&&("function"===typeof zn?(c=new zn,e=>c.encode(e)):async e=>new Uint8Array(await new n(e).arrayBuffer()));var c;const u=i&&o&&Wn(()=>{let e=!1;const t=new n(tn.origin,{body:new Vn,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),d=a&&o&&Wn(()=>Dt.isReadableStream(new r("").body)),h={stream:d&&(e=>e.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!h[e]&&(h[e]=(t,n)=>{let r=t&&t[e];if(r)return r.call(t);throw new Nt("Response type '".concat(e,"' is not supported"),Nt.ERR_NOT_SUPPORT,n)})});const f=async(e,t)=>{const r=Dt.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(Dt.isBlob(e))return e.size;if(Dt.isSpecCompliantForm(e)){const t=new n(tn.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Dt.isArrayBufferView(e)||Dt.isArrayBuffer(e)?e.byteLength:(Dt.isURLSearchParams(e)&&(e+=""),Dt.isString(e)?(await l(e)).byteLength:void 0)})(t):r};return async e=>{let{url:s,method:a,data:o,signal:l,cancelToken:c,timeout:g,onDownloadProgress:m,onUploadProgress:p,responseType:v,headers:y,withCredentials:b="same-origin",fetchOptions:E}=Rn(e),S=t||fetch;v=v?(v+"").toLowerCase():"text";let T=_n([l,c&&c.toAbortSignal()],g),x=null;const k=T&&T.unsubscribe&&(()=>{T.unsubscribe()});let w;try{if(p&&u&&"get"!==a&&"head"!==a&&0!==(w=await f(y,o))){let e,t=new n(s,{method:"POST",body:o,duplex:"half"});if(Dt.isFormData(o)&&(e=t.headers.get("content-type"))&&y.setContentType(e),t.body){const[e,n]=Sn(w,En(Tn(p)));o=Gn(t.body,65536,e,n)}}Dt.isString(b)||(b=b?"include":"omit");const t=i&&"credentials"in n.prototype,l=Ve(Ve({},E),{},{signal:T,method:a.toUpperCase(),headers:y.normalize().toJSON(),body:o,duplex:"half",credentials:t?b:void 0});x=i&&new n(s,l);let c=await(i?S(x,E):S(s,l));const g=d&&("stream"===v||"response"===v);if(d&&(m||g&&k)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=c[t]});const t=Dt.toFiniteNumber(c.headers.get("content-length")),[n,s]=m&&Sn(t,En(Tn(m),!0))||[];c=new r(Gn(c.body,65536,n,()=>{s&&s(),k&&k()}),e)}v=v||"text";let L=await h[Dt.findKey(h,v)||"text"](c,e);return!g&&k&&k(),await new Promise((t,n)=>{vn(t,n,{data:L,headers:hn.from(c.headers),status:c.status,statusText:c.statusText,config:e,request:x})})}catch(L){if(k&&k(),L&&"TypeError"===L.name&&/Load failed|fetch/i.test(L.message))throw Object.assign(new Nt("Network Error",Nt.ERR_NETWORK,e,x),{cause:L.cause||L});throw Nt.from(L,L&&L.code,e,x)}}},qn=new Map,Qn=e=>{let t=e&&e.env||{};const{fetch:n,Request:r,Response:s}=t,i=[r,s,n];let a,o,l=i.length,c=qn;for(;l--;)a=i[l],o=c.get(a),void 0===o&&c.set(a,o=l?new Map:Yn(t)),c=o;return o},Xn=(Qn(),{http:null,xhr:In,fetch:{get:Qn}});Dt.forEach(Xn,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(cf){}Object.defineProperty(e,"adapterName",{value:t})}});const $n=e=>"- ".concat(e),Jn=e=>Dt.isFunction(e)||null===e||!1===e;const Zn={getAdapter:function(e,t){e=Dt.isArray(e)?e:[e];const{length:n}=e;let r,s;const i={};for(let a=0;a<n;a++){let n;if(r=e[a],s=r,!Jn(r)&&(s=Xn[(n=String(r)).toLowerCase()],void 0===s))throw new Nt("Unknown adapter '".concat(n,"'"));if(s&&(Dt.isFunction(s)||(s=s.get(t))))break;i[n||"#"+a]=s}if(!s){const e=Object.entries(i).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});let t=n?e.length>1?"since :\n"+e.map($n).join("\n"):" "+$n(e[0]):"as no adapter specified";throw new Nt("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return s},adapters:Xn};function er(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new pn(null,e)}function tr(e){er(e),e.headers=hn.from(e.headers),e.data=fn.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Zn.getAdapter(e.adapter||sn.adapter,e)(e).then(function(t){return er(e),t.data=fn.call(e,e.transformResponse,t),t.headers=hn.from(t.headers),t},function(t){return gn(t)||(er(e),t&&t.response&&(t.response.data=fn.call(e,e.transformResponse,t.response),t.response.headers=hn.from(t.response.headers))),Promise.reject(t)})}const nr="1.13.2",rr={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{rr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const sr={};rr.transitional=function(e,t,n){function r(e,t){return"[Axios v"+nr+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,s,i)=>{if(!1===e)throw new Nt(r(s," has been removed"+(t?" in "+t:"")),Nt.ERR_DEPRECATED);return t&&!sr[s]&&(sr[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,s,i)}},rr.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const ir={assertOptions:function(e,t,n){if("object"!==typeof e)throw new Nt("options must be an object",Nt.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let s=r.length;for(;s-- >0;){const i=r[s],a=t[i];if(a){const t=e[i],n=void 0===t||a(t,i,e);if(!0!==n)throw new Nt("option "+i+" must be "+n,Nt.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new Nt("Unknown option "+i,Nt.ERR_BAD_OPTION)}},validators:rr},ar=ir.validators;class or{constructor(e){this.defaults=e||{},this.interceptors={request:new Yt,response:new Yt}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(cf){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=An(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:s}=t;void 0!==n&&ir.assertOptions(n,{silentJSONParsing:ar.transitional(ar.boolean),forcedJSONParsing:ar.transitional(ar.boolean),clarifyTimeoutError:ar.transitional(ar.boolean)},!1),null!=r&&(Dt.isFunction(r)?t.paramsSerializer={serialize:r}:ir.assertOptions(r,{encode:ar.function,serialize:ar.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ir.assertOptions(t,{baseUrl:ar.spelling("baseURL"),withXsrfToken:ar.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=s&&Dt.merge(s.common,s[t.method]);s&&Dt.forEach(["delete","get","head","post","put","patch","common"],e=>{delete s[e]}),t.headers=hn.concat(i,s);const a=[];let o=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let u,d=0;if(!o){const e=[tr.bind(this),void 0];for(e.unshift(...a),e.push(...l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=a.length;let h=t;for(;d<u;){const e=a[d++],t=a[d++];try{h=e(h)}catch(f){t.call(this,f);break}}try{c=tr.call(this,h)}catch(f){return Promise.reject(f)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return Wt(wn((e=An(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}Dt.forEach(["delete","get","head","options"],function(e){or.prototype[e]=function(t,n){return this.request(An(n||{},{method:e,url:t,data:(n||{}).data}))}}),Dt.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,s){return this.request(An(s||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}or.prototype[e]=t(),or.prototype[e+"Form"]=t(!0)});const lr=or;class cr{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,s){n.reason||(n.reason=new pn(e,r,s),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new cr(function(t){e=t}),cancel:e}}}const ur=cr;const dr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(dr).forEach(e=>{let[t,n]=e;dr[n]=t});const hr=dr;const fr=function e(t){const n=new lr(t),r=ze(lr.prototype.request,n);return Dt.extend(r,lr.prototype,n,{allOwnKeys:!0}),Dt.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(An(t,n))},r}(sn);fr.Axios=lr,fr.CanceledError=pn,fr.CancelToken=ur,fr.isCancel=gn,fr.VERSION=nr,fr.toFormData=jt,fr.AxiosError=Nt,fr.Cancel=fr.CanceledError,fr.all=function(e){return Promise.all(e)},fr.spread=function(e){return function(t){return e.apply(null,t)}},fr.isAxiosError=function(e){return Dt.isObject(e)&&!0===e.isAxiosError},fr.mergeConfig=An,fr.AxiosHeaders=hn,fr.formToJSON=e=>nn(Dt.isHTMLForm(e)?new FormData(e):e),fr.getAdapter=Zn.getAdapter,fr.HttpStatusCode=hr,fr.default=fr;const gr=fr,mr=["https://hianime-api2.vercel.app"];let pr=0;const vr=()=>mr,yr=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(let r=0;r<mr.length;r++)try{const n="".concat(mr[(pr+r)%mr.length],"/api/v1").concat(e),s=await gr.get(n,{params:t,timeout:1e4});if(s.data.success)return pr=(pr+r)%mr.length,s.data.data}catch(n){if(console.error("Server ".concat(r+1," failed:"),n.message),r===mr.length-1)throw new Error("All anime servers are down")}},br={home:async()=>{try{return await yr("/home")}catch(e){return console.error("HiAnime home error:",e),null}},search:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{return await yr("/search",{keyword:e,page:t})}catch(n){return console.error("HiAnime search error:",n),{animes:[],pageInfo:{}}}},details:async e=>{try{return await yr("/anime/".concat(e))}catch(t){return console.error("HiAnime details error:",t),null}},episodes:async e=>{try{return await yr("/episodes/".concat(e))}catch(t){return console.error("HiAnime episodes error:",t),{episodes:[]}}},servers:async e=>{try{return await yr("/servers",{id:e})}catch(t){return console.error("HiAnime servers error:",t),{sub:[],dub:[]}}},stream:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hd-1",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sub";try{return await yr("/stream",{id:e,server:t,type:n})}catch(r){return console.error("HiAnime stream error:",r),null}},topAiring:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return await yr("/animes/top-airing",{page:e})}catch(t){return console.error("HiAnime top airing error:",t),{animes:[],pageInfo:{}}}},popular:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return await yr("/animes/most-popular",{page:e})}catch(t){return console.error("HiAnime popular error:",t),{animes:[],pageInfo:{}}}},recentEpisodes:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return await yr("/animes/recently-updated",{page:e})}catch(t){return console.error("HiAnime recent error:",t),{animes:[],pageInfo:{}}}},genres:async()=>{try{return await yr("/genres")}catch(e){return console.error("HiAnime genres error:",e),[]}},filter:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{return await yr("/filter",Ve(Ve({},e),{},{page:t}))}catch(n){return console.error("HiAnime filter error:",n),{animes:[],pageInfo:{}}}},random:async()=>{try{const e=await yr("/random");return(null===e||void 0===e?void 0:e.id)||null}catch(e){return console.error("HiAnime random error:",e),null}},schedule:async e=>{try{return await yr("/schedules",e?{date:e}:{})}catch(t){return console.error("HiAnime schedule error:",t),{}}}},Er="https://anime-api-one-murex.vercel.app",Sr={search:async e=>{try{return(await gr.get("".concat(Er,"/search"),{params:{query:e}})).data||[]}catch(t){return console.error("ShashankAnime search error:",t),[]}},getEpisodes:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sub";try{return(await gr.get("".concat(Er,"/episodes/").concat(e),{params:{mode:t}})).data||{mode:t,episodes:[]}}catch(n){return console.error("ShashankAnime episodes error:",n),{mode:t,episodes:[]}}},getEpisodeUrl:async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"best",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"sub";try{return(await gr.get("".concat(Er,"/episode_url"),{params:{show_id:e,ep_no:t,quality:n,mode:r}})).data||{episode_url:null,mode:r}}catch(s){return console.error("ShashankAnime episode URL error:",s),{episode_url:null,mode:r}}},getBothVersions:async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"best";try{const[r,s]=await Promise.all([Sr.getEpisodeUrl(e,t,n,"sub"),Sr.getEpisodeUrl(e,t,n,"dub")]);return{sub:r.episode_url,dub:s.episode_url,hasSubOnly:!!r.episode_url&&!s.episode_url,hasDubOnly:!r.episode_url&&!!s.episode_url,hasBoth:!!r.episode_url&&!!s.episode_url}}catch(r){return console.error("ShashankAnime both versions error:",r),{sub:null,dub:null,hasSubOnly:!1,hasDubOnly:!1,hasBoth:!1}}},checkAvailability:e=>({hasSub:e.episodes_sub>0,hasDub:e.episodes_dub>0,subCount:e.episodes_sub||0,dubCount:e.episodes_dub||0,isComplete:e.episodes_sub>0&&e.episodes_dub>0,dubInProgress:e.episodes_sub>e.episodes_dub&&e.episodes_dub>0})},Tr="b97bbe91d4e62db2ae1eea9d5bf2f2aa",xr="https://api.themoviedb.org/3",kr="https://api.tvmaze.com",wr="https://api.breakingbadquotes.xyz/v1/quotes",Lr="https://movie-quote-api.herokuapp.com/v1/quote",Ar=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"w500";return e?e.startsWith("http")?e:"".concat("https://image.tmdb.org/t/p","/").concat(t).concat(e):"/placeholder-movie.jpg"},Rr={trending:async()=>{try{return(await gr.get("".concat(xr,"/trending/movie/week"),{params:{api_key:Tr}})).data.results}catch(e){return console.error("TMDB trending error:",e),[]}},movies:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return(await gr.get("".concat(xr,"/movie/popular"),{params:{api_key:Tr,page:e}})).data}catch(t){return console.error("TMDB movies error:",t),{results:[],total_pages:0}}},tvShows:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return(await gr.get("".concat(xr,"/tv/popular"),{params:{api_key:Tr,page:e}})).data}catch(t){return console.error("TMDB TV error:",t),{results:[],total_pages:0}}},anime:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return(await gr.get("".concat(xr,"/discover/tv"),{params:{api_key:Tr,with_genres:"16",with_keywords:"210024|287501",page:e}})).data}catch(t){return console.error("TMDB anime error:",t),{results:[],total_pages:0}}},upcoming:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{return(await gr.get("".concat(xr,"/movie/upcoming"),{params:{api_key:Tr,page:e}})).data}catch(t){return console.error("TMDB upcoming error:",t),{results:[],total_pages:0}}},search:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{return(await gr.get("".concat(xr,"/search/multi"),{params:{api_key:Tr,query:e,page:t}})).data}catch(n){return console.error("TMDB search error:",n),{results:[],total_pages:0}}},details:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"movie";try{return(await gr.get("".concat(xr,"/").concat(t,"/").concat(e),{params:{api_key:Tr,append_to_response:"videos,credits,similar"}})).data}catch(n){return console.error("TMDB details error:",n),null}}},Ir={search:async e=>{try{return(await gr.get("".concat(kr,"/search/shows"),{params:{q:e}})).data.map(e=>{var t,n;return{id:e.show.id,name:e.show.name,image:(null===(t=e.show.image)||void 0===t?void 0:t.medium)||"/placeholder-movie.jpg",summary:e.show.summary,rating:(null===(n=e.show.rating)||void 0===n?void 0:n.average)||"N/A",genres:e.show.genres}})}catch(t){return console.error("TVMaze search error:",t),[]}},schedule:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"US";try{return(await gr.get("".concat(kr,"/schedule"),{params:{country:e,date:(new Date).toISOString().split("T")[0]}})).data.slice(0,20)}catch(t){return console.error("TVMaze schedule error:",t),[]}}},_r={search:async e=>{try{const t=await gr.get("https://www.omdbapi.com",{params:{apikey:"3c0368f7",s:e,type:"movie"}});return"True"===t.data.Response?t.data.Search.map(e=>({id:e.imdbID,title:e.Title,poster:"N/A"!==e.Poster?e.Poster:"/placeholder-movie.jpg",year:e.Year})):[]}catch(t){return console.error("OMDb search error:",t),[]}}},Dr={random:async()=>{try{return(await gr.get(Lr)).data}catch(e){return console.error("Quotes error:",e),{quote:"The greatest glory in living lies not in never falling, but in rising every time we fall.",role:"Nelson Mandela"}}},breakingBad:async()=>{try{return(await gr.get(wr)).data[0]}catch(e){return null}}},Pr={search:async e=>{try{const[t,n]=await Promise.all([br.search(e,1).catch(()=>({animes:[]})),Sr.search(e).catch(()=>[])]);return{hianime:t.animes||[],shashank:n,combined:[...t.animes.map(e=>Ve(Ve({},e),{},{source:"hianime"})),...n.map(e=>Ve(Ve({},e),{},{source:"shashank"}))]}}catch(t){return console.error("Anime search error:",t),{hianime:[],shashank:[],combined:[]}}},getAnime:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hianime";try{if("shashank"===t){const[t,n]=await Promise.all([Sr.getEpisodes(e,"sub"),Sr.getEpisodes(e,"dub")]);return{id:e,subEpisodes:t.episodes,dubEpisodes:n.episodes,source:"shashank"}}return Ve(Ve({},await br.info(e)),{},{source:"hianime"})}catch(n){return console.error("Get anime error:",n),null}}},Cr=async e=>{try{const t=await Rr.search(e);if(t.results&&t.results.length>0)return{source:"TMDB",data:t.results,type:"mixed"};const n=await Pr.search(e);if(n.combined.length>0)return{source:"Anime (Dual)",data:n.combined.map(e=>Ve(Ve({},e),{},{media_type:"anime",poster_path:e.poster||e.image,name:e.title||e.name})),type:"anime"};const r=await _r.search(e);if(r.length>0)return{source:"OMDb",data:r,type:"movies"};const s=await Ir.search(e);return s.length>0?{source:"TVMaze",data:s,type:"tv"}:{source:"none",data:[],type:"none"}}catch(t){return console.error("Smart search error:",t),{source:"error",data:[],type:"error"}}},Or=e=>{let{movie:t,type:n="movie"}=e;const r=t.title||t.name||"Untitled",s=t.release_date||t.first_air_date||"",i=s?new Date(s).getFullYear():"N/A",a=t.vote_average?t.vote_average.toFixed(1):"N/A",o=t.poster_path||t.poster||t.Poster,l=o&&"N/A"!==o?o.startsWith("http")?o:Ar(o,"w300"):"/placeholder-movie.jpg";return(0,Ue.jsxs)(Oe,{to:"anime"===t.media_type||"anime"===n?"/anime/watch/".concat(t.id||t.imdbID):"/".concat(n,"/").concat(t.id||t.imdbID),className:"group relative block overflow-hidden rounded-lg bg-gray-800 transition-transform duration-300 hover:scale-105 hover:shadow-2xl",children:[(0,Ue.jsx)("div",{className:"aspect-[2/3] overflow-hidden",children:(0,Ue.jsx)("img",{src:l,alt:r,className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-110",loading:"lazy",onError:e=>{e.target.src="/placeholder-movie.jpg"}})}),(0,Ue.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100",children:(0,Ue.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[(0,Ue.jsx)("h3",{className:"mb-1 text-sm font-semibold text-white line-clamp-2",children:r}),(0,Ue.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-300",children:[(0,Ue.jsxs)("span",{children:["\ud83d\udcc5 ",i]}),"N/A"!==a&&(0,Ue.jsxs)("span",{className:"flex items-center gap-1",children:["\u2b50 ",a]})]})]})}),(0,Ue.jsx)("div",{className:"absolute right-2 top-2 rounded bg-red-600 px-2 py-1 text-xs font-bold text-white",children:"anime"===t.media_type||"anime"===n?"\u2728 ANIME":"tv"===n||"tv"===t.media_type?"\ud83d\udcfa TV":"\ud83c\udfac MOVIE"}),"N/A"!==a&&(0,Ue.jsxs)("div",{className:"absolute left-2 top-2 rounded bg-black/70 px-2 py-1 text-xs font-bold text-white backdrop-blur-sm",children:["\u2b50 ",a]})]})},Nr=()=>{const[e]=Fe(),t=e.get("search"),[n,r]=(0,i.useState)([]),[s,a]=(0,i.useState)([]),[o,l]=(0,i.useState)(t||""),[c,u]=(0,i.useState)(null),[d,h]=(0,i.useState)(!0),[f,g]=(0,i.useState)(!1);(0,i.useEffect)(()=>{m()},[]),(0,i.useEffect)(()=>{t&&(l(t),p(t))},[t]);const m=async()=>{h(!0);const[e,t]=await Promise.all([Rr.trending(),Dr.random()]);r(e),u(t),h(!1)},p=async e=>{if(!e.trim())return void a([]);g(!0);const t=await Cr(e);a(t.data||[]),g(!1)},v=s.length>0?s:n,y=s.length>0?'Search Results for "'.concat(o,'"'):"\ud83d\udd25 Trending This Week";return(0,Ue.jsxs)("div",{className:"min-h-screen pt-20 pb-10",children:[(0,Ue.jsx)("div",{className:"relative h-96 bg-gradient-to-r from-red-900 via-gray-900 to-black",children:(0,Ue.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-4 text-center sm:p-6",children:[(0,Ue.jsxs)("h1",{className:"mb-4 text-4xl font-bold text-white sm:text-5xl md:text-6xl",children:["Welcome to ",(0,Ue.jsx)("span",{className:"bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent",children:"Khopadi Movies"})]}),(0,Ue.jsx)("p",{className:"mb-2 text-lg text-gray-300 sm:text-xl",children:"Discover millions of movies, TV shows and anime"}),c&&(0,Ue.jsxs)("div",{className:"mb-6 max-w-2xl",children:[(0,Ue.jsxs)("p",{className:"text-sm italic text-gray-400",children:['"',c.quote,'"']}),(0,Ue.jsxs)("p",{className:"text-xs text-red-400",children:["- ",c.role]})]}),(0,Ue.jsx)("form",{onSubmit:async e=>{e.preventDefault(),p(o)},className:"w-full max-w-2xl",children:(0,Ue.jsxs)("div",{className:"flex gap-2",children:[(0,Ue.jsx)("input",{type:"text",placeholder:"Search for movies, TV shows, anime...",value:o,onChange:e=>l(e.target.value),className:"flex-1 rounded-lg bg-white/10 px-4 py-3 text-white placeholder-gray-400 backdrop-blur-md focus:outline-none focus:ring-2 focus:ring-red-500 sm:px-6 sm:py-4"}),(0,Ue.jsxs)("button",{type:"submit",disabled:f,className:"rounded-lg bg-red-600 px-6 py-3 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50 sm:px-8 sm:py-4",children:["\ud83d\udd0d",(0,Ue.jsx)("span",{className:"hidden sm:inline",children:f?" Searching...":" Search"})]})]})})]})}),(0,Ue.jsxs)("div",{className:"container mx-auto px-4 py-10",children:[(0,Ue.jsxs)("div",{className:"mb-6 flex flex-col items-center justify-between sm:flex-row",children:[(0,Ue.jsx)("h2",{className:"text-2xl font-bold sm:text-3xl",children:y}),s.length>0&&(0,Ue.jsx)("button",{onClick:()=>{a([]),l(""),window.history.pushState({},"","/")},className:"mt-2 text-red-500 hover:text-red-400 sm:mt-0",children:"\u2716 Clear Search"})]}),d?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-4 sm:gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(12)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):v.length>0?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-4 sm:gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:v.map(e=>(0,Ue.jsx)(Or,{movie:e,type:e.media_type||"movie"},e.id))}):(0,Ue.jsxs)("div",{className:"py-20 text-center",children:[(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No results found"}),(0,Ue.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Try a different search term"})]})]})]})},Mr=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(!0),[s,a]=(0,i.useState)(1),[o,l]=(0,i.useState)(1);(0,i.useEffect)(()=>{c()},[s]);const c=async()=>{r(!0);const e=await Rr.movies(s);t(e.results||[]),l(e.total_pages||1),r(!1),window.scrollTo({top:0,behavior:"smooth"})};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4",children:[(0,Ue.jsxs)("div",{className:"mb-8",children:[(0,Ue.jsx)("h1",{className:"mb-2 text-4xl font-bold",children:"\ud83c\udfac Popular Movies"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Discover the most popular movies of all time"})]}),n?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(18)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):e.length>0?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:e.map(e=>(0,Ue.jsx)(Or,{movie:e,type:"movie"},e.id))}),(0,Ue.jsxs)("div",{className:"mt-10 flex items-center justify-center gap-4",children:[(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.max(1,e-1)),disabled:1===s,className:"rounded-lg bg-gray-800 px-6 py-2 font-semibold text-white transition-colors hover:bg-gray-700 disabled:opacity-50",children:"\u2190 Previous"}),(0,Ue.jsxs)("span",{className:"text-lg",children:["Page ",s," of ",Math.min(o,500)]}),(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.min(500,e+1)),disabled:s>=o||s>=500,className:"rounded-lg bg-red-600 px-6 py-2 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50",children:"Next \u2192"})]})]}):(0,Ue.jsx)("div",{className:"py-20 text-center",children:(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No movies found"})})]})})},Fr=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(!0),[s,a]=(0,i.useState)(1),[o,l]=(0,i.useState)(1);(0,i.useEffect)(()=>{c()},[s]);const c=async()=>{r(!0);const e=await Rr.tvShows(s);t(e.results||[]),l(e.total_pages||1),r(!1),window.scrollTo({top:0,behavior:"smooth"})};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4",children:[(0,Ue.jsxs)("div",{className:"mb-8",children:[(0,Ue.jsx)("h1",{className:"mb-2 text-4xl font-bold",children:"\ud83d\udcfa Popular TV Shows"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Binge-watch the best TV series"})]}),n?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(18)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):e.length>0?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:e.map(e=>(0,Ue.jsx)(Or,{movie:e,type:"tv"},e.id))}),(0,Ue.jsxs)("div",{className:"mt-10 flex items-center justify-center gap-4",children:[(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.max(1,e-1)),disabled:1===s,className:"rounded-lg bg-gray-800 px-6 py-2 font-semibold text-white transition-colors hover:bg-gray-700 disabled:opacity-50",children:"\u2190 Previous"}),(0,Ue.jsxs)("span",{className:"text-lg",children:["Page ",s," of ",Math.min(o,500)]}),(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.min(500,e+1)),disabled:s>=o||s>=500,className:"rounded-lg bg-red-600 px-6 py-2 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50",children:"Next \u2192"})]})]}):(0,Ue.jsx)("div",{className:"py-20 text-center",children:(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No TV shows found"})})]})})},Ur=e=>{var t,n;let{anime:r}=e;const s=r.title||r.name||"Untitled",i=r.poster||"/placeholder-movie.jpg",a=r.type||"TV",o=(null===(t=r.episodes)||void 0===t?void 0:t.sub)||(null===(n=r.episodes)||void 0===n?void 0:n.eps)||0;r.duration;return(0,Ue.jsxs)(Oe,{to:"/anime/watch/".concat(r.id),className:"group relative block overflow-hidden rounded-lg bg-gray-800 transition-transform duration-300 hover:scale-105 hover:shadow-2xl",children:[(0,Ue.jsx)("div",{className:"aspect-[2/3] overflow-hidden",children:(0,Ue.jsx)("img",{src:i,alt:s,className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-110",loading:"lazy",onError:e=>{e.target.src="/placeholder-movie.jpg"}})}),(0,Ue.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100",children:(0,Ue.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[(0,Ue.jsx)("h3",{className:"mb-1 text-sm font-semibold text-white line-clamp-2",children:s}),(0,Ue.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-300",children:[(0,Ue.jsxs)("span",{children:["\ud83c\udfa5 ",a]}),o>0&&(0,Ue.jsxs)("span",{children:["\ud83d\udcfa ",o," eps"]})]})]})}),(0,Ue.jsx)("div",{className:"absolute right-2 top-2 rounded bg-red-600 px-2 py-1 text-xs font-bold text-white",children:a}),o>0&&(0,Ue.jsxs)("div",{className:"absolute left-2 top-2 rounded bg-black/70 px-2 py-1 text-xs font-bold text-white backdrop-blur-sm",children:["\ud83d\udcfa ",o]})]})},Br=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(!0),[s,a]=(0,i.useState)(1),[o,l]=(0,i.useState)(1),[c,u]=(0,i.useState)("top-airing");(0,i.useEffect)(()=>{d()},[s,c]);const d=async()=>{var e;let n;switch(r(!0),c){case"top-airing":default:n=await br.topAiring(s);break;case"popular":n=await br.popular(s);break;case"recent":n=await br.recentEpisodes(s)}t(n.animes||[]),l((null===(e=n.pageInfo)||void 0===e?void 0:e.totalPages)||1),r(!1),window.scrollTo({top:0,behavior:"smooth"})};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4",children:[(0,Ue.jsxs)("div",{className:"mb-8",children:[(0,Ue.jsx)("h1",{className:"mb-4 text-4xl font-bold",children:"\u2728 Anime Hub"}),(0,Ue.jsx)("p",{className:"mb-4 text-gray-400",children:"Watch the best anime with multiple servers and subtitles"}),(0,Ue.jsx)("div",{className:"flex flex-wrap gap-3",children:[{value:"top-airing",label:"\ud83d\udd25 Top Airing",emoji:"\ud83d\udd25"},{value:"popular",label:"\u2b50 Most Popular",emoji:"\u2b50"},{value:"recent",label:"\ud83c\udd95 Recent Episodes",emoji:"\ud83c\udd95"}].map(e=>(0,Ue.jsxs)("button",{onClick:()=>{u(e.value),a(1)},className:"px-6 py-3 rounded-lg font-semibold transition-all ".concat(c===e.value?"bg-red-600 text-white scale-105":"bg-gray-800 text-gray-300 hover:bg-gray-700"),children:[e.emoji," ",e.label]},e.value))})]}),n?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(18)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):e.length>0?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:e.map(e=>(0,Ue.jsx)(Ur,{anime:e},e.id))}),(0,Ue.jsxs)("div",{className:"mt-10 flex items-center justify-center gap-4",children:[(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.max(1,e-1)),disabled:1===s,className:"rounded-lg bg-gray-800 px-6 py-2 font-semibold text-white transition-colors hover:bg-gray-700 disabled:opacity-50",children:"\u2190 Previous"}),(0,Ue.jsxs)("span",{className:"text-lg",children:["Page ",s," of ",Math.min(o,100)]}),(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.min(100,e+1)),disabled:s>=o||s>=100,className:"rounded-lg bg-red-600 px-6 py-2 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50",children:"Next \u2192"})]})]}):(0,Ue.jsx)("div",{className:"py-20 text-center",children:(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No anime found"})})]})})},jr=()=>{const[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(!0),[s,a]=(0,i.useState)(1),[o,l]=(0,i.useState)(1);(0,i.useEffect)(()=>{c()},[s]);const c=async()=>{r(!0);const e=await Rr.upcoming(s);t(e.results||[]),l(e.total_pages||1),r(!1),window.scrollTo({top:0,behavior:"smooth"})};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4",children:[(0,Ue.jsxs)("div",{className:"mb-8",children:[(0,Ue.jsx)("h1",{className:"mb-2 text-4xl font-bold",children:"\ud83c\udfac Upcoming Movies"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Coming soon to theaters near you"})]}),n?(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:[...Array(18)].map((e,t)=>(0,Ue.jsx)("div",{className:"aspect-[2/3] animate-pulse rounded-lg bg-gray-800"},t))}):e.length>0?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)("div",{className:"grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:e.map(e=>(0,Ue.jsx)(Or,{movie:e,type:"movie"},e.id))}),(0,Ue.jsxs)("div",{className:"mt-10 flex items-center justify-center gap-4",children:[(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.max(1,e-1)),disabled:1===s,className:"rounded-lg bg-gray-800 px-6 py-2 font-semibold text-white transition-colors hover:bg-gray-700 disabled:opacity-50",children:"\u2190 Previous"}),(0,Ue.jsxs)("span",{className:"text-lg",children:["Page ",s," of ",Math.min(o,500)]}),(0,Ue.jsx)("button",{onClick:()=>a(e=>Math.min(500,e+1)),disabled:s>=o||s>=500,className:"rounded-lg bg-red-600 px-6 py-2 font-semibold text-white transition-colors hover:bg-red-700 disabled:opacity-50",children:"Next \u2192"})]})]}):(0,Ue.jsx)("div",{className:"py-20 text-center",children:(0,Ue.jsx)("p",{className:"text-xl text-gray-400",children:"\ud83d\udea8 No upcoming movies found"})})]})})},Gr=()=>{var e,t,n,r,s,a;const{id:o}=oe(),l=se(),{colors:c}=rf(),[u,d]=(0,i.useState)(null),[h,f]=(0,i.useState)(!0),[g,m]=(0,i.useState)(!1),p=l.pathname.includes("/tv/")?"tv":"movie";(0,i.useEffect)(()=>{v(),window.scrollTo(0,0)},[o]);const v=async()=>{try{f(!0);const e=await Rr.details(o,p);d(e)}catch(e){console.error("Error fetching movie details:",e)}finally{f(!1)}};if(h)return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20",children:(0,Ue.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-600"})});if(!u)return null;const y=null===(e=u.videos)||void 0===e||null===(t=e.results)||void 0===t?void 0:t.find(e=>"Trailer"===e.type&&"YouTube"===e.site),b=u.title||u.name;return(0,Ue.jsxs)("div",{className:"pt-16",children:[(0,Ue.jsxs)("div",{className:"relative h-[80vh]",children:[(0,Ue.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-black/80 to-transparent z-10"}),(0,Ue.jsx)("img",{src:Ar(u.backdrop_path,"original"),alt:b,className:"w-full h-full object-cover"}),(0,Ue.jsx)("div",{className:"absolute inset-0 z-20 flex items-center",children:(0,Ue.jsx)("div",{className:"container mx-auto px-6",children:(0,Ue.jsxs)("div",{className:"max-w-4xl",children:[(0,Ue.jsx)("h1",{className:"text-5xl md:text-7xl font-bold mb-4",children:b}),(0,Ue.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,Ue.jsxs)("span",{className:"bg-yellow-500 text-black px-3 py-1 rounded font-bold text-lg",children:["\u2b50 ",(null===(n=u.vote_average)||void 0===n?void 0:n.toFixed(1))||"N/A"]}),(0,Ue.jsx)("span",{className:"text-gray-300",children:u.release_date?new Date(u.release_date).getFullYear():u.first_air_date?new Date(u.first_air_date).getFullYear():"N/A"}),u.runtime&&(0,Ue.jsxs)("span",{className:"text-gray-300",children:[u.runtime," min"]}),u.number_of_seasons&&(0,Ue.jsxs)("span",{className:"text-gray-300",children:[u.number_of_seasons," Seasons"]}),(0,Ue.jsx)("span",{className:"text-gray-300",children:(null===(r=u.genres)||void 0===r?void 0:r.map(e=>e.name).join(", "))||"N/A"})]}),(0,Ue.jsx)("p",{className:"text-lg md:text-xl mb-8 text-gray-300 leading-relaxed",children:u.overview||"No description available"}),(0,Ue.jsxs)("div",{className:"flex space-x-4",children:[(0,Ue.jsxs)(Oe,{to:"/watch/".concat(p,"/").concat(o),className:"bg-red-600 hover:bg-red-700 text-white px-8 py-3 rounded-lg font-semibold flex items-center space-x-2 transition-colors",children:[(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ue.jsx)("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})}),(0,Ue.jsx)("span",{children:"\u25b6 Watch Now"})]}),y&&(0,Ue.jsxs)("button",{onClick:()=>m(!0),className:"bg-gray-800 hover:bg-gray-700 text-white px-8 py-3 rounded-lg font-semibold flex items-center space-x-2 transition-colors",children:[(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ue.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})}),(0,Ue.jsx)("span",{children:"\ud83c\udfa5 Trailer"})]}),(0,Ue.jsx)("button",{className:"bg-gray-800 hover:bg-gray-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors",children:"\u2795 Watchlist"})]})]})})})]}),g&&y&&(0,Ue.jsx)("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>m(!1),children:(0,Ue.jsxs)("div",{className:"relative w-full max-w-6xl aspect-video",onClick:e=>e.stopPropagation(),children:[(0,Ue.jsx)("button",{onClick:()=>m(!1),className:"absolute -top-12 right-0 text-white hover:text-red-500 text-4xl",children:"\xd7"}),(0,Ue.jsx)("iframe",{src:"https://www.youtube.com/embed/".concat(y.key,"?autoplay=1"),className:"w-full h-full rounded-lg",allowFullScreen:!0,allow:"autoplay"})]})}),(0,Ue.jsxs)("div",{className:"container mx-auto px-6 py-12",children:[(null===(s=u.credits)||void 0===s?void 0:s.cast)&&u.credits.cast.length>0&&(0,Ue.jsxs)("div",{className:"mb-12",children:[(0,Ue.jsx)("h2",{className:"text-3xl font-bold mb-6",children:"\ud83c\udfad Cast"}),(0,Ue.jsx)("div",{className:"flex overflow-x-auto space-x-6 pb-4 scrollbar-hide",children:u.credits.cast.slice(0,10).map(e=>(0,Ue.jsxs)("div",{className:"flex-shrink-0 w-32",children:[(0,Ue.jsx)("img",{src:e.profile_path?Ar(e.profile_path,"w185"):"/placeholder-movie.jpg",alt:e.name,className:"w-32 h-48 object-cover rounded-lg mb-2",onError:e=>e.target.src="/placeholder-movie.jpg"}),(0,Ue.jsx)("p",{className:"font-semibold text-sm",children:e.name}),(0,Ue.jsx)("p",{className:"text-xs text-gray-400",children:e.character})]},e.id))})]}),(null===(a=u.similar)||void 0===a?void 0:a.results)&&u.similar.results.length>0&&(0,Ue.jsxs)("div",{children:[(0,Ue.jsxs)("h2",{className:"text-3xl font-bold mb-6",children:["\ud83c\udfac Similar ","tv"===p?"Shows":"Movies"]}),(0,Ue.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6",children:u.similar.results.slice(0,12).map(e=>{var t;return(0,Ue.jsx)(Oe,{to:"/".concat(p,"/").concat(e.id),className:"group cursor-pointer",children:(0,Ue.jsxs)("div",{className:"relative overflow-hidden rounded-lg shadow-lg transition-transform group-hover:scale-105",children:[(0,Ue.jsx)("img",{src:Ar(e.poster_path,"w342"),alt:e.title||e.name,className:"w-full h-auto",onError:e=>e.target.src="/placeholder-movie.jpg"}),(0,Ue.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-4",children:(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("h3",{className:"font-semibold text-sm line-clamp-2",children:e.title||e.name}),(0,Ue.jsxs)("p",{className:"text-yellow-500 text-xs mt-1",children:["\u2b50 ",(null===(t=e.vote_average)||void 0===t?void 0:t.toFixed(1))||"N/A"]})]})})]})},e.id)})})]})]})]})},Kr=()=>{var e,t,n;const{id:r,type:s}=oe(),a=ae(),[o,l]=(0,i.useState)(null),[c,u]=(0,i.useState)(!0),[d,h]=(0,i.useState)(0),f=[{name:"2embed",url:(e,t)=>"https://2embed.cc/embed".concat("tv"===t?"/tv":"","/").concat(e)},{name:"Vidsrc",url:(e,t)=>"https://vidsrc.me/embed/".concat("tv"===t?"tv":"movie","?tmdb=").concat(e)},{name:"Vidsrc.vip",url:(e,t)=>"https://vidsrc.vip/embed/".concat("tv"===t?"tv":"movie","?tmdb=").concat(e)}];if((0,i.useEffect)(()=>{(async()=>{try{u(!0);const e=await Rr.details(r,s||"movie");l(e)}catch(e){console.error("Error fetching details:",e)}finally{u(!1)}})()},[r,s]),c)return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20 bg-gray-900",children:(0,Ue.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-600"})});if(!o)return null;const g=s||"movie",m=f[d].url(r,g);return(0,Ue.jsx)("div",{className:"min-h-screen pt-16 bg-gray-900 text-white",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,Ue.jsxs)("button",{onClick:()=>a(-1),className:"mb-4 flex items-center space-x-2 text-gray-400 hover:text-white transition-colors",children:[(0,Ue.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Ue.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,Ue.jsx)("span",{children:"Back"})]}),(0,Ue.jsx)("div",{className:"relative bg-black rounded-lg overflow-hidden mb-6 shadow-2xl",children:(0,Ue.jsx)("div",{className:"aspect-video",children:(0,Ue.jsx)("iframe",{src:m,className:"w-full h-full",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",title:o.title||o.name})})}),(0,Ue.jsx)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:(0,Ue.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[(0,Ue.jsx)("div",{className:"flex-shrink-0 mx-auto md:mx-0",children:(0,Ue.jsx)("img",{src:Ar(o.poster_path,"w342"),alt:o.title||o.name,className:"w-48 h-auto rounded-lg shadow-lg",onError:e=>{e.target.src="/placeholder-movie.jpg"}})}),(0,Ue.jsxs)("div",{className:"flex-1 text-center md:text-left",children:[(0,Ue.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold mb-4",children:o.title||o.name}),(0,Ue.jsxs)("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-4 mb-4",children:[(0,Ue.jsxs)("span",{className:"bg-yellow-500 text-black px-3 py-1 rounded font-bold",children:["\u2b50 ",(null===(e=o.vote_average)||void 0===e?void 0:e.toFixed(1))||"N/A"]}),(0,Ue.jsx)("span",{className:"text-gray-400",children:o.release_date?new Date(o.release_date).getFullYear():o.first_air_date?new Date(o.first_air_date).getFullYear():"N/A"}),o.runtime&&(0,Ue.jsxs)("span",{className:"text-gray-400",children:[o.runtime," min"]}),(0,Ue.jsx)("span",{className:"text-gray-400",children:(null===(t=o.genres)||void 0===t?void 0:t.map(e=>e.name).join(", "))||"N/A"})]}),(0,Ue.jsx)("p",{className:"text-gray-300 leading-relaxed mb-4",children:o.overview||"No description available"}),(null===(n=o.credits)||void 0===n?void 0:n.cast)&&o.credits.cast.length>0&&(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"\ud83c\udfad Cast"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:o.credits.cast.slice(0,5).map(e=>e.name).join(", ")})]})]})]})}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,Ue.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"\ud83c\udf10 Select Server"}),(0,Ue.jsx)("p",{className:"text-sm text-gray-400 mb-4",children:"If current server is not working, try switching to another server."}),(0,Ue.jsx)("div",{className:"flex flex-col sm:flex-row flex-wrap gap-3",children:f.map((e,t)=>(0,Ue.jsxs)("button",{onClick:()=>h(t),className:"w-full sm:w-auto px-6 py-3 rounded-lg font-semibold transition-all ".concat(d===t?"bg-red-600 text-white scale-105":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:["\ud83d\udce1 ",e.name]},t))})]}),(0,Ue.jsx)("div",{className:"bg-yellow-500/10 border border-yellow-500 rounded-lg p-4",children:(0,Ue.jsxs)("p",{className:"text-yellow-500 text-sm",children:["\u26a0\ufe0f ",(0,Ue.jsx)("strong",{children:"Note:"})," Streaming sources are third-party embedded players. If a server doesn't work, please try another one. Some content may not be available."]})})]})})},Hr=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},Vr=Number.isSafeInteger||function(e){return"number"===typeof e&&Math.abs(e)<=zr},zr=Number.MAX_SAFE_INTEGER||9007199254740991;let Wr=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),Yr=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),qr=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var Qr="manifest",Xr="level",$r="audioTrack",Jr="subtitleTrack",Zr="main",es="audio",ts="subtitle";class ns{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class rs{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ns(e),this.fast_=new ns(t),this.defaultTTFB_=r,this.ttfb_=new ns(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new ns(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new ns(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new ns(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){const n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function ss(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function is(){return is=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},is.apply(null,arguments)}function as(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function os(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?as(Object(n),!0).forEach(function(t){ss(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):as(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class ls{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n="[".concat(e,"]:");this.trace=cs,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const cs=function(){},us={trace:cs,debug:cs,log:cs,warn:cs,info:cs,error:cs};function ds(){return is({},us)}function hs(e,t,n){return t[e]?t[e].bind(t):function(e,t){const n=self.console[e];return n?n.bind(self.console,"".concat(t?"["+t+"] ":"","[").concat(e,"] >")):cs}(e,n)}const fs=ds();const gs=fs;function ms(){if("undefined"===typeof self)return;return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function ps(e,t){const n=Object.keys(e),r=Object.keys(t),s=n.length,i=r.length;return!s||!i||s===i&&!n.some(e=>-1===r.indexOf(e))}function vs(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("undefined"!==typeof TextDecoder){const n=new TextDecoder("utf-8").decode(e);if(t){const e=n.indexOf("\0");return-1!==e?n.substring(0,e):n}return n.replace(/\0/g,"")}const n=e.length;let r,s,i,a="",o=0;for(;o<n;){if(r=e[o++],0===r&&t)return a;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:s=e[o++],a+=String.fromCharCode((31&r)<<6|63&s);break;case 14:s=e[o++],i=e[o++],a+=String.fromCharCode((15&r)<<12|(63&s)<<6|63&i)}}return a}function ys(e){let t="";for(let n=0;n<e.length;n++){let r=e[n].toString(16);r.length<2&&(r="0"+r),t+=r}return t}function bs(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Es(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ss,Ts={exports:{}};var xs=function(){return Ss||(Ss=1,e=Ts,function(){var t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,i={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var s=i.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");return s.path=i.normalizePath(s.path),i.buildURLFromParts(s)}var a=i.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=i.normalizePath(a.path),i.buildURLFromParts(a)):t;var o=i.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=n.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var c={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var u=o.path,d=u.substring(0,u.lastIndexOf("/")+1)+a.path;c.path=i.normalizePath(d)}else c.path=o.path,a.params||(c.params=o.params,a.query||(c.query=o.query));return null===c.path&&(c.path=r.alwaysNormalize?i.normalizePath(a.path):a.path),i.buildURLFromParts(c)},parseURL:function(e){var n=t.exec(e);return n?{scheme:n[1]||"",netLoc:n[2]||"",path:n[3]||"",params:n[4]||"",query:n[5]||"",fragment:n[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=i}()),Ts.exports;var e}();class ks{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ws="audio",Ls="video",As="audiovideo";class Rs{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"===typeof e&&(e={url:e}),this.base=e,function(e,t){const n=Ps(e,t);n&&(n.enumerable=!0,Object.defineProperty(e,t,n))}(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;r=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[ws]:null,[Ls]:null,[As]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new ks),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=xs.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ws]=null,e[Ls]=null,e[As]=null}}function Is(e){return"initSegment"!==e.sn}class _s extends Rs{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Hr(e)&&Hr(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(null==(e=this._decryptdata)||!e.keyId){const e=Object.keys(t);if(1===e.length){const n=this._decryptdata=t[e[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=Hr(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t;const e=Object.keys(this.levelkeys),n=e.length;if(n>1||1===n&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){Hr(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return Is(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const r=t[e];!r||null!=(n=this._decryptdata)&&n.keyId||(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,n,r,s){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,s)):a[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:s,partial:i}}}class Ds extends Rs{constructor(e,t,n,r,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const i=e.enumeratedString("BYTERANGE");i&&this.setByteRange(i,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Ps(e,t){const n=Object.getPrototypeOf(e);if(n){const e=Object.getOwnPropertyDescriptor(n,t);return e||Ps(n,t)}}const Cs=Math.pow(2,32)-1,Os=[].push,Ns={video:1,audio:2,id3:3,text:4};function Ms(e){return String.fromCharCode.apply(null,e)}function Fs(e,t){const n=e[t]<<8|e[t+1];return n<0?65536+n:n}function Us(e,t){const n=js(e,t);return n<0?4294967296+n:n}function Bs(e,t){let n=Us(e,t);return n*=Math.pow(2,32),n+=Us(e,t+4),n}function js(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Gs(e,t){const n=[];if(!t.length)return n;const r=e.byteLength;for(let s=0;s<r;){const i=Us(e,s),a=i>1?s+i:r;if(Ms(e.subarray(s+4,s+8))===t[0])if(1===t.length)n.push(e.subarray(s+8,a));else{const r=Gs(e.subarray(s+8,a),t.slice(1));r.length&&Os.apply(n,r)}s=a}return n}function Ks(e){const t=[],n=e[0];let r=8;const s=Us(e,r);r+=4;let i=0,a=0;0===n?(i=Us(e,r),a=Us(e,r+4),r+=8):(i=Bs(e,r),a=Bs(e,r+8),r+=16),r+=2;let o=e.length+a;const l=Fs(e,r);r+=2;for(let c=0;c<l;c++){let n=r;const i=Us(e,n);n+=4;const a=2147483647&i;if(1===(2147483648&i)>>>31)return gs.warn("SIDX has hierarchical references (not supported)"),null;const l=Us(e,n);n+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/s,start:o,end:o+a-1}}),o+=a,n+=4,r=n}return{earliestPresentationTime:i,timescale:s,version:n,referencesCount:l,references:t}}function Hs(e){const t=[],n=Gs(e,["moov","trak"]);for(let r=0;r<n.length;r++){const e=n[r],s=Gs(e,["tkhd"])[0];if(s){let n=s[0];const r=Us(s,0===n?12:20),i=Gs(e,["mdia","mdhd"])[0];if(i){n=i[0];const s=Us(i,0===n?12:20),a=Gs(e,["mdia","hdlr"])[0];if(a){const n=Ms(a.subarray(8,12)),i={soun:ws,vide:Ls}[n],o=Vs(Gs(e,["mdia","minf","stbl","stsd"])[0]);i?(t[r]={timescale:s,type:i,stsd:o},t[i]=os({timescale:s,id:r},o)):t[r]={timescale:s,type:n,stsd:o}}}}}return Gs(e,["moov","mvex","trex"]).forEach(e=>{const n=Us(e,4),r=t[n];r&&(r.default={duration:Us(e,12),flags:Us(e,20)})}),t}function Vs(e){const t=e.subarray(8),n=t.subarray(86),r=Ms(t.subarray(4,8));let s,i=r;const a="enca"===r||"encv"===r;if(a){const e=Gs(t,[r])[0];Gs(e.subarray("enca"===r?28:78),["sinf"]).forEach(e=>{const t=Gs(e,["schm"])[0];if(t){const n=Ms(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=Gs(e,["frma"])[0];t&&(i=Ms(t))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const e=Gs(n,["avcC"])[0];e&&e.length>3&&(i+="."+Ys(e[1])+Ys(e[2])+Ys(e[3]),s=zs("avc1"===o?"dva1":"dvav",n));break}case"mp4a":{const e=Gs(t,[r])[0],n=Gs(e.subarray(28),["esds"])[0];if(n&&n.length>7){let e=4;if(3!==n[e++])break;e=Ws(n,e),e+=2;const t=n[e++];if(128&t&&(e+=2),64&t&&(e+=n[e++]),4!==n[e++])break;e=Ws(n,e);const r=n[e++];if(64!==r)break;if(i+="."+Ys(r),e+=12,5!==n[e++])break;e=Ws(n,e);const s=n[e++];let a=(248&s)>>3;31===a&&(a+=1+((7&s)<<3)+((224&n[e])>>5)),i+="."+a}break}case"hvc1":case"hev1":{const e=Gs(n,["hvcC"])[0];if(e&&e.length>12){const t=e[1],n=["","A","B","C"][t>>6],r=31&t,s=Us(e,2),a=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);i+="."+n+r,i+="."+function(e){let t=0;for(let n=0;n<32;n++)t|=(e>>n&1)<<31-n;return t>>>0}(s).toString(16).toUpperCase(),i+="."+a+o;let c="";for(let e=l.length;e--;){const t=l[e];if(t||c){c="."+t.toString(16).toUpperCase()+c}}i+=c}s=zs("hev1"==o?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":i=zs(i,n)||i;break;case"vp09":{const e=Gs(n,["vpcC"])[0];if(e&&e.length>6){const t=e[4],n=e[5],r=e[6]>>4&15;i+="."+qs(t)+"."+qs(n)+"."+qs(r)}break}case"av01":{const e=Gs(n,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,r=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,c=2===t&&o?l?12:10:o?10:8,u=(16&e[2])>>4,d=(8&e[2])>>3,h=(4&e[2])>>2,f=3&e[2],g=1,m=1,p=1,v=0;i+="."+t+"."+qs(r)+a+"."+qs(c)+"."+u+"."+d+h+f+"."+qs(g)+"."+qs(m)+"."+qs(p)+"."+v,s=zs("dav1",n)}break}}return{codec:i,encrypted:a,supplemental:s}}function zs(e,t){const n=Gs(t,["dvvC"]),r=n.length?n[0]:Gs(t,["dvcC"])[0];if(r){const t=r[2]>>1&127,n=r[2]<<5&32|r[3]>>3&31;return e+"."+qs(t)+"."+qs(n)}}function Ws(e,t){const n=t+5;for(;128&e[t++]&&t<n;);return t}function Ys(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function qs(e){return(e<10?"0":"")+e}function Qs(e,t){Gs(e,["moov","trak"]).forEach(e=>{const n=Gs(e,["mdia","minf","stbl","stsd"])[0];if(!n)return;const r=n.subarray(8);let s=Gs(r,["enca"]);const i=s.length>0;i||(s=Gs(r,["encv"])),s.forEach(e=>{Gs(i?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{const n=Xs(e);n&&t(n,i)})})})}function Xs(e){const t=Gs(e,["schm"])[0];if(t){const n=Ms(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=Gs(e,["schi","tenc"])[0];if(t)return t}}}function $s(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function Js(e,t){const n=[],r=t.samples,s=t.timescale,i=t.id;let a=!1;return Gs(r,["moof"]).map(o=>{const l=o.byteOffset-8;Gs(o,["traf"]).map(o=>{const c=Gs(o,["tfdt"]).map(e=>{const t=e[0];let n=Us(e,4);return 1===t&&(n*=Math.pow(2,32),n+=Us(e,8)),n/s})[0];return void 0!==c&&(e=c),Gs(o,["tfhd"]).map(c=>{const u=Us(c,4),d=16777215&Us(c,0);let h=0;const f=0!==(16&d);let g=0;const m=0!==(32&d);let p=8;u===i&&(0!==(1&d)&&(p+=8),0!==(2&d)&&(p+=4),0!==(8&d)&&(h=Us(c,p),p+=4),f&&(g=Us(c,p),p+=4),m&&(p+=4),"video"===t.type&&(a=Zs(t.codec)),Gs(o,["trun"]).map(i=>{const o=i[0],c=16777215&Us(i,0),u=0!==(1&c);let d=0;const f=0!==(4&c),m=0!==(256&c);let p=0;const v=0!==(512&c);let y=0;const b=0!==(1024&c),E=0!==(2048&c);let S=0;const T=Us(i,4);let x=8;u&&(d=Us(i,x),x+=4),f&&(x+=4);let k=d+l;for(let l=0;l<T;l++){if(m?(p=Us(i,x),x+=4):p=h,v?(y=Us(i,x),x+=4):y=g,b&&(x+=4),E&&(S=0===o?Us(i,x):js(i,x),x+=4),t.type===Ls){let t=0;for(;t<y;){const i=Us(r,k);if(k+=4,ei(a,r[k])){ti(r.subarray(k,k+i),a?2:1,e+S/s,n)}k+=i,t+=i+4}}e+=p/s}}))})})}),n}function Zs(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function ei(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function ti(e,t,n,r){const s=ni(e);let i=0;i+=t;let a=0,o=0,l=0;for(;i<s.length;){a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(255===l);o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(255===l);const e=s.length-i;let t=i;if(o<e)i+=o;else if(o>e){gs.error("Malformed SEI payload. ".concat(o," is too small, only ").concat(e," bytes left to parse."));break}if(4===a){if(181===s[t++]){const e=Fs(s,t);if(t+=2,49===e){const e=Us(s,t);if(t+=4,1195456820===e){const e=s[t++];if(3===e){const i=s[t++],o=64&i,l=o?2+3*(31&i):0,c=new Uint8Array(l);if(o){c[0]=i;for(let e=1;e<l;e++)c[e]=s[t++]}r.push({type:e,payloadType:a,pts:n,bytes:c})}}}}}else if(5===a&&o>16){const e=[];for(let n=0;n<16;n++){const r=s[t++].toString(16);e.push(1==r.length?"0"+r:r),3!==n&&5!==n&&7!==n&&9!==n||e.push("-")}const i=o-16,l=new Uint8Array(i);for(let n=0;n<i;n++)l[n]=s[t++];r.push({payloadType:a,pts:n,uuid:e.join(""),userData:vs(l),userDataBytes:l})}}}function ni(e){const t=e.byteLength,n=[];let r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;const s=t-n.length,i=new Uint8Array(s);let a=0;for(r=0;r<s;a++,r++)a===n[0]&&(a++,n.shift()),i[r]=e[a];return i}function ri(e,t,n){if(16!==e.byteLength)throw new RangeError("Invalid system id");let r,s,i;r=0,s=new Uint8Array,i=new Uint8Array;const a=new Uint8Array(4);return n.byteLength>0&&new DataView(a.buffer).setUint32(0,n.byteLength,!1),function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=n.length;let i=8,a=s;for(;a--;)i+=n[a].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=255&i,o.set(e,4),a=0,i=8;a<s;a++)o.set(n[a],i),i+=n[a].byteLength;return o}([112,115,115,104],new Uint8Array([0,0,0,0]),e,i,s,a,n)}function si(e){const t=e.getUint32(0),n=e.byteOffset,r=e.byteLength;if(r<t)return{offset:n,size:r};if(1886614376!==e.getUint32(4))return{offset:n,size:t};const s=e.getUint32(8)>>>24;if(0!==s&&1!==s)return{offset:n,size:t};const i=e.buffer,a=ys(new Uint8Array(i,n+12,16));let o=null,l=null,c=0;if(0===s)c=28;else{const s=e.getUint32(28);if(!s||r<32+16*s)return{offset:n,size:t};o=[];for(let e=0;e<s;e++)o.push(new Uint8Array(i,n+32+16*e,16));c=32+16*s}if(!c)return{offset:n,size:t};const u=e.getUint32(c);return t-32<u?{offset:n,size:t}:(l=new Uint8Array(i,n+c+4,u),{version:s,systemId:a,kids:o,data:l,offset:n,size:t})}const ii=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ai={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function oi(e,t){const n=ai[t];return!!n&&!!n[e.slice(0,4)]}function li(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!e.split(",").some(e=>!ci(e,t,n))}function ci(e,t){var n;const r=ms(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);return null!=(n=null==r?void 0:r.isTypeSupported(ui(e,t)))&&n}function ui(e,t){return"".concat(t,"/mp4;codecs=").concat(e)}function di(e){if(e){const t=e.substring(0,4);return ai.video[t]}return 2}function hi(e){const t=ii();return e.split(",").reduce((e,n)=>{const r=t&&Zs(n)?9:ai.video[n];return r?(2*r+e)/(e?3:2):(ai.audio[n]+e)/(e?2:1)},0)}const fi={};const gi=/flac|opus|mp4a\.40\.34/i;function mi(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(gi,e=>function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(fi[e])return fi[e];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let s=0;s<n.length;s++){var r;if(ci(n[s],"audio",t))return fi[e]=n[s],n[s];if("mp3"===n[s]&&null!=(r=ms(t))&&r.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t))}function pi(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(vi(e,"audio")||vi(e,"video")))return e;if(t){const n=t.split(",");if(n.length>1){if(e)for(let t=n.length;t--;)if(n[t].substring(0,4)===e.substring(0,4))return n[t];return n[0]}}return t||e}function vi(e,t){return oi(e,t)&&ci(e,t)}function yi(e){if(e.startsWith("av01.")){const t=e.split("."),n=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=n[e-4];return t.join(".")}return e}function bi(e){const t=ms(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ei(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Si={supported:!1,smooth:!1,powerEfficient:!1},Ti={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function xi(e,t){return{supported:!1,configurations:t,decodingInfoResults:[Si],error:e}}function ki(e,t,n,r,s,i){const a=e.videoCodec,o=e.audioCodec?e.audioGroups:null,l=null==i?void 0:i.audioCodec,c=null==i?void 0:i.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(null!=o&&o.length)try{d=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce((e,n)=>{if(n){const r=t.groups[n];if(!r)throw new Error("Audio track group ".concat(n," not found"));Object.keys(r.channels).forEach(t=>{e[t]=(e[t]||0)+r.channels[t]})}return e},{2:0})}catch(h){return!0}return void 0!==a&&(a.split(",").some(e=>Zs(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(r,30)||"SDR"!==e.videoRange&&e.videoRange!==n||e.bitrate>Math.max(s,8e6))||!!d&&Hr(u)&&Object.keys(d).some(e=>parseInt(e)>u)}function wi(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=e.videoCodec;if(!s&&!e.audioCodec||!n)return Promise.resolve(Ti);const i=[],a=function(e){var t;const n=null==(t=e.videoCodec)?void 0:t.split(","),r=Ai(e),s=e.width||640,i=e.height||480,a=e.frameRate||30,o=e.videoRange.toLowerCase();return n?n.map(e=>{const t={contentType:ui(yi(e),"video"),width:s,height:i,bitrate:r,framerate:a};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=a.length,l=function(e,t,n){var r;const s=null==(r=e.audioCodec)?void 0:r.split(","),i=Ai(e);if(s&&e.audioGroups)return e.audioGroups.reduce((e,r)=>{var a;const o=r?null==(a=t.groups[r])?void 0:a.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===r){const r=parseFloat(t.channels||"");s.forEach(t=>{const s={contentType:ui(t,"audio"),bitrate:n?Li(t,i):i};r&&(s.channels=""+r),e.push(s)})}return e},e):e},[]);return[]}(e,t,o>0),c=l.length;for(let u=o||1*c||1;u--;){const e={type:"media-source"};if(o&&(e.video=a[u%o]),c){e.audio=l[u%c];const t=e.audio.bitrate;e.video&&t&&(e.video.bitrate-=t)}i.push(e)}if(s){const e=navigator.userAgent;if(s.split(",").some(e=>Zs(e))&&ii())return Promise.resolve(xi(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(e,")")),i))}return Promise.all(i.map(e=>{const t=function(e){let t="";const{audio:n,video:r}=e;if(r){const e=Ei(r.contentType);t+="".concat(e,"_r").concat(r.height,"x").concat(r.width,"f").concat(Math.ceil(r.framerate)).concat(r.transferFunction||"sd","_").concat(Math.ceil(r.bitrate/1e5))}if(n){const e=Ei(n.contentType);t+="".concat(r?"_":"").concat(e,"_c").concat(n.channels)}return t}(e);return r[t]||(r[t]=n.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:i,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:i,decodingInfoResults:[],error:e}))}function Li(e,t){if(t<=1)return 1;let n=128e3;return"ec-3"===e?n=768e3:"ac-3"===e&&(n=64e4),Math.min(t/2,n)}function Ai(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}const Ri=["NONE","TYPE-0","TYPE-1",null];const Ii=["SDR","PQ","HLG"];var _i="",Di="YES",Pi="v2";function Ci(e){const{canSkipUntil:t,canSkipDateRanges:n,age:r}=e;return t&&r<t/2?n?Pi:Di:_i}class Oi{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ni{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=null==(t=e.supplemental)?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=",".concat(n.substring(0,4)))}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Mi(this._audioGroups,e)}hasSubtitleGroup(e){return Mi(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function Mi(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Fi(e,t){let n=!1,r=[];if(e&&(n="SDR"!==e,r=[e]),t){r=t.allowedVideoRanges||Ii.slice(0);const e="SDR"!==r.join("")&&!t.videoCodec;n=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"===typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),n||(r=["SDR"])}return{preferHDR:n,allowedVideoRanges:r}}const Ui=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(n,r)=>{if(e&&(r=e(n,r)),"object"===typeof r&&null!==r){if(t.has(r))return;t.add(r)}return r}})(t));function Bi(e,t){gs.log('[abr] start candidates with "'.concat(e,'" ignored because ').concat(t))}function ji(e){return e.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Gi(e){if(!e)return e;const{lang:t,assocLang:n,characteristics:r,channels:s,audioCodec:i}=e;return{lang:t,assocLang:n,characteristics:r,channels:s,audioCodec:i}}function Ki(e,t,n){if("attrs"in e){const n=t.indexOf(e);if(-1!==n)return n}for(let r=0;r<t.length;r++){if(Hi(e,t[r],n))return r}return-1}function Hi(e,t,n){const{groupId:r,name:s,lang:i,assocLang:a,default:o}=e,l=e.forced;return(void 0===r||t.groupId===r)&&(void 0===s||t.name===s)&&(void 0===i||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--";if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(i,t.lang))&&(void 0===i||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split(","),r=t.split(",");return n.length===r.length&&!n.some(e=>-1===r.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===n||n(e,t))}function Vi(e,t){const{audioCodec:n,channels:r}=e;return(void 0===n||(t.audioCodec||"").substring(0,4)===n.substring(0,4))&&(void 0===r||r===(t.channels||"2"))}function zi(e,t,n){for(let r=t;r>-1;r--)if(n(e[r]))return r;for(let r=t+1;r<e.length;r++)if(n(e[r]))return r;return-1}function Wi(e,t){var n;return!!e&&e!==(null==(n=t.loadLevelObj)?void 0:n.uri)}const Yi=function(e,t){let n=0,r=e.length-1,s=null,i=null;for(;n<=r;){s=(n+r)/2|0,i=e[s];const a=t(i);if(a>0)n=s+1;else{if(!(a<0))return i;r=s-1}}return null};function qi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,i=null;if(e){i=t[1+e.sn-t[0].sn]||null;const r=e.endDTS-n;r>0&&r<15e-7&&(n+=15e-7),i&&e.level!==i.level&&i.end<=e.end&&(i=t[2+e.sn-t[0].sn]||null)}else 0===n&&0===t[0].start&&(i=t[0]);if(i&&((!e||e.level===i.level)&&0===Qi(n,r,i)||function(e,t,n){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const r=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),n);return e.start<=r}return!1}(i,e,Math.min(s,r))))return i;const a=Yi(t,Qi.bind(null,n,r));return!a||a===e&&i?i:a}function Qi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(n.start<=e&&n.start+n.duration>e)return 0;const r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function Xi(e,t,n){const r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}function $i(e,t,n){if(e&&e.startCC<=t&&e.endCC>=t){let r=e.fragments;const{fragmentHint:s}=e;let i;return s&&(r=r.concat(s)),Yi(r,e=>e.cc<t?1:e.cc>t?-1:(i=e,e.end<=n?1:e.start>n?-1:0)),i||null}return null}function Ji(e){switch(e.details){case Yr.FRAG_LOAD_TIMEOUT:case Yr.KEY_LOAD_TIMEOUT:case Yr.LEVEL_LOAD_TIMEOUT:case Yr.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Zi(e){return e.details.startsWith("key")}function ea(e){return Zi(e)&&!!e.frag&&!e.frag.decryptdata}function ta(e,t){const n=Ji(t);return e.default["".concat(n?"timeout":"error","Retry")]}function na(e,t){const n="linear"===e.backoff?1:Math.pow(2,t);return Math.min(n*e.retryDelayMs,e.maxRetryDelayMs)}function ra(e){return os(os({},e),{errorRetry:null,timeoutRetry:null})}function sa(e,t,n,r){if(!e)return!1;const s=null==r?void 0:r.code,i=t<e.maxNumRetry&&(function(e){return ia(e)||!!e&&(e<400||e>499)}(s)||!!n);return e.shouldRetry?e.shouldRetry(e,t,n,r,i):i}function ia(e){return 0===e&&!1===navigator.onLine}var aa=0,oa=2,la=3,ca=5,ua=0,da=1,ha=2,fa=4;function ga(e){const t={action:aa,flags:ua};return e&&(t.resolved=!0),t}var ma="NOT_LOADED",pa="APPENDING",va="PARTIAL",ya="OK";class ba{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.BUFFER_APPENDED,this.onBufferAppended,this),e.on(qr.FRAG_BUFFERED,this.onFragBuffered,this),e.on(qr.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.BUFFER_APPENDED,this.onBufferAppended,this),e.off(qr.FRAG_BUFFERED,this.onFragBuffered,this),e.off(qr.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let r=n.length;r--;){const t=n[r];if(!t)break;if(t.start<=e&&e<=t.end&&t.loaded)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,s=Object.keys(r);for(let i=s.length;i--;){const a=r[s[i]];if((null==a?void 0:a.body.type)===t&&(!n||a.buffered)){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,n,r,s){this.timeRanges&&(this.timeRanges[e]=t);const i=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(r=>{const a=this.fragments[r];if(!a)return;if(i>=a.body.sn)return;if(!a.buffered&&(!a.loaded||s))return void(a.body.type===n&&this.removeFragment(a.body));const o=a.range[e];o&&(0!==o.time.length?o.time.some(e=>{const n=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&this.removeFragment(a.body),n}):this.removeFragment(a.body))})}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const n=e.frag,r=Sa(n),s=this.fragments[r];if(!s||s.buffered&&n.gap)return;const i=!n.relurl;Object.keys(t).forEach(r=>{const a=n.elementaryStreams[r];if(!a)return;const o=t[r],l=i||!0===a.partial;s.range[r]=this.getBufferedTimes(n,e.part,l,o)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,n),Ea(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0;(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=Ta(n,t=>t.fragment.sn>=e))}fragBuffered(e,t){const n=Sa(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,n,r){const s={time:[],partial:n},i=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||i;for(let c=0;c<r.length;c++){const e=r.start(c)-this.bufferPadding,t=r.end(c)+this.bufferPadding;if(l>=e&&o<=t){s.time.push({startPTS:Math.max(i,r.start(c)),endPTS:Math.min(a,r.end(c))});break}if(i<t&&a>e){const e=Math.max(i,r.start(c)),t=Math.min(a,r.end(c));t>e&&(s.partial=!0,s.time.push({startPTS:e,endPTS:t}))}else if(a<=e)break}return s}getPartialFragment(e){let t,n,r,s=null,i=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const c=o[l];c&&Ea(c)&&(n=c.body.start-a,r=c.body.end+a,e>=n&&e<=r&&(t=Math.min(e-n,r-e),i<=t&&(s=c.body,i=t)))}),s}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||Ea(t))}getState(e){const t=Sa(e),n=this.fragments[t];return n?n.buffered?Ea(n)?va:ya:pa:ma}isTimeBuffered(e,t,n){let r,s;for(let i=0;i<n.length;i++){if(r=n.start(i)-this.bufferPadding,s=n.end(i)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,s=Sa(n);this.fragments[s]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:s,type:i}=t;if("initSegment"===n.sn)return;const a=n.type;if(r){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(r)}this.timeRanges=s;const o=s[i];this.detectEvictedFragments(i,o,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Sa(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const s=t[n[r]];if((null==s?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,n,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(i=>{const a=this.fragments[i];if(!a)return;const o=a.body;o.type!==n||r&&!o.gap||o.start<t&&o.end>e&&(a.buffered||s)&&this.removeFragment(o)})}removeFragment(e){const t=Sa(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const t=e.sn;this.activePartLists[e.type]=Ta(n,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function Ea(e){var t,n,r;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(n=e.range.audio)&&n.partial||null!=(r=e.range.audiovideo)&&r.partial)}function Sa(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.sn)}function Ta(e,t){return e.filter(e=>{const n=t(e);return n||e.clearElementaryStreamInfo(),n})}var xa=0,ka=1;class wa{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case xa:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ka:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error("[AESCrypto] invalid aes mode ".concat(this.aesMode))}}}class La{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=t.getUint32(4*r);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],s=n[1],i=n[2],a=n[3],o=this.invSubMix,l=o[0],c=o[1],u=o[2],d=o[3],h=new Uint32Array(256);let f=0,g=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let n=g^g<<1^g<<2^g<<3^g<<4;n=n>>>8^255&n^99,e[f]=n,t[n]=f;const o=h[f],m=h[o],p=h[m];let v=257*h[n]^16843008*n;r[f]=v<<24|v>>>8,s[f]=v<<16|v>>>16,i[f]=v<<8|v>>>24,a[f]=v,v=16843009*p^65537*m^257*o^16843008*f,l[n]=v<<24|v>>>8,c[n]=v<<16|v>>>16,u[n]=v<<8|v>>>24,d[n]=v,f?(f=o^h[h[h[p^o]]],g^=h[h[g]]):f=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const s=this.keySize=t.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);const i=this.ksRows=4*(s+6+1);let a,o;const l=this.keySchedule=new Uint32Array(i),c=this.invKeySchedule=new Uint32Array(i),u=this.sBox,d=this.rcon,h=this.invSubMix,f=h[0],g=h[1],m=h[2],p=h[3];let v,y;for(a=0;a<i;a++)a<s?v=l[a]=t[a]:(y=v,a%s===0?(y=y<<8|y>>>24,y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y],y^=d[a/s|0]<<24):s>6&&a%s===4&&(y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y]),l[a]=v=(l[a-s]^y)>>>0);for(o=0;o<i;o++)a=i-o,y=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?y:f[u[y>>>24]]^g[u[y>>>16&255]]^m[u[y>>>8&255]]^p[u[255&y]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,s=this.invKeySchedule,i=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],u=a[3],d=this.uint8ArrayToUint32Array_(n);let h=d[0],f=d[1],g=d[2],m=d[3];const p=new Int32Array(e),v=new Int32Array(p.length);let y,b,E,S,T,x,k,w,L,A,R,I,_,D;const P=this.networkToHostOrderSwap;for(;t<p.length;){for(L=P(p[t]),A=P(p[t+1]),R=P(p[t+2]),I=P(p[t+3]),T=L^s[0],x=I^s[1],k=R^s[2],w=A^s[3],_=4,D=1;D<r;D++)y=o[T>>>24]^l[x>>16&255]^c[k>>8&255]^u[255&w]^s[_],b=o[x>>>24]^l[k>>16&255]^c[w>>8&255]^u[255&T]^s[_+1],E=o[k>>>24]^l[w>>16&255]^c[T>>8&255]^u[255&x]^s[_+2],S=o[w>>>24]^l[T>>16&255]^c[x>>8&255]^u[255&k]^s[_+3],T=y,x=b,k=E,w=S,_+=4;y=i[T>>>24]<<24^i[x>>16&255]<<16^i[k>>8&255]<<8^i[255&w]^s[_],b=i[x>>>24]<<24^i[k>>16&255]<<16^i[w>>8&255]<<8^i[255&T]^s[_+1],E=i[k>>>24]<<24^i[w>>16&255]<<16^i[T>>8&255]<<8^i[255&x]^s[_+2],S=i[w>>>24]<<24^i[T>>16&255]<<16^i[x>>8&255]<<8^i[255&k]^s[_+3],v[t]=P(y^h),v[t+1]=P(S^f),v[t+2]=P(E^g),v[t+3]=P(b^m),h=L,f=A,g=R,m=I,t+=4}return v.buffer}}class Aa{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=function(e){switch(e){case xa:return"AES-CBC";case ka:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode ".concat(e))}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class Ra{constructor(e){let{removePKCS7Padding:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(cf){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?e.slice(0,t-n):e}(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((s,i)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,r);const o=this.flush();o?s(o.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:s,currentResult:i,remainderData:a}=this;if(r!==xa||16!==t.byteLength)return gs.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=$s(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;s&&(n=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new La),l.expandKey(t);const c=i;return this.currentResult=l.decrypt(o.buffer,0,n),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new Aa(this.subtle,t,r)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new wa(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,t)}).catch(s=>(gs.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(s.name,": ").concat(s.message)),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const s=this.flush();if(s)return s.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%16;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(gs.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}const Ia=Math.pow(2,17);class _a{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Ca({type:Wr.NETWORK_ERROR,details:Yr.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a ".concat(n?"part list":"url")),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,i=r.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void o(Pa(e));e.gap=!1}const l=this.loader=s?new s(r):new i(r),c=Da(e);e.loader=l;const u=ra(r.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Ia};e.stats=l.stats;const h={onSuccess:(t,n,r,s)=>{this.resetLoader(e,l);let i=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(i.slice(0,16)),i=i.slice(16)),a({frag:e,part:null,payload:i,networkDetails:s})},onError:(t,r,s,i)=>{this.resetLoader(e,l),o(new Ca({type:Wr.NETWORK_ERROR,details:Yr.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:os({url:n,data:void 0},t),error:new Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:s,stats:i}))},onAbort:(t,n,r)=>{this.resetLoader(e,l),o(new Ca({type:Wr.NETWORK_ERROR,details:Yr.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:(t,n,r)=>{this.resetLoader(e,l),o(new Ca({type:Wr.NETWORK_ERROR,details:Yr.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:r,stats:t}))}};t&&(h.onProgress=(n,r,s,i)=>t({frag:e,part:null,payload:s,networkDetails:i})),l.load(c,d,h)})}loadPart(e,t,n){this.abort();const r=this.config,s=r.fLoader,i=r.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(Pa(e,t));const l=this.loader=s?new s(r):new i(r),c=Da(e,t);e.loader=l;const u=ra(r.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ia};t.stats=l.stats,l.load(c,d,{onSuccess:(r,s,i,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:r.data,networkDetails:o};n(c),a(c)},onError:(n,r,s,i)=>{this.resetLoader(e,l),o(new Ca({type:Wr.NETWORK_ERROR,details:Yr.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:os({url:c.url,data:void 0},n),error:new Error("HTTP Error ".concat(n.code," ").concat(n.text)),networkDetails:s,stats:i}))},onAbort:(n,r,s)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new Ca({type:Wr.NETWORK_ERROR,details:Yr.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:s,stats:n}))},onTimeout:(n,r,s)=>{this.resetLoader(e,l),o(new Ca({type:Wr.NETWORK_ERROR,details:Yr.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:s,stats:n}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,s=r.total;if(n.loaded+=r.loaded,s){const r=Math.round(e.duration/t.duration),i=Math.min(Math.round(n.loaded/s),r),a=(r-i)*Math.round(n.loaded/i);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);const i=n.loading,a=r.loading;i.start?i.first+=a.first-a.start:(i.start=a.start,i.first=a.first),i.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Da(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},s=n.byteRangeStartOffset,i=n.byteRangeEndOffset;if(Hr(s)&&Hr(i)){var a;let t=s,n=i;if("initSegment"===e.sn&&("AES-128"===(o=null==(a=e.decryptdata)?void 0:a.method)||"AES-256"===o)){const e=i-s;e%16&&(n=i+(16-e%16)),0!==s&&(r.resetIV=!0,t=s-16)}r.rangeStart=t,r.rangeEnd=n}var o;return r}function Pa(e,t){const n=new Error("GAP ".concat(e.gap?"tag":"attribute"," found")),r={type:Wr.MEDIA_ERROR,details:Yr.FRAG_GAP,fatal:!1,frag:e,error:n,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new Ca(r)}class Ca extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Oa extends ls{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Na{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=s,this.partial=i}}const Ma={length:0,start:()=>0,end:()=>0};class Fa{static isBuffered(e,t){if(e){const n=Fa.getBuffered(e);for(let e=n.length;e--;)if(t>=n.start(e)&&t<=n.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Fa.getBuffered(e);return Fa.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=Fa.bufferedRanges(e);if(r.length)return Fa.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let r=-1,s=[];if(n)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(r=c);const i=s.length;if(i){const t=s[i-1].end;e[c].start-t<n?e[c].end>t&&(s[i-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let i,a=0,o=t,l=t;for(let c=0;c<s.length;c++){const e=s[c].start,u=s[c].end;if(-1===r&&t>=e&&t<=u&&(r=c),t+n>=e&&t<u)o=e,l=u,a=l-t;else if(t+n<e){i=e;break}}return{len:a,start:o||0,end:l||0,nextStart:i,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||Ma}catch(cf){return gs.log("failed to get media.buffered",cf),Ma}}}const Ua=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ba(e){return Ua.test(e)}function ja(e,t){if(null!==e.variableList||e.hasVariableRefs){const n=e.variableList;return t.replace(Ua,t=>{const r=t.substring(2,t.length-1),s=null==n?void 0:n[r];return void 0===s?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(r,'"'))),t):s})}return t}function Ga(e,t,n){let r,s,i=e.variableList;if(i||(e.variableList=i={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{const e=new self.URL(n).searchParams;if(!e.has(r))throw new Error('"'.concat(r,'" does not match any query parameter in URI: "').concat(n,'"'));s=e.get(r)}catch(a){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(a.message)))}}else r=t.NAME,s=t.VALUE;r in i?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(r,'"'))):i[r]=s||""}function Ka(e,t,n){const r=t.IMPORT;if(n&&r in n){let t=e.variableList;t||(e.variableList=t={}),t[r]=n[r]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(r,'"')))}const Ha=/^(\d+)x(\d+)$/,Va=/(.+?)=(".*?"|.*?)(?:,|$)/g;class za{constructor(e,t){"string"===typeof e&&(e=za.parseAttrList(e,t)),is(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const n=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)n[e]=parseInt(t.slice(2*e,2*e+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=Ha.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={};for(Va.lastIndex=0;null!==(n=Va.exec(e));){const s=n[1].trim();let i=n[2];const a=0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1;let o=!1;if(a)i=i.slice(1,-1);else switch(s){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(a||o))i=ja(t,i);else if(!o&&!a)switch(s){case"CLOSED-CAPTIONS":if("NONE"===i)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":gs.warn("".concat(e,": attribute ").concat(s," is missing quotes"))}r[s]=i}return r}}function Wa(e){return"ID"!==e&&"CLASS"!==e&&"CUE"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function Ya(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class qa{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(r=null==t?void 0:t.tagOrder)?r:n,t){const n=t.attr;for(const t in n)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==n[t]){gs.warn('DATERANGE tag attribute: "'.concat(t,'" does not match for tags with ID: "').concat(e.ID,'"')),this._badValueForSameId=t;break}e=is(new za({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Hr(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(gs.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id,'": ').concat(e)),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Hr(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&Hr(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class Qa{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return!!this.fragments.length&&Hr(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Xa(e,t){return e.length===t.length&&!e.some((e,n)=>e!==t[n])}function $a(e,t){return!e&&!t||!(!e||!t)&&Xa(e,t)}function Ja(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function Za(e){switch(e){case"AES-128":case"AES-256":return xa;case"AES-256-CTR":return ka;default:throw new Error("invalid full segment method ".concat(e))}}function eo(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function to(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function no(e){const t=function(e,t,n){const r=e[t];e[t]=e[n],e[n]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function ro(e){const t=e.split(":");let n=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),r=e[e.length-1].split(",");if(2===r.length){const t="base64"===r[0],s=r[1];t?(e.splice(-1,1),n=eo(s)):n=function(e){const t=to(e).subarray(0,16),n=new Uint8Array(16);return n.set(t,16-t.length),n}(s)}}return n}const so="undefined"!==typeof self?self:void 0;var io={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ao="org.w3.clearkey",oo="com.apple.streamingkeydelivery",lo="com.microsoft.playready",co="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function uo(e){switch(e){case oo:return io.FAIRPLAY;case lo:return io.PLAYREADY;case co:return io.WIDEVINE;case ao:return io.CLEARKEY}}function ho(e){switch(e){case io.FAIRPLAY:return oo;case io.PLAYREADY:return lo;case io.WIDEVINE:return co;case io.CLEARKEY:return ao}}function fo(e){const{drmSystems:t,widevineLicenseUrl:n}=e,r=t?[io.FAIRPLAY,io.WIDEVINE,io.PLAYREADY,io.CLEARKEY].filter(e=>!!t[e]):[];return!r[io.WIDEVINE]&&n&&r.push(io.WIDEVINE),r}const go=null!=so&&null!=(mo=so.navigator)&&mo.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var mo;function po(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),n=String.fromCharCode.apply(null,Array.from(t)),r=n.substring(n.indexOf("<"),n.length),s=(new DOMParser).parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(s){const e=s.childNodes[0]?s.childNodes[0].nodeValue:s.getAttribute("VALUE");if(e){const t=eo(e).subarray(0,16);return no(t),t}}return null}let vo={};class yo{static clearKeyUriToKeyIdMap(){vo={}}static setKeyIdForUri(e,t){vo[e]=t}static addKeyIdForUri(e){const t=Object.keys(vo).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),vo[e]=n,n}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5?arguments[5]:void 0;this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=s,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!Ja(e),null!=i&&i.startsWith("0x")&&(this.keyId=new Uint8Array(bs(i)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Xa(e.keyFormatVersions,this.keyFormatVersions)&&$a(e.iv,this.iv)&&$a(e.keyId,this.keyId)}isSupported(){if(this.method){if(Ja(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case oo:case co:case lo:case ao:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Ja(this.method)){let t=this.iv;t||("number"!==typeof e&&(gs.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),e=0),t=function(e){const t=new Uint8Array(16);for(let n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}(e));return new yo(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.keyId){const e=vo[this.uri];if(e&&!Xa(this.keyId,e)&&yo.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=ro(this.uri);if(n)switch(this.keyFormat){case co:if(this.pssh=n,!this.keyId){const e=function(e){const t=[];if(e instanceof ArrayBuffer){const n=e.byteLength;let r=0;for(;r+32<n;){const n=si(new DataView(e,r));t.push(n),r+=n.size}}return t}(n.buffer);if(e.length){var r;const t=e[0];this.keyId=null!=(r=t.kids)&&r.length?t.kids[0]:null}}this.keyId||(this.keyId=bo(t));break;case lo:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=ri(e,0,n),this.keyId=po(n);break}default:{let e=n.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e;e=function(e){const t=null==e?void 0:e[co];if(t)return t.keyId;return null}(t),e||(e=bo(t),e||(e=vo[this.uri])),e&&(this.keyId=e,yo.setKeyIdForUri(this.uri,e))}return this}}function bo(e){const t=null==e?void 0:e[lo];if(t){const e=ro(t.uri);if(e)return po(e)}return null}const Eo=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,So=/#EXT-X-MEDIA:(.*)/g,To=/^#EXT(?:INF|-X-TARGETDURATION):/m,xo=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),ko=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class wo{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return xs.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return To.test(e)}static parseMasterPlaylist(e,t){const n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Ba(e)},r=[];if(Eo.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let s;for(;null!=(s=Eo.exec(e));)if(s[1]){var i;const e=new za(s[1],n),a=ja(n,s[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:wo.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),_o(e.CODECS,o);const c=e["SUPPLEMENTAL-CODECS"];c&&(o.supplemental={},_o(c,o.supplemental)),null!=(i=o.unknownCodecs)&&i.length||r.push(o),n.levels.push(o)}else if(s[3]){const e=s[3],r=s[4];switch(e){case"SESSION-DATA":{const e=new za(r,n),t=e["DATA-ID"];t&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[t]=e);break}case"SESSION-KEY":{const e=Ro(r,t,n);e.encrypted&&e.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(e)):gs.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(r,'"'));break}case"DEFINE":Ga(n,new za(r,n),t);break;case"CONTENT-STEERING":{const e=new za(r,n);n.contentSteering={uri:wo.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=Io(r)}}const a=r.length>0&&r.length<n.levels.length;return n.levels=a?r:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,n){let r;const s={},i=n.levels,a={AUDIO:i.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:i.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(So.lastIndex=0;null!==(r=So.exec(e));){const e=new za(r[1],n),i=e.TYPE;if(i){const n=a[i],r=s[i]||[];s[i]=r;const l=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],u=e.CHANNELS,d=e.CHARACTERISTICS,h=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:i,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?wo.resolve(e.URI,t):""};if(c&&(f.assocLang=c),u&&(f.channels=u),d&&(f.characteristics=d),h&&(f.instreamId=h),null!=n&&n.length){const e=wo.findGroup(n,f.groupId)||n[0];Do(f,e,"audioCodec"),Do(f,e,"textCodec")}r.push(f)}}return s}static parseLevelPlaylist(e,t,n,r,s,i){var a;const o={url:t},l=new Qa(t),c=l.fragments,u=[];let d,h,f,g,m=null,p=0,v=0,y=0,b=0,E=0,S=null,T=new _s(r,o),x=-1,k=!1,w=null;if(xo.lastIndex=0,l.m3u8=e,l.hasVariableRefs=Ba(e),"#EXTM3U"!==(null==(a=xo.exec(e))?void 0:a[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(d=xo.exec(e));){k&&(k=!1,T=new _s(r,o),T.playlistOffset=y,T.setStart(y),T.sn=p,T.cc=b,E&&(T.bitrate=E),T.level=n,m&&(T.initSegment=m,m.rawProgramDateTime&&(T.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),w&&(T.setByteRange(w),w=null)));const e=d[1];if(e){T.duration=parseFloat(e);const t=(" "+d[2]).slice(1);T.title=t||null,T.tagList.push(t?["INF",e,t]:["INF",e])}else if(d[3]){if(Hr(T.duration)){T.playlistOffset=y,T.setStart(y),f&&Oo(T,f,l),T.sn=p,T.level=n,T.cc=b,c.push(T);const e=(" "+d[3]).slice(1);T.relurl=ja(l,e),Po(T,S,u),S=T,y+=T.duration,p++,v=0,k=!0}}else{if(d=d[0].match(ko),!d){gs.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<d.length&&void 0===d[h];h++);const e=(" "+d[h]).slice(1),s=(" "+d[h+1]).slice(1),a=d[h+2]?(" "+d[h+2]).slice(1):null;switch(e){case"BYTERANGE":S?T.setByteRange(s,S):T.setByteRange(s);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=s,T.tagList.push(["PROGRAM-DATE-TIME",s]),-1===x&&(x=c.length);break;case"PLAYLIST-TYPE":l.type&&No(l,e,d),l.type=s.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?No(l,e,d):c.length>0&&Mo(l,e,d),p=l.startSN=parseInt(s);break;case"SKIP":{l.skippedSegments&&No(l,e,d);const t=new za(s,l),n=t.decimalInteger("SKIPPED-SEGMENTS");if(Hr(n)){l.skippedSegments+=n;for(let e=n;e--;)c.push(null);p+=n}const r=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(r.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&No(l,e,d),l.targetduration=Math.max(parseInt(s),1);break;case"VERSION":null!==l.version&&No(l,e,d),l.version=parseInt(s);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||No(l,e,d),l.live=!1;break;case"#":(s||a)&&T.tagList.push(a?[s,a]:[s]);break;case"DISCONTINUITY":b++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([e]);break;case"BITRATE":T.tagList.push([e,s]),E=1e3*parseInt(s),Hr(E)?T.bitrate=E:E=0;break;case"DATERANGE":{const e=new za(s,l),t=new qa(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:gs.warn('Ignoring invalid DATERANGE tag: "'.concat(s,'"')),T.tagList.push(["EXT-X-DATERANGE",s]);break}case"DEFINE":{const e=new za(s,l);"IMPORT"in e?Ka(l,e,i):Ga(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?No(l,e,d):c.length>0&&Mo(l,e,d),l.startCC=b=parseInt(s);break;case"KEY":{const e=Ro(s,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={});const t=f[e.keyFormat];null!=t&&t.matches(e)||(t&&(f=is({},f)),f[e.keyFormat]=e)}else gs.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(s,'"'));break}case"START":l.startTimeOffset=Io(s);break;case"MAP":{const e=new za(s,l);if(T.duration){const t=new _s(r,o);Co(t,e,n,f),m=t,T.initSegment=m,m.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=m.rawProgramDateTime)}else{const t=T.byteRangeEndOffset;if(t){const e=T.byteRangeStartOffset;w="".concat(t-e,"@").concat(e)}else w=null;Co(T,e,n,f),m=T,k=!0}m.cc=b;break}case"SERVER-CONTROL":g&&No(l,e,d),g=new za(s),l.canBlockReload=g.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=g.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&g.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=g.optionalFloat("PART-HOLD-BACK",0),l.holdBack=g.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&No(l,e,d);const t=new za(s);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=v>0?e[e.length-1]:void 0,n=v++,r=new za(s,l),i=new Ds(r,T,o,n,t);e.push(i),T.duration+=i.duration;break}case"PRELOAD-HINT":{const e=new za(s,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new za(s,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:gs.warn("line parsed but not handled: ".concat(d))}}}S&&!S.relurl?(c.pop(),y-=S.duration,l.partList&&(l.fragmentHint=S)):l.partList&&(Po(T,S,u),T.cc=b,l.fragmentHint=T,f&&Oo(T,f,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const L=c.length,A=c[0],R=c[L-1];if(y+=l.skippedSegments*l.targetduration,y>0&&L&&R){l.averagetargetduration=y/L;const e=R.sn;l.endSN="initSegment"!==e?e:0,l.live||(R.endList=!0),x>0&&(!function(e,t){let n=e[t];for(let r=t;r--;){const t=e[r];if(!t)return;t.programDateTime=n.programDateTime-1e3*t.duration,n=t}}(c,x),A&&u.unshift(A))}return l.fragmentHint&&(y+=l.fragmentHint.duration),l.totalduration=y,u.length&&l.dateRangeTagCount&&A&&Lo(u,l),l.endCC=b,l}}function Lo(e,t){let n=e.length;if(!n){if(!t.hasProgramDateTime)return;{const r=t.fragments[t.fragments.length-1];e.push(r),n++}}const r=e[n-1],s=t.live?1/0:t.totalduration,i=Object.keys(t.dateRanges);for(let o=i.length;o--;){const l=t.dateRanges[i[o]],c=l.startDate.getTime();l.tagAnchor=r.ref;for(let r=n;r--;){var a;if((null==(a=e[r])?void 0:a.sn)<t.startSN)break;const n=Ao(t,c,e,r,s);if(-1!==n){l.tagAnchor=t.fragments[n].ref;break}}}}function Ao(e,t,n,r,s){const i=n[r];if(i){const o=i.programDateTime;if(t>=o||0===r){var a;if(t<=o+1e3*(((null==(a=n[r+1])?void 0:a.start)||s)-i.start)){const s=n[r].sn-e.startSN;if(s<0)return-1;const i=e.fragments;if(i.length>n.length){for(let a=(n[r+1]||i[i.length-1]).sn-e.startSN;a>s;a--){const e=i[a].programDateTime;if(t>=e&&t<e+1e3*i[a].duration)return a}}return s}}}return-1}function Ro(e,t,n){var r,s;const i=new za(e,n),a=null!=(r=i.METHOD)?r:"",o=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,u=null!=(s=i.KEYFORMAT)?s:"identity";o&&i.IV&&!l&&gs.error("Invalid IV: ".concat(i.IV));const d=o?wo.resolve(o,t):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new yo(a,d,u,h,l,i.KEYID)}function Io(e){const t=new za(e).decimalFloatingPoint("TIME-OFFSET");return Hr(t)?t:null}function _o(e,t){let n=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const r=n.filter(t=>oi(t,e));r.length&&(t["".concat(e,"Codec")]=r.map(e=>e.split("/")[0]).join(","),n=n.filter(e=>-1===r.indexOf(e)))}),t.unknownCodecs=n}function Do(e,t,n){const r=t[n];r&&(e[n]=r)}function Po(e,t,n){e.rawProgramDateTime?n.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function Co(e,t,n,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function Oo(e,t,n){e.levelkeys=t;const{encryptedFragments:r}=n;r.length&&r[r.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||r.push(e)}function No(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must not appear more than once (").concat(n[0],")"))}function Mo(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must appear before the first Media Segment (").concat(n[0],")"))}function Fo(e,t){const n=t.startPTS;if(Hr(n)){let r,s=0;t.sn>e.sn?(s=n-e.start,r=e):(s=e.start-n,r=t),r.duration!==s&&r.setDuration(s)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function Uo(e,t,n,r,s,i,a){r-n<=0&&(a.warn("Fragment should have a positive duration",t),r=n+t.duration,i=s+t.duration);let o=n,l=r;const c=t.startPTS,u=t.endPTS;if(Hr(c)){const d=Math.abs(c-n);e&&d>e.totalduration?a.warn("media timestamps and playlist times differ by ".concat(d,"s for level ").concat(t.level," ").concat(e.url)):Hr(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,o=Math.max(n,c),n=Math.min(n,c),s=void 0!==t.startDTS?Math.min(s,t.startDTS):s,l=Math.min(r,u),r=Math.max(r,u),i=void 0!==t.endDTS?Math.max(i,t.endDTS):i}const d=n-t.start;0!==t.start&&t.setStart(n),t.setDuration(r-t.start),t.startPTS=n,t.maxStartPTS=o,t.startDTS=s,t.endPTS=r,t.minEndPTS=l,t.endDTS=i;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let f;const g=h-e.startSN,m=e.fragments;for(m[g]=t,f=g;f>0;f--)Fo(m[f],m[f-1]);for(f=g;f<m.length-1;f++)Fo(m[f],m[f+1]);return e.fragmentHint&&Fo(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function Bo(e,t,n){if(e===t)return;let r=null;const s=e.fragments;for(let u=s.length-1;u>=0;u--){const e=s[u].initSegment;if(e){r=e;break}}let i;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,n){const r=t.skippedSegments,s=Math.max(e.startSN,t.startSN)-t.startSN,i=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=s;c<=i;c++){const s=l[a+c];let i=o[c];if(r&&!i&&s&&(i=t.fragments[c]=s),s&&i){n(s,i,c,o);const r=s.relurl,a=i.relurl;if(r&&qo(r,a))return void(t.playlistParsingError=jo("media sequence mismatch ".concat(i.sn,":"),e,t,s,i));if(s.cc!==i.cc)return void(t.playlistParsingError=jo("discontinuity sequence mismatch (".concat(s.cc,"!=").concat(i.cc,")"),e,t,s,i))}}}(e,t,(e,n,s,a)=>{if((!t.startCC||t.skippedSegments)&&n.cc!==e.cc){const r=e.cc-n.cc;for(let e=s;e<a.length;e++)a[e].cc+=r;t.endCC=a[a.length-1].cc}Hr(e.startPTS)&&Hr(e.endPTS)&&(n.setStart(n.startPTS=e.startPTS),n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.setDuration(e.endPTS-e.startPTS),n.duration&&(i=n),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(n.elementaryStreams=e.elementaryStreams),n.loader=e.loader,e.hasStats&&(n.stats=e.stats),e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)});const a=t.fragments,o=t.fragmentHint?a.concat(t.fragmentHint):a;if(r&&o.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)}),t.skippedSegments){if(t.deltaUpdateFailed=a.some(e=>!e),t.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)a.shift();t.startSN=a[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,n){const{dateRanges:r,recentlyRemovedDateranges:s}=t,i=is({},e);s&&s.forEach(e=>{delete i[e]});const a=Object.keys(i).length;if(!a)return r;return Object.keys(r).forEach(e=>{const t=i[e],s=new qa(r[e].attr,t);s.isValid?(i[e]=s,t||(s.tagOrder+=a)):n.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(Ui(r[e].attr),'"'))}),i}(e.dateRanges,t,n));const r=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<o.length;e++)null===o[e].programDateTime&&Po(o[e],o[e-1],r);Lo(r,t)}t.endCC=a[a.length-1].cc}if(!t.startCC){var l;const n=Vo(e,t.startSN-1);t.startCC=null!=(l=null==n?void 0:n.cc)?l:a[0].cc}!function(e,t,n){if(e&&t){let r=0;for(let s=0,i=e.length;s<=i;s++){const i=e[s],a=t[s+r];i&&a&&i.index===a.index&&i.fragment.sn===a.fragment.sn?n(i,a):r--}}}(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),i?Uo(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,n):Go(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const c=t.advancedDateTime;if(t.advanced&&c){const e=t.edge;t.driftStart||(t.driftStartTime=c,t.driftStart=e),t.driftEndTime=c,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function jo(e,t,n,r,s){return new Error("".concat(e," ").concat(s.url,"\nPlaylist starting @").concat(t.startSN,"\n").concat(t.m3u8,"\n\nPlaylist starting @").concat(n.startSN,"\n").concat(n.m3u8))}function Go(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=t.startSN+t.skippedSegments-e.startSN,s=e.fragments,i=r>=0;let a=0;if(i&&r<s.length)a=s[r].start;else if(i&&t.startSN===e.endSN+1)a=e.fragmentEnd;else if(i&&n)a=e.fragmentStart+r*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;a=e.fragmentStart}Ko(t,a)}function Ko(e,t){if(t){const n=e.fragments;for(let r=e.skippedSegments;r<n.length;r++)n[r].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function Ho(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=1e3*e.targetduration;if(e.updated){const r=e.fragments,s=4;if(r.length&&n*s>t){const e=1e3*r[r.length-1].duration;e<n&&(n=e)}}else n/=2;return Math.round(n)}function Vo(e,t,n){if(!e)return null;let r=e.fragments[t-e.startSN];return r||(r=e.fragmentHint,r&&r.sn===t?r:t<e.startSN&&n&&n.sn===t?n:null)}function zo(e,t,n){return e?Wo(e.partList,t,n):null}function Wo(e,t,n){if(e)for(let r=e.length;r--;){const s=e[r];if(s.index===n&&s.fragment.sn===t)return s}return null}function Yo(e){e.forEach((e,t)=>{var n;null==(n=e.details)||n.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function qo(e,t){return!(e===t||!t)&&Qo(e)!==Qo(t)}function Qo(e){return e.replace(/\?[^?]*$/,"")}function Xo(e,t){for(let r=0,s=e.length;r<s;r++){var n;if((null==(n=e[r])?void 0:n.cc)===t)return e[r]}return null}function $o(e,t){const n=e.start+t;e.startPTS=n,e.setStart(n),e.endPTS=n+e.duration}function Jo(e,t){const n=t.fragments;for(let r=0,s=n.length;r<s;r++)$o(n[r],e);t.fragmentHint&&$o(t.fragmentHint,e),t.alignedSliding=!0}function Zo(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const n=Math.min(t.endCC,e.endCC),r=Xo(t.fragments,n),s=Xo(e.fragments,n);if(!r||!s)return;gs.log("Aligning playlist at start of dicontinuity sequence ".concat(n));Jo(r.start-s.start,e)}function el(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const n=e.fragments,r=t.fragments;if(!n.length||!r.length)return;let s,i;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(s=Xo(r,a),i=Xo(n,a)),s&&i||(s=r[Math.floor(r.length/2)],i=Xo(n,s.cc)||n[Math.floor(n.length/2)]);const o=s.programDateTime,l=i.programDateTime;if(!o||!l)return;Jo((l-o)/1e3-(i.start-s.start),e)}function tl(e,t,n){nl(e,t,n),e.addEventListener(t,n)}function nl(e,t,n){e.removeEventListener(t,n)}const rl=function(e){let t="";const n=e.length;for(let r=0;r<n;r++)t+="[".concat(e.start(r).toFixed(3),"-").concat(e.end(r).toFixed(3),"]");return t},sl="STOPPED",il="IDLE",al="KEY_LOADING",ol="FRAG_LOADING",ll="FRAG_LOADING_WAITING_RETRY",cl="WAITING_TRACK",ul="PARSING",dl="PARSED",hl="ENDED",fl="ERROR",gl="WAITING_INIT_PTS",ml="WAITING_LEVEL";class pl extends Oa{constructor(e,t,n,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=sl,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:n,mediaBuffer:r,state:s}=this,i=n?n.currentTime:0,a=Fa.bufferInfo(r||n,i,e.maxBufferHole),o=!a.len;if(this.log("Media seeking to ".concat(Hr(i)?i.toFixed(3):i,", state: ").concat(s,", ").concat(o?"out of":"in"," buffer")),this.state===hl)this.resetLoadingState();else if(t){const n=e.maxFragLookUpTolerance,r=t.start-n,s=t.start+t.duration+n;if(o||s<a.start||r>a.end){const e=i>s;(i<r||e)&&(e&&t.loader&&(this.log("Cancelling fragment load for seek (sn: ".concat(t.sn,")")),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(n){this.fragmentTracker.removeFragmentsInRange(i,1/0,this.playlistType,!0);if(i>this.lastCurrentTime&&(this.lastCurrentTime=i),!this.loadingParts){const e=Math.max(a.end,i),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log("LL-Part loading ON after seeking to ".concat(i.toFixed(2)," with buffer @").concat(e.toFixed(2))),this.loadingParts=t)}}this.hls.hasEnoughToStart||(this.log("Setting ".concat(o?"startPosition":"nextLoadPosition"," to ").concat(i," for seek without enough to start")),this.nextLoadPosition=i,o&&(this.startPosition=i)),o&&this.state===il&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new _a(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ra(e.config)}registerListeners(){const{hls:e}=this;e.on(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(qr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(qr.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===sl)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=sl}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=Fa.bufferedInfo(s,e.start,0));const i=e.nextStart;if(i&&i>r&&i<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const a=t.partList;if(null!=a&&a.length){const e=a[a.length-1];return Fa.isBuffered(this.media,e.start+e.duration/2)}const o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;tl(n,"seeking",this.onMediaSeeking),tl(n,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===sl&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(null!==r){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),nl(r,"seeking",this.onMediaSeeking),nl(r,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=sl,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){this._doFragLoad(e,t,n,e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn("".concat(t.type," sn: ").concat(t.sn).concat(e.part?" part: "+e.part.index:""," of ").concat(this.fragInfo(t,!1,e.part),") was dropped during download.")),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const t=this.state,n=e.frag;this.fragContextChanged(n)?(t===ol||!this.fragCurrent&&t===ul)&&(this.fragmentTracker.removeFragment(n),this.state=il):("payload"in e&&(this.log("Loaded ".concat(n.type," sn: ").concat(n.sn," of ").concat(this.playlistLabel()," ").concat(n.level)),this.hls.trigger(qr.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(t=>{this.state!==sl&&this.state!==fl&&(this.warn("Frag error: ".concat((null==t?void 0:t.message)||t)),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===pa){const t=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,t),s=Math.max(e.duration,r?r.len:this.config.maxBufferLength),i=this.backtrackFragment;(1===(i?e.sn-i.sn:0)||this.reduceMaxBufferLength(s,e.duration))&&n.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===va&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null};this.hls.trigger(qr.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:t}=this,{frag:n,payload:r}=e,s=n.decryptdata;if(r&&r.byteLength>0&&null!=s&&s.key&&s.iv&&Ja(s.method)){const i=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,Za(s.method)).catch(e=>{throw t.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:n}),e}).then(r=>{const s=self.performance.now();return t.trigger(qr.FRAG_DECRYPTED,{frag:n,payload:r,stats:{tstart:i,tdecrypt:s}}),e.payload=r,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==sl&&this.state!==fl&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==sl&&(this.state=il),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,r;const s=e.tracks;if(s&&!t.encrypted&&(null!=(n=s.audio)&&n.encrypted||null!=(r=s.video)&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const e=this.media,n=new Error("Encrypted track with no key in ".concat(this.fragInfo(t)," (media ").concat(e?"attached mediaKeys: "+e.mediaKeys:"detached",")"));return this.warn(n.message),!e||e.mediaKeys?!1:(this.hls.trigger(qr.ERROR,{type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_NO_KEYS,fatal:!1,error:n,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t)," > buffer:").concat(n?rl(Fa.getBuffered(n)):"(detached)",")")),Is(e)){var r;if(e.type!==ts){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=il)}const t=null==(r=this.levels)?void 0:r[e.level];null!=t&&t.fragmentError&&(this.log("Resetting level fragment error count of ".concat(t.fragmentError," on frag buffered")),t.fragmentError=0)}this.state=il}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:s}=e,i=!s||0===s.length||s.some(e=>!e),a=new Na(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!i);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;var s;this.fragCurrent=e;const i=t.details;if(!this.levels||!i)throw new Error("frag load aborted, missing level".concat(i?"":" detail","s"));let a=null;if(!e.encrypted||null!=(s=e.decryptdata)&&s.key)e.encrypted||(a=this.keyLoader.loadClear(e,i.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log("Loading key for ".concat(e.sn," of [").concat(i.startSN,"-").concat(i.endSN,"], ").concat(this.playlistLabel()," ").concat(e.level)),this.state=al,this.fragCurrent=e,a=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(qr.KEY_LOADED,e),this.state===al&&(this.state=il),e}),this.hls.trigger(qr.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const o=this.fragPrevious;if(Is(e)&&(!o||e.sn!==o.sn)){const n=this.shouldLoadParts(t.details,e.end);n!==this.loadingParts&&(this.log("LL-Part loading ".concat(n?"ON":"OFF"," loading sn ").concat(null==o?void 0:o.sn,"->").concat(e.sn)),this.loadingParts=n)}if(n=Math.max(e.start,n||0),this.loadingParts&&Is(e)){const s=i.partList;if(s&&r){n>i.fragmentEnd&&i.fragmentHint&&(e=i.fragmentHint);const o=this.getNextPart(s,e,n);if(o>-1){const l=s[o];let c;return e=this.fragCurrent=l.fragment,this.log("Loading ".concat(e.type," sn: ").concat(e.sn," part: ").concat(l.index," (").concat(o,"/").concat(s.length-1,") of ").concat(this.fragInfo(e,!1,l),") cc: ").concat(e.cc," [").concat(i.startSN,"-").concat(i.endSN,"], target: ").concat(parseFloat(n.toFixed(3)))),this.nextLoadPosition=l.start+l.duration,this.state=ol,c=a?a.then(n=>!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(e,l,t,r)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,r).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(qr.FRAG_LOADING,{frag:e,part:l,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(s,n))return Promise.resolve(null)}}var l;if(Is(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @".concat(n.toFixed(2)," Check buffer at sn: ").concat(e.sn," loaded parts: ").concat(null==(l=i.partList)?void 0:l.filter(e=>e.loaded).map(e=>"[".concat(e.start,"-").concat(e.end,"]")))),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading ".concat(e.type," sn: ").concat(e.sn," of ").concat(this.fragInfo(e,!1),") cc: ").concat(e.cc," ").concat("["+i.startSN+"-"+i.endSN+"]",", target: ").concat(parseFloat(n.toFixed(3)))),Hr(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ol;const c=this.config.progressive&&e.type!==ts;let u;return u=c&&a?a.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,r)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,c?r:void 0),a]).then(e=>{let[t]=e;return!c&&r&&r(t),t}).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(qr.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,n,r){return new Promise((s,i)=>{var a;const o=[],l=null==(a=n.details)?void 0:a.partList,c=t=>{this.fragmentLoader.loadPart(e,t,r).then(r=>{o[t.index]=r;const i=r.part;this.hls.trigger(qr.FRAG_LOADED,r);const a=zo(n.details,e.sn,t.index+1)||Wo(l,e.sn,t.index+1);if(!a)return s({frag:e,part:i,partsLoaded:o});c(a)}).catch(i)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Yr.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Wr.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(qr.ERROR,t)}else this.hls.trigger(qr.ERROR,{type:Wr.OTHER_ERROR,details:Yr.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ul)return void(this.fragCurrent||this.state===sl||this.state===fl||(this.state=il));const{frag:n,part:r,level:s}=t,i=self.performance.now();n.stats.parsing.end=i,r&&(r.stats.parsing.end=i);const a=this.getLevelDetails(),o=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);o!==this.loadingParts&&(this.log("LL-Part loading ".concat(o?"ON":"OFF"," after parsing segment ending @").concat(n.end.toFixed(2))),this.loadingParts=o),this.updateLevelTiming(n,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const s=e.partList[0];if(s.fragment.type===ts)return!1;if(t>=s.end+((null==(n=e.fragmentHint)?void 0:n.duration)||0)){var r;if((this.hls.hasEnoughToStart?(null==(r=this.media)?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:s,part:i}=e;if(null==t||!t[r])return this.warn("Levels object was unset while buffering fragment ".concat(s," of ").concat(this.playlistLabel()," ").concat(r,". The current chunk will not be buffered.")),null;const a=t[r],o=a.details,l=i>-1?zo(o,s,i):null,c=l?l.fragment:Vo(o,s,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,n,r,s){if(this.state!==ul)return;const{data1:i,data2:a}=e;let o=i;if(a&&(o=$s(i,a)),!o.length)return;const l=this.initPTS[t.cc],c=l?-l.baseTime/l.timescale:void 0,u={type:e.type,frag:t,part:n,chunkMeta:r,offset:c,parent:t.type,data:o};if(this.hls.trigger(qr.BUFFER_APPENDING,u),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Fa.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const n=t.currentTime,r=Fa.bufferInfo(t,n,0),s=e.duration,i=Math.min(2*this.config.maxFragLookUpTolerance,.25*s),a=Math.max(Math.min(e.start-i,r.end-i),n+i);e.start-a>i&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!Hr(r))return null;const s=this.lastCurrentTime>r||null!=(n=this.media)&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,s)}getFwdBufferInfoAtPos(e,t,n,r){const s=Fa.bufferInfo(e,t,r);if(0===s.len&&void 0!==s.nextStart){const i=this.fragmentTracker.getBufferedFrag(t,n);if(i&&(s.nextStart<=i.end||i.gap)){const n=Math.max(Math.min(s.nextStart,i.end)-t,r);return Fa.bufferInfo(e,t,n)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return n=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-3*t,n.maxMaxBufferLength/2,r);return s>=r&&(n.maxMaxBufferLength=s,this.warn("Reduce max buffer length to ".concat(s,"s")),!0)}getAppendedFrag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zr;const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:s}=this,i=n[0].start,a=s.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const n=s.initialLiveManifestSize;if(r<n)return this.warn("Not enough fragments to start playback (have: ".concat(r,", need: ").concat(n,")")),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<i){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);const n=this.hls.startPosition,r=this.hls.liveSyncPosition,s=o?(-1!==n&&n>=i?n:r)||o.start:e;this.log("Setting startPosition to ".concat(s," to match start frag at live edge. mainStart: ").concat(n," liveSyncPosition: ").concat(r," frag.start: ").concat(null==(l=o)?void 0:l.start)),this.startPosition=this.nextLoadPosition=s}}else e<=i&&(o=n[0]);if(!o){const n=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,n,t)}let c=this.filterReplacedPrimary(o,t);if(!c&&o){const e=o.sn-t.startSN;c=this.filterReplacedPrimary(n[e+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===ya||n===va&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,s){let i=null;if(e.gap&&(i=this.getNextFragment(this.nextLoadPosition,t),i&&!i.gap&&n.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(null!==e&&n.len+e.len>=s){const e=i.sn;return this.loopSn!==e&&(this.log('buffer full after gaps in "'.concat(r,'" playlist starting at sn: ').concat(e)),this.loopSn=e),null}}return this.loopSn=void 0,i}get primaryPrefetch(){if(vl(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(vl(this.config)&&e.type!==ts){const n=this.hls.interstitialsManager,r=null==n?void 0:n.bufferingItem;if(r){const n=r.event;if(n){if(n.appendInPlace||Math.abs(e.start-r.start)>1||0===r.start)return null}else{if(e.end<=r.start&&!1===(null==t?void 0:t.live))return null;if(e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}}const s=null==n?void 0:n.playerQueue;if(s)for(let t=s.length;t--;){const n=s[t].interstitial;if(n.appendInPlace&&e.start>=n.startTime&&e.end<=n.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,n){let r=-1,s=!1,i=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(i=i&&!o.independent,r>-1&&n<o.start)break;const l=o.loaded;l?r=-1:(s||(o.independent||i)&&o.fragment===t)&&(o.fragment!==t&&this.warn("Need buffer at ".concat(n," but next unloaded part starts at ").concat(o.start)),r=a),s=l}return r}loadedEndOfParts(e,t){let n;for(let r=e.length;r--;){if(n=e[r],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(n.programDateTime)),r=function(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!Hr(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;for(let r=0;r<e.length;++r){const s=e[r];if(Xi(t,n,s))return s}return null}(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const i=t[s-e.startSN];n.cc===i.cc&&(r=i,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(r.sn)))}r||(r=$i(e,n.cc,n.end),r&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(r.sn)))}}else{const t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:s}=this,{fragments:i,endSN:a}=n;const{fragmentHint:o}=n,{maxFragLookUpTolerance:l}=r,c=n.partList,u=!!(this.loadingParts&&null!=c&&c.length&&o);let d;if(u&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(i=i.concat(o),a=o.sn),e<t){var h;d=qi(s,i,e,e<this.lastCurrentTime||e>t-l||null!=(h=this.media)&&h.paused||!this.startFragRequested?0:l)}else d=i[i.length-1];if(d){const e=d.sn-n.startSN,t=this.fragmentTracker.getState(d);if((t===ya||t===va&&d.gap)&&(s=d),s&&d.sn===s.sn&&(!u||c[0].fragment.sn>d.sn||!n.live)){if(d.level===s.level){const t=i[e+1];d=d.sn<a&&this.fragmentTracker.getState(t)!==ya?t:null}}}return d}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,i=!t,a=e.alignedSliding&&Hr(s);if(i||!a&&!s){!function(e,t){e&&(Zo(t,e),t.alignedSliding||el(t,e),t.alignedSliding||t.skippedSegments||Go(e,t,!1))}(n,e);const s=e.fragmentStart;return this.log("Live playlist sliding: ".concat(s.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," fragments: ").concat(r)),s}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(-1===n){const s=null!==this.startTimeOffset,i=s?this.startTimeOffset:e.startTimeOffset;null!==i&&Hr(i)?(n=t+i,i<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log("Setting startPosition to ".concat(n," for start time offset ").concat(i," found in ").concat(s?"multivariant":"media"," playlist")),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge ".concat(n)),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Is(e)&&e.stats.aborted&&(this.log("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of ").concat(this.playlistLabel()," ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===ll)||(this.state=il)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var s;if(this.fragContextChanged(r))return void this.warn("Frag load error must match current frag to retry ".concat(r.url," > ").concat(null==(s=this.fragCurrent)?void 0:s.url));const i=t.details===Yr.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction;if(!a)return void(this.state=fl);const{action:o,flags:l,retryCount:c=0,retryConfig:u}=a,d=!!u,h=d&&o===ca,f=d&&!a.resolved&&l===da,g=null==(n=this.hls.latestLevelDetails)?void 0:n.live;if(!h&&f&&Is(r)&&!r.endList&&g&&!ea(t))this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((h||f)&&c<u.maxNumRetry){var m;const n=ia(null==(m=t.response)?void 0:m.code),s=na(u,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+s,this.state=ll,a.resolved=!0,n)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(t.reason="offline");this.warn("Fragment ".concat(r.sn," of ").concat(e," ").concat(r.level," errored with ").concat(t.details,", retrying loading ").concat(c+1,"/").concat(u.maxNumRetry," in ").concat(s,"ms"))}else if(u){if(this.resetFragmentErrors(e),!(c<u.maxNumRetry))return void this.warn("".concat(t.details," reached or exceeded max retry (").concat(c,")"));i||o===la||(a.resolved=!0)}else this.state=o===oa?ml:fl;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!ia(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=il)}reduceLengthAndFlushBuffer(e){if(this.state===ul||this.state===dl){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(null==t?void 0:t.duration)||10);const i=!s;return i&&this.warn("Buffer full error while media.currentTime (".concat(this.getLoadPosition(),") is not buffered, flush ").concat(n," buffer")),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),i}return!1}resetFragmentErrors(e){e===es&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==sl&&(this.state=il)}afterBufferFlushed(e,t,n){if(!e)return;const r=Fa.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===hl&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==sl&&(this.state=il)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log("Loading context changed while buffering sn ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(-1===e.level?"<removed>":e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const s=n.details;if(!s)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce((t,i)=>{const a=e.elementaryStreams[i];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn("Could not parse fragment ".concat(e.sn," ").concat(i," duration reliably (").concat(o,")")),t||!1;const l=r?0:Uo(s,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS,this);return this.hls.trigger(qr.LEVEL_PTS_UPDATED,{details:s,level:n,drift:l,type:i,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t},!1)){var i;const t=null===(null==(i=this.transmuxer)?void 0:i.error);if((0===n.fragmentError||t&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),t){const t=new Error("Found no media in fragment ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(this.warn(t.message),this.hls.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:"Found no media in msn ".concat(e.sn," of ").concat(this.playlistLabel(),' "').concat(n.url,'"')}),!this.hls)return;this.resetTransmuxer()}}this.state=dl,this.log("Parsed ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t),")")),this.hls.trigger(qr.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Zr?"level":"track"}fragInfo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;var r,s;return"".concat(this.playlistLabel()," ").concat(e.level," (").concat(n?"part":"frag",":[").concat((null!=(r=t&&!n?e.startPTS:(n||e).start)?r:NaN).toFixed(3),"-").concat((null!=(s=t&&!n?e.endPTS:(n||e).end)?s:NaN).toFixed(3),"]").concat(n&&"main"===e.type?"INDEPENDENT="+(n.independent?"YES":"NO"):"")}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}get state(){return this._state}}function vl(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class yl{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;return e.length?(n=1===e.length?e[0]:function(e,t){const n=new Uint8Array(t);let r=0;for(let s=0;s<e.length;s++){const t=e[s];n.set(t,r),r+=t.length}return n}(e,t),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var bl,El={exports:{}};var Sl=(bl||(bl=1,function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,a){if("function"!==typeof r)throw new TypeError("The listener must be a function");var o=new s(r,i||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,s=[];if(0===this._eventsCount)return s;for(r in e=this._events)t.call(e,r)&&s.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,a=new Array(i);s<i;s++)a[s]=r[s].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,s,i,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,s),!0;case 5:return u.fn.call(u.context,t,r,s,i),!0;case 6:return u.fn.call(u.context,t,r,s,i,a),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,s);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,s){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||s&&!o.once||r&&o.context!==r||a(this,i);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=1===c.length?c[0]:c:a(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(El)),El.exports),Tl=Es(Sl);const xl="1.6.15",kl={};function wl(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Ll(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Al(e,t){let n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3],n}function Rl(e,t){const n=t;let r=0;for(;Ll(e,t);){r+=10;r+=Al(e,t+6),wl(e,t+10)&&(r+=10),t+=r}if(r>0)return e.subarray(n,n+r)}function Il(e,t){return 255===e[t]&&240===(246&e[t+1])}function _l(e,t){return 1&e[t+1]?7:9}function Dl(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Pl(e,t){return t+1<e.length&&Il(e,t)}function Cl(e,t){if(Pl(e,t)){const n=_l(e,t);if(t+n>=e.length)return!1;const r=Dl(e,t);if(r<=n)return!1;const s=t+r;return s===e.length||Pl(e,s)}return!1}function Ol(e,t,n,r,s){if(!e.samplerate){const i=function(e,t,n,r){const s=t[n+2],i=s>>2&15;if(i>12){const t=new Error("invalid ADTS sampling index:".concat(i));return void e.emit(qr.ERROR,qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const a=1+(s>>6&3),o=t[n+3]>>6&3|(1&s)<<2,l="mp4a.40."+a,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][i];let u=i;5!==a&&29!==a||(u-=3);const d=[a<<3|(14&u)>>1,(1&u)<<7|o<<3];return gs.log("manifest codec:".concat(r,", parsed codec:").concat(l,", channels:").concat(o,", rate:").concat(c," (ADTS object type:").concat(a," sampling index:").concat(i,")")),{config:d,samplerate:c,channelCount:o,codec:l,parsedCodec:l,manifestCodec:r}}(t,n,r,s);if(!i)return;is(e,i)}}function Nl(e){return 9216e4/e}function Ml(e,t,n,r,s){const i=r+s*Nl(e.samplerate),a=function(e,t){const n=_l(e,t);if(t+n<=e.length){const r=Dl(e,t)-n;if(r>0)return{headerLength:n,frameLength:r}}}(t,n);let o;if(a){const{frameLength:r,headerLength:s}=a,l=s+r,c=Math.max(0,n+l-t.length);c?(o=new Uint8Array(l-s),o.set(t.subarray(n+s,t.length),0)):o=t.subarray(n+s,n+l);const u={unit:o,pts:i};return c||e.samples.push(u),{sample:u,length:l,missing:c}}const l=t.length-n;o=new Uint8Array(l),o.set(t.subarray(n,t.length),0);return{sample:{unit:o,pts:i},length:l,missing:-1}}function Fl(e,t){return Ll(e,t)&&Al(e,t+6)+10<=e.length-t}function Ul(e){return function(e,t,n,r){const s=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const a=(d=e,d&&d.buffer instanceof ArrayBuffer&&void 0!==d.byteLength&&void 0!==d.byteOffset?e.byteOffset:0),o=(a+e.byteLength)/i,l=(a+t)/i,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(n,0),o));var d;return new r(s,c,u-c)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,Uint8Array)}function Bl(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");const n=e.data.subarray(1).indexOf(0);if(-1===n)return;const r=vs(Ul(e.data,1,n)),s=e.data[2+n],i=e.data.subarray(3+n).indexOf(0);if(-1===i)return;const a=vs(Ul(e.data,3+n,i));let o;return o="--\x3e"===r?vs(Ul(e.data,4+n+i)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+n+i)),t.mimeType=r,t.pictureType=s,t.description=a,t.data=o,t}function jl(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=vs(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const n=vs(e.data.subarray(t),!0);t+=n.length+1;const r=vs(e.data.subarray(t));return{key:e.type,info:n,data:r}}const t=vs(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?Bl(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const n=vs(e.data.subarray(t),!0);t+=n.length+1;const r=vs(e.data.subarray(t));return{key:e.type,info:n,data:r}}const t=vs(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function Gl(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=Al(e,4);return{type:t,size:n,data:e.subarray(10,10+n)}}function Kl(e){let t=0;const n=[];for(;Ll(e,t);){const r=Al(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const s=t+r;for(;t+10<s;){const r=Gl(e.subarray(t)),s=jl(r);s&&n.push(s),t+=r.size+10}wl(e,t)&&(t+=10)}return n}function Hl(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function Vl(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),n=1&t[3];let r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}}function zl(e){const t=Kl(e);for(let n=0;n<t.length;n++){const e=t[n];if(Hl(e))return Vl(e)}}let Wl=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function Yl(){return{type:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",id:-1,pid:-1,inputTimeScale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,sequenceNumber:-1,samples:[],dropped:0}}class ql{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=$s(this.cachedData,e),this.cachedData=null);let n,r=Rl(e,0),s=r?r.length:0;const i=this._audioTrack,a=this._id3Track,o=r?zl(r):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&Hr(o))&&(this.basePTS=Ql(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Wl.audioId3,duration:Number.POSITIVE_INFINITY});s<l;){if(this.canParse(e,s)){const t=this.appendFrame(i,e,s);t?(this.frameIndex++,this.lastPTS=t.sample.pts,s+=t.length,n=s):s=l}else Fl(e,s)?(r=Rl(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Wl.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,n=s):s++;if(s===l&&n!==l){const t=e.slice(n);this.cachedData?this.cachedData=$s(this.cachedData,t):this.cachedData=t}}return{audioTrack:i,videoTrack:Yl(),id3Track:a,textTrack:Yl()}}demuxSampleAes(e,t,n){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Yl(),id3Track:this._id3Track,textTrack:Yl()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Ql=(e,t,n)=>{if(Hr(e))return 90*e;return 9e4*t+(n?9e4*n.baseTime/n.timescale:0)};let Xl=null;const $l=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Jl=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Zl=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ec=[0,1,1,4];function tc(e,t,n,r,s){if(n+24>t.length)return;const i=nc(t,n);if(i&&n+i.frameLength<=t.length){const a=r+s*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:t.subarray(n,n+i.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=i.channelCount,e.samplerate=i.sampleRate,e.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}function nc(e,t){const n=e[t+1]>>3&3,r=e[t+1]>>1&3,s=e[t+2]>>4&15,i=e[t+2]>>2&3;if(1!==n&&0!==s&&15!==s&&3!==i){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*$l[14*(3===n?3-r:3===r?3:4)+s-1],c=Jl[3*(3===n?0:2===n?1:2)+i],u=3===o?1:2,d=Zl[n][r],h=ec[r],f=8*d*h,g=Math.floor(d*l/c+a)*h;if(null===Xl){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Xl=e?parseInt(e[1]):0}return!!Xl&&Xl<=87&&2===r&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:u,frameLength:g,samplesPerFrame:f}}}function rc(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function sc(e,t){return t+1<e.length&&rc(e,t)}function ic(e,t){if(t+1<e.length&&rc(e,t)){const n=4,r=nc(e,t);let s=n;null!=r&&r.frameLength&&(s=r.frameLength);const i=t+s;return i===e.length||sc(e,i)}return!1}const ac=(e,t)=>{let n=0,r=5;t+=r;const s=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=e[t];const o=Math.min(r,8),l=8-o;i[0]=4278190080>>>24+l<<l,s[0]=(a[0]&i[0])>>l,n=n?n<<o|s[0]:s[0],t+=1,r-=o}return n};class oc extends ql{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=lc(e,t,n,this.basePTS,this.frameIndex);if(-1!==r){return{sample:e.samples[e.samples.length-1],length:r,missing:0}}}static probe(e){if(!e)return!1;const t=Rl(e,0);if(!t)return!1;const n=t.length;return 11===e[n]&&119===e[n+1]&&void 0!==zl(t)&&ac(e,n)<16}}function lc(e,t,n,r,s){if(n+8>t.length)return-1;if(11!==t[n]||119!==t[n+1])return-1;const i=t[n+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],o=63&t[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+i];if(n+l>t.length)return-1;const c=t[n+6]>>5;let u=0;2===c?u+=2:(1&c&&1!==c&&(u+=2),4&c&&(u+=2));const d=(t[n+6]<<8|t[n+7])>>12-u&1,h=[2,1,2,3,3,4,4,5][c]+d,f=t[n+5]>>3,g=7&t[n+5],m=new Uint8Array([i<<6|f<<1|g>>2,(3&g)<<6|c<<3|d<<2|o>>4,o<<4&224]),p=r+s*(1536/a*9e4),v=t.subarray(n,n+l);return e.config=m,e.channelCount=h,e.samplerate=a,e.samples.push({unit:v,pts:p}),l}const cc=/\/emsg[-/]ID3/i;function uc(e,t){return Hr(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class dc{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Ra(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,xa)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),i=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(i).then(s=>{const i=new Uint8Array(s);r.set(i,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)n.set(e.subarray(s,s+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(n.subarray(r,r+16),s);return e}decryptAvcSample(e,t,n,r,s){const i=ni(s.data),a=this.getAvcEncryptedData(i);this.decryptBuffer(a.buffer).then(a=>{s.data=this.getAvcDecryptedUnit(i,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)}).catch(r)}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void r();const s=e[t].units;for(;!(n>=s.length);n++){const i=s[n];if(!(i.data.length<=48||1!==i.type&&5!==i.type)&&(this.decryptAvcSample(e,t,n,r,i),!this.decrypter.isSync()))return}}}}class hc{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n,r=this.VideoSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!=(t=r)&&t.units){const e=r.units;n=e[e.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const n=t.samples,r=n.length;if(!r)return void t.dropped++;{const t=n[r-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let s=e.naluState||0;const i=s,a=[];let o,l,c,u=0,d=-1,h=0;for(-1===s&&(d=0,h=this.getNALuType(t,0),s=0,u=1);u<r;)if(o=t[u++],s)if(1!==s)if(o)if(1===o){if(l=u-s-1,d>=0){const e={data:t.subarray(d,l),type:h};a.push(e)}else{const n=this.getLastNalUnit(e.samples);n&&(i&&u<=4-i&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-i)),l>0&&(n.data=$s(n.data,t.subarray(0,l)),n.state=0))}u<r?(c=this.getNALuType(t,u),d=u,h=c,s=0):s=-1}else s=0;else s=3;else s=o?0:2;else s=o?0:1;if(d>=0&&s>=0){const e={data:t.subarray(d,r),type:h,state:s};a.push(e)}if(0===a.length){const n=this.getLastNalUnit(e.samples);n&&(n.data=$s(n.data,t))}return e.naluState=s,a}}class fc{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");r.set(e.subarray(n,n+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&gs.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class gc extends hc{parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let i,a=this.VideoSample,o=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(r=>{var s,l;switch(r.type){case 1:{let t=!1;i=!0;const s=r.data;if(o&&s.length>4){const e=this.readSliceType(s);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var c;if(t)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=t;break}case 5:i=!0,null!=(s=a)&&s.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:i=!0,ti(r.data,1,n.pts,t.samples);break;case 7:{var u,d;i=!0,o=!0;const t=r.data,n=this.readSPS(t);if(!e.sps||e.width!==n.width||e.height!==n.height||(null==(u=e.pixelRatio)?void 0:u[0])!==n.pixelRatio[0]||(null==(d=e.pixelRatio)?void 0:d[1])!==n.pixelRatio[1]){e.width=n.width,e.height=n.height,e.pixelRatio=n.pixelRatio,e.sps=[t];const r=t.subarray(1,4);let s="avc1.";for(let e=0;e<3;e++){let t=r[e].toString(16);t.length<2&&(t="0"+t),s+=t}e.codec=s}break}case 8:i=!0,e.pps=[r.data];break;case 9:i=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:i=!0;break;default:i=!1}if(a&&i){a.units.push(r)}}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new fc(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n,r=8,s=8;for(let i=0;i<e;i++)0!==s&&(n=t.readEG(),s=(r+n+256)%256),r=0===s?r:s}readSPS(e){const t=new fc(e);let n,r,s,i=0,a=0,o=0,l=0;const c=t.readUByte.bind(t),u=t.readBits.bind(t),d=t.readUEG.bind(t),h=t.readBoolean.bind(t),f=t.skipBits.bind(t),g=t.skipEG.bind(t),m=t.skipUEG.bind(t),p=this.skipScalingList.bind(this);c();const v=c();if(u(5),f(3),c(),m(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const e=d();if(3===e&&f(1),m(),m(),f(1),h())for(r=3!==e?8:12,s=0;s<r;s++)h()&&p(s<6?16:64,t)}m();const y=d();if(0===y)d();else if(1===y)for(f(1),g(),g(),n=d(),s=0;s<n;s++)g();m(),f(1);const b=d(),E=d(),S=u(1);0===S&&f(1),f(1),h()&&(i=d(),a=d(),o=d(),l=d());let T=[1,1];if(h()&&h()){switch(c()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(b+1)-2*i-2*a),height:(2-S)*(E+1)*16-(S?2:4)*(o+l),pixelRatio:T}}}class mc extends hc{constructor(){super(...arguments),this.initVPS=null}parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let i,a=this.VideoSample,o=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(r=>{var s,l;switch(r.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,i=!0;break;case 16:case 17:case 18:case 21:var c;if(i=!0,o)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:i=!0,null!=(s=a)&&s.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:i=!0,ti(r.data,2,n.pts,t.samples);break;case 32:i=!0,e.vps||("object"!==typeof e.params&&(e.params={}),e.params=is(e.params,this.readVPS(r.data)),this.initVPS=r.data),e.vps=[r.data];break;case 33:if(i=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],r.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(r.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!==typeof e.params&&(e.params={});for(const n in t.params)e.params[n]=t.params[n]}this.pushParameterSet(e.sps,r.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(i=!0,"object"===typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(r.data);for(const n in t)e.params[n]=t[n]}this.pushParameterSet(e.pps,r.data,e.vps)}break;case 35:i=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:i=!1}if(a&&i){a.units.push(r)}}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&3===e[r]&&0===e[r-1]&&0===e[r-2]||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new fc(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new fc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),i=t.readBits(5),a=t.readUByte(),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),g=t.readUByte(),m=t.readUByte(),p=t.readUByte(),v=[],y=[];for(let W=0;W<n;W++)v.push(t.readBoolean()),y.push(t.readBoolean());if(n>0)for(let W=n;W<8;W++)t.readBits(2);for(let W=0;W<n;W++)v[W]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[W]&&t.readUByte();t.readUEG();const b=t.readUEG();3==b&&t.skipBits(1);const E=t.readUEG(),S=t.readUEG(),T=t.readBoolean();let x=0,k=0,w=0,L=0;T&&(x+=t.readUEG(),k+=t.readUEG(),w+=t.readUEG(),L+=t.readUEG());const A=t.readUEG(),R=t.readUEG(),I=t.readUEG();for(let W=t.readBoolean()?0:n;W<=n;W++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let n=0;n<(3===e?2:6);n++){if(t.readBoolean()){const n=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<n;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const _=t.readUEG();let D=0;for(let W=0;W<_;W++){let e=!1;if(0!==W&&(e=t.readBoolean()),e){W===_&&t.readUEG(),t.readBoolean(),t.readUEG();let e=0;for(let n=0;n<=D;n++){const n=t.readBoolean();let r=!1;n||(r=t.readBoolean()),(n||r)&&e++}D=e}else{const e=t.readUEG(),n=t.readUEG();D=e+n;for(let r=0;r<e;r++)t.readUEG(),t.readBoolean();for(let r=0;r<n;r++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let n=0;n<e;n++){for(let e=0;e<I+4;e++)t.readBits(1);t.readBits(1)}}let P=0,C=1,O=1,N=!0,M=1,F=0;t.readBoolean(),t.readBoolean();let U=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(C=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(C=t.readBits(16),O=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readBoolean(),U&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG());if(t.readBoolean()){M=t.readBits(32),F=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),r=t.readBoolean();let s=!1;(e||r)&&(s=t.readBoolean(),s&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),s&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let i=0;i<=n;i++){N=t.readBoolean();let n=!1;N||t.readBoolean()?t.readEG():n=t.readBoolean();const i=n?1:t.readUEG()+1;if(e)for(let e=0;e<i;e++)t.readUEG(),t.readUEG(),s&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(r)for(let e=0;e<i;e++)t.readUEG(),t.readUEG(),s&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let B=E,j=S;if(T){let e=1,t=1;1===b?e=t=2:2==b&&(e=2),B=E-e*k-e*x,j=S-t*L-t*w}const G=r?["A","B","C"][r]:"",K=a<<24|o<<16|l<<8|c;let H=0;for(let W=0;W<32;W++)H=(H|(K>>W&1)<<31-W)>>>0;let V=H.toString(16);1===i&&"2"===V&&(V="6");const z=s?"H":"L";return{codecString:"hvc1.".concat(G).concat(i,".").concat(V,".").concat(z).concat(p,".B0"),params:{general_tier_flag:s,general_profile_idc:i,general_profile_space:r,general_profile_compatibility_flags:[a,o,l,c],general_constraint_indicator_flags:[u,d,h,f,g,m],general_level_idc:p,bit_depth:A+8,bit_depth_luma_minus8:A,bit_depth_chroma_minus8:R,min_spatial_segmentation_idc:P,chroma_format_idc:b,frame_rate:{fixed:N,fps:F/M}},width:B,height:j,pixelRatio:[C,O]}}readPPS(e){const t=new fc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let s=1;return r&&n?s=0:r?s=3:n&&(s=2),{parallelismType:s}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const pc=188;class vc{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=vc.syncOffset(e);return n>0&&t.warn("MPEG2-TS detected but first sync word found @ offset ".concat(n)),-1!==n}static syncOffset(e){const t=e.length;let n=Math.min(940,t-pc)+1,r=0;for(;r<n;){let s=!1,i=-1,a=0;for(let o=r;o<t;o+=pc){if(71!==e[o]||t-o!==pc&&71!==e[o+pc]){if(a)return-1;break}if(a++,-1===i&&(i=o,0!==i&&(n=Math.min(i+18612,e.length-pc)+1)),s||(s=0===yc(e,o)),s&&a>1&&(0===i&&a>2||o+pc>n))return i}r++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Ns[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=vc.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=vc.createTrack("audio",r),this._id3Track=vc.createTrack("id3"),this._txtTrack=vc.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t){let n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r||(this.sampleAes=null);const i=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=i.pid,u=i.pesData,d=a.pid,h=o.pid,f=a.pesData,g=o.pesData,m=null,p=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=$s(this.remainderData,e)).length,this.remainderData=null),y<pc&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:i,id3Track:o,textTrack:l};const b=Math.max(0,vc.syncOffset(e));y-=(y-b)%pc,y<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let E=0;for(let T=b;T<y;T+=pc)if(71===e[T]){const t=!!(64&e[T+1]),s=yc(e,T);let y;if((48&e[T+3])>>4>1){if(y=T+5+e[T+4],y===T+pc)continue}else y=T+4;switch(s){case c:t&&(u&&(n=xc(u,this.logger))&&(this.readyVideoParser(i.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(i,l,n,!1)),u={data:[],size:0}),u&&(u.data.push(e.subarray(y,T+pc)),u.size+=T+pc-y);break;case d:if(t){if(f&&(n=xc(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,n);break;case"mp3":this.parseMPEGPES(a,n);break;case"ac3":this.parseAC3PES(a,n)}f={data:[],size:0}}f&&(f.data.push(e.subarray(y,T+pc)),f.size+=T+pc-y);break;case h:t&&(g&&(n=xc(g,this.logger))&&this.parseID3PES(o,n),g={data:[],size:0}),g&&(g.data.push(e.subarray(y,T+pc)),g.size+=T+pc-y);break;case 0:t&&(y+=e[y]+1),v=this._pmtId=bc(e,y);break;case v:{t&&(y+=e[y]+1);const n=Ec(e,y,this.typeSupported,r,this.observer,this.logger);c=n.videoPid,c>0&&(i.pid=c,i.segmentCodec=n.segmentVideoCodec),d=n.audioPid,d>0&&(a.pid=d,a.segmentCodec=n.segmentAudioCodec),h=n.id3Pid,h>0&&(o.pid=h),null===m||p||(this.logger.warn("MPEG-TS PMT found at ".concat(T," after unknown PID '").concat(m,"'. Backtracking to sync byte @").concat(b," to parse all TS packets.")),m=null,T=b-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=s}}else E++;E>0&&Sc(this.observer,new Error("Found ".concat(E," TS packet/s that do not start with 0x47")),void 0,this.logger),i.pesData=u,a.pesData=f,o.pesData=g;const S={audioTrack:a,videoTrack:i,id3Track:o,textTrack:l};return s&&this.extractRemainingSamples(S),S}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:s}=e,i=n.pesData,a=t.pesData,o=r.pesData;let l;if(i&&(l=xc(i,this.logger))?(this.readyVideoParser(n.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(n,s,l,!0),n.pesData=null)):n.pesData=i,a&&(l=xc(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=xc(o,this.logger))?(this.parseID3PES(r,l),r.pesData=null):r.pesData=o}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new dc(this.observer,this.config,t);return this.decrypt(r,s)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new gc:"hevc"===e&&(this.videoParser=new mc))}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let s,i,a,o=t.data;if(r){this.aacOverFlow=null;const t=r.missing,s=r.sample.unit.byteLength;if(-1===t)o=$s(r.sample.unit,o);else{const i=s-t;r.sample.unit.set(o.subarray(0,t),i),e.samples.push(r.sample),n=r.missing}}for(s=n,i=o.length;s<i-1&&!Pl(o,s);s++);if(s!==n){let e;const t=s<i-1;if(e=t?"AAC PES did not start with ADTS header,offset:".concat(s):"No ADTS header found in AAC PES",Sc(this.observer,new Error(e),t,this.logger),!t)return}if(Ol(e,this.observer,o,s,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!r)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=Nl(e.samplerate);a=r.sample.pts+t}}let l,c=0;for(;s<i;){if(l=Ml(e,o,s,a,c),s+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;s<i-1&&!Pl(o,s);s++);}}parseMPEGPES(e,t){const n=t.data,r=n.length;let s=0,i=0;const a=t.pts;if(void 0!==a)for(;i<r;)if(sc(n,i)){const t=tc(e,n,i,a,s);if(!t)break;i+=t.length,s++}else i++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(void 0===r)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const s=n.length;let i,a=0,o=0;for(;o<s&&(i=lc(e,n,o,r,a++))>0;)o+=i}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=is({},t,{type:this._videoTrack?Wl.emsg:Wl.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function yc(e,t){return((31&e[t+1])<<8)+e[t+2]}function bc(e,t){return(31&e[t+10])<<8|e[t+11]}function Ec(e,t,n,r,s,i){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=yc(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!r){Tc("ADTS AAC",i);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!r){Tc("H.264",i);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:n.mpeg||n.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):i.log("MPEG audio found, not supported in this browser");break;case 193:if(!r){Tc("AC-3",i);break}case 129:n.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let r=t+5,s=l;for(;s>2;){if(106===e[r])!0!==n.ac3?i.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const t=e[r+1]+2;r+=t,s-=t}}break;case 194:case 135:return Sc(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"))}t+=l+5}return a}function Sc(e,t,n,r){r.warn("parsing error: ".concat(t.message)),e.emit(qr.ERROR,qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:t,reason:t.message})}function Tc(e,t){t.log("".concat(e," with AES-128-CBC encryption found in unencrypted stream"))}function xc(e,t){let n,r,s,i,a,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=$s(l[0],l[1]),l.splice(1,1);n=l[0];if(1===(n[0]<<16)+(n[1]<<8)+n[2]){if(r=(n[4]<<8)+n[5],r&&r>e.size-6)return null;const c=n[7];192&c&&(i=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&c?(a=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2,i-a>54e5&&(t.warn("".concat(Math.round((i-a)/9e4),"s delta between PTS and DTS, align them")),i=a)):a=i),s=n[8];let u=s+9;if(e.size<=u)return null;e.size-=u;const d=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){n=l[e];let t=n.byteLength;if(u){if(u>t){u-=t;continue}n=n.subarray(u),t-=u,u=0}d.set(n,o),o+=t}return r&&(r-=s+3),{data:d,pts:i,dts:a,len:r}}return null}class kc{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const wc=Math.pow(2,32)-1;class Lc{static init(){let e;for(e in Lc.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Lc.types)Lc.types.hasOwnProperty(e)&&(Lc.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Lc.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);Lc.STTS=Lc.STSC=Lc.STCO=s,Lc.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Lc.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Lc.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Lc.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const i=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Lc.FTYP=Lc.box(Lc.types.ftyp,i,o,i,a),Lc.DINF=Lc.box(Lc.types.dinf,Lc.box(Lc.types.dref,r))}static box(e){let t=8;for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];let i=r.length;const a=i;for(;i--;)t+=r[i].byteLength;const o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),i=0,t=8;i<a;i++)o.set(r[i],t),t+=r[i].byteLength;return o}static hdlr(e){return Lc.box(Lc.types.hdlr,Lc.HDLR_TYPES[e])}static mdat(e){return Lc.box(Lc.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(wc+1)),r=Math.floor(t%(wc+1));return Lc.box(Lc.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(e){return Lc.box(Lc.types.mdia,Lc.mdhd(e.timescale||0,e.duration||0),Lc.hdlr(e.type),Lc.minf(e))}static mfhd(e){return Lc.box(Lc.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?Lc.box(Lc.types.minf,Lc.box(Lc.types.smhd,Lc.SMHD),Lc.DINF,Lc.stbl(e)):Lc.box(Lc.types.minf,Lc.box(Lc.types.vmhd,Lc.VMHD),Lc.DINF,Lc.stbl(e))}static moof(e,t,n){return Lc.box(Lc.types.moof,Lc.mfhd(e),Lc.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=Lc.trak(e[t]);return Lc.box.apply(null,[Lc.types.moov,Lc.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(Lc.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=Lc.trex(e[t]);return Lc.box.apply(null,[Lc.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(wc+1)),r=Math.floor(t%(wc+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Lc.box(Lc.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,n[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return Lc.box(Lc.types.sdtp,n)}static stbl(e){return Lc.box(Lc.types.stbl,Lc.stsd(e),Lc.box(Lc.types.stts,Lc.STTS),Lc.box(Lc.types.stsc,Lc.STSC),Lc.box(Lc.types.stsz,Lc.STSZ),Lc.box(Lc.types.stco,Lc.STCO))}static avc1(e){let t,n,r,s=[],i=[];for(t=0;t<e.sps.length;t++)n=e.sps[t],r=n.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(n));for(t=0;t<e.pps.length;t++)n=e.pps[t],r=n.byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(n));const a=Lc.box(Lc.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(i))),o=e.width,l=e.height,c=e.pixelRatio[0],u=e.pixelRatio[1];return Lc.box(Lc.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,Lc.box(Lc.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Lc.box(Lc.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return Lc.box(Lc.types.mp4a,Lc.audioStsd(e),Lc.box(Lc.types.esds,Lc.esds(e)))}static mp3(e){return Lc.box(Lc.types[".mp3"],Lc.audioStsd(e))}static ac3(e){return Lc.box(Lc.types["ac-3"],Lc.audioStsd(e),Lc.box(Lc.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return Lc.box(Lc.types.stsd,Lc.STSD,Lc.mp4a(e));if("ac3"===t&&e.config)return Lc.box(Lc.types.stsd,Lc.STSD,Lc.ac3(e));if("mp3"===t&&"mp3"===e.codec)return Lc.box(Lc.types.stsd,Lc.STSD,Lc.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return Lc.box(Lc.types.stsd,Lc.STSD,Lc.avc1(e));if("hevc"===t&&e.vps)return Lc.box(Lc.types.stsd,Lc.STSD,Lc.hvc1(e))}throw new Error("unsupported ".concat(e.type," segment codec (").concat(t,"/").concat(e.codec,")"))}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,i=Math.floor(n/(wc+1)),a=Math.floor(n%(wc+1));return Lc.box(Lc.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,s>>8&255,255&s,0,0]))}static traf(e,t){const n=Lc.sdtp(e),r=e.id,s=Math.floor(t/(wc+1)),i=Math.floor(t%(wc+1));return Lc.box(Lc.types.traf,Lc.box(Lc.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),Lc.box(Lc.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i])),Lc.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,Lc.box(Lc.types.trak,Lc.tkhd(e),Lc.mdia(e))}static trex(e){const t=e.id;return Lc.box(Lc.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,s=12+16*r,i=new Uint8Array(s);let a,o,l,c,u,d;for(t+=8+s,i.set(["video"===e.type?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<r;a++)o=n[a],l=o.duration,c=o.size,u=o.flags,d=o.cts,i.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*a);return Lc.box(Lc.types.trun,i)}static initSegment(e){Lc.types||Lc.init();const t=Lc.moov(e);return $s(Lc.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let s=r.length;for(let h=0;h<n.length;h+=1){s+=3;for(let e=0;e<n[h].length;e+=1)s+=2+n[h][e].length}const i=new Uint8Array(s);i.set(r,0),s=r.length;const a=n.length-1;for(let h=0;h<n.length;h+=1){i.set(new Uint8Array([32+h|(h===a?128:0),0,n[h].length]),s),s+=3;for(let e=0;e<n[h].length;e+=1)i.set(new Uint8Array([n[h][e].length>>8,255&n[h][e].length]),s),s+=2,i.set(n[h][e],s),s+=n[h][e].length}const o=Lc.box(Lc.types.hvcC,i),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return Lc.box(Lc.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Lc.box(Lc.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Lc.box(Lc.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))}}Lc.types=void 0,Lc.HDLR_TYPES=void 0,Lc.STTS=void 0,Lc.STSC=void 0,Lc.STCO=void 0,Lc.STSZ=void 0,Lc.VMHD=void 0,Lc.SMHD=void 0,Lc.STSD=void 0,Lc.FTYP=void 0,Lc.DINF=void 0;function Ac(e,t){const n=e*t*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?Math.round(n):n}function Rc(e){return Ac(e,1e3,1/9e4,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}function Ic(e){const{baseTime:t,timescale:n,trackId:r}=e;return"".concat(t/n," (").concat(t,"/").concat(n,") trackId: ").concat(r)}let _c,Dc=null,Pc=null;function Cc(e,t,n,r){return{duration:t,size:n,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class Oc extends ls{constructor(e,t,n,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===Dc){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Dc=e?parseInt(e[1]):0}if(null===Pc){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Pc=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;t&&e&&e.trackId===t.trackId&&e.baseTime===t.baseTime&&e.timescale===t.timescale||this.log("Reset initPTS: ".concat(t?Ic(t):t," > ").concat(e?Ic(e):e)),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((e,r)=>{let s=r.pts,i=s-e;return i<-4294967296&&(t=!0,s=Nc(s,n),i=s-e),i>0?e:s},n);return t&&this.debug("PTS rollover detected"),r}remux(e,t,n,r,s,i,a,o){let l,c,u,d,h,f,g=s,m=s;const p=e.pid>-1,v=t.pid>-1,y=t.samples.length,b=e.samples.length>0,E=a&&y>0||y>1;if((!p||b)&&(!v||E)||this.ISGenerated||a){if(this.ISGenerated){var S,T,x,k;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(S=t.pixelRatio)?void 0:S[0])!==(null==(T=e.pixelRatio)?void 0:T[0])||(null==(x=t.pixelRatio)?void 0:x[1])!==(null==(k=e.pixelRatio)?void 0:k[1]))||!e&&E||null===this.nextAudioTs&&b)&&this.resetInitSegment()}this.ISGenerated||(u=this.generateIS(e,t,s,i));const n=this.isVideoContiguous;let r,a=-1;if(E&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){this.warn("Dropped ".concat(a," out of ").concat(y," video samples due to a missing keyframe"));const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,m+=(t.samples[0].pts-e)/t.inputTimeScale,r=m}else-1===a&&(this.warn("No keyframe found out of ".concat(y," video samples")),f=!1);if(this.ISGenerated){if(b&&E){const n=this.getVideoStartPts(t.samples),r=(Nc(e.samples[0].pts,n)-n)/t.inputTimeScale;g+=Math.max(0,r),m+=Math.max(0,-r)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),u=this.generateIS(e,t,s,i)),c=this.remuxAudio(e,g,this.isAudioContiguous,i,v||E||o===es?m:void 0),E){const r=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),u=this.generateIS(e,t,s,i)),l=this.remuxVideo(t,m,n,r)}}else E&&(l=this.remuxVideo(t,m,n,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(h=Mc(n,s,this._initPTS,this._initDTS)),r.samples.length&&(d=Fc(r,s,this._initPTS))),{audio:c,video:l,initSegment:u,independent:f,text:d,id3:h}}computeInitPts(e,t,n,r){const s=Math.round(n*t);let i=Nc(e,s);if(i<s+t)for(this.log("Adjusting PTS for rollover in timeline near ".concat((s-i)/t," ").concat(r));i<s+t;)i+=8589934592;return i-s}generateIS(e,t,n,r){const s=e.samples,i=t.samples,a=this.typeSupported,o={},l=this._initPTS;let c,u,d,h=!l||r,f="audio/mp4",g=-1;if(h&&(c=u=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):Lc.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(g=e.id,d=e.inputTimeScale,l&&d===l.timescale?h=!1:c=u=this.computeInitPts(s[0].pts,d,n,"audio"))}if(t.sps&&t.pps&&i.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Lc.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(g=t.id,d=t.inputTimeScale,l&&d===l.timescale)h=!1;else{const e=this.getVideoStartPts(i),t=Nc(i[0].dts,e),r=this.computeInitPts(t,d,n,"video"),s=this.computeInitPts(e,d,n,"video");u=Math.min(u,r),c=Math.min(c,s)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,h?(l&&this.warn("Timestamps at playlist time: ".concat(r?"":"~").concat(n," ").concat(c/d," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(n," offset: ").concat(c/d," (").concat(c,"/").concat(d,") trackId: ").concat(g)),this._initPTS={baseTime:c,timescale:d,trackId:g},this._initDTS={baseTime:u,timescale:d,trackId:g}):c=d=void 0,{tracks:o,initPTS:c,timescale:d,trackId:g}}remuxVideo(e,t,n,r){const s=e.inputTimeScale,i=e.samples,a=[],o=i.length,l=this._initPTS,c=l.baseTime*s/l.timescale;let u,d,h=this.nextVideoTs,f=8,g=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,v=!1;if(!n||null===h){const e=c+t*s,r=i[0].pts-Nc(i[0].dts,i[0].pts);Dc&&null!==h&&Math.abs(e-r-(h+c))<15e3?n=!0:h=e-r-c}const y=h+c;for(let N=0;N<o;N++){const e=i[N];e.pts=Nc(e.pts,y),e.dts=Nc(e.dts,y),e.dts<i[N>0?N-1:N].dts&&(v=!0)}v&&i.sort(function(e,t){const n=e.dts-t.dts,r=e.pts-t.pts;return n||r}),u=i[0].dts,d=i[i.length-1].dts;const b=d-u,E=b?Math.round(b/(o-1)):g||e.inputTimeScale/30;if(n){const n=u-y,r=n>E,s=n<-1;if((r||s)&&(r?this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(Rc(n,!0)," ms (").concat(n,"dts) hole between fragments detected at ").concat(t.toFixed(3))):this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(Rc(-n,!0)," ms (").concat(n,"dts) overlapping between fragments detected at ").concat(t.toFixed(3))),!s||y>=i[0].pts||Dc)){u=y;const e=i[0].pts-n;if(r)i[0].dts=u,i[0].pts=e;else{let t=!0;for(let r=0;r<i.length&&!(i[r].dts>e&&t);r++){const e=i[r].pts;if(i[r].dts-=n,i[r].pts-=n,r<i.length-1){const n=i[r+1].pts;t=n<=i[r].pts==n<=e}}}this.log("Video: Initial PTS/DTS adjusted: ".concat(Rc(e,!0),"/").concat(Rc(u,!0),", delta: ").concat(Rc(n,!0)," ms"))}}u=Math.max(0,u);let S=0,T=0,x=u;for(let N=0;N<o;N++){const e=i[N],t=e.units,n=t.length;let r=0;for(let s=0;s<n;s++)r+=t[s].data.length;T+=r,S+=n,e.length=r,e.dts<x?(e.dts=x,x+=E/4|0||1):x=e.dts,m=Math.min(e.pts,m),p=Math.max(e.pts,p)}d=i[o-1].dts;const k=T+4*S+8;let w;try{w=new Uint8Array(k)}catch(O){return void this.observer.emit(qr.ERROR,qr.ERROR,{type:Wr.MUX_ERROR,details:Yr.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:k,reason:"fail allocating video mdat ".concat(k)})}const L=new DataView(w.buffer);L.setUint32(0,k),w.set(Lc.types.mdat,4);let A=!1,R=Number.POSITIVE_INFINITY,I=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,D=Number.NEGATIVE_INFINITY;for(let N=0;N<o;N++){const e=i[N],t=e.units;let n,l=0;for(let r=0,s=t.length;r<s;r++){const e=t[r],n=e.data,s=e.data.byteLength;L.setUint32(f,s),f+=4,w.set(n,f),f+=s,l+=4+s}if(N<o-1)g=i[N+1].dts-e.dts,n=i[N+1].pts-e.pts;else{const t=this.config,a=N>0?e.dts-i[N-1].dts:E;if(n=N>0?e.pts-i[N-1].pts:E,t.stretchShortVideoTrack&&null!==this.nextAudioTs){const n=Math.floor(t.maxBufferHole*s),i=(r?m+r*s:this.nextAudioTs+c)-e.pts;i>n?(g=i-a,g<0?g=a:A=!0,this.log("It is approximately ".concat(i/90," ms to the next segment; using duration ").concat(g/90," ms for the last video frame."))):g=a}else g=a}const u=Math.round(e.pts-e.dts);R=Math.min(R,g),_=Math.max(_,g),I=Math.min(I,n),D=Math.max(D,n),a.push(Cc(e.key,g,l,u))}if(a.length)if(Dc){if(Dc<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Pc&&D-I<_-R&&E/_<.025&&0===a[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,n=a.length;t<n;t++){const r=e+a[t].duration,s=e+a[t].cts;if(t<n-1){const e=r+a[t+1].cts;a[t].duration=e-s}else a[t].duration=t?a[t-1].duration:E;a[t].cts=0,e=r}}g=A||!g?E:g;const P=d+g;this.nextVideoTs=h=P-c,this.videoSampleDuration=g,this.isVideoContiguous=!0;const C={data1:Lc.moof(e.sequenceNumber++,u,is(e,{samples:a})),data2:w,startPTS:(m-c)/s,endPTS:(p+g-c)/s,startDTS:(u-c)/s,endDTS:h/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,C}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,n,r,s){const i=e.inputTimeScale,a=i/(e.samplerate?e.samplerate:i),o=this.getSamplesPerFrame(e),l=o*a,c=this._initPTS,u="mp3"===e.segmentCodec&&this.typeSupported.mpeg,d=[],h=void 0!==s;let f=e.samples,g=u?0:8,m=this.nextAudioTs||-1;const p=c.baseTime*i/c.timescale,v=p+t*i;if(this.isAudioContiguous=n=n||f.length&&m>0&&(r&&Math.abs(v-(m+p))<9e3||Math.abs(Nc(f[0].pts,v)-(m+p))<20*l),f.forEach(function(e){e.pts=Nc(e.pts,v)}),!n||m<0){const e=f.length;if(f=f.filter(e=>e.pts>=0),e!==f.length&&this.warn("Removed ".concat(f.length-e," of ").concat(e," samples (initPTS ").concat(p," / ").concat(i,")")),!f.length)return;m=0===s?0:r&&!h?Math.max(0,v-p):f[0].pts-p}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let n=0,r=m+p;n<f.length;n++){const s=f[n],a=s.pts,o=a-r,c=Math.abs(1e3*o/i);if(o<=-t*l&&h)0===n&&(this.warn("Audio frame @ ".concat((a/i).toFixed(3),"s overlaps marker by ").concat(Math.round(1e3*o/i)," ms.")),this.nextAudioTs=m=a-p,r=a);else if(o>=t*l&&c<1e4&&h){let t=Math.round(o/l);for(r=a-t*l;r<0&&t&&l;)t--,r+=l;0===n&&(this.nextAudioTs=m=r-p),this.warn("Injecting ".concat(t," audio frames @ ").concat(((r-p)/i).toFixed(3),"s due to ").concat(Math.round(1e3*o/i)," ms gap."));for(let i=0;i<t;i++){let t=kc.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=s.unit.subarray()),f.splice(n,0,{unit:t,pts:r}),r+=l,n++}}s.pts=r,r+=l}}let y,b=null,E=null,S=0,T=f.length;for(;T--;)S+=f[T].unit.byteLength;for(let _=0,D=f.length;_<D;_++){const t=f[_],r=t.unit;let s=t.pts;if(null!==E){d[_-1].duration=Math.round((s-E)/a)}else{if(n&&"aac"===e.segmentCodec&&(s=m+p),b=s,!(S>0))return;S+=g;try{y=new Uint8Array(S)}catch(I){return void this.observer.emit(qr.ERROR,qr.ERROR,{type:Wr.MUX_ERROR,details:Yr.REMUX_ALLOC_ERROR,fatal:!1,error:I,bytes:S,reason:"fail allocating audio mdat ".concat(S)})}if(!u){new DataView(y.buffer).setUint32(0,S),y.set(Lc.types.mdat,4)}}y.set(r,g);const i=r.byteLength;g+=i,d.push(Cc(!0,o,i,0)),E=s}const x=d.length;if(!x)return;const k=d[d.length-1];m=E-p,this.nextAudioTs=m+a*k.duration;const w=u?new Uint8Array(0):Lc.moof(e.sequenceNumber++,b/a,is({},e,{samples:d}));e.samples=[];const L=(b-p)/i,A=this.nextAudioTs/i,R={data1:w,data2:y,startPTS:L,endPTS:A,startDTS:L,endDTS:A,type:"audio",hasAudio:!0,hasVideo:!1,nb:x};return this.isAudioContiguous=!0,R}}function Nc(e,t){let n;if(null===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}function Mc(e,t,n,r){const s=e.samples.length;if(!s)return;const i=e.inputTimeScale;for(let o=0;o<s;o++){const s=e.samples[o];s.pts=Nc(s.pts-n.baseTime*i/n.timescale,t*i)/i,s.dts=Nc(s.dts-r.baseTime*i/r.timescale,t*i)/i}const a=e.samples;return e.samples=[],{samples:a}}function Fc(e,t,n){const r=e.samples.length;if(!r)return;const s=e.inputTimeScale;for(let a=0;a<r;a++){const r=e.samples[a];r.pts=Nc(r.pts-n.baseTime*s/n.timescale,t*s)/s}e.samples.sort((e,t)=>e.pts-t.pts);const i=e.samples;return e.samples=[],{samples:i}}function Uc(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==(null==e?void 0:e.start)?(e.start+(n?e.duration:0))/e.timescale:t}function Bc(e,t,n){const r=e.codec;if(r&&r.length>4)return r;if(t===ws){if("ec-3"===r||"ac-3"===r||"alac"===r)return r;if("fLaC"===r||"Opus"===r){return mi(r,!1)}return n.warn('Unhandled audio codec "'.concat(r,'" in mp4 MAP')),r||"mp4a"}return n.warn('Unhandled video codec "'.concat(r,'" in mp4 MAP')),r||"avc1"}try{_c=self.performance.now.bind(self.performance)}catch(uf){_c=Date.now}const jc=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const s=this.videoTrack=Yl("video",1),i=this.audioTrack=Yl("audio",1),a=this.txtTrack=Yl("text",1);if(this.id3Track=Yl("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Hs(e);if(o.video){const{id:e,timescale:t,codec:n,supplemental:r}=o.video;s.id=e,s.timescale=a.timescale=t,s.codec=n,s.supplemental=r}if(o.audio){const{id:e,timescale:t,codec:n}=o.audio;i.id=e,i.timescale=t,i.codec=n}a.id=Ns.text,s.sampleDuration=0,s.duration=i.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let n=0;n<t;){const r=Us(e,n);if(r>8&&109===e[n+4]&&111===e[n+5]&&111===e[n+6]&&102===e[n+7])return!0;n=r>1?n+r:t}return!1}(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=$s(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},n=Gs(e,["moof"]);if(n.length<2)return t.remainder=e,t;const r=n[n.length-1];return t.valid=e.slice(0,r.byteOffset-8),t.remainder=e.slice(r.byteOffset-8),t}(n);this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array}else r.samples=n;const i=this.extractID3Track(r,t);return s.samples=Js(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:i,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=Js(e,t),{videoTrack:t,audioTrack:Yl(),id3Track:r,textTrack:Yl()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=Gs(e.samples,["emsg"]);r&&r.forEach(e=>{const r=function(e){const t=e[0];let n="",r="",s=0,i=0,a=0,o=0,l=0,c=0;if(0===t){for(;"\0"!==Ms(e.subarray(c,c+1));)n+=Ms(e.subarray(c,c+1)),c+=1;for(n+=Ms(e.subarray(c,c+1)),c+=1;"\0"!==Ms(e.subarray(c,c+1));)r+=Ms(e.subarray(c,c+1)),c+=1;r+=Ms(e.subarray(c,c+1)),c+=1,s=Us(e,12),i=Us(e,16),o=Us(e,20),l=Us(e,24),c=28}else if(1===t){c+=4,s=Us(e,c),c+=4;const t=Us(e,c);c+=4;const i=Us(e,c);for(c+=4,a=2**32*t+i,Vr(a)||(a=Number.MAX_SAFE_INTEGER,gs.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Us(e,c),c+=4,l=Us(e,c),c+=4;"\0"!==Ms(e.subarray(c,c+1));)n+=Ms(e.subarray(c,c+1)),c+=1;for(n+=Ms(e.subarray(c,c+1)),c+=1;"\0"!==Ms(e.subarray(c,c+1));)r+=Ms(e.subarray(c,c+1)),c+=1;r+=Ms(e.subarray(c,c+1)),c+=1}return{schemeIdUri:n,value:r,timeScale:s,presentationTime:a,presentationTimeDelta:i,eventDuration:o,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(cc.test(r.schemeIdUri)){const e=uc(r,t);let s=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;s<=.001&&(s=Number.POSITIVE_INFINITY);const i=r.payload;n.samples.push({data:i,len:i.byteLength,dts:e,pts:e,type:Wl.emsg,duration:s})}else if(this.config.enableEmsgKLVMetadata&&r.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=uc(r,t);n.samples.push({data:r.payload,len:r.payload.byteLength,dts:e,pts:e,type:Wl.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends ls{constructor(e,t,n,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:s,video:i}=this.initData=Hs(e);if(t)!function(e,t){if(!e||!t)return;const n=t.keyId;n&&t.isCommonEncryption&&Qs(e,(e,t)=>{const r=e.subarray(8,24);r.some(e=>0!==e)||(gs.log("[eme] Patching keyId in 'enc".concat(t?"a":"v",">sinf>>tenc' box: ").concat(ys(r)," -> ").concat(ys(n))),e.set(n,8))})}(e,t);else{const e=s||i;null!=e&&e.encrypted&&this.warn('Init segment with encrypted track with has no key ("'.concat(e.codec,'")!'))}s&&(n=Bc(s,ws,this)),i&&(r=Bc(i,Ls,this));const a={};s&&i?a.audiovideo={container:"video/mp4",codec:n+","+r,supplemental:i.supplemental,encrypted:i.encrypted,initSegment:e,id:"main"}:s?a.audio={container:"audio/mp4",codec:n,encrypted:s.encrypted,initSegment:e,id:"audio"}:i?a.video={container:"video/mp4",codec:r,supplemental:i.supplemental,encrypted:i.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,r,s,i){var a,o;let{initPTS:l,lastEndTime:c}=this;const u={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};Hr(c)||(c=this.lastEndTime=s||0);const d=t.samples;if(!d.length)return u;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(d),f=this.initData),null==(o=f)||!o.length)return this.warn("Failed to generate initSegment."),u;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const g=function(e,t,n){const r={},s=Gs(e,["moof","traf"]);for(let i=0;i<s.length;i++){const e=s[i],a=Gs(e,["tfhd"])[0],o=Us(a,4),l=t[o];if(!l)continue;r[o]||(r[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const c=r[o],u=Gs(e,["tfdt"])[0];if(u){const e=u[0];let t=Us(u,4);1===e&&(t===Cs?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=Cs+1,t+=Us(u,8))),Hr(t)&&(!Hr(c.start)||t<c.start)&&(c.start=t)}const d=l.default,h=Us(a,0)|(null==d?void 0:d.flags);let f=(null==d?void 0:d.duration)||0;8&h&&(f=Us(a,2&h?12:8));const g=Gs(e,["trun"]);let m=c.start||0,p=0,v=f;for(let t=0;t<g.length;t++){const e=g[t],n=Us(e,4),r=c.sampleCount;c.sampleCount+=n;const s=1&e[3],i=4&e[3],a=1&e[2],o=2&e[2],l=4&e[2],u=8&e[2];let d=8,h=n;for(s&&(d+=4),i&&n&&(1&e[d+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=r),d+=4,a?(v=Us(e,d),d+=4):v=f,o&&(d+=4),u&&(d+=4),m+=v,p+=v,h--);h--;)a?(v=Us(e,d),d+=4):v=f,o&&(d+=4),l&&(1&e[d+1]||void 0===c.keyFrameIndex&&(c.keyFrameIndex=c.sampleCount-(h+1),c.keyFrameStart=m),d+=4),u&&(d+=4),m+=v,p+=v;!p&&f&&(p+=f*n)}c.duration+=p}if(!Object.keys(r).some(e=>r[e].duration)){let t=1/0,n=0;const s=Gs(e,["sidx"]);for(let e=0;e<s.length;e++){const r=Ks(s[e]);if(null!=r&&r.references){t=Math.min(t,r.earliestPresentationTime/r.timescale);const e=r.references.reduce((e,t)=>e+t.info.duration||0,0);n=Math.max(n,e+r.earliestPresentationTime/r.timescale)}}n&&Hr(n)&&Object.keys(r).forEach(e=>{r[e].duration||(r[e].duration=n*r[e].timescale-r[e].start)})}return r}(d,f,this),m=f.audio?g[f.audio.id]:null,p=f.video?g[f.video.id]:null,v=Uc(p,1/0),y=Uc(m,1/0),b=Uc(p,0,!0),E=Uc(m,0,!0);let S=s,T=0;const x=m&&(!p||!l&&y<v||l&&l.trackId===f.audio.id),k=x?m:p;if(k){const e=k.timescale,t=k.start-s*e,n=x?f.audio.id:f.video.id;S=k.start/e,T=x?E-y:b-v,!i&&l||!function(e,t,n,r){if(null===e)return!0;const s=Math.max(r,1),i=t-e.baseTime/e.timescale;return Math.abs(i-n)>s}(l,S,s,T)&&e===l.timescale||(l&&this.warn("Timestamps at playlist time: ".concat(i?"":"~").concat(s," ").concat(t/e," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(s," offset: ").concat(S-s," (").concat(t,"/").concat(e,") trackId: ").concat(n)),l=null,h.initPTS=t,h.timescale=e,h.trackId=n)}else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(s));l?(h.initPTS=l.baseTime,h.timescale=l.timescale,h.trackId=l.trackId):(h.timescale&&void 0!==h.trackId&&void 0!==h.initPTS||(this.warn("Could not set initPTS"),h.initPTS=S,h.timescale=1,h.trackId=-1),this.initPTS=l={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const w=S-l.baseTime/l.timescale,L=w+T;T>0?this.lastEndTime=L:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const A=!!f.audio,R=!!f.video;let I="";A&&(I+="audio"),R&&(I+="video");const _={data1:d,startPTS:w,startDTS:w,endPTS:L,endDTS:L,type:I,hasAudio:A,hasVideo:R,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};u.audio=A&&!R?_:void 0,u.video=R?_:void 0;const D=null==p?void 0:p.sampleCount;if(D){const e=p.keyFrameIndex,t=-1!==e;_.nb=D,_.dropped=0===e||this.isVideoContiguous?0:t?e:D,_.independent=t,_.firstKeyFrame=e,t&&p.keyFrameStart&&(_.firstKeyFramePTS=(p.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(u.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),_.dropped&&this.warn("fmp4 does not start with IDR: firstIDR ".concat(e,"/").concat(D," dropped: ").concat(_.dropped," start: ").concat(_.firstKeyFramePTS||"NA"))}return u.initSegment=h,u.id3=Mc(n,s,l,l),r.samples.length&&(u.text=Fc(r,s,l)),u}}},{demux:vc,remux:Oc},{demux:class extends ql{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Rl(e,0);let r=(null==n?void 0:n.length)||0;if(ic(e,r))return!1;for(let s=e.length;r<s;r++)if(Cl(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&Il(e,t)&&Dl(e,t)<=e.length-t}(e,t)}appendFrame(e,t,n){Ol(e,this.observer,t,n,e.manifestCodec);const r=Ml(e,t,n,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:Oc},{demux:class extends ql{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Rl(e,0);let n=(null==t?void 0:t.length)||0;if(t&&11===e[n]&&119===e[n+1]&&void 0!==zl(t)&&ac(e,n)<=16)return!1;for(let r=e.length;n<r;n++)if(ic(e,n))return gs.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return rc(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,n){if(null!==this.basePTS)return tc(e,t,n,this.basePTS,this.frameIndex)}},remux:Oc}];jc.splice(2,0,{demux:oc,remux:Oc});class Gc{constructor(e,t,n,r,s,i){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=i}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const s=n.transmuxing;s.executeStart=_c();let i=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;r&&(this.currentTransmuxState=r);const{contiguous:l,discontinuity:c,trackSwitch:u,accurateTimeOffset:d,timeOffset:h,initSegmentChange:f}=r||a,{audioCodec:g,videoCodec:m,defaultInitPts:p,duration:v,initSegmentData:y}=o,b=function(e,t){let n=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(n=t);return n}(i,t);if(b&&Ja(b.method)){const e=this.getDecrypter(),t=Za(b.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(i,b.key.buffer,b.iv.buffer,t).then(e=>{const t=this.push(e,null,n);return this.decryptionPromise=null,t}),this.decryptionPromise;{let r=e.softwareDecrypt(i,b.key.buffer,b.iv.buffer,t);if(n.part>-1){const t=e.flush();r=t?t.buffer:t}if(!r)return s.executeEnd=_c(),Kc(n);i=new Uint8Array(r)}}const E=this.needsProbing(c,u);if(E){const e=this.configureTransmuxer(i);if(e)return this.logger.warn("[transmuxer] ".concat(e.message)),this.observer.emit(qr.ERROR,qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),s.executeEnd=_c(),Kc(n)}(c||u||f||E)&&this.resetInitSegment(y,g,m,v,t),(c||f||E)&&this.resetInitialTimestamp(p),l||this.resetContiguity();const S=this.transmux(i,b,h,d,n);this.asyncResult=Hc(S);const T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,s.executeEnd=_c(),S}flush(e){const t=e.transmuxing;t.executeStart=_c();const{decrypter:n,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const i=[],{timeOffset:a}=r;if(n){const t=n.flush();t&&i.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=_c();const n=[Kc(e)];return this.asyncResult?Promise.resolve(n):n}const c=o.flush(a);return Hc(c)?(this.asyncResult=!0,c.then(t=>(this.flushRemux(i,t,e),i))):(this.flushRemux(i,c,e),this.asyncResult?Promise.resolve(i):i)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:s,id3Track:i,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log("[transmuxer.ts]: Flushed ".concat(this.id," sn: ").concat(n.sn).concat(n.part>-1?" part: "+n.part:""," of ").concat(this.id===Zr?"level":"track"," ").concat(n.level));const c=this.remuxer.remux(r,s,i,a,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=_c()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,s){const{demuxer:i,remuxer:a}=this;i&&a&&(i.resetInitSegment(e,t,n,r),a.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,s){let i;return i=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,r,s):this.transmuxUnencrypted(e,n,r,s),i}transmuxUnencrypted(e,t,n,r){const{audioTrack:s,videoTrack:i,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,i,a,o,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,s){return this.demuxer.demuxSampleAes(e,t,n).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let s;for(let u=0,d=jc.length;u<d;u++){var i;if(null!=(i=jc[u].demux)&&i.probe(e,this.logger)){s=jc[u];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=s.remux,c=s.demux;o&&o instanceof l||(this.remuxer=new l(n,t,r,this.logger)),a&&a instanceof c||(this.demuxer=new c(n,t,r,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ra(this.config)),e}}const Kc=e=>({remuxResult:{},chunkMeta:e});function Hc(e){return"then"in e&&e.then instanceof Function}class Vc{constructor(e,t,n,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=s||null}}class zc{constructor(e,t,n,r,s,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=i}}let Wc=0;class Yc{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Wc++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,n=this.hls;if(n&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var r;const e=null==(r=this.workerContext)?void 0:r.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":n.logger[t.data.logType]&&n.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,n.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));this.hls.config.enableWorker=!1,this.hls.logger.warn('Error in "'.concat(this.id,'" Web Worker, fallback to inline')),this.hls.trigger(qr.ERROR,{type:Wr.OTHER_ERROR,details:Yr.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const i=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===qr.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new Tl,this.observer.on(qr.FRAG_DECRYPTED,i),this.observer.on(qr.ERROR,i);const a=bi(s.preferManagedMediaSource);if(this.useWorker&&"undefined"!==typeof Worker){const n=this.hls.logger;if(s.workerPath||"function"===typeof __HLS_WORKER_BUNDLE__){try{s.workerPath?(n.log("loading Web Worker ".concat(s.workerPath,' for "').concat(t,'"')),this.workerContext=function(e){const t=kl[e];if(t)return t.clientCount++,t;const n=new self.URL(e,self.location.href).href,r={worker:new self.Worker(n),scriptURL:n,clientCount:1};return kl[e]=r,r}(s.workerPath)):(n.log('injecting Web Worker for "'.concat(t,'"')),this.workerContext=function(){const e=kl[xl];if(e)return e.clientCount++,e;const t=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),n=self.URL.createObjectURL(t),r={worker:new self.Worker(n),objectURL:n,clientCount:1};return kl[xl]=r,r}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:Ui(s)})}catch(uf){n.warn('Error setting up "'.concat(t,'" Web Worker, fallback to inline'),uf),this.terminateWorker(),this.error=null,this.transmuxer=new Gc(this.observer,a,s,"",t,e.logger)}return}}this.transmuxer=new Gc(this.observer,a,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Wc++;const t=this.hls.config,n=bi(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:Ui(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=kl[e||xl];if(t&&1===t.clientCount--){const{worker:n,objectURL:r}=t;delete kl[e||xl],r&&self.URL.revokeObjectURL(r),n.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,s,i,a,o,l,c){var u,d;l.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:f}=this,g=i?i.start:s.start,m=s.decryptdata,p=this.frag,v=!(p&&s.cc===p.cc),y=!(p&&l.level===p.level),b=p?l.sn-p.sn:-1,E=this.part?l.part-this.part.index:-1,S=0===b&&l.id>1&&l.id===(null==p?void 0:p.stats.chunkCount),T=!y&&(1===b||0===b&&(1===E||S&&E<=0)),x=self.performance.now();(y||b||0===s.stats.parsing.start)&&(s.stats.parsing.start=x),!i||!E&&T||(i.stats.parsing.start=x);const k=!(p&&(null==(u=s.initSegment)?void 0:u.url)===(null==(d=p.initSegment)?void 0:d.url)),w=new zc(v,T,o,y,g,k);if(!T||v||k){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for ".concat(s.type," sn: ").concat(l.sn).concat(l.part>-1?" part: "+l.part:""," ").concat(this.id===Zr?"level":"track",": ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(v,"\n        trackSwitch: ").concat(y,"\n        contiguous: ").concat(T,"\n        accurateTimeOffset: ").concat(o,"\n        timeOffset: ").concat(g,"\n        initSegmentChange: ").concat(k));const e=new Vc(n,r,t,a,c);this.configureTransmuxer(e)}if(this.frag=s,this.part=i,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:m,chunkMeta:l,state:w},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,m,l,w);Hc(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const t=n.flush(e);Hc(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class qc extends ls{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=null==t?void 0:t.renditionReports;if(r){let i=-1;for(let n=0;n<r.length;n++){const a=r[n];let o;try{o=new self.URL(a.URI,t.url).href}catch(s){this.warn("Could not construct new URL for Rendition Report: ".concat(s)),o=a.URI||""}if(o===e){i=n;break}o===e.substring(0,o.length)&&(i=n)}if(-1!==i){const e=r[i],s=parseInt(e["LAST-MSN"])||t.lastPartSn;let a=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=n&&Ci(n);return new Oi(s,a>=0?a:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(n))}return e}playlistLoaded(e,t,n){const{details:r,stats:s}=t,i=self.performance.now(),a=s.loading.first?Math.max(0,i-s.loading.first):0;r.advancedDateTime=Date.now()-a;const o=this.hls.config.timelineOffset;if(o!==r.appliedTimelineOffset){const e=Math.max(o||0,0);r.appliedTimelineOffset=e,r.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(r.live||null!=n&&n.live){const o="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){Bo(n,r,this);const e=r.playlistParsingError;if(e){this.warn(e);const n=this.hls;if(!n.config.ignorePlaylistParsingErrors){var l;const{networkDetails:i}=t;return void n.trigger(qr.ERROR,{type:Wr.NETWORK_ERROR,details:Yr.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=r.fragments[0])?void 0:l.type,networkDetails:i,stats:s})}r.playlistParsingError=null}}-1===r.requestScheduled&&(r.requestScheduled=s.loading.start);const c=this.hls.mainForwardBufferInfo,u=c?c.end-c.len:0,d=Ho(r,1e3*(r.edge-u));if(r.requestScheduled+d<i?r.requestScheduled=i:r.requestScheduled+=d,this.log("live playlist ".concat(e," ").concat(r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED")),!this.canLoad||!r.live)return;let h,f,g;if(r.canBlockReload&&r.endSN&&r.advanced){const e=this.hls.config.lowLatencyMode,s=r.lastPartSn,a=r.endSN,l=r.lastPartIndex,c=s===a;-1!==l?c?(f=a+1,g=e?0:l):(f=s,g=e?l+1:r.maxPartIndex):f=a+1;const u=r.age,d=u+r.ageHeader;let m=Math.min(d-r.partTarget,1.5*r.targetduration);if(m>0){if(d>3*r.targetduration)this.log("Playlist last advanced ".concat(u.toFixed(2),"s ago. Omitting segment and part directives.")),f=void 0,g=void 0;else if(null!=n&&n.tuneInGoal&&d-r.partTarget>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(n.tuneInGoal," to: ").concat(m," with playlist age: ").concat(r.age)),m=0;else{const e=Math.floor(m/r.targetduration);if(f+=e,void 0!==g){g+=Math.round(m%r.targetduration/r.partTarget)}this.log("CDN Tune-in age: ".concat(r.ageHeader,"s last advanced ").concat(u.toFixed(2),"s goal: ").concat(m," skip sn ").concat(e," to part ").concat(g))}r.tuneInGoal=m}if(h=this.getDeliveryDirectives(r,t.deliveryDirectives,f,g),e||!c)return r.requestScheduled=i,void this.loadingPlaylist(o,h)}else(r.canBlockReload||r.canSkipUntil)&&(h=this.getDeliveryDirectives(r,t.deliveryDirectives,f,g));h&&void 0!==f&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(d-2*a,d/2)),this.scheduleLoading(o,h,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r)return void this.loadingPlaylist(e,t);const s=self.performance.now(),i=r.requestScheduled;if(s>=i)return void this.loadingPlaylist(e,t);const a=i-s;this.log("reload live playlist ".concat(e.name||e.bitrate+"bps"," in ").concat(Math.round(a)," ms")),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,r){let s=Ci(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,s=_i),new Oi(n,r,s)}checkRetry(e){const t=e.details,n=Ji(e),r=e.errorAction,{action:s,retryCount:i=0,retryConfig:a}=r||{},o=!!r&&!!a&&(s===ca||!r.resolved&&s===oa);if(o){var l;if(i>=a.maxNumRetry)return!1;if(n&&null!=(l=e.context)&&l.deliveryDirectives)this.warn("Retrying playlist loading ".concat(i+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" without delivery-directives')),this.loadPlaylist();else{const e=na(a,i);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn("Retrying playlist loading ".concat(i+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" in ').concat(e,"ms"))}e.levelRetry=!0,r.resolved=!0}return o}}function Qc(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Xc(e[n].attrs,t[n].attrs))return!1;return!0}function Xc(e,t,n){const r=e["STABLE-RENDITION-ID"];return r&&!n?r===t["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>e[n]!==t[n])}function $c(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class Jc{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(null===this.queues||null===this.tracks)return;const r=this.queues[t];r.push(e),1!==r.length||n||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=null==(t=e[0])?void 0:t.label;"async-blocker"!==n&&"async-blocker-prepend"!==n||(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(r){var n;if(s.onError(r),null===this.queues||null===this.tracks)return;const t=null==(n=this.tracks[e])?void 0:n.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":"\n".concat(this.list("video"),"\n").concat(this.list("audio"),"\n").concat(this.list("audiovideo"),"}")}list(e){var t,n;return null!=(t=this.queues)&&t[e]||null!=(n=this.tracks)&&n[e]?"".concat(e,": (").concat(this.listSbInfo(e),") ").concat(this.listOps(e)):""}listSbInfo(e){var t;const n=null==(t=this.tracks)?void 0:t[e],r=null==n?void 0:n.buffer;return r?"SourceBuffer".concat(r.updating?" updating":"").concat(n.ended?" ended":"").concat(n.ending?" ending":""):"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}const Zc=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,eu="HlsJsTrackRemovedError";class tu extends Error{constructor(e){super(e),this.name=eu}}function nu(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function ru(e){return"audio"===e?1:0}class su{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(qr.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(qr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(qr.BUFFER_CODECS,this.onBufferCodecs,this),e.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(qr.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(qr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(qr.BUFFER_CODECS,this.onBufferCodecs,this),e.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Hr(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to ".concat(n,": ").concat(e[n].height,"p@").concat(e[n].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((t,n)=>this.isLevelAllowed(t)&&n<=e);return this.clientRect=null,su.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(cf){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,n){if(null==e||!e.length)return-1;const r=(e,t)=>!t||(e.width!==t.width||e.height!==t.height);let s=e.length-1;const i=Math.max(t,n);for(let a=0;a<e.length;a+=1){const t=e[a];if((t.width>=i||t.height>=i)&&r(t,e[a+1])){s=a;break}}return s}}const iu={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},au={HLS:"h"};class ou{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof ou?e:new ou(e))),this.value=e,this.params=t}}function lu(e,t,n,r){return new Error("failed to ".concat(e,' "').concat((s=t,Array.isArray(s)?JSON.stringify(s):s instanceof Map?"Map{}":s instanceof Set?"Set{}":"object"===typeof s?JSON.stringify(s):String(s)),'" as ').concat(n),{cause:r});var s}function cu(e,t,n){return lu("serialize",e,t,n)}class uu{constructor(e){this.description=e}}const du="Bare Item";function hu(e){if(!1===ArrayBuffer.isView(e))throw cu(e,"Byte Sequence");return":".concat((t=e,btoa(String.fromCharCode(...t))),":");var t}function fu(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw cu(e,"Integer");return e.toString()}function gu(e,t){if(e<0)return-gu(-e,t);const n=Math.pow(10,t);if(Math.abs(e*n%1-.5)<Number.EPSILON){const t=Math.floor(e*n);return(t%2===0?t:t+1)/n}return Math.round(e*n)/n}function mu(e){const t=gu(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw cu(e,"Decimal");const n=t.toString();return n.includes(".")?n:"".concat(n,".0")}const pu=/[\x00-\x1f\x7f]+/;function vu(e){const t=(n=e).description||n.toString().slice(7,-1);var n;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw cu(t,"Token");return t}function yu(e){switch(typeof e){case"number":if(!Hr(e))throw cu(e,du);return Number.isInteger(e)?fu(e):mu(e);case"string":return function(e){if(pu.test(e))throw cu(e,"String");return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}(e);case"symbol":return vu(e);case"boolean":return function(e){if("boolean"!==typeof e)throw cu(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return"@".concat(fu(e.getTime()/1e3))}(e);if(e instanceof Uint8Array)return hu(e);if(e instanceof uu)return vu(e);default:throw cu(e,du)}}function bu(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw cu(e,"Key");return e}function Eu(e){return null==e?"":Object.entries(e).map(e=>{let[t,n]=e;return!0===n?";".concat(bu(t)):";".concat(bu(t),"=").concat(yu(n))}).join("")}function Su(e){return e instanceof ou?"".concat(yu(e.value)).concat(Eu(e.params)):yu(e)}function Tu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if("object"!==typeof e||null==e)throw cu(e,"Dict");const n=e instanceof Map?e.entries():Object.entries(e),r=(null===t||void 0===t?void 0:t.whitespace)?" ":"";return Array.from(n).map(e=>{let[t,n]=e;n instanceof ou===!1&&(n=new ou(n));let r=bu(t);var s;return!0===n.value?r+=Eu(n.params):(r+="=",Array.isArray(n.value)?r+="(".concat((s=n).value.map(Su).join(" "),")").concat(Eu(s.params)):r+=Su(n)),r}).join(",".concat(r))}function xu(e,t){return Tu(e,t)}const ku="CMCD-Object",wu="CMCD-Request",Lu="CMCD-Session",Au="CMCD-Status",Ru={br:ku,ab:ku,d:ku,ot:ku,tb:ku,tpb:ku,lb:ku,tab:ku,lab:ku,url:ku,pb:wu,bl:wu,tbl:wu,dl:wu,ltc:wu,mtp:wu,nor:wu,nrr:wu,rc:wu,sn:wu,sta:wu,su:wu,ttfb:wu,ttfbb:wu,ttlb:wu,cmsdd:wu,cmsds:wu,smrt:wu,df:wu,cs:wu,ts:wu,cid:Lu,pr:Lu,sf:Lu,sid:Lu,st:Lu,v:Lu,msd:Lu,bs:Au,bsd:Au,cdn:Au,rtp:Au,bg:Au,pt:Au,ec:Au,e:Au},Iu=wu;function _u(e,t){const n={};if(!e)return n;const r=Object.keys(e),s=t?(i=t,Object.keys(i).reduce((e,t)=>{var n;return null===(n=i[t])||void 0===n||n.forEach(n=>e[n]=t),e},{})):{};var i;return r.reduce((t,n)=>{var r;const i=Ru[n]||s[n]||Iu;return(null!==(r=t[i])&&void 0!==r?r:t[i]={})[n]=e[n],t},n)}const Du="event";const Pu=e=>Math.round(e),Cu=(e,t)=>Array.isArray(e)?e.map(e=>Cu(e,t)):e instanceof ou&&"string"===typeof e.value?new ou(Cu(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){const n=new URL(e),r=new URL(t);if(n.origin!==r.origin)return e;const s=n.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+n.search+n.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),Ou=e=>100*Pu(e/100),Nu={br:Pu,d:Pu,bl:Ou,dl:Ou,mtp:Ou,nor:(e,t)=>{let n=e;return t.version>=2&&(e instanceof ou&&"string"===typeof e.value?n=new ou([e]):"string"===typeof e&&(n=[e])),Cu(n,t)},rtp:Ou,tb:Pu},Mu="request",Fu="response",Uu=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Bu=["e"],ju=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Gu(e){return ju.test(e)}const Ku=["d","dl","nor","ot","rtp","su"];const Hu=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const Vu=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function zu(e){return Vu.includes(e)||Gu(e)}const Wu={[Fu]:function(e){return Uu.includes(e)||Ku.includes(e)||Hu.includes(e)||Gu(e)},[Du]:function(e){return Uu.includes(e)||Bu.includes(e)||Gu(e)},[Mu]:function(e){return Uu.includes(e)||Ku.includes(e)||Gu(e)}};function Yu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(null==e||"object"!==typeof e)return n;const r=t.version||e.v||1,s=t.reportingMode||Mu,i=1===r?zu:Wu[s];let a=Object.keys(e).filter(i);const o=t.filter;"function"===typeof o&&(a=a.filter(o));const l=s===Fu||s===Du;l&&!a.includes("ts")&&a.push("ts"),r>1&&!a.includes("v")&&a.push("v");const c=is({},Nu,t.formatters),u={version:r,reportingMode:s,baseUrl:t.baseUrl};return a.sort().forEach(t=>{let s=e[t];const i=c[t];if("function"===typeof i&&(s=i(s,u)),"v"===t){if(1===r)return;s=r}"pr"==t&&1===s||(l&&"ts"===t&&!Hr(s)&&(s=Date.now()),function(e){return"number"===typeof e?Hr(e):null!=e&&""!==e&&!1!==e}(s)&&(function(e){return["ot","sf","st","e","sta"].includes(e)}(t)&&"string"===typeof s&&(s=new uu(s)),n[t]=s))}),n}function qu(e,t,n){return is(e,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(!e)return n;const r=_u(Yu(e,t),null===t||void 0===t?void 0:t.customHeaderMap);return Object.entries(r).reduce((e,t)=>{let[n,r]=t;const s=xu(r,{whitespace:!1});return s&&(e[n]=s),e},n)}(t,n))}function Qu(e){if(!e)return"";const t=function(e){return e?xu(Yu(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),{whitespace:!1}):""}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return encodeURIComponent(t)}const Xu=/CMCD=[^&#]+/;function $u(e,t,n){const r=function(e){if(!e)return"";const t=Qu(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return"".concat("CMCD","=").concat(t)}(t,n);if(!r)return e;if(Xu.test(e))return e.replace(Xu,r);const s=e.includes("?")?"&":"?";return"".concat(e).concat(s).concat(r)}function Ju(e,t,n,r){e&&Object.keys(t).forEach(s=>{const i=e.filter(e=>e.groupId===s).map(e=>{const i=is({},e);return i.details=void 0,i.attrs=new za(i.attrs),i.url=i.attrs.URI=Zu(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),i.groupId=i.attrs["GROUP-ID"]=t[s],i.attrs["PATHWAY-ID"]=r,i});e.push(...i)})}function Zu(e,t,n,r){const{HOST:s,PARAMS:i,[n]:a}=r;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return s&&!o&&(l.host=s),i&&Object.keys(i).sort().forEach(e=>{e&&l.searchParams.set(e,i[e])}),l.href}class ed extends ls{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=ed.CDMCleanupPromise?[ed.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:t,initData:n}=e,r='"'.concat(e.type,'" event: init data type: "').concat(t,'"');if(this.debug(r),null!==n){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=fo(this.config));const t=e.map(ho).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(s=>{const i=uo(s);if("sinf"!==t||i!==io.FAIRPLAY)return void this.log('Ignoring "'.concat(e.type,'" event with init data type: "').concat(t,'" for selected key-system ').concat(i));let a;try{const e=Ms(new Uint8Array(n)),t=Xs(eo(JSON.parse(e).sinf));if(!t)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(t.subarray(8,24))}catch(d){return void this.warn("".concat(r," Failed to parse sinf: ").concat(d))}const o=ys(a),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let u=l[o];for(let e=0;e<c.length;e++){const r=c[e],s=r.decryptdata;if(!s.keyId)continue;const i=ys(s.keyId);if(Xa(a,s.keyId)||-1!==s.uri.replace(/-/g,"").indexOf(o)){if(u=l[i],!u)continue;if(s.pssh)break;delete l[i],s.pssh=new Uint8Array(n),s.keyId=a,u=l[o]=u.then(()=>this.generateRequestWithPreferredKeySession(r,t,n,"encrypted-event-key-match")),u.catch(e=>this.handleError(e));break}}u||this.handleError(new Error("Key ID ".concat(o," not encountered in playlist. Key-system sessions ").concat(c.length,".")))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log('"'.concat(e.type,'" event'))},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(qr.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(qr.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(qr.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(qr.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(qr.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(qr.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(qr.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(qr.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=null==t?void 0:t[e];return r?r.licenseUrl:e===io.WIDEVINE&&n?n:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error('no license server URL configured for key-system "'.concat(e,'"'));return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=null==t?void 0:t[e];if(n)return n.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}attemptKeySystemAccess(e){const t=this.hls.levels,n=(e,t,n)=>!!e&&n.indexOf(e)===t,r=t.map(e=>e.audioCodec).filter(n),s=t.map(e=>e.videoCodec).filter(n);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((t,n)=>{const i=e=>{const a=e.shift();this.getMediaKeysPromise(a,r,s).then(e=>t({keySystem:a,mediaKeys:e})).catch(t=>{e.length?i(e):n(t instanceof rd?t:new rd({type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};i(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!==typeof n){let e="Configured requestMediaKeySystemAccess is not a function ".concat(n);return null===go&&"http:"===self.location.protocol&&(e="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(e))}return n(e,t)}getMediaKeysPromise(e,t,n){var r;const s=function(e,t,n,r){let s;switch(e){case io.FAIRPLAY:s=["cenc","sinf"];break;case io.WIDEVINE:case io.PLAYREADY:s=["cenc"];break;case io.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(e))}return function(e,t,n,r){return[{initDataTypes:e,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:"audio/mp4; codecs=".concat(e),robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:n.map(e=>({contentType:"video/mp4; codecs=".concat(e),robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}(s,t,n,r)}(e,t,n,this.config.drmSystemOptions||{});let i=this.keySystemAccessPromises[e],a=null==(r=i)?void 0:r.keySystemAccess;if(!a){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(Ui(s))),a=this.requestMediaKeySystemAccess(e,s);const t=i=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(t=>{this.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))}),a.then(n=>{this.log('Access for key-system "'.concat(n.keySystem,'" obtained'));const r=this.fetchServerCertificate(e);this.log('Create media-keys for "'.concat(e,'"'));const s=t.mediaKeys=n.createMediaKeys().then(n=>(this.log('Media-keys created for "'.concat(e,'"')),t.hasMediaKeys=!0,r.then(t=>t?this.setMediaKeysServerCertificate(n,e,t):n)));return s.catch(t=>{this.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))}),s})}return a.then(()=>i.mediaKeys)}createMediaKeySessionContext(e){let{decryptdata:t,keySystem:n,mediaKeys:r}=e;this.log('Creating key-system session "'.concat(n,'" keyId: ').concat(ys(t.keyId||[])," keyUri: ").concat(t.uri));const s=r.createSession(),i={decryptdata:t,keySystem:n,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=td(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log('Updating key-session "'.concat(n.sessionId,'" for keyId ').concat(ys(e.decryptdata.keyId||[]),"\n      } (data length: ").concat(t.byteLength,")")),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(e=>{let{hasMediaKeys:t}=e;return!!t}).map(e=>{let{keySystem:t}=e;return ho(t)}).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:t,mediaKeys:n}=e;return this.attemptSetMediaKeys(t,n)})}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:r}=e;const s=ho(r);s?t(s):n(new Error('Unable to find format for key-system "'.concat(r,'"')))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=fo(this.config),n=e.map(uo).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const r=nd(e,t[n]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,n=td(t),r=this.bannedKeyIds[n];if(r||"internal-error"===this.getKeyStatus(t)){const n=sd(r||"internal-error",t);return this.handleError(n,e.frag),Promise.reject(n)}const s="(keyId: ".concat(n,' format: "').concat(t.keyFormat,'" method: ').concat(t.method," uri: ").concat(t.uri,")");this.log("Starting session for key ".concat(s));const i=this.keyIdToKeySessionPromise[n];if(!i){const r=this.getKeySystemForKeyPromise(t).then(n=>{let{keySystem:r,mediaKeys:i}=n;return this.throwIfDestroyed(),this.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(s)),this.attemptSetMediaKeys(r,i).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:r,mediaKeys:i,decryptdata:t})))}).then(e=>{const n=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",n,"playlist-key")});return r.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[n]=r,r}return i.catch(n=>{if(n instanceof rd){const r=os({},n.data);"internal-error"===this.getKeyStatus(t)&&(r.decryptdata=t);const s=new rd(r,n.message);this.handleError(s,e.frag)}}),i}throwIfDestroyed(){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof rd){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error("".concat(e.message).concat(n?" (".concat(ys(n.keyId||[]),")"):"")),this.hls.trigger(qr.ERROR,e.data)}else this.error(e.message),this.hls.trigger(qr.ERROR,{type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=td(e),n=this.keyIdToKeySessionPromise[t];if(!n){const t=uo(e.keyFormat),n=t?[t]:fo(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=fo(this.config)),0===e.length)throw new rd({type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(Ui({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));const r=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((e,n)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return n(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(e).catch(n)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log('Media-keys set for "'.concat(e,'"')),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===n.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,n,r){var s;const i=null==(s=this.config.drmSystems)||null==(s=s[e.keySystem])?void 0:s.generateRequest;if(i)try{const r=i.call(this.hls,t,n,e);if(!r)throw new Error("Invalid response from configured generateRequest filter");t=r.initDataType,n=r.initData?r.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(f){if(this.warn(f.message),this.hls&&this.hls.config.debug)throw f}if(null===n)return this.log('Skipping key-session request for "'.concat(r,'" (no initData)')),Promise.resolve(e);const a=td(e.decryptdata),o=e.decryptdata.uri;this.log('Generating key-session request for "'.concat(r,'" keyId: ').concat(a," URI: ").concat(o," (init data type: ").concat(t," length: ").concat(n.byteLength,")"));const l=new Tl,c=e._onmessage=t=>{const n=e.mediaKeysSession;if(!n)return void l.emit("error",new Error("invalid state"));const{messageType:r,message:s}=t;this.log('"'.concat(r,'" message event for session "').concat(n.sessionId,'" message size: ').concat(s.byteLength)),"license-request"===r||"license-renewal"===r?this.renewLicense(e,s).catch(e=>{l.eventNames().length?l.emit("error",e):this.handleError(e)}):"license-release"===r?e.keySystem===io.FAIRPLAY&&this.updateKeySession(e,to("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn('unhandled media key message type "'.concat(r,'"'))},u=(e,t)=>{let n;t.keyStatus=e,e.startsWith("usable")?l.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?n=sd(e,t.decryptdata):"expired"===e?n=new Error("key expired (keyId: ".concat(a,")")):"released"===e?n=new Error("key released"):"status-pending"===e||this.warn('unhandled key status change "'.concat(e,'" (keyId: ').concat(a,")")),n&&(l.eventNames().length?l.emit("error",n):this.handleError(n))},d=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void l.emit("error",new Error("invalid state"));const n=this.getKeyStatuses(e);if(!Object.keys(n).some(e=>"status-pending"!==n[e]))return;if("expired"===n[a])return this.log("Expired key ".concat(Ui(n),' in key-session "').concat(e.mediaKeysSession.sessionId,'"')),void this.renewKeySession(e);let r=n[a];if(r)u(r,e);else{var s;const t=1e3;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(s=e.keyStatusTimeouts)[a]||(s[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const n=this.getKeyStatus(e.decryptdata);if(n&&"status-pending"!==n)return this.log("No status for keyId ".concat(a,' in key-session "').concat(e.mediaKeysSession.sessionId,'". Using session key-status ').concat(n," from other session.")),u(n,e);this.log("key status for ".concat(a,' in key-session "').concat(e.mediaKeysSession.sessionId,'" timed out after ').concat(t,"ms")),r="internal-error",u(r,e)},t)),this.log("No status for keyId ".concat(a," (").concat(Ui(n),")."))}};tl(e.mediaKeysSession,"message",c),tl(e.mediaKeysSession,"keystatuseschange",d);const h=new Promise((e,t)=>{l.on("error",t),l.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log('Request generated for key-session "'.concat(e.mediaKeysSession.sessionId,'" keyId: ').concat(a," URI: ").concat(o))}).catch(t=>{throw new rd({type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},"Error generating key-session request: ".concat(t))}).then(()=>h).catch(t=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,r)=>{if("string"===typeof r&&"object"===typeof n){const e=r;r=n,n=e}const s="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===io.PLAYREADY&&16===s.length){const e=ys(s);t[e]=n,no(s)}const i=ys(s);"internal-error"===n&&(this.bannedKeyIds[i]=n),this.log('key status change "'.concat(n,'" for keyStatuses keyId: ').concat(i,' key-session "').concat(e.mediaKeysSession.sessionId,'"')),t[i]=n}),t}fetchServerCertificate(e){const t=this.config,n=new(0,t.loader)(t),r=this.getServerCertificateUrl(e);return r?(this.log('Fetching server certificate for "'.concat(e,'"')),new Promise((s,i)=>{const a={responseType:"arraybuffer",url:r},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{s(e.data)},onError:(t,n,s,o)=>{i(new rd({type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:os({url:a.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(r,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:(t,n,s)=>{i(new rd({type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:{url:a.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(r,")")))},onAbort:(e,t,n)=>{i(new Error("aborted"))}};n.load(a,l,c)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,s)=>{e.setServerCertificate(n).then(s=>{this.log("setServerCertificate ".concat(s?"success":"not supported by CDM"," (").concat(n.byteLength,') on "').concat(t,'"')),r(e)}).catch(e=>{s(new rd({type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new rd({type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=(new DOMParser).parseFromString(n,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let t;for(let n=0,r=s.length;n<r;n++){var i,a;t=s[n];const r=null==(i=t.querySelector("name"))?void 0:i.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;r&&o&&e.setRequestHeader(r,o)}}const o=r.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return to(atob(l))}setupLicenseXHR(e,t,n,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,r)}).catch(i=>{if(!n.decryptdata)throw i;return e.open("POST",t,!0),s.call(this.hls,e,t,n,r)}).then(n=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:n||r}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const i=this.getLicenseServerUrlOrThrow(e.keySystem);this.log("Sending license request to URL: ".concat(i));const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log("License received ".concat(t instanceof ArrayBuffer?t.byteLength:t));const n=this.config.licenseResponseCallback;if(n)try{t=n.call(this.hls,a,i,e)}catch(o){this.error(o)}r(t)}else{const o=n.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)s(new rd({type:Wr.KEY_SYSTEM_ERROR,details:Yr.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:i,data:void 0,code:a.status,text:a.statusText}},"License Request XHR failed (".concat(i,"). Status: ").concat(a.status," (").concat(a.statusText,")")));else{const n=l-this._requestLicenseFailureCount+1;this.warn("Retrying license request, ".concat(n," attempts left")),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,i,e,t).then(t=>{let{xhr:n,licenseChallenge:r}=t;e.keySystem==io.PLAYREADY&&(r=this.unpackPlayReadyKeyMessage(n,r)),n.send(r)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,tl(n,"encrypted",this.onMediaEncrypted),tl(n,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(nl(e,"encrypted",this.onMediaEncrypted),nl(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,yo.clearKeyUriToKeyIdMap();const s=r.length;ed.CDMCleanupPromise=Promise.all(r.map(e=>this.removeSession(e)).concat((null==n||null==(e=n.setMediaKeys(null))?void 0:e.catch(e=>{this.log("Could not clear media keys: ".concat(e)),this.hls&&this.hls.trigger(qr.ERROR,{type:Wr.OTHER_ERROR,details:Yr.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: ".concat(e))})}))||Promise.resolve())).catch(e=>{this.log("Could not close sessions and clear media keys: ".concat(e)),this.hls&&this.hls.trigger(qr.ERROR,{type:Wr.OTHER_ERROR,details:Yr.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: ".concat(e))})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,t){let{sessionKeys:n}=t;if(n&&this.config.emeEnabled&&!this.keyFormatPromise){const e=n.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log("Selecting key-system from session-keys ".concat(e.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:r}=e;if(t){this.log('Remove licenses and keys and close session "'.concat(t.sessionId,'" keyId: ').concat(ys((null==r?void 0:r.keyId)||[]))),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:i}=e;i&&Object.keys(i).forEach(e=>self.clearTimeout(i[e]));const{drmSystemOptions:a}=this.config,o=function(e){var t;return!!e&&("persistent-license"===e.sessionType||!(null==(t=e.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(a)?new Promise((e,n)=>{self.setTimeout(()=>n(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(n)}):Promise.resolve();return o.catch(e=>{this.log("Could not remove session: ".concat(e)),this.hls&&this.hls.trigger(qr.ERROR,{type:Wr.OTHER_ERROR,details:Yr.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: ".concat(e))})}).then(()=>t.close()).catch(e=>{this.log("Could not close session: ".concat(e)),this.hls&&this.hls.trigger(qr.ERROR,{type:Wr.OTHER_ERROR,details:Yr.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: ".concat(e))})})}return Promise.resolve()}}function td(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return ys(e.keyId)}function nd(e,t){return e.keyId&&t.mediaKeysSession.keyStatuses.has(e.keyId)?t.mediaKeysSession.keyStatuses.get(e.keyId):e.matches(t.decryptdata)?t.keyStatus:void 0}ed.CDMCleanupPromise=void 0;class rd extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function sd(e,t){const n="output-restricted"===e,r=n?Yr.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Yr.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new rd({type:Wr.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:t},n?"HDCP level output restricted":'key status changed to "'.concat(e,'"'))}function id(e,t){let n;try{n=new Event("addtrack")}catch(uf){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function ad(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: ".concat(t))}catch(uf){gs.debug("[texttrack-utils]: ".concat(uf));try{const n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(r){gs.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(r))}}"disabled"===n&&(e.mode=n)}function od(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues)for(let r=e.cues.length;r--;)t&&e.cues[r].removeEventListener("enter",t),e.removeCue(e.cues[r]);"disabled"===n&&(e.mode=n)}function ld(e,t,n,r){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&e.cues.length>0){const s=function(e,t,n){const r=[],s=function(e,t){if(t<=e[0].startTime)return 0;const n=e.length-1;if(t>e[n].endTime)return-1;let r,s=0,i=n;for(;s<=i;)if(r=Math.floor((i+s)/2),t<e[r].startTime)i=r-1;else{if(!(t>e[r].startTime&&s<n))return r;s=r+1}return e[s].startTime-t<t-e[i].startTime?s:i}(e,t);if(s>-1)for(let i=s,a=e.length;i<a;i++){const s=e[i];if(s.startTime>=t&&s.endTime<=n)r.push(s);else if(s.startTime>n)return r}return r}(e.cues,t,n);for(let t=0;t<s.length;t++)r&&!r(s[t])||e.removeCue(s[t])}"disabled"===s&&(e.mode=s)}function cd(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];"subtitles"!==r.kind&&"captions"!==r.kind||!r.label||t.push(e[n])}return t}function ud(e){let t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}const dd=.025;let hd=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function fd(e,t,n){return"".concat(e.identifier,"-").concat(n+1,"-").concat(ud(t))}class gd{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;if(e<=0||isNaN(n))return!1;if(0===n)return!0;return((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return md(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-md(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Hr(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return md(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<dd))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?hd.Range:hd.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return'["'.concat((e=this).identifier,'" ').concat(e.cue.pre?"<pre>":e.cue.post?"<post>":"").concat(e.timelineStart.toFixed(2),"-").concat(e.resumeTime.toFixed(2),"]");var e}}function md(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<dd)?t.start:t.start+t.duration}function pd(e,t,n){const r=new self.URL(e,n);return"data:"!==r.protocol&&r.searchParams.set("_HLS_primary_id",t),r}function vd(e,t){for(;null!=(n=e.assetList[++t])&&n.error;)var n;return t}function yd(e){const t=e.timelineStart,n=e.duration||0;return'["'.concat(e.identifier,'" ').concat(t.toFixed(2),"-").concat((t+n).toFixed(2),"]")}class bd{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(qr.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=r;const i=()=>{this.hasDetails=!0};s.once(qr.LEVEL_LOADED,i),s.once(qr.AUDIO_TRACK_LOADED,i),s.once(qr.SUBTITLE_TRACK_LOADED,i),s.on(qr.MEDIA_ATTACHING,(e,t)=>{let{media:n}=t;this.removeMediaListeners(),this.mediaAttached=n;this.interstitial.playoutLimit&&(n.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(qr.BUFFER_APPENDED,()=>{const e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,s.trigger(qr.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let n=this.assetItem.uri;try{n=pd(n,e.config.primarySessionId||"").href}catch(t){}e.loadSource(n)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=Fa.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=n-.02}reachedPlayout(e){const t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Fa.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var r;null==(r=this.hls)||r.on(e,t)}once(e,t,n){var r;null==(r=this.hls)||r.once(e,t)}off(e,t,n){var r;null==(r=this.hls)||r.off(e,t)}toString(){var e;return"HlsAssetPlayer: ".concat(yd(this.assetItem)," ").concat(null==(e=this.hls)?void 0:e.sessionId," ").concat(this.appendInPlace?"append-in-place":"")}}class Ed extends ls{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(void 0===t&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&null!=(s=r[n])&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let s=n[r];if(t&&"primary"!==t&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const e=n[r].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if((null==(n=t[r].event)?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let s=0;s<r;s++){const e=n[s];if(!e.error){const n=e.timelineStart;if(t===n||t>n&&(t<n+(e.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;const t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){const e=t.assetList,n=e[e.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,s=this.events,i=this.parseDateRanges(r,{url:n.url},t),a=Object.keys(r),o=s?s.filter(e=>!a.includes(e.identifier)):[];i.length&&i.sort((e,t)=>{const n=e.cue.pre,r=e.cue.post,s=t.cue.pre,i=t.cue.post;if(n&&!s)return-1;if(s&&!n)return 1;if(r&&!i)return 1;if(i&&!r)return-1;if(!n&&!s&&!r&&!i){const n=e.startTime,r=t.startTime;if(n!==r)return n-r}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=i,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.events||[];if(r.length||t.length||this.length<2){const s=this.items,i=this.parseSchedule(r,e);(n||t.length||(null==s?void 0:s.length)!==i.length||i.some((e,t)=>Math.abs(e.playout.start-s[t].playout.start)>.005||Math.abs(e.playout.end-s[t].playout.end)>.005))&&(this.items=i,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,n){const r=[],s=Object.keys(e);for(let i=0;i<s.length;i++){const a=s[i],o=e[a];if(o.isInterstitial){let e=this.eventMap[a];e?e.setDateRange(o):(e=new gd(o,t),this.eventMap[a]=e,!1===n&&(e.appendInPlace=n)),r.push(e)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,s=r.live?1/0:r.edge;let i=0;if((e=e.filter(e=>!e.error&&!(e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let r=0,o=0;if(e.forEach((t,a)=>{const l=t.cue.pre,c=t.cue.post,u=e[a-1]||null,d=t.appendInPlace,h=c?s:t.startOffset,f=t.duration,g=t.timelineOccupancy===hd.Range?f:0,m=t.resumptionOffset,p=(null==u?void 0:u.startTime)===h,v=h+t.cumulativeDuration;let y=d?v+f:h+m;if(l||!c&&h<=0){const e=o;o+=g,t.timelineStart=v;const r=i;i+=f,n.push({event:t,start:v,end:y,playout:{start:r,end:i},integrated:{start:e,end:o}})}else{if(!(h<=s))return;{if(!p){const s=h-r;if(s>.033){const l=r,c=o;o+=s;const u=i;i+=s;const d={previousEvent:e[a-1]||null,nextEvent:t,start:l,end:l+s,playout:{start:u,end:i},integrated:{start:c,end:o}};n.push(d)}else s>0&&u&&(u.cumulativeDuration+=s,n[n.length-1].end=h)}c&&(y=v),t.timelineStart=v;const s=o;o+=g;const l=i;i+=f,n.push({event:t,start:v,end:y,playout:{start:l,end:i},integrated:{start:s,end:o}})}}const b=t.resumeTime;r=c||b>s?s:b}),r<s){var a;const e=r,t=o,l=s-r;o+=l;const c=i;i+=l,n.push({previousEvent:(null==(a=n[n.length-1])?void 0:a.event)||null,nextEvent:null,start:r,end:e+l,playout:{start:c,end:i},integrated:{start:t,end:o}})}this.setDurations(s,i,o)}else{const e=0;n.push({previousEvent:null,nextEvent:null,start:e,end:s,playout:{start:e,end:s},integrated:{start:e,end:s}}),this.setDurations(s,s,s)}return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let s=0,i=-1;e.forEach((a,o)=>{const l=a.cue.pre,c=a.cue.post,u=l?0:c?r:a.startTime;this.updateAssetDurations(a);if(i===u?a.cumulativeDuration=s:(s=0,i=u),!c&&a.snapOptions.in&&(a.resumeAnchor=qi(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)}if(!a.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn("Could not change append strategy for abutting event ".concat(a)))}const d=Hr(a.resumeOffset)?a.resumeOffset:a.duration;s+=d})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;if(Math.abs(n-r)>dd)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with estimated timeline end ").concat(r)),!1;return!Object.keys(t).some(r=>{const s=t[r].details,i=s.edge;if(n>=i)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," past ").concat(r," playlist end ").concat(i)),!1;const a=qi(null,s.fragments,n);if(!a)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," does not align with any fragments in ").concat(r," playlist (").concat(s.fragStart,"-").concat(s.fragmentEnd,")")),!0;const o="audio"===r?.175:0;return!(Math.abs(a.start-n)<dd+o||Math.abs(a.end-n)<dd+o)&&(this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with ").concat(r," fragment bounds (").concat(a.start,"-").concat(a.end," sn: ").concat(a.sn," cc: ").concat(a.cc,")")),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,s=!1;for(let i=0;i<e.assetList.length;i++){const a=e.assetList[i],o=t+n;a.startOffset=n,a.timelineStart=o,r||(r=null===a.duration),s||(s=!!a.error);n+=a.error?0:a.duration||0}e.duration=r&&!s?Math.max(n,e.duration):n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Sd(e){return"[".concat(e.event?'"'+e.event.identifier+'"':"primary",": ").concat(e.start.toFixed(2),"-").concat(e.end.toFixed(2),"]")}class Td{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=pd(n,this.hls.sessionId,e.baseUrl)}catch(u){const t=this.assignAssetListError(e,Yr.ASSET_LIST_LOAD_ERROR,u,n);return void this.hls.trigger(qr.ERROR,t)}t&&"data:"!==r.protocol&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,i=new(0,s.loader)(s),a={responseType:"json",url:r.href},o=s.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,n,r,s)=>{const i=t.data,a=null==i?void 0:i.ASSETS;if(!Array.isArray(a)){const t=this.assignAssetListError(e,Yr.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),r.url,n,s);return void this.hls.trigger(qr.ERROR,t)}e.assetListResponse=i,this.hls.trigger(qr.ASSET_LIST_LOADED,{event:e,assetListResponse:i,networkDetails:s})},onError:(t,n,r,s)=>{const i=this.assignAssetListError(e,Yr.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status ".concat(t.code," ").concat(t.text," (").concat(n.url,")")),n.url,s,r);this.hls.trigger(qr.ERROR,i)},onTimeout:(t,n,r)=>{const s=this.assignAssetListError(e,Yr.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST (".concat(n.url,")")),n.url,t,r);this.hls.trigger(qr.ERROR,s)}};return i.load(a,l,c),this.hls.trigger(qr.ASSET_LIST_LOADING,{event:e}),i}assignAssetListError(e,t,n,r,s,i){return e.error=n,{type:Wr.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:i,stats:s}}}function xd(e){var t;null==e||null==(t=e.play())||t.catch(()=>{})}function kd(e,t){return"[".concat(e,"] Advancing timeline position to ").concat(t)}class wd{constructor(e){this.buffered=void 0;const t=(t,n,r)=>{if((n>>>=0)>r-1)throw new DOMException("Failed to execute '".concat(t,"' on 'TimeRanges': The index provided (").concat(n,") is greater than the maximum bound (").concat(r,")"));return e[n][t]};this.buffered={get length(){return e.length},end:n=>t("end",n,e.length),start:n=>t("start",n,e.length)}}}const Ld={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ad=e=>String.fromCharCode(Ld[e]||e),Rd=15,Id=100,_d={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Dd={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Pd={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Cd={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Od=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Nd{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n="function"===typeof t?t():t;gs.log("".concat(this.time," [").concat(e,"] ").concat(n))}}}const Md=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class Fd{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Ud{constructor(){this.uchar=" ",this.penState=new Fd}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Bd{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Fd,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Id;t++)this.chars.push(new Ud);this.logger=e}equals(e){for(let t=0;t<Id;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Id;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Id;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Id&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Id)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Ad(e);this.pos>=Id?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Id;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Id;n++){const r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class jd{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Rd;t++)this.rows.push(new Bd(e));this.logger=e}reset(){for(let e=0;e<Rd;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let n=0;n<Rd;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Rd;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Rd;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ui(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<Rd;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const r=n.rows[e].cueStartTime,s=this.logger.time;if(null!==r&&null!==s&&r<s)for(let i=0;i<this.nrRollUpRows;i++)this.rows[t-this.nrRollUpRows+i+1].copy(n.rows[e+i])}}this.currRow=t;const n=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,r=Math.max(t-1,0);n.setCursor(e.indent),e.color=n.chars[r].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ui(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let s=0;s<Rd;s++){const n=this.rows[s].getTextString();n&&(r=s+1,e?t.push("Row "+r+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}getTextAndFormat(){return this.rows}}class Gd{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new jd(n),this.nonDisplayedMemory=new jd(n),this.lastOutputScreen=new jd(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+Ui(t)),this.writeScreen.setPen(t)}outputDataUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Kd{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const r=this.logger=new Nd;this.channels=[null,new Gd(e,t,r),new Gd(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const e=127&t[n],r=127&t[n+1];let s=!1,i=null;if(0===e&&0===r)continue;this.logger.log(3,()=>"["+Md([t[n],t[n+1]])+"] -> ("+Md([e,r])+")");const a=this.cmdHistory;if(e>=16&&e<=31){if(Vd(e,r,a)){Hd(null,null,a),this.logger.log(3,()=>"Repeated command ("+Md([e,r])+") is dropped");continue}Hd(e,r,this.cmdHistory),s=this.parseCmd(e,r),s||(s=this.parseMidrow(e,r)),s||(s=this.parsePAC(e,r)),s||(s=this.parseBackgroundAttributes(e,r))}else Hd(null,null,a);if(!s&&(i=this.parseChars(e,r),i)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(i)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}s||i||this.logger.log(2,()=>"Couldn't parse cleaned data "+Md([e,r])+" orig: "+Md([t[n],t[n+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const n=20===e||21===e||23===e?1:2,r=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let n=0;if((17===e||25===e)&&t>=32&&t<=47){if(n=17===e?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return!!r&&(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Md([e,t])+")"),!0)}return!1}parsePAC(e,t){let n;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const r=e<=23?1:2;n=t>=64&&t<=95?1===r?_d[e]:Pd[e]:1===r?Dd[e]:Cd[e];const s=this.channels[r];return!!s&&(s.setPAC(this.interpretPAC(n,t)),this.currentChannel=r,!0)}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1===(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}parseChars(e,t){let n,r=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let e;e=17===s?t+80:18===s?t+112:t+144,this.logger.log(2,()=>"Special char '"+Ad(e)+"' in channel "+n),r=[e]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+Md(r).join(",")),r}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let n;const r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=Od[n],t%2===1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));const s=e<=23?1:2;return this.channels[s].setBkgData(r),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Hd(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Hd(e,t,n){n.a=e,n.b=t}function Vd(e,t,n){return n.a===e&&n.b===t}var zd=function(){if(null!=so&&so.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!==typeof t)return!1;if(!Array.isArray(e))return!1;const n=t.toLowerCase();return!!~e.indexOf(n)&&n}function r(e){return n(t,e)}function s(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let s=1;for(;s<arguments.length;s++){const t=arguments[s];for(const n in t)e[n]=t[n]}return e}function i(t,i,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",u=!1,d=t,h=i,f=a,g=null,m="",p=!0,v="auto",y="start",b=50,E="middle",S=50,T="middle";Object.defineProperty(o,"id",s({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",s({},l,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(o,"startTime",s({},l,{get:function(){return d},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",s({},l,{get:function(){return h},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",s({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",s({},l,{get:function(){return g},set:function(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",s({},l,{get:function(){return m},set:function(t){const r=function(t){return n(e,t)}(t);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");m=r,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",s({},l,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",s({},l,{get:function(){return v},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",s({},l,{get:function(){return y},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",s({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",s({},l,{get:function(){return E},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",s({},l,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",s({},l,{get:function(){return T},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),o.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i}();class Wd{decode(e,t){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Yd(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(r||0)}const n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}class qd{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Qd(e,t,n,r){const s=r?e.split(r):[e];for(const i in s){if("string"!==typeof s[i])continue;const e=s[i].split(n);if(2!==e.length)continue;t(e[0],e[1])}}const Xd=new zd(0,0,""),$d="middle"===Xd.align?"middle":"center";function Jd(e,t,n){const r=e;function s(){const t=Yd(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function i(){e=e.replace(/^\s+/,"")}if(i(),t.startTime=s(),i(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.slice(3),i(),t.endTime=s(),i(),function(e,t){const r=new qd;Qd(e,function(e,t){let s;switch(e){case"region":for(let s=n.length-1;s>=0;s--)if(n[s].id===t){r.set(e,n[s].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":s=t.split(","),r.integer(e,s[0]),r.percent(e,s[0])&&r.set("snapToLines",!1),r.alt(e,s[0],["auto"]),2===s.length&&r.alt("lineAlign",s[1],["start",$d,"end"]);break;case"position":s=t.split(","),r.percent(e,s[0]),2===s.length&&r.alt("positionAlign",s[1],["start",$d,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",$d,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");let s=r.get("line","auto");"auto"===s&&-1===Xd.line&&(s=-1),t.line=s,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",$d);let i=r.get("position","auto");"auto"===i&&50===Xd.position&&(i="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=i}(e,t)}function Zd(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class eh{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Wd,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function n(){let e=t.buffer,n=0;for(e=Zd(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;const r=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),r}function r(e){Qd(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=n();const r=e.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==r||!r[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let s=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:e=n(),t.state){case"HEADER":/:/.test(e)?r(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new zd(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Jd(e,t.cue,t.regionList)}catch(cf){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==e.indexOf("--\x3e");if(!e||n&&(s=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(cf){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(cf){e.onparsingerror&&e.onparsingerror(cf)}return e.onflush&&e.onflush(),this}}const th=/\r\n|\n\r|\n|\r/g,nh=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(n,n+t.length)===t};function rh(e,t,n){return ud(e.toString())+ud(t.toString())+ud(n)}function sh(e,t,n,r,s,i,a){const o=new eh,l=vs(new Uint8Array(e)).trim().replace(th,"\n").split("\n"),c=[],u=t?function(e){return Ac(e,9e4,1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}(t.baseTime,t.timescale):0;let d,h="00:00.000",f=0,g=0,m=!0;o.oncue=function(e){const i=n[r];let a=n.ccOffset;const o=(f-u)/9e4;if(null!=i&&i.new&&(void 0!==g?a=n.ccOffset=i.start:function(e,t,n){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;null!=(i=s)&&i.new;){var i;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=n}(n,r,o)),o){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));a=o-n.presentationOffset}const l=e.endTime-e.startTime,h=Nc(9e4*(e.startTime+a-g),9e4*s)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const m=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(m)),e.id||(e.id=rh(e.startTime,e.endTime,m)),e.endTime>0&&c.push(e)},o.onparsingerror=function(e){d=e},o.onflush=function(){d?a(d):i(c)},l.forEach(e=>{if(m){if(nh(e,"X-TIMESTAMP-MAP=")){m=!1,e.slice(16).split(",").forEach(e=>{nh(e,"LOCAL:")?h=e.slice(6):nh(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{g=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Hr(t)||!Hr(n)||!Hr(r)||!Hr(s))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*n,t+=6e4*r,t+=36e5*s,t}(h)/1e3}catch(t){d=t}return}""===e&&(m=!1)}o.parse(e+"\n")}),o.flush()}const ih="stpp.ttml.im1t",ah=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,oh=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,lh={left:"start",center:"center",right:"end",start:"start",end:"end"};function ch(e,t,n,r){const s=Gs(new Uint8Array(e),["mdat"]);if(0===s.length)return void r(new Error("Could not parse IMSC1 mdat"));const i=s.map(e=>vs(e)),a=function(e,t){return Ac(e,t,1/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1),arguments.length>3&&void 0!==arguments[3]&&arguments[3])}(t.baseTime,1,t.timescale);try{i.forEach(e=>n(function(e,t){const n=(new DOMParser).parseFromString(e,"text/xml"),r=n.getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(s).reduce((e,t)=>(e[t]=r.getAttribute("ttp:".concat(t))||s[t],e),{}),a="preserve"!==r.getAttribute("xml:space"),o=dh(uh(r,"styling","style")),l=dh(uh(r,"layout","region")),c=uh(r,"body","[begin]");return[].map.call(c,e=>{const n=hh(e,a);if(!n||!e.hasAttribute("begin"))return null;const r=mh(e.getAttribute("begin"),i),s=mh(e.getAttribute("dur"),i);let c=mh(e.getAttribute("end"),i);if(null===r)throw gh(e);if(null===c){if(null===s)throw gh(e);c=r+s}const u=new zd(r-t,c-t,n);u.id=rh(u.startTime,u.endTime,u.text);const d=function(e,t,n){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&n.hasOwnProperty(a)&&(s=n[a]);return i.reduce((n,i)=>{const a=fh(t,r,i)||fh(e,r,i)||fh(s,r,i);return a&&(n[i]=a),n},{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:h}=d;if(h){const e=lh[h];e&&(u.lineAlign=e),u.align=h}return is(u,d),u}).filter(e=>null!==e)}(e,a)))}catch(o){r(o)}}function uh(e,t,n){const r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function dh(e){return e.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function hh(e,t){return[].slice.call(e.childNodes).reduce((e,n,r)=>{var s;return"br"===n.nodeName&&r?e+"\n":null!=(s=n.childNodes)&&s.length?hh(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent},"")}function fh(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function gh(e){return new Error("Could not parse ttml timestamp ".concat(e))}function mh(e,t){if(!e)return null;let n=Yd(e);return null===n&&(ah.test(e)?n=function(e,t){const n=ah.exec(e),r=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/t.frameRate}(e,t):oh.test(e)&&(n=function(e,t){const n=oh.exec(e),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),n}class ph{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function vh(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function yh(e,t){return!!e&&e.kind===vh(t)&&$c(t,e)}function bh(e,t,n,r){return Math.min(t,r)-Math.max(e,n)}const Eh=/\s/,Sh={newCue(e,t,n,r){const s=[];let i,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let h=0;h<r.rows.length;h++)if(i=r.rows[h],o=!0,l=0,c="",!i.isEmpty()){var d;for(let e=0;e<i.chars.length;e++)Eh.test(i.chars[e].uchar)&&o?l++:(c+=i.chars[e].uchar,o=!1);i.cueStartTime=t,t===n&&(n+=1e-4),l>=16?l--:l++;const r=Zd(c.trim()),f=rh(t,n,r);null!=e&&null!=(d=e.cues)&&d.getCueById(f)||(a=new u(t,n,r),a.id=f,a.line=h+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),s.push(a))}return e&&s.length&&(s.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),s.forEach(t=>ad(e,t))),s}};const Th=/(\d+)-(\d+)\/(\d+)/;class xh{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||kh,this.controller=new self.AbortController,this.stats=new ks}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=function(e,t){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(is({},e.headers))};e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return n}(e,this.controller.signal),i="arraybuffer"===e.responseType,a=i?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=o&&Hr(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout);(Hc(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(n=>{var s;this.response=this.loader=n;const a=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},l-(a-r.loading.start)),!n.ok){const{status:e,statusText:t}=n;throw new wh(t||"fetch, bad network response",e,n)}r.loading.first=a,r.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=Th.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(Hr(e))return e}const n=e.get("Content-Length");if(n)return parseInt(n)}(n.headers)||r.total;const o=null==(s=this.callbacks)?void 0:s.onProgress;return o&&Hr(t.highWaterMark)?this.loadProgressively(n,r,e,t.highWaterMark,o):i?n.arrayBuffer():"json"===e.responseType?n.json():n.text()}).then(n=>{var s,i;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=n[a];l&&(r.loaded=r.total=l);const c={url:o.url,data:n,code:o.status},u=null==(s=this.callbacks)?void 0:s.onProgress;u&&!Hr(t.highWaterMark)&&u(r,e,n,o),null==(i=this.callbacks)||i.onSuccess(c,r,e,o)}).catch(t=>{var n;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const s=t&&t.code||0,i=t?t.message:null;null==(n=this.callbacks)||n.onError({code:s,text:i},e,t?t.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;const i=new yl,a=e.body.getReader(),o=()=>a.read().then(a=>{if(a.done)return i.dataLength&&s(t,n,i.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return t.loaded+=c,c<r||i.dataLength?(i.push(l),i.dataLength>=r&&s(t,n,i.flush().buffer,e)):s(t,n,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function kh(e,t){return new self.Request(e.url,t)}class wh extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const Lh=/^age:\s*[\d.]+\s*$/im;class Ah{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ks,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return s(n,t.url)}).catch(e=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(e=>{var s;null==(s=this.callbacks)||s.onError({code:n.status,text:e.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:i}=n.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&Hr(s)?s:i,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!n.aborted&&r>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const r=t.status,l="text"===t.responseType?t.responseText:null;if(r>=200&&r<300){const s=null!=l?l:t.response;if(null!=s){var i,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const o="arraybuffer"===t.responseType?s.byteLength:s.length;n.loaded=n.total=o,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first);const l=null==(i=this.callbacks)?void 0:i.onProgress;l&&l(n,e,s,t);const c={url:t.responseURL,data:s,code:r};return void(null==(a=this.callbacks)||a.onSuccess(c,n,e,t))}}const c=s.loadPolicy.errorRetry;var o;if(sa(c,n.retry,!1,{url:e.url,data:void 0,code:r}))this.retry(c);else gs.error("".concat(r," while loading ").concat(e.url)),null==(o=this.callbacks)||o.onError({code:r,text:t.statusText},e,t,n)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(sa(e,this.stats.retry,!0))this.retry(e);else{var t;gs.warn("timeout while loading ".concat(null==(t=this.context)?void 0:t.url));const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=na(e,n.retry),n.retry++,gs.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==t?void 0:t.url,", retrying ").concat(n.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Lh.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Rh=os(os({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Ah,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends ls{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:n,partCurrent:r,hls:s}=this,{autoLevelEnabled:i,media:a}=s;if(!n||!a)return;const o=performance.now(),l=r?r.stats:n.stats,c=r?r.duration:n.duration,u=o-l.loading.start,d=s.minAutoLevel,h=n.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||h<=d)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i)return;const g=f>-1&&f!==h,m=!!e||g;if(!m&&(a.paused||!a.playbackRate||!a.readyState))return;const p=s.mainForwardBufferInfo;if(!m&&null===p)return;const v=this.bwEstimator.getEstimateTTFB(),y=Math.abs(a.playbackRate);if(u<=Math.max(v,c/(2*y)*1e3))return;const b=p?p.len/y:0,E=l.loading.first?l.loading.first-l.loading.start:-1,S=l.loaded&&E>-1,T=this.getBwEstimate(),x=s.levels,k=x[h],w=Math.max(l.loaded,Math.round(c*(n.bitrate||k.averageBitrate)/8));let L=S?u-E:u;L<1&&S&&(L=Math.min(u,8*l.loaded/T));const A=S?1e3*l.loaded/L:0,R=v/1e3,I=A?(w-l.loaded)/A:8*w/T+R;if(I<=b)return;const _=A?8*A:T,D=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),P=this.hls.config.abrBandWidthUpFactor;let C,O=Number.POSITIVE_INFINITY;for(C=h-1;C>d;C--){const e=x[C].maxBitrate,t=!x[C].details||D;if(O=this.getTimeToLoadFrag(R,_,c*e,t),O<Math.min(b,c+R))break}if(O>=I)return;if(O>10*c)return;S?this.bwEstimator.sample(u-Math.min(v,E),l.loaded):this.bwEstimator.sampleTTFB(u);const N=x[C].maxBitrate;this.getBwEstimate()*P>N&&this.resetEstimator(N);const M=this.findBestLevel(N,d,C,0,b,1,1);M>-1&&(C=M),this.warn("Fragment ".concat(n.sn).concat(r?" part "+r.index:""," of level ").concat(h," is loading too slowly;\n      Fragment duration: ").concat(n.duration.toFixed(3),"\n      Time to underbuffer: ").concat(b.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(I.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(O.toFixed(3)," s\n      TTFB estimate: ").concat(0|E," ms\n      Current BW estimate: ").concat(Hr(T)?0|T:"Unknown"," bps\n      New BW estimate: ").concat(0|this.getBwEstimate()," bps\n      Switching to level ").concat(C," @ ").concat(0|N," bps")),s.nextLoadLevel=s.nextAutoLevel=C,this.clearTimer();const F=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===C&&C>0){const e=this.getStarvationDelay();if(this.warn("Aborting inflight request ".concat(C>0?"and switching down":"","\n      Fragment duration: ").concat(n.duration.toFixed(3)," s\n      Time to underbuffer: ").concat(e.toFixed(3)," s")),n.abortRequests(),this.fragCurrent=this.partCurrent=null,C>d){let t=this.findBestLevel(this.hls.levels[d].bitrate,d,C,0,e,1,1);-1===t&&(t=d),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};g||I>2*O?F():this.timer=self.setInterval(F,1e3*O),s.trigger(qr.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log("setting initial bwe to ".concat(e)),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new rs(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.FRAG_LOADING,this.onFragLoading,this),e.on(qr.FRAG_LOADED,this.onFragLoaded,this),e.on(qr.FRAG_BUFFERED,this.onFragBuffered,this),e.on(qr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(qr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(qr.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(qr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.FRAG_LOADING,this.onFragLoading,this),e.off(qr.FRAG_LOADED,this.onFragLoaded,this),e.off(qr.FRAG_BUFFERED,this.onFragBuffered,this),e.off(qr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(qr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(qr.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(qr.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){var r;if(!n.bitrateTest)this.fragCurrent=n,this.partCurrent=null!=(r=t.part)?r:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Yr.BUFFER_ADD_CODEC_ERROR:case Yr.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Yr.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:n,partCurrent:r}=this;if(e&&n&&e.sn===n.sn&&e.level===n.level){const t=performance.now(),n=r?r.stats:e.stats,s=t-n.loading.start,i=n.loading.first?n.loading.first-n.loading.start:-1;if(n.loaded&&i>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(s-Math.min(e,i),n.loaded)}else this.bwEstimator.sampleTTFB(s)}break}}}getTimeToLoadFrag(e,t,n,r){return e+n/t+(r?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;Hr(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,t){let{frag:n,part:r}=t;const s=r?r.stats:n.stats;if(n.type===Zr&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=r?r.duration:n.duration,t=this.hls.levels[n.level],i=(t.loaded?t.loaded.bytes:0)+s.loaded,a=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:i,duration:a},t.realBitrate=Math.round(8*i/a)}if(n.bitrateTest){const e={stats:s,frag:n,part:r,id:n.type};this.onFragBuffered(qr.FRAG_BUFFERED,e),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,s=null!=r&&r.stats.loaded?r.stats:n.stats;if(s.aborted)return;if(this.ignoreFragment(n))return;const i=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(i,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Zr||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,r,1,1);if(s>-1)return s;const i=this.hls.firstLevel,a=Math.min(Math.max(i,t),e);return this.warn("Could not find best starting auto level. Defaulting to first in playlist ".concat(i," clamped to ").concat(a)),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(-1!==e&&(!t||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=t&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,r)&&t[e].loadError<=t[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:i}=n,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=s.abrBandWidthFactor,u=s.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,i,r,l,0,c,u);if(e>=0)return this.rebufferNotice=-1,e}let d=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){d=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-e,this.info("bitrate test took ".concat(Math.round(1e3*e),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*d)," ms")),c=u=1}}const h=this.findBestLevel(o,i,r,l,d,c,u);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info("".concat(l?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(h))),h>-1)return h;const f=n.levels[i],g=n.loadLevelObj;return g&&(null==f?void 0:f.bitrate)<g.bitrate?i:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,s,i,a){var o;const l=r+s,c=this.lastLoadedFragLevel,u=-1===c?this.hls.firstLevel:c,{fragCurrent:d,partCurrent:h}=this,{levels:f,allAudioTracks:g,loadLevel:m,config:p}=this.hls;if(1===f.length)return 0;const v=f[u],y=!(null==(o=this.hls.latestLevelDetails)||!o.live),b=-1===m||-1===c;let E,S="SDR",T=(null==v?void 0:v.frameRate)||0;const{audioPreference:x,videoPreference:k}=p,w=this.audioTracksByGroup||(this.audioTracksByGroup=ji(g));let L=-1;if(b){if(-1!==this.firstSelection)return this.firstSelection;const r=this.codecTiers||(this.codecTiers=function(e,t,n,r){return e.slice(n,r+1).reduce((e,n,r)=>{if(!n.codecSet)return e;const s=n.audioGroups;let i=e[n.codecSet];i||(e[n.codecSet]=i={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:r,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!s,fragmentError:0}),i.minBitrate=Math.min(i.minBitrate,n.bitrate);const a=Math.min(n.height,n.width);return i.minHeight=Math.min(i.minHeight,a),i.minFramerate=Math.min(i.minFramerate,n.frameRate),i.minIndex=Math.min(i.minIndex,r),i.maxScore=Math.max(i.maxScore,n.score),i.fragmentError+=n.fragmentError,i.videoRanges[n.videoRange]=(i.videoRanges[n.videoRange]||0)+1,s&&s.forEach(e=>{if(!e)return;const n=t.groups[e];n&&(i.hasDefaultAudio=i.hasDefaultAudio||t.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(n.channels).forEach(e=>{i.channels[e]=(i.channels[e]||0)+n.channels[e]}))}),e},{})}(f,w,t,n)),s=function(e,t,n,r,s){const i=Object.keys(e),a=null==r?void 0:r.channels,o=null==r?void 0:r.audioCodec,l=null==s?void 0:s.videoCodec,c=a&&2===parseInt(a);let u=!1,d=!1,h=1/0,f=1/0,g=1/0,m=1/0,p=0,v=[];const{preferHDR:y,allowedVideoRanges:b}=Fi(t,s);for(let x=i.length;x--;){const t=e[i[x]];u||(u=t.channels[2]>0),h=Math.min(h,t.minHeight),f=Math.min(f,t.minFramerate),g=Math.min(g,t.minBitrate),b.filter(e=>t.videoRanges[e]>0).length>0&&(d=!0)}h=Hr(h)?h:0,f=Hr(f)?f:0;const E=Math.max(1080,h),S=Math.max(30,f);g=Hr(g)?g:n,n=Math.max(g,n),d||(t=void 0);const T=i.length>1;return{codecSet:i.reduce((t,r)=>{const s=e[r];if(r===t)return t;if(v=d?b.filter(e=>s.videoRanges[e]>0):[],T){if(s.minBitrate>n)return Bi(r,"min bitrate of ".concat(s.minBitrate," > current estimate of ").concat(n)),t;if(!s.hasDefaultAudio)return Bi(r,"no renditions with default or auto-select sound found"),t;if(o&&r.indexOf(o.substring(0,4))%5!==0)return Bi(r,'audio codec preference "'.concat(o,'" not found')),t;if(a&&!c){if(!s.channels[a])return Bi(r,"no renditions with ".concat(a," channel sound found (channels options: ").concat(Object.keys(s.channels),")")),t}else if((!o||c)&&u&&0===s.channels[2])return Bi(r,"no renditions with stereo sound found"),t;if(s.minHeight>E)return Bi(r,"min resolution of ".concat(s.minHeight," > maximum of ").concat(E)),t;if(s.minFramerate>S)return Bi(r,"min framerate of ".concat(s.minFramerate," > maximum of ").concat(S)),t;if(!v.some(e=>s.videoRanges[e]>0))return Bi(r,"no variants with VIDEO-RANGE of ".concat(Ui(v)," found")),t;if(l&&r.indexOf(l.substring(0,4))%5!==0)return Bi(r,'video codec preference "'.concat(l,'" not found')),t;if(s.maxScore<p)return Bi(r,"max score of ".concat(s.maxScore," < selected max of ").concat(p)),t}return t&&(hi(r)>=hi(t)||s.fragmentError>e[t].fragmentError)?t:(m=s.minIndex,p=s.maxScore,r)},void 0),videoRanges:v,preferHDR:y,minFramerate:f,minBitrate:g,minIndex:m}}(r,S,e,x,k),{codecSet:i,videoRanges:a,minFramerate:o,minBitrate:l,minIndex:c,preferHDR:u}=s;L=c,E=i,S=u?a[a.length-1]:a[0],T=o,e=Math.max(e,l),this.log("picked start tier ".concat(Ui(s)))}else E=null==v?void 0:v.codecSet,S=null==v?void 0:v.videoRange;const A=h?h.duration:d?d.duration:0,R=this.bwEstimator.getEstimateTTFB()/1e3,I=[];for(let D=n;D>=t;D--){var _;const t=f[D],o=D>u;if(!t)continue;if(p.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const n=navigator.mediaCapabilities;"function"===typeof(null==n?void 0:n.decodingInfo)&&ki(t,w,S,T,e,x)?(t.supportedPromise=wi(t,w,n,this.supportedCache),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const n=this.hls.levels,r=n.indexOf(t);e.error?this.warn('MediaCapabilities decodingInfo error: "'.concat(e.error,'" for level ').concat(r," ").concat(Ui(e))):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log("MediaCapabilities decodingInfo for level ".concat(r," not smooth or powerEfficient: ").concat(Ui(e))):(this.warn("Unsupported MediaCapabilities decodingInfo result for level ".concat(r," ").concat(Ui(e))),r>-1&&n.length>1&&(this.log("Removing unsupported level ".concat(r)),this.hls.removeLevel(r),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn("Error handling MediaCapabilities decodingInfo: ".concat(e))})):t.supportedResult=Ti}if((E&&t.codecSet!==E||S&&t.videoRange!==S||o&&T>t.frameRate||!o&&T>0&&T<t.frameRate||null!=(_=t.supportedResult)&&null!=(_=_.decodingInfoResults)&&_.some(e=>!1===e.smooth))&&(!b||D!==L)){I.push(D);continue}const d=t.details,g=(h?null==d?void 0:d.partTarget:null==d?void 0:d.averagetargetduration)||A;let v;v=o?a*e:i*e;const k=A&&r>=2*A&&0===s?t.averageBitrate:t.maxBitrate,P=this.getTimeToLoadFrag(R,v,k*g,void 0===d);if(v>=k&&(D===c||0===t.loadError&&0===t.fragmentError)&&(P<=R||!Hr(P)||y&&!this.bitrateTestDelay||P<l)){const e=this.forcedAutoLevel;return D===m||-1!==e&&e===m||(I.length&&this.trace("Skipped level(s) ".concat(I.join(",")," of ").concat(n,' max with CODECS and VIDEO-RANGE:"').concat(f[I[0]].codecs,'" ').concat(f[I[0]].videoRange,'; not compatible with "').concat(E,'" ').concat(S)),this.info("switch candidate:".concat(u,"->").concat(D," adjustedbw(").concat(Math.round(v),")-bitrate=").concat(Math.round(v-k)," ttfb:").concat(R.toFixed(1)," avgDuration:").concat(g.toFixed(1)," maxFetchDuration:").concat(l.toFixed(1)," fetchDuration:").concat(P.toFixed(1)," firstSelection:").concat(b," codecSet:").concat(t.codecSet," videoRange:").concat(t.videoRange," hls.loadLevel:").concat(m))),b&&(this.firstSelection=D),D}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}},bufferController:class extends ls{constructor(e,t){var n;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:n}=this;e&&this.log("Media source opened"),t&&n&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(qr.MEDIA_ATTACHED,{media:t,mediaSource:n}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e,")"))},this.hls=e,this.fragmentTracker=t,this.appendSource=(n=ms(e.config.preferManagedMediaSource),"undefined"!==typeof self&&n===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(qr.BUFFER_RESET,this.onBufferReset,this),e.on(qr.BUFFER_APPENDING,this.onBufferAppending,this),e.on(qr.BUFFER_CODECS,this.onBufferCodecs,this),e.on(qr.BUFFER_EOS,this.onBufferEos,this),e.on(qr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(qr.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(qr.FRAG_PARSED,this.onFragParsed,this),e.on(qr.FRAG_CHANGED,this.onFragChanged,this),e.on(qr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(qr.BUFFER_RESET,this.onBufferReset,this),e.off(qr.BUFFER_APPENDING,this.onBufferAppending,this),e.off(qr.BUFFER_CODECS,this.onBufferCodecs,this),e.off(qr.BUFFER_EOS,this.onBufferEos,this),e.off(qr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(qr.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(qr.FRAG_PARSED,this.onFragParsed,this),e.off(qr.FRAG_CHANGED,this.onFragChanged,this),e.off(qr.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn("Transfering MediaSource with".concat(t?" operations in queue":"").concat(e?" updating SourceBuffer(s)":""," ").concat(this.operationQueue)),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?is(n,r.tracks):this.sourceBuffers.forEach(e=>{const[t]=e;t&&(n[t]=is({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log("".concat(r," bufferCodec event(s) expected.")),null!=(n=this.transferData)&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const r=ms(this.appendSource);if(r){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const i=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(i),e)this._objectUrl=n.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(i);if(this.appendSource)try{n.removeAttribute("src");const t=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||t&&i instanceof t,nu(n),function(e,t){const n=self.document.createElement("source");n.type="video/mp4",n.src=t,e.appendChild(n)}(n,e),n.load()}catch(s){n.src=e}else n.src=e}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log("".concat((null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"," media source: ").concat(null==(n=e.constructor)?void 0:n.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,s=r?Object.keys(r):null,i=s?s.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&i){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log("attachTransferred: (bufferCodecEventsTotal ".concat(this.bufferCodecEventsTotal,")\nrequired tracks: ").concat(Ui(n,(e,t)=>"initSegment"===e?void 0:t),";\ntransfer tracks: ").concat(Ui(r,(e,t)=>"initSegment"===e?void 0:t),"}")),!ps(r,n)){t.mediaSource=null,t.tracks=void 0;const s=e.currentTime,i=this.details,a=Math.max(s,(null==i?void 0:i.fragments[0].start)||0);return a-s>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time ".concat(s," -> ").concat(a)):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'.concat(Object.keys(r),'"->"').concat(Object.keys(n),'") start time: ').concat(a," currentTime: ").concat(s)),this.onMediaDetaching(qr.MEDIA_DETACHING,{}),this.onMediaAttaching(qr.MEDIA_ATTACHING,t),void(e.currentTime=a))}this.transferData=void 0,s.forEach(e=>{const t=e,n=r[t];if(n){const e=n.buffer;if(e){const r=this.fragmentTracker,s=n.id;if(r.hasFragments(s)||r.hasParts(s)){const n=Fa.getBuffered(e);r.detectEvictedFragments(t,n,s,null,!0)}const i=ru(t),a=[t,e];this.sourceBuffers[i]=a,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,n)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:i}=this;if(s){if(this.log("media source ".concat(n?"transferring":"detaching")),n)this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.removeBuffer(t)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===s.readyState;try{const t=s.sourceBuffers;for(let n=t.length;n--;)e&&t[n].abort(),s.removeSourceBuffer(t[n]);e&&s.endOfStream()}catch(uf){this.warn("onMediaDetaching: ".concat(uf.message," while calling endOfStream"))}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(i&&self.URL.revokeObjectURL(i),this.mediaSrc===i?(r.removeAttribute("src"),this.appendSource&&nu(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(qr.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(e){var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;null!=(r=this.mediaSource)&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(uf){this.warn("onBufferReset ".concat(e),uf)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[ru(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Jc(this.tracks)}onBufferCodecs(e,t){var n;const r=this.tracks,s=Object.keys(t);this.log('BUFFER_CODECS: "'.concat(s,'" (current SB count ').concat(this.sourceBufferCount,")"));const i="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!i&&this.sourceBufferCount&&this.media&&s.some(e=>!r[e]);i||a?this.warn('Unsupported transition between "'.concat(Object.keys(r),'" and "').concat(s,'" SourceBuffers')):(s.forEach(e=>{var n,s;const i=t[e],{id:a,codec:o,levelCodec:l,container:c,metadata:u,supplemental:d}=i;let h=r[e];const f=null==(n=this.transferData)||null==(n=n.tracks)?void 0:n[e],g=null!=f&&f.buffer?f:h,m=(null==g?void 0:g.pendingCodec)||(null==g?void 0:g.codec),p=null==g?void 0:g.levelCodec;h||(h=r[e]={buffer:void 0,listeners:[],codec:o,supplemental:d,container:c,levelCodec:l,metadata:u,id:a});const v=pi(m,p),y=null==v?void 0:v.replace(Zc,"$1");let b=pi(o,l);const E=null==(s=b)?void 0:s.replace(Zc,"$1");b&&v&&y!==E&&("audio"===e.slice(0,5)&&(b=mi(b,this.appendSource)),this.log("switching codec ".concat(m," to ").concat(b)),b!==(h.pendingCodec||h.codec)&&(h.pendingCodec=b),h.container=c,this.appendChangeType(e,c,b))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&"main"===(null==(n=t.audio)?void 0:n.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r="".concat(t,";codecs=").concat(n),s={label:"change-type=".concat(r),execute:()=>{const s=this.tracks[e];if(s){const i=s.buffer;null!=i&&i.changeType&&(this.log("changing ".concat(e," sourceBuffer type to ").concat(r)),i.changeType(r),s.codec=n,s.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn("Failed to change ".concat(e," SourceBuffer type"),t)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(n,Zr))?void 0:t.gap))return;const s={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>r||null!=t&&t.buffer&&Fa.isBuffered(t.buffer,r)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(r,Zr))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:s,frag:e},this.append(s,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:s,parent:i,frag:a,part:o,chunkMeta:l,offset:c}=t,u=l.buffering[s],{sn:d,cc:h}=a,f=self.performance.now();u.start=f;const g=a.stats.buffering,m=o?o.stats.buffering:null;0===g.start&&(g.start=f),m&&0===m.start&&(m.start=f);const p=n.audio;let v=!1;"audio"===s&&"audio/mpeg"===(null==p?void 0:p.container)&&(v=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const y=n.video,b=null==y?void 0:y.buffer;if(b&&"initSegment"!==d){const e=o||a,t=this.blockedAudioAppend;if("audio"!==s||"main"===i||this.blockedAudioAppend||y.ending||y.ended){if("video"===s){const n=e.end;if(t){const e=t.frag.start;(n>e||n<this.lastVideoAppendEnd||Fa.isBuffered(b,e))&&this.unblockAudio()}this.lastVideoAppendEnd=n}}else{const t=e.start+.05*e.duration,n=b.buffered,r=this.currentOp("video");n.length||r?!r&&!Fa.isBuffered(b,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const E=(o||a).start,S={label:"append-".concat(s),execute:()=>{var e;u.executeStart=self.performance.now();const t=null==(e=this.tracks[s])?void 0:e.buffer;t&&(v?this.updateTimestampOffset(t,E,.1,s,d,h):void 0!==c&&Hr(c)&&this.updateTimestampOffset(t,c,1e-6,s,d,h)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();u.executeEnd=u.end=e,0===g.first&&(g.first=e),m&&0===m.first&&(m.first=e);const t={};this.sourceBuffers.forEach(e=>{let[n,r]=e;n&&(t[n]=Fa.getBuffered(r))}),this.appendErrors[s]=0,"audio"===s||"video"===s?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(qr.BUFFER_APPENDED,{type:s,frag:a,part:o,chunkMeta:l,parent:a.type,timeRanges:t})},onError:e=>{var t;const n={type:Wr.MEDIA_ERROR,parent:a.type,details:Yr.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:o,chunkMeta:l,error:e,err:e,fatal:!1},r=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)n.details=Yr.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!r)n.errorAction=ga(!0);else if(e.name===eu&&0===this.sourceBufferCount)n.errorAction=ga(!0);else{const e=++this.appendErrors[s];this.warn("Failed ".concat(e,"/").concat(this.hls.config.appendErrorMaxRetry,' times to append segment in "').concat(s,'" sourceBuffer (').concat(r||"no media error",")")),(e>=this.hls.config.appendErrorMaxRetry||r)&&(n.fatal=!0)}this.hls.trigger(qr.ERROR,n)}};this.log('queuing "'.concat(s,'" append sn: ').concat(d).concat(o?" p: "+o.index:""," of ").concat(a.type===Zr?"level":"track"," ").concat(a.level," cc: ").concat(h)),this.append(S,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log('queuing "'.concat(e,'" remove ').concat(t,"-").concat(n)),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(qr.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn("Failed to remove ".concat(t,"-").concat(n,' from "').concat(e,'" SourceBuffer'),r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:s}=t;n?this.append(this.getFlushOp(n,r,s),n):this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.append(this.getFlushOp(t,r,s),t)})}onFragParsed(e,t){const{frag:n,part:r}=t,s=[],i=r?r.elementaryStreams:n.elementaryStreams;i[As]?s.push("audiovideo"):(i[ws]&&s.push("audio"),i[Ls]&&s.push("video"));0===s.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(n.type," level: ").concat(n.level," sn: ").concat(n.sn)),this.blockBuffers(()=>{const e=self.performance.now();n.stats.buffering.end=e,r&&(r.stats.buffering.end=e);const t=r?r.stats:n.stats;this.hls.trigger(qr.FRAG_BUFFERED,{frag:n,part:r,stats:t,id:n.type})},s).catch(e=>{this.warn("Fragment buffered callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(e=>{let[n]=e;if(n){const e=this.tracks[n];t.type&&t.type!==n||(e.ending=!0,e.ended||(e.ended=!0,this.log("".concat(n," buffer reached EOS"))))}});const r=!1!==(null==(n=this.overrides)?void 0:n.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;var n;return t&&!(null!=(n=this.tracks[t])&&n.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(qr.BUFFERED_TO_END,void 0)):e&&this.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState))})):(this.tracksEnded(),this.hls.trigger(qr.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(e=>{let[t]=e;if(null!==t){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(e,t){let{details:n}=t;n.fragments.length&&(this.details=n,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Yr.BUFFER_APPEND_ERROR&&t.frag){var n;const e=null==(n=t.errorAction)?void 0:n.nextAutoLevel;Hr(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||null===t)return;if(!this.sourceBufferCount)return;const r=e.config,s=n.currentTime,i=t.levelTargetDuration,a=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(Hr(a)&&a>=0){const e=Math.max(a,i),t=Math.floor(s/i)*i-e;this.flushBackBuffer(s,i,t)}const o=r.frontBufferFlushThreshold;if(Hr(o)&&o>0){const e=Math.max(r.maxBufferLength,o),t=Math.max(e,i),n=Math.floor(s/i)*i+t;this.flushFrontBuffer(s,i,n)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(e=>{let[t,r]=e;if(r){const e=Fa.getBuffered(r);if(e.length>0&&n>e.start(0)){var s;this.hls.trigger(qr.BACK_BUFFER_REACHED,{bufferEnd:n});const e=this.tracks[t];if(null!=(s=this.details)&&s.live)this.hls.trigger(qr.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(null!=e&&e.ended)return void this.log("Cannot flush ".concat(t," back buffer while SourceBuffer is in ended state"));this.hls.trigger(qr.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:t})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(t=>{let[r,s]=t;if(s){const t=Fa.getBuffered(s),i=t.length;if(i<2)return;const a=t.start(i-1),o=t.end(i-1);if(n>a||e>=a&&e<=o)return;this.hls.trigger(qr.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||"open"!==(null==n?void 0:n.readyState))return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,r)}}return{duration:1/0}}const s=null==(e=this.overrides)?void 0:e.duration;if(s)return Hr(s)?{duration:s}:null;const i=this.media.duration;return r>(Hr(n.duration)?n.duration:0)&&r>i||!Hr(i)?{duration:r}:null}updateMediaSource(e){let{duration:t,start:n,end:r}=e;const s=this.mediaSource;this.media&&s&&"open"===s.readyState&&(s.duration!==t&&(Hr(t)&&this.log("Updating MediaSource duration to ".concat(t.toFixed(3))),s.duration=t),void 0!==n&&void 0!==r&&(this.log("MediaSource duration is set to ".concat(s.duration,". Setting seekable range to ").concat(n,"-").concat(r,".")),s.setLiveSeekableRange(n,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log("checkPendingTracks (pending: ".concat(t," codec events expected: ").concat(e,") ").concat(Ui(n))),this.tracksReady){var r;const e=null==(r=this.transferData)?void 0:r.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(t=>{let[n,r]=t;if(n){const t=this.tracks[n];e[n]={buffer:r,container:t.container,codec:t.codec,supplemental:t.supplemental,levelCodec:t.levelCodec,id:t.id,metadata:t.metadata}}}),this.hls.trigger(qr.BUFFER_CREATED,{tracks:e}),this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),this.sourceBuffers.forEach(e=>{let[t]=e;this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const a=i,o=e[a];if(this.isPending(o)){const e=this.getTrackCodec(o,a),i="".concat(o.container,";codecs=").concat(e);o.codec=e,this.log("creating sourceBuffer(".concat(i,")").concat(this.currentOp(a)?" Queued":""," ").concat(Ui(o)));try{const e=n.addSourceBuffer(i),r=ru(a),s=[a,e];t[r]=s,o.buffer=e}catch(s){var r;return this.error("error while trying to add sourceBuffer: ".concat(s.message)),this.shiftAndExecuteNext(a),null==(r=this.operationQueue)||r.removeBlockers(),delete this.tracks[a],void this.hls.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:s,sourceBufferName:a,mimeType:i,parent:o.id})}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&("video"===t||"audiovideo"===t)&&li(n,"video")&&(r=function(e,t){const n=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)oi(t[e],"video")||n.push(t[e])}return t&&n.push(t),n.join(",")}(r,n));const s=pi(r,e.levelCodec);return s?"audio"===t.slice(0,5)?mi(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{const n=t.removedRanges;null!=n&&n.length&&this.hls.trigger(qr.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;const n=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==n?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error("".concat(e," SourceBuffer error. MediaSource readyState: ").concat(null==(n=this.mediaSource)?void 0:n.readyState));this.error("".concat(r),t),this.hls.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,n,r,s,i){const a=t-e.timestampOffset;Math.abs(a)>=n&&(this.log("Updating ".concat(r," SourceBuffer timestampOffset to ").concat(t," (sn: ").concat(s," cc: ").concat(i,")")),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:s}=this,i=this.tracks[e],a=null==i?void 0:i.buffer;if(!r||!s||!a)return this.warn("Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),void this.shiftAndExecuteNext(e);const o=Hr(r.duration)?r.duration:1/0,l=Hr(s.duration)?s.duration:1/0,c=Math.max(0,t),u=Math.min(n,o,l);u>c&&(!i.ending||i.ended)?(i.ended=!1,this.log("Removing [".concat(c,",").concat(u,"] from the ").concat(e," SourceBuffer")),a.remove(c,u)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=null==n?void 0:n.buffer;if(!r)throw new tu("Attempting to append to the ".concat(t," SourceBuffer, but it does not exist"));n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn("SourceBuffer blocked callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn("Callback run without blocking ".concat(this.operationQueue," ").concat(t))}}isUpdating(){return this.sourceBuffers.some(e=>{let[t,n]=e;return t&&n.updating})}isQueued(){return this.sourceBuffers.some(e=>{let[t]=e;return t&&!!this.currentOp(t)})}isPending(e){return!!e&&!e.buffer}blockBuffers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceBufferTypes;if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,r=t.map(e=>this.appendBlocker(e));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(t=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;n&&!n.updating&&this.shiftAndExecuteNext(e)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,t)=>{let[n]=t;return e+(n?1:0)},0)}get sourceBufferTypes(){return this.sourceBuffers.map(e=>{let[t]=e;return t}).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const i=n.bind(this,e);r.listeners.push({event:t,listener:i}),s.addEventListener(t,i)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(e=>{n.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}},capLevelController:su,errorController:class extends ls{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(qr.ERROR,this.onError,this),e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(qr.ERROR,this.onError,this),e.off(qr.ERROR,this.onErrorOut,this),e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===Zr?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===n?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if(null!=(n=e.details)&&n.hasKey(t))return!0;const r=e.audioGroups;if(r){return this.hls.allAudioTracks.filter(e=>r.indexOf(e.groupId)>=0).some(e=>{var n;return null==(n=e.details)?void 0:n.hasKey(t)})}}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case Yr.FRAG_LOAD_ERROR:case Yr.FRAG_LOAD_TIMEOUT:case Yr.KEY_LOAD_ERROR:case Yr.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case Yr.FRAG_PARSING_ERROR:if(null!=(n=t.frag)&&n.gap)return void(t.errorAction=ga());case Yr.FRAG_GAP:case Yr.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=oa);case Yr.LEVEL_EMPTY_ERROR:case Yr.LEVEL_PARSING_ERROR:{var i;const e=t.parent===Zr?t.level:r.loadLevel;t.details===Yr.LEVEL_EMPTY_ERROR&&null!=(i=t.context)&&null!=(i=i.levelDetails)&&i.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case Yr.LEVEL_LOAD_ERROR:case Yr.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==s?void 0:s.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level)));case Yr.AUDIO_TRACK_LOAD_ERROR:case Yr.AUDIO_TRACK_LOAD_TIMEOUT:case Yr.SUBTITLE_LOAD_ERROR:case Yr.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const e=r.loadLevelObj;if(e&&(s.type===$r&&e.hasAudioGroup(s.groupId)||s.type===Jr&&e.hasSubtitleGroup(s.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=oa,void(t.errorAction.flags=da)}return;case Yr.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(t.errorAction={action:oa,flags:ha});case Yr.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Yr.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Yr.KEY_SYSTEM_NO_SESSION:return void(t.errorAction={action:oa,flags:fa});case Yr.BUFFER_ADD_CODEC_ERROR:case Yr.REMUX_ALLOC_ERROR:case Yr.BUFFER_APPEND_ERROR:var a;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(a=t.level)?a:r.loadLevel);return;case Yr.INTERNAL_EXCEPTION:case Yr.BUFFER_APPENDING_ERROR:case Yr.BUFFER_FULL_ERROR:case Yr.LEVEL_SWITCH_ERROR:case Yr.BUFFER_STALLED_ERROR:case Yr.BUFFER_SEEK_OVER_HOLE:case Yr.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=ga())}t.type===Wr.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ga())}getPlaylistRetryOrSwitchAction(e,t){const n=ta(this.hls.config.playlistLoadPolicy,e),r=this.playlistError++;if(sa(n,r,Ji(e),e.response))return{action:ca,flags:ua,retryConfig:n,retryCount:r};const s=this.getLevelSwitchAction(e,t);return n&&(s.retryConfig=n,s.retryCount=r),s}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:i}=t.config,a=ta(Zi(e)?i:s,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(r&&(e.details!==Yr.FRAG_GAP&&r.fragmentError++,!ea(e))){if(sa(a,o,Ji(e),e.response))return{action:ca,flags:ua,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(e,n);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(e,t){const n=this.hls;null!==t&&void 0!==t||(t=n.loadLevel);const r=this.hls.levels[t];if(r){var s,i;const t=e.details;r.loadError++,t===Yr.BUFFER_APPEND_ERROR&&r.fragmentError++;let l=-1;const{levels:c,loadLevel:u,minAutoLevel:d,maxAutoLevel:h}=n;n.autoLevelEnabled||n.config.preserveManualLevelOnError||(n.loadLevel=-1);const f=null==(s=e.frag)?void 0:s.type,g=(f===es&&t===Yr.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===Yr.BUFFER_ADD_CODEC_ERROR||t===Yr.BUFFER_APPEND_ERROR))&&c.some(e=>{let{audioCodec:t}=e;return r.audioCodec!==t}),m="video"===e.sourceBufferName&&(t===Yr.BUFFER_ADD_CODEC_ERROR||t===Yr.BUFFER_APPEND_ERROR)&&c.some(e=>{let{codecSet:t,audioCodec:n}=e;return r.codecSet!==t&&r.audioCodec===n}),{type:p,groupId:v}=null!=(i=e.context)?i:{};for(let n=c.length;n--;){const s=(n+u)%c.length;if(s!==u&&s>=d&&s<=h&&0===c[s].loadError){var a,o;const n=c[s];if(t===Yr.FRAG_GAP&&f===Zr&&e.frag){const t=c[s].details;if(t){const n=qi(e.frag,t.fragments,e.frag.start);if(null!=n&&n.gap)continue}}else{if(p===$r&&n.hasAudioGroup(v)||p===Jr&&n.hasSubtitleGroup(v))continue;if(f===es&&null!=(a=r.audioGroups)&&a.some(e=>n.hasAudioGroup(e))||f===ts&&null!=(o=r.subtitleGroups)&&o.some(e=>n.hasSubtitleGroup(e))||g&&r.audioCodec===n.audioCodec||m&&r.codecSet===n.codecSet||!g&&r.codecSet!==n.codecSet)continue}l=s;break}}if(l>-1&&n.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:oa,flags:ua,nextAutoLevel:l}}return{action:oa,flags:da}}onErrorOut(e,t){var n;switch(null==(n=t.errorAction)?void 0:n.action){case aa:break;case oa:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===Yr.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'.concat(t.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r}=n,s=n.nextAutoLevel;switch(r){case ua:this.switchLevel(e,s);break;case ha:{const r=this.getVariantLevelIndex(e.frag),s=t.levels[r],i=null==s?void 0:s.attrs["HDCP-LEVEL"];if(n.hdcpLevel=i,"NONE"===i)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(i){t.maxHdcpLevel=Ri[Ri.indexOf(i)-1],n.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'));break}}case fa:{const t=e.decryptdata;if(t){const r=this.hls.levels,s=r.length;for(let n=s;n--;){var i,a;if(this.variantHasKey(r[n],t))this.log("Banned key found in level ".concat(n," (").concat(r[n].bitrate,'bps) or audio group "').concat(null==(i=r[n].audioGroups)?void 0:i.join(","),'" (').concat(null==(a=e.frag)?void 0:a.type," fragment) ").concat(ys(t.keyId||[]))),r[n].fragmentError++,r[n].loadError++,this.log("Removing level ".concat(n," with key error (").concat(e.error,")")),this.hls.removeLevel(n)}const o=e.frag;if(this.hls.levels.length<s)n.resolved=!0;else if(o&&o.type!==Zr){const e=o.decryptdata;e&&!t.matches(e)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Yr.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=Ei(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r]["".concat(e.sourceBufferName,"Codec")]===t&&(this.log("Removing level ".concat(r," for ").concat(e.details,' ("').concat(t,'" not supported)')),this.hls.removeLevel(r))}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"===typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const e=r-this.lastTime,s=n-this.lastDroppedFrames,i=t-this.lastDecodedFrames,a=1e3*s/e,o=this.hls;if(o.trigger(qr.FPS_DROP,{currentDropped:s,currentDecoded:i,totalDroppedFrames:n}),a>0&&s>o.config.fpsDroppedMonitoringThreshold*i){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(qr.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:go,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Sh,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends pl{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",ts),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(qr.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(qr.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(qr.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(qr.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(qr.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(qr.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(qr.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(qr.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(qr.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(qr.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=il,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(this.fragContextChanged(n)||(Is(n)&&(this.fragPrevious=n),this.state=il),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let i;const a=n.start;for(let l=0;l<s.length;l++)if(a>=s[l].start&&a<=s[l].end){i=s[l];break}const o=n.start+n.duration;i?i.end=o:(i={start:a,end:o},s.push(i)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(0===n&&r!==Number.POSITIVE_INFINITY){const e=r-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let n=0;n<t.length;)if(t[n].end<=e)t.shift();else{if(!(t[n].start<e))break;t[n].start=e,n++}}),this.fragmentTracker.removeFragmentsInRange(n,e,ts)}}onError(e,t){const n=t.frag;(null==n?void 0:n.type)===ts&&(t.details===Yr.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==sl&&(this.state=il))}onSubtitleTracksUpdated(e,t){let{subtitleTracks:n}=t;this.levels&&Qc(this.levels,n)?this.levels=n.map(e=>new Ni(e)):(this.tracksBuffered=[],this.levels=n.map(e=>{const t=new Ni(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ts),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==sl&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:s}=this,{details:i,id:a}=t;if(!s)return void this.warn("Subtitle tracks were reset while loading level ".concat(a));const o=s[a];if(a>=s.length||!o)return;this.log("Subtitle track ".concat(a," loaded [").concat(i.startSN,",").concat(i.endSN,"]").concat(i.lastPartSn?"[part-".concat(i.lastPartSn,"-").concat(i.lastPartIndex,"]"):"",",duration:").concat(i.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(i.live||null!=(n=o.details)&&n.live){if(i.deltaUpdateFailed)return;const e=this.mainDetails;if(!e)return void(this.startFragRequested=!1);const t=e.fragments[0];var c;if(o.details)l=this.alignPlaylists(i,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&t&&(l=t.start,Ko(i,l));else i.hasProgramDateTime&&e.hasProgramDateTime?(el(i,e),l=i.fragmentStart):t&&(l=t.start,Ko(i,l));e&&!this.startFragRequested&&this.setStartPosition(e,l)}if(o.details=i,this.levelLastLoaded=o,a===r&&(this.hls.trigger(qr.SUBTITLE_TRACK_UPDATED,{details:i,id:a,groupId:t.groupId}),this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===il)){qi(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&null!=r&&r.key&&r.iv&&Ja(r.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,Za(r.method)).catch(e=>{throw s.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(n=>{const r=performance.now();s.trigger(qr.FRAG_DECRYPTED,{frag:t,payload:n,stats:{tstart:e,tdecrypt:r}})}).catch(e=>{this.warn("".concat(e.name,": ").concat(e.message)),this.state=il})}}doTick(){if(this.media){if(this.state===il){const{currentTrackId:e,levels:t}=this,n=null==t?void 0:t[e];if(!n||!t.length||!n.details)return;if(this.waitForLive(n))return;const{config:r}=this,s=this.getLoadPosition(),i=Fa.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:o}=i,l=n.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,u=c.length,d=l.edge;let h=null;const f=this.fragPrevious;if(a<d){const e=r.maxFragLookUpTolerance,t=a>d-e?0:e;h=qi(f,c,Math.max(c[0].start,a),t),!h&&f&&f.start<c[0].start&&(h=c[0])}else h=c[u-1];if(h=this.filterReplacedPrimary(h,n.details),!h)return;const g=c[h.sn-l.startSN-1];if(g&&g.cc===h.cc&&this.fragmentTracker.getState(g)===ma&&(h=g),this.fragmentTracker.getState(h)===ma){const e=this.mapToInitFragWhenRequired(h);e&&this.loadFragment(e,n,a)}}}else this.state=il}loadFragment(e,t,n){Is(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new wd(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends qc{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=cd(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=t[r];else if("showing"===t[r].mode){e=t[r];break}const n=this.findTrackForTextTrack(e);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(qr.LEVEL_LOADING,this.onLevelLoading,this),e.on(qr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(qr.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(qr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(qr.LEVEL_LOADING,this.onLevelLoading,this),e.off(qr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(qr.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(qr.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;cd(n.textTracks).forEach(e=>{od(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,i=this.tracksInGroup[n];if(!i||i.groupId!==r)return void this.warn("Subtitle track with id:".concat(n," and group:").concat(r," not found in active group ").concat(null==i?void 0:i.groupId));const a=i.details;i.details=t.details,this.log("Subtitle track ".concat(n,' "').concat(i.name,'" lang:').concat(i.lang," group:").concat(r," loaded [").concat(s.startSN,"-").concat(s.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==r?void 0:r.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!s&&t){this.selectDefaultTrack=!1;const n=Ki(t,e);if(n>-1)s=e[n];else{const e=Ki(t,this.tracks);s=this.tracks[e]}}let r=this.findTrackId(s);-1===r&&s&&(r=this.findTrackId(null));const i={subtitleTracks:e};this.log("Updating subtitle tracks, ".concat(e.length,' track(s) found in "').concat(null==n?void 0:n.join(","),'" group-id')),this.hls.trigger(qr.SUBTITLE_TRACKS_UPDATED,i),-1!==r&&-1===this.trackId&&this.setSubtitleTrack(r)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if((!n||s.default)&&(n||e)&&(!e||Hi(s,e)))return r}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(Xc(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(Xc(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){if($c(t[n],e))return n}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Jr||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Hi(e,n))return n;const r=Ki(e,this.tracksInGroup);if(r>-1){const e=this.tracksInGroup[r];return this.setSubtitleTrack(r),e}if(n)return null;{const n=Ki(e,t);if(n>-1)return t[n]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),i=e.details,a=null==i?void 0:i.age;this.log("Loading subtitle ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&i.live?" age "+a.toFixed(1)+(i.type?" "+i.type||0:""):""," ").concat(s)),this.hls.trigger(qr.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=cd(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(e=>$c(n,e))[0],r||this.warn('Unable to find subtitle TextTrack with name "'.concat(n.name,'" and language "').concat(n.lang,'"'))),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==r&&(e.mode="disabled")}),r){const e=this.subtitleDisplay?"showing":"hidden";r.mode!==e&&(r.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!Hr(e))return void this.warn("Invalid subtitle track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r)return void this.hls.trigger(qr.SUBTITLE_TRACK_SWITCH,{id:e});const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&s)return;this.log("Switching to subtitle-track ".concat(e)+(r?' "'.concat(r.name,'" lang:').concat(r.lang," group:").concat(r.groupId):""));const{id:i,groupId:a="",name:o,type:l,url:c}=r;this.hls.trigger(qr.SUBTITLE_TRACK_SWITCH,{id:i,groupId:a,name:o,type:l,url:c});const u=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(u)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(qr.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(qr.FRAG_LOADING,this.onFragLoading,this),e.on(qr.FRAG_LOADED,this.onFragLoaded,this),e.on(qr.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(qr.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(qr.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(qr.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(qr.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(qr.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(qr.FRAG_LOADING,this.onFragLoading,this),e.off(qr.FRAG_LOADED,this.onFragLoaded,this),e.off(qr.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(qr.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(qr.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(qr.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(qr.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new ph(this,"textTrack1"),t=new ph(this,"textTrack2"),n=new ph(this,"textTrack3"),r=new ph(this,"textTrack4");this.cea608Parser1=new Kd(1,e,t),this.cea608Parser2=new Kd(3,n,r)}addCues(e,t,n,r,s){let i=!1;for(let a=s.length;a--;){const e=s[a],r=bh(e[0],e[1],t,n);if(r>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],n),i=!0,r/(n-t)>.5))return}if(i||s.push([t,n]),this.config.renderTextTracksNatively){const s=this.captionsTracks[e];this.Cues.newCue(s,t,n,r)}else{const s=this.Cues.newCue(null,t,n,r);this.hls.trigger(qr.CUES_PARSED,{type:"captions",cues:s,track:e})}}onInitPtsFound(e,t){let{frag:n,id:r,initPTS:s,timescale:i,trackId:a}=t;const{unparsedVttFrags:o}=this;r===Zr&&(this.initPTS[n.cc]={baseTime:s,timescale:i,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(qr.FRAG_LOADED,e):this.hls.trigger(qr.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const s=n.textTracks[r];if(yh(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:s,languageCode:i}=t[e],a=this.getExistingTrack(s,i);if(a)n[e]=a,od(n[e]),id(n[e],r);else{const t=this.createTextTrack("captions",s,i);t&&(t[e]=!0,n[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(qr.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(e=>{od(r[e]),delete r[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)od(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(e=>e.textCodec===ih);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Qc(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const e=this.media,t=e?cd(e.textTracks):null;if(this.tracks.forEach((e,n)=>{let r;if(t){let n=null;for(let r=0;r<t.length;r++)if(t[r]&&yh(t[r],e)){n=t[r],t[r]=null;break}n&&(r=n)}if(r)od(r);else{const t=vh(e);r=this.createTextTrack(t,e.name,e.lang),r&&(r.mode="disabled")}r&&this.textTracks.push(r)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: ".concat(e.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){const e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(qr.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const n="textTrack".concat(t[1]),r=this.captionsProperties[n];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Zr){var n,r;const{cea608Parser1:e,cea608Parser2:s,lastSn:i}=this,{cc:a,sn:o}=t.frag,l=null!=(n=null==(r=t.part)?void 0:r.index)?n:-1;e&&s&&(o!==i+1||o===i&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),s.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===ts)if(r.byteLength){const e=n.decryptdata,s="stats"in t;if(null==e||!e.encrypted||s){const e=this.tracks[n.level],s=this.vttCCs;s[n.cc]||(s[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),e&&e.textCodec===ih?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(qr.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;ch(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),n.trigger(qr.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{n.logger.log("Failed to parse IMSC1: ".concat(t)),n.trigger(qr.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:s,unparsedVttFrags:i}=this,a=s.length-1;if(!s[n.cc]&&-1===a)return void i.push(e);const o=this.hls;sh(null!=(t=n.initSegment)&&t.data?$s(n.initSegment.data,new Uint8Array(r)).buffer:r,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,e=>{this._appendCues(e,n.level),o.trigger(qr.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},t=>{const s="Missing initPTS for VTT MPEGTS"===t.message;s?i.push(e):this._fallbackToIMSC1(n,r),o.logger.log("Failed to parse VTT cue: ".concat(t)),s&&a>n.cc||o.trigger(qr.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||ch(t,this.initPTS[e.cc],()=>{n.textCodec=ih,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach(e=>ad(n,e))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;n.trigger(qr.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===ts&&this.onFragLoaded(qr.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(n.type!==Zr||"NONE"!==this.closedCaptionsForLevel(n))for(let s=0;s<r.length;s++){const e=r[s].bytes;if(e){this.cea608Parser1||this.initCea608Parsers();const t=this.extractCea608Data(e);this.cea608Parser1.addData(r[s].pts,t[0]),this.cea608Parser2.addData(r[s].pts,t[1])}}}onBufferFlushing(e,t){let{startOffset:n,endOffset:r,endOffsetSubtitles:s,type:i}=t;const{media:a}=this;if(a&&!(a.currentTime<r)){if(!i||"video"===i){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>ld(e[t],n,r))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==s){const{textTracks:e}=this;Object.keys(e).forEach(t=>ld(e[t],n,s))}}}extractCea608Data(e){const t=[[],[]],n=31&e[0];let r=2;for(let s=0;s<n;s++){const n=e[r++],s=127&e[r++],i=127&e[r++];if(0===s&&0===i)continue;if(0!==(4&n)){const e=3&n;0!==e&&1!==e||(t[e].push(s),t[e].push(i))}}return t}},audioStreamController:class extends pl{constructor(e,t,n){super(e,t,n,"audio-stream-controller",es),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(qr.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(qr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(qr.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(qr.BUFFER_RESET,this.onBufferReset,this),e.on(qr.BUFFER_CREATED,this.onBufferCreated,this),e.on(qr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(qr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(qr.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(qr.FRAG_LOADING,this.onFragLoading,this),e.on(qr.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(qr.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(qr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(qr.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(qr.BUFFER_RESET,this.onBufferReset,this),e.off(qr.BUFFER_CREATED,this.onBufferCreated,this),e.off(qr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(qr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(qr.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(qr.FRAG_LOADING,this.onFragLoading,this),e.off(qr.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,t){let{frag:n,id:r,initPTS:s,timescale:i,trackId:a}=t;if(r===Zr){const e=n.cc,t=this.fragCurrent;if(this.initPTS[e]={baseTime:s,timescale:i,trackId:a},this.log("InitPTS for cc: ".concat(e," found from main: ").concat(s/i," (").concat(s,"/").concat(i,") trackId: ").concat(a)),this.mainAnchor=n,this.state===gl){const t=this.waitingData;(!t&&!this.loadingParts||t&&t.frag.cc!==e)&&this.syncWithAnchor(n,null==t?void 0:t.frag)}else!this.hls.hasEnoughToStart&&t&&t.cc!==e?(t.abortRequests(),this.syncWithAnchor(n,t)):this.state===il&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const r=(null==(n=this.mainFragLoading)?void 0:n.frag)||null;if(t&&(null==r?void 0:r.cc)===t.cc)return;const s=(r||e).cc,i=$i(this.getLevelDetails(),s,this.getLoadPosition());i&&(this.log("Syncing with main frag at ".concat(i.start," cc ").concat(i.cc)),this.startFragRequested=!1,this.nextLoadPosition=i.start,this.resetLoadingState(),this.state===il&&this.doTickIdle())}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=sl);const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),n>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n,this.state=il):this.state=cl,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case il:this.doTickIdle();break;case cl:{const{levels:e,trackId:t}=this,n=null==e?void 0:e[t],r=null==n?void 0:n.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=gl}break}case ll:this.checkRetryDate();break;case gl:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:r,complete:s}=e,i=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=ol;const e={frag:t,part:n,payload:r.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),s&&super._handleFragmentLoadComplete(e)}else i&&i.cc!==e.frag.cc&&this.syncWithAnchor(i,e.frag)}else this.state=il}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:s}=this,i=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!i.startFragPrefetch)||null==n||!n[s])return;const a=n[s],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=cl,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,ws,es));const c=this.getFwdBufferInfo(l,es);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o))return t.trigger(qr.BUFFER_EOS,{type:"audio"}),void(this.state=hl);const u=c.len,d=t.maxBufferLength,h=o.fragments,f=h[0].start,g=this.getLoadPosition(),m=this.flushing?g:c.end;if(this.switchingTrack&&r){const e=g;o.PTSKnown&&e<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=f+.05)}if(u>=d&&!this.switchingTrack&&m<h[h.length-1].start)return;let p=this.getNextFragment(m,o);if(p&&this.isLoopLoading(p,m)&&(p=this.getNextFragmentLoopLoading(p,o,c,Zr,d)),!p)return void(this.bufferFlushed=!0);let v=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&Is(p)&&!p.endList&&(!o.live||!this.loadingParts&&m<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===ya&&(this.mainFragLoading=v=null),v&&Is(v))){if(p.start>v.end){const e=this.fragmentTracker.getFragAtPos(m,Zr);e&&e.end>v.end&&(v=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(p.start>v.end)return}this.loadFragment(p,a,m)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,t){let{audioTracks:n}=t;this.resetTransmuxer(),this.levels=n.map(e=>new Ni(e))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==sl&&(this.setInterval(100),this.state=il,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(qr.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:s,id:i,groupId:a,track:o}=t;if(!r)return void this.warn("Audio tracks reset while loading track ".concat(i,' "').concat(o.name,'" of "').concat(a,'"'));const l=this.mainDetails;if(!l||s.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==sl&&(this.state=cl));this.cachedTrackLoadedData=null,this.log("Audio track ".concat(i,' "').concat(o.name,'" of "').concat(a,'" loaded [').concat(s.startSN,",").concat(s.endSN,"]").concat(s.lastPartSn?"[part-".concat(s.lastPartSn,"-").concat(s.lastPartIndex,"]"):"",",duration:").concat(s.totalduration));const c=r[i];let u=0;if(s.live||null!=(n=c.details)&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;var d;if(c.details)u=this.alignPlaylists(s,c.details,null==(d=this.levelLastLoaded)?void 0:d.details);s.alignedSliding||(Zo(s,l),s.alignedSliding||el(s,l),u=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,u),this.hls.trigger(qr.AUDIO_TRACK_UPDATED,{details:s,id:i,groupId:t.groupId}),this.state!==cl||this.waitForCdnTuneIn(s)||(this.state=il),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{config:i,trackId:a,levels:o}=this;if(!o)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const u=i.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new Yc(this.hls,es,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[n.cc],f=null==(t=n.initSegment)?void 0:t.data;if(void 0!==h){const e=!1,t=r?r.index:-1,i=-1!==t,a=new Na(n.level,n.sn,n.stats.chunkCount,s.byteLength,t,i);d.push(s,f,u,"",n,r,c.totalduration,e,a,h)}else{this.log("Unknown video PTS for cc ".concat(n.cc,", waiting for video PTS before demuxing audio frag ").concat(n.sn," of [").concat(c.startSN," ,").concat(c.endSN,"],track ").concat(a));const{cache:e}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new yl,complete:!1};e.push(new Uint8Array(s)),this.state!==sl&&(this.state=gl)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Zr&&Is(t.frag)&&(this.mainFragLoading=t,this.state===il&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type===es)if(this.fragContextChanged(n))this.warn("Fragment ".concat(n.sn).concat(r?" p: "+r.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if(Is(n)){this.fragPrevious=n;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(qr.AUDIO_TRACK_SWITCHED,os({},e)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}else this.audioOnly||n.type!==Zr||n.elementaryStreams.video||n.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var n;if(t.fatal)this.state=fl;else switch(t.details){case Yr.FRAG_GAP:case Yr.FRAG_PARSING_ERROR:case Yr.FRAG_DECRYPT_ERROR:case Yr.FRAG_LOAD_ERROR:case Yr.FRAG_LOAD_TIMEOUT:case Yr.KEY_LOAD_ERROR:case Yr.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(es,t);break;case Yr.AUDIO_TRACK_LOAD_ERROR:case Yr.AUDIO_TRACK_LOAD_TIMEOUT:case Yr.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==cl||(null==(n=t.context)?void 0:n.type)!==$r||(this.state=il);break;case Yr.BUFFER_ADD_CODEC_ERROR:case Yr.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Yr.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Yr.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,t){let{type:n}=t;n!==Ls&&(this.flushing=!0)}onBufferFlushed(e,t){let{type:n}=t;if(n!==Ls){this.flushing=!1,this.bufferFlushed=!0,this.state===hl&&(this.state=il);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,n,es),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:s,chunkMeta:i}=e,a=this.getCurrentContext(i);if(!a)return void this.resetWhenMissingContext(i);const{frag:o,part:l,level:c}=a,{details:u}=c,{audio:d,text:h,id3:f,initSegment:g}=s;if(!this.fragContextChanged(o)&&u){if(this.state=ul,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=g&&g.tracks){const e=o.initSegment||o;if(this.unhandledEncryptionError(g,o))return;this._bufferInitSegment(c,g.tracks,e,i),r.trigger(qr.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:g.tracks})}if(d){const{startPTS:e,endPTS:t,startDTS:n,endDTS:r}=d;l&&(l.elementaryStreams[ws]={startPTS:e,endPTS:t,startDTS:n,endDTS:r}),o.setElementaryStreamInfo(ws,e,t,n,r),this.bufferFragmentData(d,o,l,i)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=is({id:n,frag:o,details:u},f);r.trigger(qr.FRAG_PARSING_METADATA,e)}if(h){const e=is({id:n,frag:o,details:u},h);r.trigger(qr.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,n,r){if(this.state!==ul)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const s=t.audio;s.id=es;const i=e.audioCodec;this.log("Init audio buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(i,"/").concat(s.codec,"]")),i&&1===i.split(",").length&&(s.levelCodec=i),this.hls.trigger(qr.BUFFER_CODECS,t);const a=s.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:a};this.hls.trigger(qr.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);var s;if(this.switchingTrack||r===ma||r===va)if(Is(e))if(null!=(s=t.details)&&s.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=gl;const n=this.mainDetails;n&&n.fragmentStart!==t.details.fragmentStart&&el(t.details,n)}else super.loadFragment(e,t,n);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:s,audioCodec:i,channels:a}=this.bufferedTrack;Hi({name:t,lang:n,assocLang:r,characteristics:s,audioCodec:i,channels:a},e,Vi)||(Wi(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(qr.AUDIO_TRACK_SWITCHED,os({},e))}},audioTrackController:class extends qc{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(qr.LEVEL_LOADING,this.onLevelLoading,this),e.on(qr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(qr.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(qr.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(qr.LEVEL_LOADING,this.onLevelLoading,this),e.off(qr.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(qr.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(qr.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,i=this.tracksInGroup[n];if(!i||i.groupId!==r)return void this.warn("Audio track with id:".concat(n," and group:").concat(r," not found in active group ").concat(null==i?void 0:i.groupId));const a=i.details;i.details=t.details,this.log("Audio track ".concat(n,' "').concat(i.name,'" lang:').concat(i.lang," group:").concat(r," loaded [").concat(s.startSN,"-").concat(s.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==r?void 0:r.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!s&&t){const n=Ki(t,e,Vi);if(n>-1)s=e[n];else{const e=Ki(t,this.tracks);s=this.tracks[e]}}let r=this.findTrackId(s);-1===r&&s&&(r=this.findTrackId(null));const a={audioTracks:e};this.log("Updating audio tracks, ".concat(e.length," track(s) found in group(s): ").concat(null==n?void 0:n.join(","))),this.hls.trigger(qr.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==r&&-1===o)this.setAudioTrack(r);else if(e.length&&-1===o){var i;const t=new Error("No audio track selected for current audio group-ID(s): ".concat(null==(i=this.groupIds)?void 0:i.join(",")," track count: ").concat(e.length));this.warn(t.message),this.hls.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==$r||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&Hi(e,r,Vi))return r;const s=Ki(e,this.tracksInGroup,Vi);if(s>-1){const e=this.tracksInGroup[s];return this.setAudioTrack(s),e}if(r){let r=t.loadLevel;-1===r&&(r=t.firstAutoLevel);const s=function(e,t,n,r,s){const i=t[r],a=t.reduce((e,t,n)=>{const r=t.uri;return(e[r]||(e[r]=[])).push(n),e},{})[i.uri];a.length>1&&(r=Math.max.apply(Math,a));const o=i.videoRange,l=i.frameRate,c=i.codecSet.substring(0,4),u=zi(t,r,t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==c)return!1;const r=t.audioGroups,i=n.filter(e=>!r||-1!==r.indexOf(e.groupId));return Ki(e,i,s)>-1});return u>-1?u:zi(t,r,t=>{const r=t.audioGroups,i=n.filter(e=>!r||-1!==r.indexOf(e.groupId));return Ki(e,i,s)>-1})}(e,t.levels,n,r,Vi);if(-1===s)return null;t.nextLoadLevel=s}if(e.channels||e.audioCodec){const t=Ki(e,n);if(t>-1)return n[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid audio track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===n&&s)return;if(this.log("Switching to audio-track ".concat(e,' "').concat(r.name,'" lang:').concat(r.lang," group:").concat(r.groupId," channels:").concat(r.channels)),this.trackId=e,this.currentTrack=r,this.hls.trigger(qr.AUDIO_TRACK_SWITCHING,os({},r)),s)return;const i=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(i)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if((!this.selectDefaultTrack||r.default)&&(!e||Hi(e,r,Vi)))return n}if(e){const{name:n,lang:r,assocLang:s,characteristics:i,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){if(Hi({name:n,lang:r,assocLang:s,characteristics:i,audioCodec:a,channels:o},t[e],Vi))return e}for(let l=0;l<t.length;l++){const n=t[l];if(Xc(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const n=t[l];if(Xc(e.attrs,n.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Wi(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),i=e.details,a=null==i?void 0:i.age;this.log("Loading audio-track ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&i.live?" age "+a.toFixed(1)+(i.type?" "+i.type||0:""):""," ").concat(s)),this.hls.trigger(qr.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}},emeController:ed,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:iu.MANIFEST,su:!this.initialized})}catch(t){this.hls.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const{frag:t,part:n}=e,r=this.hls.levels[t.level],s=this.getObjectType(t),i={d:1e3*(n||t).duration,ot:s};s!==iu.VIDEO&&s!==iu.AUDIO&&s!=iu.MUXED||(i.br=r.bitrate/1e3,i.tb=this.getTopBandwidth(s)/1e3,i.bl=this.getBufferLength(s));const a=n?this.getNextPart(n):this.getNextFrag(t);null!=a&&a.url&&a.url!==t.url&&(i.nor=a.url),this.apply(e,i)}catch(t){this.hls.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;null!=n&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(qr.MEDIA_DETACHED,this.onMediaDetached,this),e.on(qr.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(qr.MEDIA_DETACHED,this.onMediaDetached,this),e.off(qr.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:au.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};is(t,this.createData());const n=t.ot===iu.INIT||t.ot===iu.VIDEO||t.ot===iu.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((e,n)=>(r.includes(n)&&(e[n]=t[n]),e),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),qu(e.headers,t,s)):e.url=$u(e.url,t,s)}getNextFrag(e){var t;const n=null==(t=this.hls.levels[e.level])?void 0:t.details;if(n){const t=e.sn-n.startSN;return n.fragments[t+1]}}getNextPart(e){var t;const{index:n,fragment:r}=e,s=null==(t=this.hls.levels[r.level])||null==(t=t.details)?void 0:t.partList;if(s){const{sn:e}=r;for(let t=s.length-1;t>=0;t--){const r=s[t];if(r.index===n&&r.fragment.sn===e)return s[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?iu.TIMED_TEXT:"initSegment"===e.sn?iu.INIT:"audio"===t?iu.AUDIO:"main"===t?this.hls.audioTracks.length?iu.VIDEO:iu.MUXED:void 0}getTopBandwidth(e){let t,n=0;const r=this.hls;if(e===iu.AUDIO)t=r.audioTracks;else{const e=r.maxAutoLevel,n=e>-1?e+1:r.levels.length;t=r.levels.slice(0,n)}return t.forEach(e=>{e.bitrate>n&&(n=e.bitrate)}),n>0?n:NaN}getBufferLength(e){const t=this.media,n=e===iu.AUDIO?this.audioBuffer:this.videoBuffer;if(!n||!t)return NaN;return 1e3*Fa.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,r){t(e),this.loader.load(e,n,r)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,r){t(e),this.loader.load(e,n,r)}}}},contentSteeringController:class extends ls{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(qr.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(qr.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((null==n?void 0:n.action)===oa&&n.flags===da){const e=this.levels;let r=this._pathwayPriority,s=this.pathwayId;if(t.context){const{groupId:n,pathwayId:r,type:i}=t.context;n&&e?s=this.getPathwayForGroupId(n,i,s):r&&(s=r)}s in this.penalizedPathways||(this.penalizedPathways[s]=performance.now()),!r&&e&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==s),t.details!==Yr.BUFFER_APPEND_ERROR||t.fatal?n.resolved||this.warn("Could not resolve ".concat(t.details,' ("').concat(t.error.message,'") with content-steering for Pathway: ').concat(s," levels: ").concat(e?e.length:e," priorities: ").concat(Ui(r)," penalized: ").concat(Ui(this.penalizedPathways))):n.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const n=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(n,'"')),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(e=>{r-n[e]>3e5&&delete n[e]});for(let s=0;s<e.length;s++){const r=e[s];if(r in n)continue;if(r===this.pathwayId)return;const i=this.hls.nextLoadLevel,a=this.hls.levels[i];if(t=this.getLevelsForPathway(r),t.length>0){this.log('Setting Pathway to "'.concat(r,'"')),this.pathwayId=r,Yo(t),this.hls.trigger(qr.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[i];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(a.bitrate," to ").concat(e.bitrate)),this.hls.nextLoadLevel=i);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===$r&&r[s].hasAudioGroup(e)||t===Jr&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(e=>{const{ID:s,"BASE-ID":i,"URI-REPLACEMENT":a}=e;if(t.some(e=>e.pathwayId===s))return;const o=this.getLevelsForPathway(i).map(e=>{const t=new za(e.attrs);t["PATHWAY-ID"]=s;const i=t.AUDIO&&"".concat(t.AUDIO,"_clone_").concat(s),o=t.SUBTITLES&&"".concat(t.SUBTITLES,"_clone_").concat(s);i&&(n[t.AUDIO]=i,t.AUDIO=i),o&&(r[t.SUBTITLES]=o,t.SUBTITLES=o);const l=Zu(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),c=new Ni({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let n=1;n<e.audioGroups.length;n++)c.addGroupId("audio","".concat(e.audioGroups[n],"_clone_").concat(s));if(e.subtitleGroups)for(let n=1;n<e.subtitleGroups.length;n++)c.addGroupId("text","".concat(e.subtitleGroups[n],"_clone_").concat(s));return c});t.push(...o),Ju(this.audioTracks,n,a,s),Ju(this.subtitleTracks,r,a,s)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;let r;this.loader&&this.loader.destroy(),this.loader=new n(t);try{r=new self.URL(e)}catch(c){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(e))}if("data:"!==r.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+e)}const s={responseType:"json",url:r.href},i=t.steeringManifestLoadPolicy.default,a=i.errorRetry||i.timeoutRetry||{},o={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,n,s)=>{this.log('Loaded steering manifest: "'.concat(r,'"'));const i=e.data;if(1!==(null==i?void 0:i.VERSION))return void this.log("Steering VERSION ".concat(i.VERSION," not supported!"));this.updated=performance.now(),this.timeToLoad=i.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=i;if(a)try{this.uri=new self.URL(a,r).href}catch(c){return this.enabled=!1,void this.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(a))}this.scheduleRefresh(this.uri||n.url),o&&this.clonePathways(o);const u={steeringManifest:i,url:r.toString()};this.hls.trigger(qr.STEERING_MANIFEST_LOADED,u),l&&this.updatePathwayPriority(l)},onError:(e,t,n,r)=>{if(this.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log("Steering manifest ".concat(t.url," no longer available"));let s=1e3*this.timeToLoad;if(429===e.code){const e=this.loader;if("function"===typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(s=1e3*parseFloat(t))}return void this.log("Steering manifest ".concat(t.url," rate limited"))}this.scheduleRefresh(this.uri||t.url,s)},onTimeout:(e,t,n)=>{this.log("Timeout loading steering manifest (".concat(t.url,")")),this.scheduleRefresh(this.uri||t.url)}};this.log("Requesting steering manifest: ".concat(r)),this.loader.load(s,o,l)}scheduleRefresh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const n=null==(t=this.hls)?void 0:t.media;!n||n.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}},interstitialsController:class extends ls{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled||!this.schedule)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const n=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const r=this.playingItem;if(!r)return void this.checkBuffer();if(n){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(!0)}if(this.checkBuffer(),n&&e<r.start||e>=r.end){var s;const t=this.findItemIndex(r);let i=this.schedule.findItemIndexAtTime(e);if(-1===i&&(i=t+(n?-1:1),this.log("seeked ".concat(n?"back ":"","to position not covered by schedule ").concat(e," (resolving from ").concat(t," to ").concat(i,")"))),!this.isInterstitial(r)&&null!=(s=this.media)&&s.paused&&(this.shouldPlay=!1),!n&&i>t){const e=this.schedule.findJumpRestrictedIndex(t+1,i);if(e>t)return void this.setSchedulePosition(e)}return void this.setSchedulePosition(i)}const i=this.playingAsset;if(!i){if(this.playingLastItem&&this.isInterstitial(r)){const t=r.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const a=i.timelineStart,o=i.duration||0;var l;(n&&e<a||e>=a+o)&&(null!=(l=r.event)&&l.appendInPlace&&(this.clearAssetPlayers(r.event,r),this.flushFrontBuffer(e)),this.setScheduleToAssetAtTime(e,i))},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const n=this.playingAsset;if(!n)return;e>=n.timelineStart+(n.duration||0)&&this.setScheduleToAssetAtTime(e,n)},this.onScheduleUpdate=(e,t)=>{const n=this.schedule;if(!n)return;const r=this.playingItem,s=n.events||[],i=n.items||[],a=n.durations,o=e.map(e=>e.identifier),l=!(!s.length&&!o.length);(l||t)&&this.log("INTERSTITIALS_UPDATED (".concat(s.length,"): ").concat(s,"\nSchedule: ").concat(i.map(e=>Sd(e))," pos: ").concat(this.timelinePos)),o.length&&this.log("Removed events ".concat(o));let c=null,u=null;r&&(c=this.updateItem(r,this.timelinePos),this.itemsMatch(r,c)?this.playingItem=c:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const d=this.bufferingItem;if(d&&(u=this.updateItem(d,this.bufferedPos),this.itemsMatch(d,u)?this.bufferingItem=u:d.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(d.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){const t=e.assetItem.timelineStart,n=e.timelineOffset-t;if(n)try{e.timelineOffset=t}catch(cf){Math.abs(n)>dd&&this.warn("".concat(cf,' ("').concat(e.assetId,'" ').concat(e.timelineOffset,"->").concat(t,")"))}}}),l||t){if(this.hls.trigger(qr.INTERSTITIALS_UPDATED,{events:s.slice(0),schedule:i.slice(0),durations:a,removedIds:o}),this.isInterstitial(r)&&o.includes(r.event.identifier))return this.warn('Interstitial "'.concat(r.event.identifier,'" removed while playing')),void this.primaryFallback(r.event);r&&this.trimInPlace(c,r),d&&u!==c&&this.trimInPlace(u,d),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Td(e),this.schedule=new Ed(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(qr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(qr.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(qr.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(qr.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(qr.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(qr.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(qr.BUFFER_APPENDED,this.onBufferAppended,this),e.on(qr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(qr.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(qr.MEDIA_ENDED,this.onMediaEnded,this),e.on(qr.ERROR,this.onError,this),e.on(qr.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(qr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(qr.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(qr.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(qr.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(qr.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(qr.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(qr.BUFFER_CODECS,this.onBufferCodecs,this),e.off(qr.BUFFER_APPENDED,this.onBufferAppended,this),e.off(qr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(qr.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(qr.MEDIA_ENDED,this.onMediaEnded,this),e.off(qr.ERROR,this.onError,this),e.off(qr.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){nl(e,"play",this.onPlay),nl(e,"pause",this.onPause),nl(e,"seeking",this.onSeeking),nl(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;tl(n,"seeking",this.onSeeking),tl(n,"timeupdate",this.onTimeupdate),tl(n,"play",this.onPlay),tl(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,null===n)this.checkStart();else if(!r){this.clearScheduleState();const e=this.findItemIndex(n);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.log("Removing schedule state for detachedData and ".concat(e)),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=t=>t?e.getAssetPlayer(t.identifier):t,r=(t,r,i,a,o)=>{if(t){let l=t[r].start;const c=t.event;if(c){if("playout"===r||c.timelineOccupancy!==hd.Point){const e=n(i);(null==e?void 0:e.interstitial)===c&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===a?s():e[a])-t.start}return l}return 0},s=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?i("primary"):Math.max(t,0)},i=t=>{var n,r;return null!=(n=e.primaryDetails)&&n.live?e.primaryDetails.edge:(null==(r=e.schedule)?void 0:r.durations[t])||0},a=(t,s)=>{var i,a;const o=e.effectivePlayingItem;if(null!=o&&null!=(i=o.event)&&i.restrictions.skip||!e.schedule)return;e.log("seek to ".concat(t,' "').concat(s,'"'));const l=e.effectivePlayingItem,c=e.schedule.findItemIndexAtTime(t,s),u=null==(a=e.schedule.items)?void 0:a[c],d=e.getBufferingPlayer(),h=null==d?void 0:d.interstitial,f=null==h?void 0:h.appendInPlace,g=l&&e.itemsMatch(l,u);if(l&&(f||g)){const i=n(e.playingAsset),a=(null==i?void 0:i.media)||e.primaryMedia;if(a){const n="primary"===s?a.currentTime:r(l,s,e.playingAsset,"timelinePos","currentTime"),o=t-n,c=(f?n:a.currentTime)+o;if(c>=0&&(!i||f||c<=i.duration))return void(a.currentTime=c)}}if(u){let n=t;if("primary"!==s){const e=t-u[s].start;n=u.start+e}const r=!e.isInterstitial(u);if(e.isInterstitial(l)&&!l.event.appendInPlace||!r&&!u.event.appendInPlace){if(l){const i=e.findItemIndex(l);if(c>i){const t=e.schedule.findJumpRestrictedIndex(i+1,c);if(t>i)return void e.setSchedulePosition(t)}let a=0;if(r)e.timelinePos=n,e.checkBuffer();else{const e=u.event.assetList,n=t-(u[s]||u).start;for(let t=e.length;t--;){const r=e[t];if(r.duration&&n>=r.startOffset&&n<r.startOffset+r.duration){a=t;break}}}e.setSchedulePosition(c,a)}}else{const t=e.media||(f?null==d?void 0:d.media:null);t&&(t.currentTime=n)}}},o=()=>{const n=e.effectivePlayingItem;if(e.isInterstitial(n))return n;const r=t();return e.isInterstitial(r)?r:null},l={get bufferedEnd(){const n=t(),s=e.bufferingItem;var i;return s&&s===n&&(r(s,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-s.playout.start||(null==(i=e.bufferingAsset)?void 0:i.startOffset))||0},get currentTime(){const t=o(),n=e.effectivePlayingItem;return n&&n===t?r(n,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-n.playout.start:0},set currentTime(t){const n=o(),r=e.effectivePlayingItem;r&&r===n&&a(t+r.playout.start,"playout")},get duration(){const e=o();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const n=null==(t=o())?void 0:t.event.assetList;return n?n.map(t=>e.getAssetPlayer(t.identifier)):[]},get playingIndex(){var t;const n=null==(t=o())?void 0:t.event;return n&&e.effectivePlayingAsset?n.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var t;return(null==(t=e.schedule)||null==(t=t.events)?void 0:t.slice(0))||[]},get schedule(){var t;return(null==(t=e.schedule)||null==(t=t.items)?void 0:t.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const n=t();return e.findItemIndex(n)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return s()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){a(e,"primary")},get duration(){return i("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){a(e,"integrated")},get duration(){return i("integrated")},get seekableStart(){var t;return((t,n)=>{var r;if(0!==t&&"primary"!==n&&null!=(r=e.schedule)&&r.length){var s;const r=e.schedule.findItemIndexAtTime(t),i=null==(s=e.schedule.items)?void 0:s[r];if(i)return t+(i[n].start-i.start)}return t})((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,n=null==t?void 0:t.event;if(n&&!n.restrictions.skip){const r=e.findItemIndex(t);if(n.appendInPlace){const e=t.playout.start+t.event.duration;a(e+.001,"playout")}else e.advanceAfterAssetEnded(n,r,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&n)&&this.findItemIndex(t)===n.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(r=this.primaryMedia);const s=null==(t=r)?void 0:t.currentTime;return void 0!==s&&Hr(s)?s:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r)return void(this.detachedData={media:r});const n=e.transferMedia();this.log("transfer MediaSource from ".concat(e," ").concat(Ui(n))),this.detachedData=n}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let s=null;const i=this.hls,a=e!==i,o=a&&e.interstitial.appendInPlace,l=null==(n=this.detachedData)?void 0:n.mediaSource;let c;if(i.media)o&&(s=i.transferMedia(),this.detachedData=s),c="Primary";else if(l){const e=this.getBufferingPlayer();e?(s=e.transferMedia(),c="".concat(e)):c="detached MediaSource"}else c="detached media";if(!s)if(l)s=this.detachedData,this.log("using detachedData: MediaSource ".concat(Ui(s)));else if(!this.detachedData||i.media===t){const e=this.playerQueue;e.length>1&&e.forEach(e=>{if(a&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn("Could not change append strategy for queued assets ".concat(t))}}),this.hls.detachMedia(),this.detachedData={media:t}}const u=s&&"mediaSource"in s&&"closed"!==(null==(r=s.mediaSource)?void 0:r.readyState),d=u&&s?s:t;this.log("".concat(u?"transfering MediaSource":"attaching media"," to ").concat(a?e:"Primary"," from ").concat(c," (media.currentTime: ").concat(t.currentTime,")"));const h=this.schedule;if(d===s&&h){const t=a&&e.assetId===h.assetIdAtEnd;d.overrides={duration:h.duration,endOfStream:!a||t,cueRemoval:!a}}e.attachMedia(d)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(-1===n){const n=this.hls.startPosition;if(this.log(kd("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const n=e.findEventIndex(t[0].identifier);this.setSchedulePosition(n)}else if(n>=0||!this.primaryLive){const t=this.timelinePos=n>0?n:0,r=e.findItemIndexAtTime(t);this.setSchedulePosition(r)}}else if(r&&!this.playingItem){const t=e.findItemIndex(r);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){const n=e.event,r=n.findAssetIndex(t),s=vd(n,r);if(n.isAssetPastPlayoutLimit(s)){if(this.schedule){var i;const t=null==(i=this.schedule.items)?void 0:i[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,s)}advanceAfterAssetEnded(e,t,n){const r=vd(e,n);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const n=this.schedule.items;if(n){const r=t+1;if(r>=n.length)return void this.setSchedulePosition(-1);const s=e.resumeTime;this.timelinePos<s&&(this.log(kd("advanceAfterAssetEnded",s)),this.timelinePos=s,e.appendInPlace&&this.advanceInPlace(s),this.checkBuffer(this.bufferedPos<s)),this.setSchedulePosition(r)}}}else{if(e.appendInPlace){const t=e.assetList[r];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const r=t.parentIdentifier,s=n.getEvent(r);if(s){const t=n.findEventIndex(r),i=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,t,i-1)}}setSchedulePosition(e,t){var n;const r=null==(n=this.schedule)?void 0:n.items;if(!r||this.playbackDisabled)return;const s=e>=0?r[e]:null;this.log("setSchedulePosition ".concat(e,", ").concat(t," (").concat(s?Sd(s):s,") pos: ").concat(this.timelinePos));const i=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(i)){const n=i.event,c=this.playingAsset,u=null==c?void 0:c.identifier,d=u?this.getAssetPlayer(u):null;if(d&&u&&(!this.eventItemsMatch(i,s)||void 0!==t&&u!==n.assetList[t].identifier)){var o;const t=n.findAssetIndex(c);if(this.log("INTERSTITIAL_ASSET_ENDED ".concat(t+1,"/").concat(n.assetList.length," ").concat(yd(c))),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(qr.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:n,schedule:r.slice(0),scheduleIndex:e,player:d}),i!==this.playingItem)return void(this.itemsMatch(i,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(n,this.findItemIndex(this.playingItem),t));this.retreiveMediaSource(u,s),!d.media||null!=(o=this.detachedData)&&o.mediaSource||d.detachMedia()}if(!this.eventItemsMatch(i,s)&&(this.endedItem=i,this.playingItem=null,this.log("INTERSTITIAL_ENDED ".concat(n," ").concat(Sd(i))),n.hasPlayed=!0,this.hls.trigger(qr.INTERSTITIAL_ENDED,{event:n,schedule:r.slice(0),scheduleIndex:e}),n.cue.once)){var l;this.updateSchedule();const e=null==(l=this.schedule)?void 0:l.items;if(s&&e){const n=this.findItemIndex(s);this.advanceSchedule(n,e,t,i,a)}return}}this.advanceSchedule(e,r,t,i,a)}advanceSchedule(e,t,n,r,s){const i=this.schedule;if(!i)return;const a=t[e]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{const n=t.interstitial,r=i.findEventIndex(n.identifier);(r<e||r>e+1)&&this.clearInterstitial(n,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const s=a.event;if(void 0===n){const t=vd(s,(n=i.findAssetIndex(s,this.timelinePos))-1);if(s.isAssetPastPlayoutLimit(t)||s.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(s,e,n);n=t}const l=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let c=this.preloadAssets(s,n);if(this.eventItemsMatch(a,l||r)||(this.waitingItem=a,this.log("INTERSTITIAL_STARTED ".concat(Sd(a)," ").concat(s.appendInPlace?"append in place":"")),this.hls.trigger(qr.INTERSTITIAL_STARTED,{event:s,schedule:t.slice(0),scheduleIndex:e})),!s.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading ".concat(s));if(s.assetListLoader&&(s.assetListLoader.destroy(),s.assetListLoader=void 0),!o)return void this.log("Waiting for attachMedia to start Interstitial ".concat(s));this.waitingItem=this.endedItem=null,this.playingItem=a;const u=s.assetList[n];if(!u)return void this.advanceAfterAssetEnded(s,e,n||0);if(c||(c=this.getAssetPlayer(u.identifier)),null===c||c.destroyed){const e=s.assetList.length;this.warn("asset ".concat(n+1,"/").concat(e," player destroyed ").concat(s)),c=this.createAssetPlayer(s,u,n),c.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&s.appendInPlace&&this.isAssetBuffered(u))return;this.startAssetPlayer(c,n,t,e,o),this.shouldPlay&&xd(c.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&xd(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(i.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,n){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming ".concat(Sd(e))),null==(r=this.detachedData)||!r.mediaSource){let n=this.timelinePos;(n<e.start||n>=e.end)&&(n=this.getPrimaryResumption(e,t),this.log(kd("resumePrimary",n)),this.timelinePos=n),this.attachPrimary(n,e)}if(!n)return;const i=null==(s=this.schedule)?void 0:s.items;i&&(this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(Sd(e))),this.hls.trigger(qr.INTERSTITIALS_PRIMARY_RESUMED,{schedule:i.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(n<e.fragmentStart||n>e.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return Fa.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(kd("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs(((null==(n=r.mainForwardBufferInfo)?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(qr.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(qr.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const r=os(os({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r)return void(this.altSelection=os(os({},this.altSelection),{},{audio:n}));const s=os(os({},r),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r)return void(this.altSelection=os(os({},this.altSelection),{},{subtitles:n}));const s=os(os({},r),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=Gi(t);this.playerQueue.forEach(e=>{let{hls:r}=e;return r&&(r.setAudioOption(t)||r.setAudioOption(n))})}onSubtitleTrackSwitch(e,t){const n=Gi(t);this.playerQueue.forEach(e=>{let{hls:r}=e;return r&&(r.setSubtitleOption(t)||-1!==t.id&&r.setSubtitleOption(n))})}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const r=t[e];if(r.cue.post){var n;const e=this.schedule.findEventIndex(r.identifier),t=null==(n=this.schedule.items)?void 0:n[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const r=null==(n=this.schedule)?void 0:n.items;if(e&&r){return r[this.findItemIndex(e,t)]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,n)=>{e.event.isAssetPastPlayoutLimit(n)&&this.clearAssetPlayer(t.identifier,null)});const n=e.end+.25,r=Fa.bufferInfo(this.primaryMedia,n,0);if(r.end>n||(r.nextStart||0)>n){this.log("trim buffered interstitial ".concat(Sd(e)," (was ").concat(Sd(t),")"));const r=!0;this.attachPrimary(n,null,r),this.flushFrontBuffer(n)}}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===(null==(n=t.event)?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const n=this.mediaSelection;n&&(null==(t=this.schedule)||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=null==(t=this.schedule)?void 0:t.items;if(!n)return;const r=Fa.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,n,e)}updateBufferedPos(e,t,n){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(1===t.length&&this.itemsMatch(t[0],s))return void(this.bufferedPos=e);const i=this.playingItem,a=this.findItemIndex(i);let o=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const n=this.findItemIndex(s),r=Math.min(n+1,t.length-1),i=t[r];if((-1===o&&s&&e>=s.end||null!=(l=i.event)&&l.appendInPlace&&e+.01>=i.start)&&(o=r),this.isInterstitial(s)){const e=s.event;if(r-a>1&&!1===e.appendInPlace)return;if(0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>n&&o>a)this.bufferedToItem(i);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&i.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(i)&&this.preloadAssets(i.event,0)}}else n&&i&&!this.itemsMatch(i,s)&&(o===a?this.bufferedToItem(i):o===a+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{const n=this.getAssetPlayer(e.identifier);return!(null!=n&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:r,events:s}=n;if(!r||!s)return t;const i=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const o=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(Sd(e))+(t?" (".concat(o.toFixed(2)," remaining)"):"")),!this.playbackDisabled)if(i){const t=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,n)=>{const r=this.getAssetPlayer(e.identifier);r&&(n===t&&r.loadSource(),r.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(qr.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==n){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=0===n.assetList.length&&!n.assetListLoader,s=n.cue.once;if(r||!s){const e=this.preloadAssets(n,t);if(null!=e&&e.interstitial.appendInPlace){const t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,s=0===r&&!e.assetListLoader,i=e.cue.once;if(s){const s=e.timelineStart;if(e.appendInPlace){var a;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(a=t.nextEvent)?void 0:a.identifier)!==e.identifier||this.flushFrontBuffer(s+.25)}let i,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-s;e>0&&(i=Math.round(1e3*e)/1e3)}if(this.log("Load interstitial asset ".concat(t+1,"/").concat(n?1:r," ").concat(e).concat(i?" live-start: ".concat(o," start-offset: ").concat(i):"")),n)return this.createAsset(e,0,0,s,e.duration,n);const l=this.assetListLoader.loadAssetList(e,i);l&&(e.assetListLoader=l)}else if(!i&&r){for(let s=t;s<r;s++){const t=e.assetList[s],n=this.getAssetPlayerQueueIndex(t.identifier);-1!==n&&!this.playerQueue[n].destroyed||t.error||this.createAssetPlayer(e,t,s)}const n=e.assetList[t];if(n){const e=this.getAssetPlayer(n.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log("Removing front buffer starting at ".concat(e));Object.keys(t).forEach(t=>{this.hls.trigger(qr.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n];return null}createAsset(e,t,n,r,s,i){const a={parentIdentifier:e.identifier,identifier:fd(e,i,t),duration:s,startOffset:n,timelineStart:r,uri:i};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){const r=this.hls,s=r.userConfig;let i=s.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(i||a)&&(i=is({},i),a.videoCodec&&(i.videoCodec=a.videoCodec),a.videoRange&&(i.allowedVideoRanges=[a.videoRange]));const o=r.audioTracks[r.audioTrack],l=r.subtitleTracks[r.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const n=t.duration;n&&e<n&&(c=e)}}const u=t.identifier,d=os(os({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:u,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:i,audioPreference:o||s.audioPreference,subtitlePreference:l||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(d.timelineOffset=t.timelineStart));const h=d.cmcd;null!=h&&h.sessionId&&h.contentId&&(d.cmcd=is({},h,{contentId:ud(t.uri)})),this.getAssetPlayer(u)&&this.warn("Duplicate date range identifier ".concat(e," and asset ").concat(u));const f=new bd(this.HlsPlayerClass,d,e,t);this.playerQueue.push(f),e.assetList[n]=t;let g=!0;const m=r=>{if(r.live){var s;const t=new Error("Interstitials MUST be VOD assets ".concat(e)),r={fatal:!0,type:Wr.OTHER_ERROR,details:Yr.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=(null==(s=this.schedule)?void 0:s.findEventIndex(e.identifier))||-1;return void this.handleAssetItemError(r,e,i,n,t.message)}const i=r.edge-r.fragmentStart,a=t.duration;(g||null===a||i>a)&&(g=!1,this.log('Interstitial asset "'.concat(u,'" duration change ').concat(a," > ").concat(i)),t.duration=i,this.updateSchedule())};f.on(qr.LEVEL_UPDATED,(e,t)=>{let{details:n}=t;return m(n)}),f.on(qr.LEVEL_PTS_UPDATED,(e,t)=>{let{details:n}=t;return m(n)}),f.on(qr.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const p=(e,t)=>{const n=this.getAssetPlayer(u);if(n&&t.tracks){n.off(qr.BUFFER_CODECS,p),n.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===n.assetItem&&e&&!n.media&&this.bufferAssetPlayer(n,e)}};f.on(qr.BUFFER_CODECS,p);f.on(qr.BUFFERED_TO_END,()=>{var n;const r=this.getAssetPlayer(u);if(this.log("buffered to end of asset ".concat(r)),!r||!this.schedule)return;const s=this.schedule.findEventIndex(e.identifier),i=null==(n=this.schedule.items)?void 0:n[s];this.isInterstitial(i)&&this.advanceAssetBuffering(i,t)});const v=t=>()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;this.shouldPlay=!0;const n=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,t)};return f.once(qr.MEDIA_ENDED,v(n)),f.once(qr.PLAYOUT_LIMIT_REACHED,v(1/0)),f.on(qr.ERROR,(t,r)=>{if(!this.schedule)return;const s=this.getAssetPlayer(u);if(r.details===Yr.BUFFER_STALLED_ERROR)return null!=s&&s.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),n,"Asset player error ".concat(r.error," ").concat(e))}),f.on(qr.DESTROYING,()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;const t=new Error("Asset player destroyed unexpectedly ".concat(u)),r={fatal:!0,type:Wr.OTHER_ERROR,details:Yr.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),n,t.message)}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(yd(t))),this.hls.trigger(qr.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:f}),f}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log('reset asset player "'.concat(e,'" after error'));const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(-1!==n){const e=this.playerQueue[n];this.log("clear ".concat(e," toSegment: ").concat(t?Sd(t):t)),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(n,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,s){const{interstitial:i,assetItem:a,assetId:o}=e,l=i.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,n[r]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED ".concat(t+1,"/").concat(l," ").concat(yd(a))),this.hls.trigger(qr.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:i,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,r;if(!this.schedule)return;const{interstitial:s,assetItem:i}=e,a=this.schedule.findEventIndex(s.identifier),o=null==(n=this.schedule.items)?void 0:n[a];if(!o)return;e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=i;const l=this.getBufferingPlayer();if(l===e)return;const c=s.appendInPlace;if(c&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const u=(null==l?void 0:l.tracks)||(null==(r=this.detachedData)?void 0:r.tracks)||this.requiredTracks;if(c&&i!==this.playingAsset){if(!e.tracks)return void this.log("Waiting for track info before buffering ".concat(e));if(u&&!ps(u,e.tracks)){const t=new Error("Asset ".concat(yd(i)," SourceBuffer tracks ('").concat(Object.keys(e.tracks),"') are not compatible with primary content tracks ('").concat(Object.keys(u),"')")),n={fatal:!0,type:Wr.OTHER_ERROR,details:Yr.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},r=s.findAssetIndex(i);return void this.handleAssetItemError(n,s,a,r,t.message)}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const r=n.currentTime,s=t.findAssetIndex(e,r),i=e.assetList[s];if(i){const a=this.getAssetPlayer(i.identifier);if(a){const o=a.currentTime||r-i.timelineStart,l=a.duration-o;if(this.warn("Stalled at ".concat(o," of ").concat(o+l," in ").concat(a," ").concat(e," (media.currentTime: ").concat(r,")")),o&&(l/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const n=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,r,s){if(e.details===Yr.BUFFER_STALLED_ERROR)return;const i=t.assetList[r]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR ".concat(i?yd(i):i," ").concat(e.error)),!this.schedule)return;const a=(null==i?void 0:i.identifier)||"",o=this.getAssetPlayerQueueIndex(a),l=this.playerQueue[o]||null,c=this.schedule.items,u=is({},e,{fatal:!1,errorAction:ga(!0),asset:i,assetListIndex:r,event:t,schedule:c,scheduleIndex:n,player:l});if(this.hls.trigger(qr.INTERSTITIAL_ASSET_ERROR,u),!e.fatal)return;const d=this.playingAsset,h=this.bufferingAsset,f=new Error(s);if(i&&(this.clearAssetPlayer(a,null),i.error=f),t.assetList.some(e=>!e.error))for(let g=r;g<t.assetList.length;g++)this.resetAssetPlayer(t.assetList[g].identifier);else t.error=f;this.updateSchedule(!0),t.error?this.primaryFallback(t):d&&d.identifier===a?this.advanceAfterAssetEnded(t,n,r):h&&h.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let r=this.timelinePos;if(n){this.log('Fallback to primary from event "'.concat(e.identifier,'" start: ').concat(t," pos: ").concat(r," playing: ").concat(Sd(n)," error: ").concat(e.error)),-1===r&&(r=this.hls.startPosition);const s=this.updateItem(n,r);this.itemsMatch(n,s)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(-1===r)return void this.checkStart();if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var n,r;const s=t.event,i=s.identifier,a=t.assetListResponse.ASSETS;if(null==(n=this.schedule)||!n.hasEvent(i))return;const o=s.timelineStart,l=s.duration;let c=0;a.forEach((e,t)=>{const n=parseFloat(e.DURATION);this.createAsset(s,t,c,o+c,n,e.URI),c+=n}),s.duration=c,this.log("Loaded asset-list with duration: ".concat(c," (was: ").concat(l,") ").concat(s));const u=this.waitingItem,d=(null==u?void 0:u.event.identifier)===i;this.updateSchedule();const h=null==(r=this.bufferingItem)?void 0:r.event;if(d){var f;const e=this.schedule.findEventIndex(i),t=null==(f=this.schedule.items)?void 0:f[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return s.error=new Error("Interstitial ".concat(a.length?"no longer within playback range":"asset-list is empty"," ").concat(this.timelinePos," ").concat(s)),this.log(s.error.message),this.updateSchedule(!0),void this.primaryFallback(s)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==h?void 0:h.identifier)===i){const e=s.assetList[0];if(e){const t=this.getAssetPlayer(e.identifier);if(h.appendInPlace){const e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Yr.ASSET_LIST_PARSING_ERROR:case Yr.ASSET_LIST_LOAD_ERROR:case Yr.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case Yr.BUFFER_STALLED_ERROR:{const e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log("Primary player stall @".concat(this.timelinePos," bufferedPos: ").concat(this.bufferedPos)),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function Ih(e){return e&&"object"===typeof e?Array.isArray(e)?e.map(Ih):Object.keys(e).reduce((t,n)=>(t[n]=Ih(e[n]),t),{}):e}function _h(e,t){const n=e.loader;if(n!==xh&&n!==Ah)t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(cf){}return!1})()&&(e.loader=xh,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class Dh extends Oa{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(qr.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(qr.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(qr.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const n=this.media=t.media;tl(n,"playing",this.onMediaPlaying),tl(n,"waiting",this.onMediaWaiting),tl(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(nl(n,"playing",this.onMediaPlaying),nl(n,"waiting",this.onMediaWaiting),nl(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const s=null==(n=this.hls)?void 0:n.config;if(!s)return;const i=this.media;if(!i)return;const{seeking:a}=i,o=this.seeking&&!a,l=!this.seeking&&a,c=i.paused&&!a||i.ended||0===i.playbackRate;if(this.seeking=a,e!==t)return t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(l||o)return void(o&&this.stallResolved(e));if(c)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&i.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(qr.MEDIA_ENDED,{stalled:!1})));if(!Fa.getBuffered(i).length)return void(this.nudgeRetry=0);const u=Fa.bufferInfo(i,e,0),d=u.nextStart||0,h=this.fragmentTracker;if(a&&h&&this.hls){const t=Ph(this.hls.inFlightFragments,e),n=u.len>2,r=!d||t||d-e>2&&!h.getPartialFragment(e);if(n||r)return;this.moved=!1}const f=null==(r=this.hls)?void 0:r.latestLevelDetails;if(!this.moved&&null!==this.stalled&&h){if(!(u.len>0)&&!d)return;const t=Math.max(d,u.start||0)-e,n=!(null==f||!f.live)?2*f.targetduration:2,r=Oh(e,h);if(t>0&&(t<=n||r))return void(i.paused||this._trySkipBufferHole(r))}const g=s.detectStallWithCurrentTimeMs,m=self.performance.now(),p=this.waiting;let v=this.stalled;if(null===v){if(!(p>0&&m-p<g))return void(this.stalled=m);v=this.stalled=p}const y=m-v;if(!a&&(y>=g||p)&&this.hls){var b;if("ended"===(null==(b=this.mediaSource)?void 0:b.readyState)&&(null==f||!f.live)&&Math.abs(e-((null==f?void 0:f.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(qr.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(u),!this.media||!this.hls)return}const E=Fa.bufferInfo(i,e,s.maxBufferHole);this._tryFixBufferStall(E,y,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log("playback not stuck anymore @".concat(e,", after ").concat(Math.round(n),"ms")),this.stallReported=!1,this.waiting=0,this.hls.trigger(qr.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(n=this.buffered.audio)&&n.length&&r&&r.length>1&&e>r.end(0)){const n=Fa.bufferedInfo(Fa.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const n=Fa.timeRangesToArray(r),s=Fa.bufferedInfo(n,t,0).bufferedIndex;if(s>-1&&s<n.length-1){const t=Fa.bufferedInfo(n,e,0).bufferedIndex,r=n[s].end,i=n[s+1].start;if((-1===t||t>s)&&i-r<1&&e-r<2){const n=new Error("nudging playhead to flush pipeline after video hole. currentTime: ".concat(e," hole: ").concat(r," -> ").concat(i," buffered index: ").concat(t));this.warn(n.message),this.media.currentTime+=1e-6;let s=Oh(e,this.fragmentTracker);s&&"fragment"in s?s=s.fragment:s||(s=void 0);const a=Fa.bufferInfo(this.media,e,0);this.hls.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,frag:s,buffer:a.len,bufferInfo:a})}}}}}_tryFixBufferStall(e,t,n){var r,s;const{fragmentTracker:i,media:a}=this,o=null==(r=this.hls)?void 0:r.config;if(!a||!i||!o)return;const l=null==(s=this.hls)?void 0:s.latestLevelDetails,c=Oh(n,i);if(c||null!=l&&l.live&&n<l.fragmentStart){if(this._trySkipBufferHole(c)||!this.media)return}const u=e.buffered,d=this.adjacentTraversal(e,n);(u&&u.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-n<o.maxBufferHole||d))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,r=e.nextStart;if(n&&r){const e=n.getFragAtPos(t,Zr),s=n.getFragAtPos(r,Zr);if(e&&s)return s.sn-e.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:s}=this;if(!r&&null!==s&&n&&t){this.stallReported=!0;const r=new Error("Playback stalling at @".concat(n.currentTime," due to low buffer (").concat(Ui(e),")"));this.warn(r.message),t.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,s=null==(t=this.hls)?void 0:t.config;if(!r||!n||!s)return 0;const i=r.currentTime,a=Fa.bufferInfo(r,i,0),o=i<a.start?a.start:a.nextStart;if(o&&this.hls){const t=a.len<=s.maxBufferHole,c=a.len>0&&a.len<1&&r.readyState<3,u=o-i;if(u>0&&(t||c)){if(u>s.maxBufferHole){let t=!1;if(0===i){const e=n.getAppendedFrag(0,Zr);e&&o<e.end&&(t=!0)}if(!t&&e){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(Ph(this.hls.inFlightFragments,o))return 0;let t=!1,r=e.end;for(;r<o;){const e=Oh(r,n);if(!e){t=!0;break}r+=e.duration}if(t)return 0}}const t=Math.max(o+.05,i+.1);if(this.warn("skipping hole, adjusting currentTime from ".concat(i," to ").concat(t)),this.moved=!0,r.currentTime=t,null==e||!e.gap){const n=new Error("fragment loaded with buffer holes, seeking from ".concat(i," to ").concat(t)),r={type:Wr.MEDIA_ERROR,details:Yr.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?r.part=e:r.frag=e),this.hls.trigger(qr.ERROR,r)}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,s=null==t?void 0:t.config;if(!n||!s)return 0;const i=n.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const a=i+(r+1)*s.nudgeOffset,o=new Error("Nudging 'currentTime' from ".concat(i," to ").concat(a));this.warn(o.message),n.currentTime=a,t.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const n=new Error("Playhead still not moving while enough data buffered @".concat(i," after ").concat(s.nudgeMaxRetry," nudges"));this.error(n.message),t.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.BUFFER_STALLED_ERROR,error:n,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Ph(e,t){const n=Ch(e.main);if(n&&n.start<=t)return n;const r=Ch(e.audio);return r&&r.start<=t?r:null}function Ch(e){if(!e)return null;switch(e.state){case il:case sl:case hl:case fl:return null}return e.frag}function Oh(e,t){return t.getAppendedFrag(e,Zr)||t.getPartialFragment(e)}function Nh(){if("undefined"!==typeof self)return self.VTTCue||self.TextTrackCue}function Mh(e,t,n,r,s){let i=new e(t,n,"");try{i.value=r,s&&(i.type=s)}catch(cf){i=new e(t,n,Ui(s?os({type:s},r):r))}return i}const Fh=(()=>{const e=Nh();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(cf){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Uh{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(qr.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(qr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(qr.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(qr.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(qr.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(qr.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(qr.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(qr.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,!1===(null==(n=t.overrides)?void 0:n.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var e;const t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&od(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if("metadata"===n.kind&&"id3"===n.label)return id(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:r}=this.hls.config;if(!n&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const i=Nh();if(i)for(let a=0;a<s.length;a++){const e=s[a].type;if(e===Wl.emsg&&!n||!r)continue;const t=Kl(s[a].data),o=s[a].pts;let l=o+s[a].duration;l>Fh&&(l=Fh);l-o<=0&&(l=o+.25);for(let n=0;n<t.length;n++){const r=t[n];if(!Hl(r)){this.updateId3CueEnds(o,e);const t=Mh(i,o,l,r,e);t&&this.id3Track.addCue(t)}}}}updateId3CueEnds(e,t){var n;const r=null==(n=this.id3Track)?void 0:n.cues;if(r)for(let s=r.length;s--;){const n=r[s];n.type===t&&n.startTime<e&&n.endTime===Fh&&(n.endTime=e)}}onBufferFlushing(e,t){let{startOffset:n,endOffset:r,type:s}=t;const{id3Track:i,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(i&&(o||l)){let e;e="audio"===s?e=>e.type===Wl.audioId3&&l:"video"===s?e=>e.type===Wl.emsg&&o:e=>e.type===Wl.audioId3&&l||e.type===Wl.emsg&&o,ld(i,n,r,e)}}onLevelUpdated(e,t){let{details:n}=t;this.updateDateRangeCues(n,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:i}=this.hls.config;if(!s)return;const a=Nh();if(n&&r&&!i){const{fragmentStart:t,fragmentEnd:r}=e;let s=this.assetCue;s?(s.startTime=t,s.endTime=r):a&&(s=this.assetCue=Mh(a,t,r,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),s&&(s.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(s),s.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:l}=e,c=Object.keys(l);let u=this.dateRangeCuesAppended;var d;if(o&&t)if(null!=(d=o.cues)&&d.length){const e=Object.keys(u).filter(e=>!c.includes(e));for(let t=e.length;t--;){var h;const n=e[t],r=null==(h=u[n])?void 0:h.cues;delete u[n],r&&Object.keys(r).forEach(e=>{const t=r[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(t)}catch(cf){}}})}}else u=this.dateRangeCuesAppended={};const f=e.fragments[e.fragments.length-1];if(0!==c.length&&Hr(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<c.length;e++){const t=c[e],n=l[t],r=n.startTime,s=u[t],o=(null==s?void 0:s.cues)||{};let d=(null==s?void 0:s.durationKnown)||!1,h=Fh;const{duration:f,endDate:g}=n;if(g&&null!==f)h=r+f,d=!0;else if(n.endOnNext&&!d){const e=c.reduce((e,t)=>{if(t!==n.id){const r=l[t];if(r.class===n.class&&r.startDate>n.startDate&&(!e||n.startDate<e.startDate))return r}return e},null);e&&(h=e.startTime,d=!0)}const m=Object.keys(n.attr);for(let e=0;e<m.length;e++){const l=m[e];if(!Wa(l))continue;const c=o[l];if(c)!d||null!=s&&s.durationKnown?Math.abs(c.startTime-r)>.01&&(c.startTime=r,c.endTime=h):c.endTime=h;else if(a){let e=n.attr[l];Ya(l)&&(e=bs(e));const s=Mh(a,r,h,{key:l,data:e},Wl.dateRange);s&&(s.id=t,this.id3Track.addCue(s),o[l]=s,i&&("X-ASSET-LIST"!==l&&"X-ASSET-URL"!==l||s.addEventListener("enter",this.onEventCueEnter)))}}u[t]={cues:o,dateRange:n,durationKnown:d}}}}}class Bh{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:s}=this.config;if(!r||1===s||!t.live)return;const i=this.targetLatency;if(null===i)return;const a=n-i;if(a<Math.min(this.maxLatency,i+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,s)),n=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,r=Math.min(t,Math.max(1,n));this.changeMediaPlaybackRate(e,r)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:i,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&n||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==s?s:i*r);const c=r;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const n=this.levelDetails;if(null===n)return null;const r=n.edge,s=e-t-this.edgeStalled,i=r-n.totalduration,a=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(i,s),a)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(qr.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(qr.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(qr.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(qr.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,t){let{details:n}=t;n.advanced&&this.onTimeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===Yr.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(n=this.levelDetails)&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&(null==(n=this.hls)||n.logger.debug("[latency-controller]: latency=".concat(this.latency.toFixed(3),", targetLatency=").concat(null==(r=this.targetLatency)?void 0:r.toFixed(3),", forwardBufferLength=").concat(this.forwardBufferLength.toFixed(3),": adjusting playback rate from ").concat(e.playbackRate," to ").concat(t)),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class jh extends qc{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(qr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(qr.FRAG_BUFFERED,this.onFragBuffered,this),e.on(qr.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(qr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(qr.FRAG_BUFFERED,this.onFragBuffered,this),e.off(qr.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],s={},i={};let a=!1,o=!1,l=!1;t.levels.forEach(e=>{const t=e.attrs;let{audioCodec:c,videoCodec:u}=e;c&&(e.audioCodec=c=mi(c,n)||void 0),u&&(u=e.videoCodec=function(e){const t=e.split(",");for(let n=0;n<t.length;n++){const e=t[n].split(".");e.length>2&&"avc1"===e[0]&&(t[n]="avc1.".concat(parseInt(e[1]).toString(16)).concat(("000"+parseInt(e[2]).toString(16)).slice(-4)))}return t.join(",")}(u));const{width:d,height:h,unknownCodecs:f}=e,g=(null==f?void 0:f.length)||0;if(a||(a=!(!d||!h)),o||(o=!!u),l||(l=!!c),g||c&&!this.isAudioSupported(c)||u&&!this.isVideoSupported(u))return void this.log('Some or all CODECS not supported "'.concat(t.CODECS,'"'));const{CODECS:m,"FRAME-RATE":p,"HDCP-LEVEL":v,"PATHWAY-ID":y,RESOLUTION:b,"VIDEO-RANGE":E}=t,S="".concat(y||".","-"),T="".concat(S).concat(e.bitrate,"-").concat(b,"-").concat(p,"-").concat(m,"-").concat(E,"-").concat(v);if(s[T])if(s[T].uri===e.url||e.attrs["PATHWAY-ID"])s[T].addGroupId("audio",t.AUDIO),s[T].addGroupId("text",t.SUBTITLES);else{const t=i[T]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const n=this.createLevel(e);s[T]=n,r.push(n)}else{const t=this.createLevel(e);s[T]=t,i[T]=1,r.push(t)}}),this.filterAndSortMediaOptions(r,t,a,o,l)}createLevel(e){const t=new Ni(e),n=e.supplemental;if(null!=n&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const e=new Error('SUPPLEMENTAL-CODECS not supported "'.concat(n.videoCodec,'"'));this.log(e.message),t.supportedResult=xi(e,[])}return t}isAudioSupported(e){return li(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return li(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,s){var i;let a=[],o=[],l=e;const c=(null==(i=t.stats)?void 0:i.parsing)||{};if((n||r)&&s&&(l=l.filter(e=>{let{videoCodec:t,videoRange:n,width:r,height:s}=e;return(!!t||!(!r||!s))&&(!!(i=n)&&Ii.indexOf(i)>-1);var i})),0===l.length)return Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",n=e;t.levels.length&&(n="one or more CODECS in variant not supported: ".concat(Ui(t.levels.map(e=>e.attrs.CODECS).filter((e,t,n)=>n.indexOf(e)===t))),this.warn(n),e+=" (".concat(n,")"));const r=new Error(e);this.hls.trigger(qr.ERROR,{type:Wr.MEDIA_ERROR,details:Yr.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:r,reason:n})}}),void(c.end=performance.now());t.audioTracks&&(a=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec)),Gh(a)),t.subtitles&&(o=t.subtitles,Gh(o));const u=l.slice(0);l.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return Ii.indexOf(e.videoRange)-Ii.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const n=di(e.videoCodec),r=di(t.videoCodec);if(n!==r)return r-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const n=hi(e.codecSet),r=hi(t.codecSet);if(n!==r)return r-n}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let d=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length))for(let v=0;v<u.length;v++)if(u[v].pathwayId===l[0].pathwayId){d=u[v];break}this._levels=l;for(let v=0;v<l.length;v++)if(l[v]===d){var h;this._firstLevel=v;const e=d.bitrate,t=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(l.length," level(s) found, first bitrate: ").concat(e)),void 0===(null==(h=this.hls.userConfig)?void 0:h.abrEwmaDefaultEstimate)){const n=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);n>t&&t===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=n)}break}const f=s&&!r,g=this.hls.config,m=!(!g.audioStreamController||!g.audioTrackController),p={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:m&&!f&&a.some(e=>!!e.url)};c.end=performance.now(),this.hls.trigger(qr.MANIFEST_PARSED,p)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const n=new Error("invalid level idx"),r=e<0;if(this.hls.trigger(qr.ERROR,{type:Wr.OTHER_ERROR,details:Yr.LEVEL_SWITCH_ERROR,level:e,fatal:r,error:n,reason:n.message}),r)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,i=t[e],a=i.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=i,n===e&&r&&s===a)return;this.log("Switching to level ".concat(e," (").concat(i.height?i.height+"p ":"").concat(i.videoRange?i.videoRange+" ":"").concat(i.codecSet?i.codecSet+" ":"","@").concat(i.bitrate,")").concat(a?" with Pathway "+a:""," from level ").concat(n).concat(s?" with Pathway "+s:""));const o={level:e,attrs:i.attrs,details:i.details,bitrate:i.bitrate,averageBitrate:i.averageBitrate,maxBitrate:i.maxBitrate,realBitrate:i.realBitrate,width:i.width,height:i.height,codecSet:i.codecSet,audioCodec:i.audioCodec,videoCodec:i.videoCodec,audioGroups:i.audioGroups,subtitleGroups:i.subtitleGroups,loaded:i.loaded,loadError:i.loadError,fragmentError:i.fragmentError,name:i.name,id:i.id,uri:i.uri,url:i.url,urlId:0,audioGroupIds:i.audioGroupIds,textGroupIds:i.textGroupIds};this.hls.trigger(qr.LEVEL_SWITCHING,o);const l=i.details;if(!l||l.live){const e=this.switchParams(i.uri,null==r?void 0:r.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn("pathwayPriority ".concat(e," should contain at least one pathway from list: ").concat(t));this.steering.pathwayPriority=n}}onError(e,t){!t.fatal&&t.context&&t.context.type===Xr&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,t){let{frag:n}=t;if(void 0!==n&&n.type===Zr){const e=n.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const t=this._levels[n.level];null!=t&&t.loadError&&(this.log("Resetting level error count of ".concat(t.loadError," on frag buffered")),t.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:s}=t,i=t.levelInfo;var a;if(!i)return this.warn("Invalid level index ".concat(r)),void(null!=(a=t.deliveryDirectives)&&a.skip&&(s.deltaUpdateFailed=!0));if(i===this.currentLevel||t.withoutMultiVariant){0===i.fragmentError&&(i.loadError=0);let e=i.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(r,t,e)}else null!=(n=t.deliveryDirectives)&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],i=e.details,a=null==i?void 0:i.age;this.log("Loading level index ".concat(r).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(s?" Pathway "+s:"").concat(a&&i.live?" age "+a.toFixed(1)+(i.type?" "+i.type||0:""):""," ").concat(n)),this.hls.trigger(qr.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const n=this._levels.filter((t,n)=>n!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));Yo(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(qr.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,t){let{levels:n}=t;this._levels=n}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(qr.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function Gh(e){const t={};e.forEach(e=>{const n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}function Kh(){return self.SourceBuffer||self.WebKitSourceBuffer}function Hh(){if(!ms())return!1;const e=Kh();return!e||e.prototype&&"function"===typeof e.prototype.appendBuffer&&"function"===typeof e.prototype.remove}class Vh extends pl{constructor(e,t,n){super(e,t,n,"stream-controller",Zr),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!Hr(t))return;if(this.log("Media seeked to ".concat(t.toFixed(3))),!this.getBufferedFrag(t))return;const n=this.getFwdBufferInfoAtPos(e,t,Zr,0);null!==n&&0!==n.len?this.tick():this.warn("Main forward buffer length at ".concat(t,' on "seeked" event ').concat(n?n.len:"empty",")"))},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.on(qr.LEVEL_LOADING,this.onLevelLoading,this),e.on(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.on(qr.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(qr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(qr.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(qr.BUFFER_CREATED,this.onBufferCreated,this),e.on(qr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(qr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(qr.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(qr.MANIFEST_PARSED,this.onManifestParsed,this),e.off(qr.LEVEL_LOADED,this.onLevelLoaded,this),e.off(qr.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(qr.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(qr.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(qr.BUFFER_CREATED,this.onBufferCreated,this),e.off(qr.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(qr.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(qr.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=r.startLevel;-1===e&&(r.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=r.firstAutoLevel),r.nextLoadLevel=e,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&-1===e&&!t&&(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n),this.state=il,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=sl}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ml:{const{levels:e,level:t}=this,n=null==e?void 0:e[t],r=null==n?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=il;break}if(this.hls.nextLoadLevel!==this.level){this.state=il;break}break}case ll:this.checkRetryDate()}this.state===il&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(null===t||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==n||!n[s])return;const i=n[s],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(qr.BUFFER_EOS,e),void(this.state=hl)}if(!this.buffering)return;e.loadLevel!==s&&-1===e.manualLevel&&this.log("Adapting to level ".concat(s," from level ").concat(this.level)),this.level=e.nextLoadLevel=s;const l=i.details;if(!l||this.state===ml||this.waitForLive(i))return this.level=s,this.state=ml,void(this.startFragRequested=!1);const c=a.len,u=this.getMaxBufferLength(i.maxBitrate);if(c>=u)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(d,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&Is(h)&&this.fragmentTracker.getState(h)!==ya){var f;const e=(null!=(f=this.backtrackFragment)?f:h).sn-l.startSN,t=l.fragments[e-1];t&&h.cc===t.cc&&(h=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,d)){if(!h.gap){const e=this.audioOnly&&!this.altAudio?ws:Ls,t=(e===Ls?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,Zr)}h=this.getNextFragmentLoopLoading(h,l,a,Zr,u)}h&&(!h.initSegment||h.initSegment.data||this.bitrateTest||(h=h.initSegment),this.loadFragment(h,i,d))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===ma||r===va?Is(e)?this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Zr)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(null!=s&&s.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*s.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],r=this.fragLastKbps;n=r&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*r)+1:0}else n=0;const i=this.getBufferedFrag(t.currentTime+n);if(i){const e=this.followingBufferedFrag(i);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,n=e.duration,r=Math.max(i.end,t+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case al:case ol:case ll:case ul:case dl:this.state=il}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;tl(n,"playing",this.onMediaPlaying),tl(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(nl(n,"playing",this.onMediaPlaying),nl(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(qr.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;for(let s=0;s<t.levels.length;s++){const e=t.levels[s].audioCodec;e&&(n=n||-1!==e.indexOf("mp4a.40.2"),r=r||-1!==e.indexOf("mp4a.40.5"))}this.audioCodecSwitch=n&&r&&!function(){var e;const t=Kh();return"function"===typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==il)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=ml)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:s}=this,i=t.level,a=t.details,o=a.totalduration;if(!r)return void this.warn("Levels were reset while loading level ".concat(i));this.log("Level ".concat(i," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",", cc [").concat(a.startCC,", ").concat(a.endCC,"] duration:").concat(o));const l=t.levelInfo,c=this.fragCurrent;!c||this.state!==ol&&this.state!==ll||c.level!==t.level&&c.loader&&this.abortCurrentFrag();let u=0;if(a.live||null!=(n=l.details)&&n.live){var d;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,l.details,null==(d=this.levelLastLoaded)?void 0:d.details)}if(l.details=a,this.levelLastLoaded=l,s||this.setStartPosition(a,u),this.hls.trigger(qr.LEVEL_UPDATED,{details:a,level:i}),this.state===ml){if(this.waitForCdnTuneIn(a))return;this.state=il}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),i=e.fragmentStart,a=e.edge,o=s>=i-t.maxFragLookUpTolerance&&s<=a;if(null!==r&&n.duration>r&&(s<r||!o)){const i=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&n.readyState<4||s<a-i)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState))if(this.warn("Playback: ".concat(s.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(a,", reset currentTime to : ").concat(r.toFixed(3))),"buffered"===this.config.liveSyncMode){var l;const e=Fa.bufferInfo(n,r,0);if(null==(l=e.buffered)||!l.length)return void(n.currentTime=r);if(e.start<=s)return void(n.currentTime=r);const{nextStart:t}=Fa.bufferedInfo(e.buffered,s,0);t&&(n.currentTime=t)}else n.currentTime=r}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{levels:i}=this;if(!i)return void this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const a=i[n.level];if(!a)return void this.warn("Level ".concat(n.level," not found on progress"));const o=a.details;if(!o)return this.warn("Dropping fragment ".concat(n.sn," of level ").concat(n.level," after level details were reset")),void this.fragmentTracker.removeFragment(n);const l=a.videoCodec,c=o.PTSKnown||!o.live,u=null==(t=n.initSegment)?void 0:t.data,d=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new Yc(this.hls,Zr,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=r?r.index:-1,g=-1!==f,m=new Na(n.level,n.sn,n.stats.chunkCount,s.byteLength,f,g),p=this.initPTS[n.cc];h.push(s,u,d,l,n,r,o.totalduration,c,m,p)}onAudioTrackSwitching(e,t){const n=this.hls,r=0!==this.altAudio;if(Wi(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r)return this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(qr.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(qr.AUDIO_TRACK_SWITCHED,t)}),void n.trigger(qr.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});n.trigger(qr.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Wi(t.url,this.hls);if(n){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,s,i=!1;for(const a in n){const e=n[a];if("main"===e.id){if(s=a,r=e,"video"===a){const e=n[a];e&&(this.videoBuffer=e.buffer)}}else i=!0}i&&r?(this.log("Alternate track found, use ".concat(s,".buffered to schedule main fragment loading")),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,s=n.type===Zr;if(s){if(this.fragContextChanged(n))return this.warn("Fragment ".concat(n.sn).concat(r?" p: "+r.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===dl&&(this.state=il));const e=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),Is(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const i=this.media;i&&(!this._hasEnoughToStart&&Fa.getBuffered(i).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal)this.state=fl;else switch(t.details){case Yr.FRAG_GAP:case Yr.FRAG_PARSING_ERROR:case Yr.FRAG_DECRYPT_ERROR:case Yr.FRAG_LOAD_ERROR:case Yr.FRAG_LOAD_TIMEOUT:case Yr.KEY_LOAD_ERROR:case Yr.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Zr,t);break;case Yr.LEVEL_LOAD_ERROR:case Yr.LEVEL_LOAD_TIMEOUT:case Yr.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ml||(null==(n=t.context)?void 0:n.type)!==Xr||(this.state=il);break;case Yr.BUFFER_ADD_CODEC_ERROR:case Yr.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Yr.BUFFER_FULL_ERROR:if("main"!==t.parent)return;if(this.reduceLengthAndFlushBuffer(t)){!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case Yr.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=il,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,t){let{type:n}=t;if(n!==ws||!this.altAudio){const e=(n===Ls?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,n,Zr),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log("could not seek to ".concat(n,", already seeking at ").concat(t));const r=this.timelineOffset;r&&n&&(n+=r);const s=this.getLevelDetails(),i=Fa.getBuffered(e),a=i.length?i.start(0):0,o=a-n,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==s?void 0:s.partTarget)||0)))&&(this.log("adjusting start position by ".concat(o," to match buffer start")),n+=o,this.startPosition=n),t<n&&(this.log("seek to target start position ".concat(n," from current time ").concat(t," buffer start ").concat(a)),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{const{hls:n}=this,r=null==e?void 0:e.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=il,this.startFragRequested=!1,this.bitrateTest=!1;const s=r.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),n.trigger(qr.FRAG_LOADED,e),r.bitrateTest=!1}).catch(t=>{this.state!==sl&&this.state!==fl&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:s}=e,i=this.getCurrentContext(s);if(!i)return void this.resetWhenMissingContext(s);const{frag:a,part:o,level:l}=i,{video:c,text:u,id3:d,initSegment:h}=r,{details:f}=l,g=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=ul,h){const e=h.tracks;if(e){const r=a.initSegment||a;if(this.unhandledEncryptionError(h,a))return;this._bufferInitSegment(l,e,r,s),n.trigger(qr.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:t,tracks:e})}const r=h.initPTS,i=h.timescale,o=this.initPTS[a.cc];if(Hr(r)&&(!o||o.baseTime!==r||o.timescale!==i)){const e=h.trackId;this.initPTS[a.cc]={baseTime:r,timescale:i,trackId:e},n.trigger(qr.INIT_PTS_FOUND,{frag:a,id:t,initPTS:r,timescale:i,trackId:e})}}if(c&&f){g&&"audiovideo"===c.type&&this.logMuxedErr(a);const e=f.fragments[a.sn-1-f.startSN],t=a.sn===f.startSN,n=!e||a.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:r,startDTS:i,endDTS:l}=c;if(o)o.elementaryStreams[c.type]={startPTS:e,endPTS:r,startDTS:i,endDTS:l};else if(c.firstKeyFrame&&c.independent&&1===s.id&&!n&&(this.couldBacktrack=!0),c.dropped&&c.independent){const s=this.getMainFwdBufferInfo(),i=(s?s.end:this.getLoadPosition())+this.config.maxBufferHole,o=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&i<o-this.config.maxBufferHole&&!n)return void this.backtrack(a);n&&(a.gap=!0),a.setElementaryStreamInfo(c.type,a.start,r,a.start,l,!0)}else t&&e-(f.appliedTimelineOffset||0)>2&&(a.gap=!0);a.setElementaryStreamInfo(c.type,e,r,i,l),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,o,s,t||n)}else{if(!t&&!n)return void this.backtrack(a);a.gap=!0}}if(g){const{startPTS:e,endPTS:t,startDTS:n,endDTS:r}=g;o&&(o.elementaryStreams[ws]={startPTS:e,endPTS:t,startDTS:n,endDTS:r}),a.setElementaryStreamInfo(ws,e,t,n,r),this.bufferFragmentData(g,a,o,s)}if(f&&null!=d&&d.samples.length){const e={id:t,frag:a,details:f,samples:d.samples};n.trigger(qr.FRAG_PARSING_METADATA,e)}if(f&&u){const e={id:t,frag:a,details:f,samples:u.samples};n.trigger(qr.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn("".concat(Is(e)?"Media":"Init"," segment with muxed audiovideo where only video expected: ").concat(e.url))}_bufferInitSegment(e,t,n,r){if(this.state!==ul)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:i,audiovideo:a}=t;if(s){const n=e.audioCodec;let r=pi(s.codec,n);"mp4a"===r&&(r="mp4a.40.5");const i=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){r&&(r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=s.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===i.indexOf("firefox")&&(r="mp4a.40.5")}r&&-1!==r.indexOf("mp4a.40.5")&&-1!==i.indexOf("android")&&"audio/mpeg"!==s.container&&(r="mp4a.40.2",this.log("Android: force audio codec to ".concat(r))),n&&n!==r&&this.log('Swapping manifest audio codec "'.concat(n,'" for "').concat(r,'"')),s.levelCodec=r,s.id=Zr,this.log("Init audio buffer, container:".concat(s.container,", codecs[selected/level/parsed]=[").concat(r||"","/").concat(n||"","/").concat(s.codec,"]")),delete t.audiovideo}if(i){i.levelCodec=e.videoCodec,i.id=Zr;const n=i.codec;if(4===(null==n?void 0:n.length))switch(n){case"hvc1":case"hev1":i.codec="hvc1.1.6.L120.90";break;case"av01":i.codec="av01.0.04M.08";break;case"avc1":i.codec="avc1.42e01e"}this.log("Init video buffer, container:".concat(i.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(n,"]").concat(i.codec!==n?" parsed-corrected="+i.codec:"").concat(i.supplemental?" supplemental="+i.supplemental:"")),delete t.audiovideo}a&&(this.log("Init audiovideo buffer, container:".concat(a.container,", codecs[level/parsed]=[").concat(e.codecs,"/").concat(a.codec,"]")),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(qr.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{const s=t[e].initSegment;null!=s&&s.byteLength&&this.hls.trigger(qr.BUFFER_APPENDING,{type:e,data:s,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Zr)}get maxBufferLength(){const{levels:e,level:t}=this,n=null==e?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=il}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const n=e.currentTime;if(Fa.isBuffered(e,n)?t=this.getAppendedFrag(n):Fa.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,n=t.level;e&&t.sn===e.sn&&e.level===n||(this.fragPlaying=t,this.hls.trigger(qr.FRAG_CHANGED,{frag:t}),e&&e.level===n||this.hls.trigger(qr.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return Hr(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(Hr(t)){const e=this.getLevelDetails(),n=this.currentFrag||(e?qi(null,e.fragments,t):null);if(n){const e=n.programDateTime;if(null!==e){const r=e+1e3*(t-n.start);return new Date(r)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class zh extends ls{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[n].loader;if(r){var t;if(e&&e!==(null==(t=r.context)?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yr.KEY_LOAD_ERROR,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return new Ca({type:Wr.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:r})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){const i=t[r];if(e.cc<=i.cc&&(!Is(e)||!Is(i)||e.sn<i.sn)||!n&&r==s-1)return this.emeController.selectKeySystemFormat(i).then(e=>{if(!this.emeController)return;i.setKeyFormat(e);const t=uo(e);return t?this.emeController.getKeySystemAccess([t]):void 0})}if(this.config.requireKeySystemAccessOnStart){const e=fo(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const n=new Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(this.emeController&&this.config.emeEnabled,")"));return Promise.reject(this.createKeyLoadError(e,Yr.KEY_LOAD_ERROR,n))}const i=s.uri;if(!i)return Promise.reject(this.createKeyLoadError(e,Yr.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(i,'"'))));const a=Wh(s);let o=this.keyIdToKeyInfo[a];if(null!=(n=o)&&n.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(this.emeController&&null!=(r=o)&&r.keyLoadPromise){switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>{const{keyInfo:n}=t;return s.key=n.decryptdata.key,{frag:e,keyInfo:n}})}}switch(this.log("".concat(this.keyIdToKeyInfo[a]?"Rel":"L","oading").concat(s.keyId?" keyId: "+ys(s.keyId):""," URI: ").concat(s.uri," from ").concat(e.type," ").concat(e.level)),o=this.keyIdToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===s.keyFormat?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,Yr.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(s.method,'"'))))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&null!=(r=t.initSegment)&&r.data){const n=function(e){const t=[];return Qs(e,e=>t.push(e.subarray(8,24))),t}(t.initSegment.data);if(n.length){let t=n[0];t.some(e=>0!==e)?(this.log("Using keyId found in init segment ".concat(ys(t))),yo.setKeyIdForUri(e.decryptdata.uri,t)):(t=yo.addKeyIdForUri(e.decryptdata.uri),this.log("Generating keyId to patch media ".concat(ys(t)))),e.decryptdata.keyId=t}}if(!e.decryptdata.keyId&&!Is(t))return Promise.resolve(n);const s=this.emeController.loadKey(n);return(e.keyLoadPromise=s.then(t=>(e.mediaKeySessionContext=t,n))).catch(n=>{throw e.keyLoadPromise=null,"data"in n&&(n.data.frag=t),n})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=new(0,n.loader)(n);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((s,i)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=n.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{const{frag:a,keyInfo:o}=n,l=Wh(o.decryptdata);if(!a.decryptdata||o!==this.keyIdToKeyInfo[l])return i(this.createKeyLoadError(a,Yr.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,s({frag:a,keyInfo:o})},onError:(e,n,r,s)=>{this.resetLoader(n),i(this.createKeyLoadError(t,Yr.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),r,os({url:a.url,data:void 0},e)))},onTimeout:(e,n,r)=>{this.resetLoader(n),i(this.createKeyLoadError(t,Yr.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:(e,n,r)=>{this.resetLoader(n),i(this.createKeyLoadError(t,Yr.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};r.load(a,l,c)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null);const i=Wh(n.decryptdata)||r;delete this.keyIdToKeyInfo[i],s&&s.destroy()}}function Wh(e){if(e.keyFormat!==oo){const t=e.keyId;if(t)return ys(t)}return e.uri}function Yh(e){const{type:t}=e;switch(t){case $r:return es;case Jr:return ts;default:return Zr}}function qh(e,t){let n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}class Qh{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.on(qr.LEVEL_LOADING,this.onLevelLoading,this),e.on(qr.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(qr.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(qr.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(qr.MANIFEST_LOADING,this.onManifestLoading,this),e.off(qr.LEVEL_LOADING,this.onLevelLoading,this),e.off(qr.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(qr.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(qr.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,s=new(n||r)(t);return this.loaders[e.type]=s,s}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Qr,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:s,url:i,deliveryDirectives:a,levelInfo:o}=t;this.load({id:n,level:r,pathwayId:s,responseType:"text",type:Xr,url:i,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:i,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:$r,url:s,deliveryDirectives:i,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:i,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:Jr,url:s,deliveryDirectives:i,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[Xr];if(n){const e=n.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(n.abort(),delete this.loaders[Xr])}}load(e){var t;const n=this.hls.config;let r,s=this.getInternalLoader(e);if(s){const t=this.hls.logger,n=s.context;if(n&&n.levelOrTrack===e.levelOrTrack&&(n.url===e.url||n.deliveryDirectives&&!e.deliveryDirectives))return void(n.url===e.url?t.log("[playlist-loader]: ignore ".concat(e.url," ongoing request")):t.log("[playlist-loader]: ignore ".concat(e.url," in favor of ").concat(n.url)));t.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),s.abort()}if(r=e.type===Qr?n.manifestLoadPolicy.default:is({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),Hr(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===Xr&&null!==e.level?t=this.hls.levels[e.level].details:e.type===$r&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===Jr&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,n=t.targetduration;if(e&&n){const t=1e3*Math.max(3*e,.8*n);r=is({},r,{maxTimeToFirstByteMs:Math.min(t,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,r.maxTimeToFirstByteMs)})}}}const i=r.errorRetry||r.timeoutRetry||{},a={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:i.maxNumRetry||0,retryDelay:i.retryDelayMs||0,maxRetryDelay:i.maxRetryDelayMs||0},o={onSuccess:(e,t,n,r)=>{const s=this.getInternalLoader(n);this.resetInternalLoader(n.type);const i=e.data;t.parsing.start=performance.now(),wo.isMediaPlaylist(i)||n.type!==Qr?this.handleTrackOrLevelPlaylist(e,t,n,r||null,s):this.handleMasterPlaylist(e,t,n,r)},onError:(e,t,n,r)=>{this.handleNetworkError(t,n,!1,e,r)},onTimeout:(e,t,n)=>{this.handleNetworkError(t,n,!0,void 0,e)}};s.load(e,a,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log("".concat(e?"auto":"force"," startLoad with configured startPosition ").concat(t)),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const s=this.hls,i=e.data,a=qh(e,n),o=wo.parseMasterPlaylist(i,a);if(o.playlistParsingError)return t.parsing.end=performance.now(),void this.handleManifestParsingError(e,n,o.playlistParsingError,r,t);const{contentSteering:l,levels:c,sessionData:u,sessionKeys:d,startTimeOffset:h,variableList:f}=o;this.variableList=f,c.forEach(e=>{const{unknownCodecs:t}=e;if(t){const{preferManagedMediaSource:n}=this.hls.config;let{audioCodec:r,videoCodec:s}=e;for(let i=t.length;i--;){const a=t[i];li(a,"audio",n)?(e.audioCodec=r=r?"".concat(r,",").concat(a):a,ai.audio[r.substring(0,4)]=2,t.splice(i,1)):li(a,"video",n)&&(e.videoCodec=s=s?"".concat(s,",").concat(a):a,ai.video[s.substring(0,4)]=2,t.splice(i,1))}}});const{AUDIO:g=[],SUBTITLES:m,"CLOSED-CAPTIONS":p}=wo.parseMasterPlaylistMedia(i,a,o);if(g.length){g.some(e=>!e.url)||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new za({}),bitrate:0,url:""}))}s.trigger(qr.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:m,captions:p,contentSteering:l,url:a,stats:t,networkDetails:r,sessionData:u,sessionKeys:d,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,n,r,s){const i=this.hls,{id:a,level:o,type:l}=n,c=qh(e,n),u=Hr(o)?o:Hr(a)?a:0,d=Yh(n),h=wo.parseLevelPlaylist(e.data,c,u,d,0,this.variableList);if(l===Qr){const e={attrs:new za({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+Ho(h,0),i.trigger(qr.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=h,this.handlePlaylistLoaded(h,e,t,n,r,s)}handleManifestParsingError(e,t,n,r,s){this.hls.trigger(qr.ERROR,{type:Wr.NETWORK_ERROR,details:Yr.MANIFEST_PARSING_ERROR,fatal:t.type===Qr,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,i="A network ".concat(n?"timeout":"error"+(r?" (status "+r.code+")":"")," occurred while loading ").concat(e.type);e.type===Xr?i+=": ".concat(e.level," id: ").concat(e.id):e.type!==$r&&e.type!==Jr||(i+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));const a=new Error(i);this.hls.logger.warn("[playlist-loader]: ".concat(i));let o=Yr.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case Qr:o=n?Yr.MANIFEST_LOAD_TIMEOUT:Yr.MANIFEST_LOAD_ERROR,l=!0;break;case Xr:o=n?Yr.LEVEL_LOAD_TIMEOUT:Yr.LEVEL_LOAD_ERROR,l=!1;break;case $r:o=n?Yr.AUDIO_TRACK_LOAD_TIMEOUT:Yr.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Jr:o=n?Yr.SUBTITLE_TRACK_LOAD_TIMEOUT:Yr.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const u={type:Wr.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:s};if(r){const n=(null==t?void 0:t.url)||e.url;u.response=os({url:n,data:void 0},r)}this.hls.trigger(qr.ERROR,u)}handlePlaylistLoaded(e,t,n,r,s,i){const a=this.hls,{type:o,level:l,levelOrTrack:c,id:u,groupId:d,deliveryDirectives:h}=r,f=qh(t,r),g=Yh(r);let m="number"===typeof r.level&&g===Zr?l:void 0;const p=e.playlistParsingError;if(p){if(this.hls.logger.warn("".concat(p," ").concat(e.url)),!a.config.ignorePlaylistParsingErrors)return void a.trigger(qr.ERROR,{type:Wr.NETWORK_ERROR,details:Yr.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:p,reason:p.message,response:t,context:r,level:m,parent:g,networkDetails:s,stats:n});e.playlistParsingError=null}if(!e.fragments.length){const i=e.playlistParsingError=new Error("No Segments found in Playlist");return void a.trigger(qr.ERROR,{type:Wr.NETWORK_ERROR,details:Yr.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:i,reason:i.message,response:t,context:r,level:m,parent:g,networkDetails:s,stats:n})}switch(e.live&&i&&(i.getCacheAge&&(e.ageHeader=i.getCacheAge()||0),i.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Qr:case Xr:if(m)if(c){if(c!==a.levels[m]){const e=a.levels.indexOf(c);e>-1&&(m=e)}}else m=0;a.trigger(qr.LEVEL_LOADED,{details:e,levelInfo:c||a.levels[0],level:m||0,id:u||0,stats:n,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:o===Qr});break;case $r:a.trigger(qr.AUDIO_TRACK_LOADED,{details:e,track:c,id:u||0,groupId:d||"",stats:n,networkDetails:s,deliveryDirectives:h});break;case Jr:a.trigger(qr.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:u||0,groupId:d||"",stats:n,networkDetails:s,deliveryDirectives:h})}}}class Xh{static get version(){return xl}static isMSESupported(){return Hh()}static isSupported(){return function(){if(!Hh())return!1;const e=ms();return"function"===typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(ui(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(ui(t,"audio"))))}()}static getMediaSource(){return ms()}static get Events(){return qr}static get MetadataSchema(){return Wl}static get ErrorTypes(){return Wr}static get ErrorDetails(){return Yr}static get DefaultConfig(){return Xh.defaultConfig?Xh.defaultConfig:Rh}static set DefaultConfig(e){Xh.defaultConfig=e}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Tl,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,n){const r=ds();if("object"===typeof console&&!0===e||"object"===typeof e){const s=["debug","log","info","warn","error"];s.forEach(t=>{r[t]=hs(t,e,n)});try{r.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.6.15"))}catch(cf){return ds()}s.forEach(t=>{fs[t]=hs(t,e)})}else is(fs,r);return r}(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=function(e,t,n){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=Ih(e),s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{const i="".concat("level"===e?"playlist":e,"LoadPolicy"),a=void 0===t[i],o=[];s.forEach(n=>{const s="".concat(e,"Loading").concat(n),l=t[s];if(void 0!==l&&a){o.push(s);const e=r[i].default;switch(t[i]={default:e},n){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&n.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(i,'": ').concat(Ui(t[i])))}),os(os({},r),t)}(Xh.DefaultConfig,e,t);this.userConfig=e,n.progressive&&_h(n,t);const{abrController:r,bufferController:s,capLevelController:i,errorController:a,fpsController:o}=n,l=new a(this),c=this.abrController=new r(this),u=new ba(this),d=n.interstitialsController,h=d?this.interstitialsController=new d(this,Xh):null,f=this.bufferController=new s(this,u),g=this.capLevelController=new i(this),m=new o(this),p=new Qh(this),v=n.contentSteeringController,y=v?new v(this):null,b=this.levelController=new jh(this,y),E=new Uh(this),S=new zh(this.config,this.logger),T=this.streamController=new Vh(this,u,S),x=this.gapController=new Dh(this,u);g.setStreamController(T),m.setStreamController(T);const k=[p,b,T];h&&k.splice(1,0,h),y&&k.splice(1,0,y),this.networkControllers=k;const w=[c,f,x,g,m,E,u];this.audioTrackController=this.createController(n.audioTrackController,k);const L=n.audioStreamController;L&&k.push(this.audioStreamController=new L(this,u,S)),this.subtitleTrackController=this.createController(n.subtitleTrackController,k);const A=n.subtitleStreamController;A&&k.push(this.subtititleStreamController=new A(this,u,S)),this.createController(n.timelineController,w),S.emeController=this.emeController=this.createController(n.emeController,w),this.cmcdController=this.createController(n.cmcdController,w),this.latencyController=this.createController(Bh,w),this.coreComponents=w,k.push(l);const R=l.onErrorOut;"function"===typeof R&&this.on(qr.ERROR,R,l),this.on(qr.MANIFEST_LOADED,p.onManifestLoaded,p)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,n)}once(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,r=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const t=e===qr.ERROR;this.trigger(qr.ERROR,{type:Wr.OTHER_ERROR,details:Yr.INTERNAL_EXCEPTION,fatal:t,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(qr.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error("attachMedia failed: invalid argument (".concat(e,")"));return void this.trigger(qr.ERROR,{type:Wr.OTHER_ERROR,details:Yr.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(qr.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(qr.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(qr.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=xs.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:".concat(r)),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(qr.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;this.logger.log("startLoad(".concat(e+(t?", <skip seek to start>":""),")")),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),this.started&&this.networkControllers);n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Zr]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[es]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ts]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log("set currentLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return Ri.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(r=-1===t&&null!=e&&e.length?e.length-1:t,n)for(let s=r;s--;){const t=e[s].attrs["HDCP-LEVEL"];if(t&&t<=n)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e){return wi(e,ji(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.allAudioTracks),navigator.mediaCapabilities)}}Xh.defaultConfig=void 0;const $h=()=>{var e;const{id:t}=oe(),[n,r]=Fe(),s=n.get("episode"),a=n.get("ep"),[o,l]=(0,i.useState)(null),[c,u]=(0,i.useState)([]),[d,h]=(0,i.useState)({sub:[],dub:[]}),[f,g]=(0,i.useState)("hd-1"),[m,p]=(0,i.useState)("sub"),[v,y]=(0,i.useState)(null),[b,E]=(0,i.useState)(!0),[S,T]=(0,i.useState)(!1),[x,k]=(0,i.useState)(!1),[w,L]=(0,i.useState)(pr),A=(0,i.useRef)(null),R=(0,i.useRef)(null);(0,i.useEffect)(()=>{I()},[t]),(0,i.useEffect)(()=>{s&&_()},[s,f,m,w]);const I=async()=>{try{var e;E(!0);const[n,i]=await Promise.all([br.details(t),br.episodes(t)]);if(l(n),u(i.episodes||[]),!s&&(null===(e=i.episodes)||void 0===e?void 0:e.length)>0){const e=i.episodes[0];r({episode:e.id,ep:e.episodeNumber})}}catch(n){console.error("Load anime error:",n)}finally{E(!1)}},_=async()=>{try{var e;T(!0);const[t,n]=await Promise.all([br.servers(s),br.stream(s,f,m)]);h(t),y(n),null!==n&&void 0!==n&&null!==(e=n.link)&&void 0!==e&&e.file?D(n.link.file,n.tracks||[]):T(!1)}catch(t){console.error("Load episode error:",t),T(!1)}},D=(e,t)=>{const n=A.current;if(!n)return;if(R.current&&R.current.destroy(),Xh.isSupported()){const t=new Xh({maxBufferLength:30,maxMaxBufferLength:60,enableWorker:!0,startLevel:-1});t.loadSource(e),t.attachMedia(n),t.on(Xh.Events.MANIFEST_PARSED,()=>{n.play().catch(e=>console.log("Autoplay prevented")),k(!0),T(!1)}),t.on(Xh.Events.ERROR,(e,t)=>{t.fatal&&(console.error("HLS error:",t),P())}),R.current=t}else n.canPlayType("application/vnd.apple.mpegurl")?(n.src=e,n.addEventListener("loadedmetadata",()=>{n.play().catch(e=>console.log("Autoplay prevented")),k(!0),T(!1)})):T(!1);n.querySelectorAll("track").forEach(e=>e.remove()),t.forEach((e,t)=>{if("captions"===e.kind||"subtitles"===e.kind){var r;const s=document.createElement("track");s.kind=e.kind,s.label=e.label||"Subtitle ".concat(t+1),s.srclang=(null===(r=e.label)||void 0===r?void 0:r.toLowerCase())||"en",s.src=e.file,e.default&&(s.default=!0),n.appendChild(s)}})},P=()=>{const e=vr(),t=(w+1)%e.length;t!==w?C(t):console.error("All API servers failed.")},C=e=>{(e=>{e>=0&&e<mr.length&&(pr=e)})(e),L(e),_()};if(b)return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20",children:(0,Ue.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-600"})});const O="sub"===m?d.sub:d.dub,N=vr();return(0,Ue.jsx)("div",{className:"min-h-screen pt-16 bg-gray-900",children:(0,Ue.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,Ue.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden mb-6",children:[(0,Ue.jsx)("video",{ref:A,className:"w-full aspect-video",controls:!0,controlsList:"nodownload",playsInline:!0}),S&&(0,Ue.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-70",children:(0,Ue.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"})})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[(0,Ue.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:null===o||void 0===o?void 0:o.title}),(0,Ue.jsxs)("p",{className:"text-gray-400",children:["Episode ",a," ",(null===(e=c.find(e=>e.id===s))||void 0===e?void 0:e.title)&&"- ".concat(c.find(e=>e.id===s).title)]})]}),(0,Ue.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Ue.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,Ue.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Audio & Servers"}),(0,Ue.jsxs)("div",{className:"flex gap-2",children:[(0,Ue.jsx)("button",{onClick:()=>p("sub"),className:"px-4 py-2 rounded-lg text-sm font-semibold transition-colors ".concat("sub"===m?"bg-red-600 text-white":"bg-gray-700 hover:bg-gray-600"),children:"SUB"}),(0,Ue.jsx)("button",{onClick:()=>p("dub"),className:"px-4 py-2 rounded-lg text-sm font-semibold transition-colors ".concat("dub"===m?"bg-red-600 text-white":"bg-gray-700 hover:bg-gray-600"),children:"DUB"})]})]}),(0,Ue.jsx)("div",{className:"flex flex-wrap gap-2",children:O.map(e=>(0,Ue.jsx)("button",{onClick:()=>{return t=e.serverName.toLowerCase(),void g(t);var t},className:"px-3 py-2 rounded-lg text-sm font-semibold transition-colors ".concat(f===e.serverName.toLowerCase()?"bg-yellow-500 text-black":"bg-gray-700 hover:bg-gray-600"),children:e.serverName},e.serverName))})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Ue.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"API Servers"}),(0,Ue.jsx)("p",{className:"text-xs text-gray-400 mb-3",children:"If video fails, try another API server."}),(0,Ue.jsx)("div",{className:"flex flex-wrap gap-2",children:N.map((e,t)=>(0,Ue.jsxs)("button",{onClick:()=>C(t),className:"px-3 py-2 rounded-lg text-sm font-semibold transition-colors ".concat(w===t?"bg-yellow-500 text-black":"bg-gray-700 hover:bg-gray-600"),children:["API ",t+1]},t))})]})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Ue.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"Episodes"}),(0,Ue.jsx)("div",{className:"grid grid-cols-5 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 gap-2 max-h-80 overflow-y-auto",children:c.map(e=>(0,Ue.jsx)("button",{onClick:()=>(e=>{r({episode:e.id,ep:e.episodeNumber})})(e),className:"aspect-square rounded-lg font-semibold transition-all flex items-center justify-center text-center p-1 ".concat(s===e.id?"bg-red-600 text-white scale-105":"bg-gray-700 hover:bg-gray-600"," ").concat(e.isFiller?"border-2 border-yellow-500":""),title:e.title||"Episode ".concat(e.episodeNumber),children:e.episodeNumber},e.id))})]})]})})},Jh=()=>{const e=ae(),[t,n]=(0,i.useState)({username:"",password:""}),[r,s]=(0,i.useState)(""),[a,o]=(0,i.useState)(!1),l=e=>{n(Ve(Ve({},t),{},{[e.target.name]:e.target.value})),s("")};return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20 pb-10",children:(0,Ue.jsx)("div",{className:"w-full max-w-md px-6",children:(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-2xl p-8",children:[(0,Ue.jsxs)("div",{className:"text-center mb-8",children:[(0,Ue.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"\ud83c\udfac Login"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Welcome back to Khopadi!"})]}),r&&(0,Ue.jsx)("div",{className:"bg-red-500/10 border border-red-500 text-red-500 rounded-lg p-3 mb-6 text-sm",children:r}),(0,Ue.jsxs)("form",{onSubmit:async n=>{if(n.preventDefault(),o(!0),s(""),!t.username||!t.password)return s("Please enter both username and password"),void o(!1);try{const n=JSON.parse(localStorage.getItem("users")||"[]").find(e=>e.username===t.username&&e.password===t.password);if(n){const t={username:n.username,loginTime:(new Date).toISOString()};localStorage.setItem("currentUser",JSON.stringify(t)),e("/")}else s("Invalid username or password")}catch(r){s("Login failed. Please try again.")}finally{o(!1)}},className:"space-y-4",children:[(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Username"}),(0,Ue.jsx)("input",{type:"text",name:"username",value:t.username,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Enter your username"})]}),(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Password"}),(0,Ue.jsx)("input",{type:"password",name:"password",value:t.password,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Enter your password"})]}),(0,Ue.jsx)("button",{type:"submit",disabled:a,className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Logging in...":"Login"})]}),(0,Ue.jsxs)("div",{className:"relative my-6",children:[(0,Ue.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,Ue.jsx)("div",{className:"w-full border-t border-gray-600"})}),(0,Ue.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,Ue.jsx)("span",{className:"px-4 bg-gray-800 text-gray-400",children:"OR"})})]}),(0,Ue.jsx)("button",{onClick:()=>{const t={username:"Guest",loginTime:(new Date).toISOString()};localStorage.setItem("currentUser",JSON.stringify(t)),e("/")},className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 rounded-lg transition-colors mb-4",children:"\ud83d\udc64 Continue as Guest"}),(0,Ue.jsxs)("p",{className:"text-center text-gray-400 text-sm",children:["Don't have an account?"," ",(0,Ue.jsx)(Oe,{to:"/register",className:"text-red-500 hover:text-red-400 font-semibold",children:"Create Account"})]})]})})})},Zh=()=>{const e=ae(),[t,n]=(0,i.useState)({username:"",password:"",confirmPassword:""}),[r,s]=(0,i.useState)(""),[a,o]=(0,i.useState)(!1),l=e=>{n(Ve(Ve({},t),{},{[e.target.name]:e.target.value})),s("")};return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20 pb-10",children:(0,Ue.jsx)("div",{className:"w-full max-w-md px-6",children:(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-2xl p-8",children:[(0,Ue.jsxs)("div",{className:"text-center mb-8",children:[(0,Ue.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"\u2728 Create Account"}),(0,Ue.jsx)("p",{className:"text-gray-400",children:"Join Khopadi Entertainment Hub!"})]}),r&&(0,Ue.jsx)("div",{className:"bg-red-500/10 border border-red-500 text-red-500 rounded-lg p-3 mb-6 text-sm",children:r}),(0,Ue.jsxs)("form",{onSubmit:async n=>{if(n.preventDefault(),o(!0),s(""),!t.username||!t.password||!t.confirmPassword)return s("Please fill all fields"),void o(!1);if(t.username.length<3)return s("Username must be at least 3 characters"),void o(!1);if(t.password.length<6)return s("Password must be at least 6 characters"),void o(!1);if(t.password!==t.confirmPassword)return s("Passwords do not match"),void o(!1);try{const n=JSON.parse(localStorage.getItem("users")||"[]");if(n.find(e=>e.username===t.username))return s("Username already exists"),void o(!1);const r={username:t.username,password:t.password,createdAt:(new Date).toISOString()};n.push(r),localStorage.setItem("users",JSON.stringify(n));const i={username:r.username,loginTime:(new Date).toISOString()};localStorage.setItem("currentUser",JSON.stringify(i)),e("/")}catch(r){s("Registration failed. Please try again.")}finally{o(!1)}},className:"space-y-4",children:[(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Username"}),(0,Ue.jsx)("input",{type:"text",name:"username",value:t.username,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Choose a username (min 3 characters)"})]}),(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Password"}),(0,Ue.jsx)("input",{type:"password",name:"password",value:t.password,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Create a password (min 6 characters)"})]}),(0,Ue.jsxs)("div",{children:[(0,Ue.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Confirm Password"}),(0,Ue.jsx)("input",{type:"password",name:"confirmPassword",value:t.confirmPassword,onChange:l,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500 transition-colors",placeholder:"Confirm your password"})]}),(0,Ue.jsx)("button",{type:"submit",disabled:a,className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Creating Account...":"Create Account"})]}),(0,Ue.jsxs)("p",{className:"text-center text-gray-400 text-sm mt-6",children:["Already have an account?"," ",(0,Ue.jsx)(Oe,{to:"/login",className:"text-red-500 hover:text-red-400 font-semibold",children:"Login"})]}),(0,Ue.jsx)("div",{className:"mt-6 p-4 bg-gray-700/50 rounded-lg",children:(0,Ue.jsx)("p",{className:"text-xs text-gray-400 text-center",children:"\ud83d\udd12 Your account is stored locally on your device"})})]})})})},ef=()=>{const e=ae(),[t,n]=(0,i.useState)(null);(0,i.useEffect)(()=>{const t=JSON.parse(localStorage.getItem("currentUser")||"null");t?n(t):e("/login")},[e]);if(!t)return(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center pt-20",children:(0,Ue.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-600"})});const r="Guest"===t.username,s=new Date(t.loginTime).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10",children:(0,Ue.jsx)("div",{className:"container mx-auto px-4",children:(0,Ue.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-2xl p-8",children:[(0,Ue.jsxs)("div",{className:"flex flex-col items-center mb-8",children:[(0,Ue.jsx)("div",{className:"w-32 h-32 bg-gradient-to-br from-red-600 to-red-800 rounded-full flex items-center justify-center text-5xl font-bold text-white mb-4",children:t.username.charAt(0).toUpperCase()}),(0,Ue.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:t.username}),r&&(0,Ue.jsx)("span",{className:"bg-gray-700 text-gray-300 px-3 py-1 rounded-full text-sm",children:"\ud83d\udc64 Guest User"})]}),(0,Ue.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,Ue.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Ue.jsx)("p",{className:"text-gray-400 text-sm mb-1",children:"Login Time"}),(0,Ue.jsxs)("p",{className:"text-white font-semibold",children:["\ud83d\udd52 ",s]})]}),(0,Ue.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Ue.jsx)("p",{className:"text-gray-400 text-sm mb-1",children:"Account Type"}),(0,Ue.jsx)("p",{className:"text-white font-semibold",children:r?"\ud83d\udc64 Guest Account":"\u2b50 Registered User"})]})]}),r&&(0,Ue.jsx)("div",{className:"bg-yellow-500/10 border border-yellow-500 rounded-lg p-4 mb-6",children:(0,Ue.jsx)("p",{className:"text-yellow-500 text-sm",children:"\u26a0\ufe0f You're browsing as a guest. Create an account to save your preferences!"})}),(0,Ue.jsxs)("div",{className:"space-y-3",children:[r?(0,Ue.jsx)("button",{onClick:()=>e("/register"),className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-colors",children:"\u2728 Create Account"}):(0,Ue.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Ue.jsx)("p",{className:"text-gray-400 text-sm mb-2",children:"\ud83d\udd12 Account Security"}),(0,Ue.jsx)("p",{className:"text-white text-sm",children:"Your account is stored locally on this device"})]}),(0,Ue.jsx)("button",{onClick:()=>{localStorage.removeItem("currentUser"),e("/login")},className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 rounded-lg transition-colors",children:"\ud83d\udeaa Logout"}),(0,Ue.jsx)("button",{onClick:()=>e("/"),className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 rounded-lg transition-colors",children:"\ud83c\udfe0 Back to Home"})]})]}),(0,Ue.jsxs)("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[(0,Ue.jsx)("p",{className:"text-3xl mb-2",children:"\ud83c\udfac"}),(0,Ue.jsx)("p",{className:"text-gray-400 text-sm",children:"Movies"})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[(0,Ue.jsx)("p",{className:"text-3xl mb-2",children:"\ud83d\udcfa"}),(0,Ue.jsx)("p",{className:"text-gray-400 text-sm",children:"TV Shows"})]}),(0,Ue.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[(0,Ue.jsx)("p",{className:"text-3xl mb-2",children:"\u2728"}),(0,Ue.jsx)("p",{className:"text-gray-400 text-sm",children:"Anime"})]})]})]})})})},tf=()=>{const[e,t]=(0,i.useState)({quote:"Loading...",role:""}),[n,r]=(0,i.useState)(!0);(0,i.useEffect)(()=>{s()},[]);const s=async()=>{r(!0);const e=await Dr.random();t(e),r(!1)};return(0,Ue.jsx)("div",{className:"min-h-screen pt-20 pb-10 flex items-center justify-center",children:(0,Ue.jsx)("div",{className:"container mx-auto px-4",children:(0,Ue.jsxs)("div",{className:"max-w-3xl mx-auto text-center",children:[(0,Ue.jsx)("h1",{className:"mb-8 text-4xl font-bold",children:"Movie Quotes"}),n?(0,Ue.jsxs)("div",{className:"animate-pulse",children:[(0,Ue.jsx)("div",{className:"h-32 bg-gray-800 rounded-lg mb-4"}),(0,Ue.jsx)("div",{className:"h-8 bg-gray-800 rounded-lg w-1/3 mx-auto"})]}):(0,Ue.jsxs)("div",{className:"bg-gradient-to-br from-red-900/20 to-gray-900 p-8 rounded-xl shadow-2xl border border-red-900/30",children:[(0,Ue.jsx)("svg",{className:"w-12 h-12 text-red-500 mb-4 mx-auto",fill:"currentColor",viewBox:"0 0 24 24",children:(0,Ue.jsx)("path",{d:"M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"})}),(0,Ue.jsxs)("p",{className:"text-2xl italic mb-6 text-gray-200",children:['"',e.quote,'"']}),(0,Ue.jsxs)("p",{className:"text-lg text-red-400 font-semibold",children:["- ",e.role]}),(0,Ue.jsx)("button",{onClick:s,className:"mt-8 px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors",children:"Get New Quote"})]})]})})})},nf=(0,i.createContext)(),rf=()=>{const e=(0,i.useContext)(nf);if(!e)throw new Error("useTheme must be used within ThemeProvider");return e};const sf=function(){const[e,t]=(0,i.useState)(!0);(0,i.useEffect)(()=>{const e=localStorage.getItem("theme");e&&t("dark"===e)},[]);const n=e?{bg:"bg-gray-900",text:"text-white",cardBg:"bg-gray-800",border:"border-gray-700"}:{bg:"bg-white",text:"text-gray-900",cardBg:"bg-gray-100",border:"border-gray-300"};return(0,Ue.jsx)(nf.Provider,{value:{isDarkMode:e,toggleTheme:()=>{const n=!e;t(n),localStorage.setItem("theme",n?"dark":"light")},colors:n},children:(0,Ue.jsx)(De,{basename:"/khopadi.github.io",children:(0,Ue.jsxs)("div",{className:"min-h-screen ".concat(n.bg," ").concat(n.text),children:[(0,Ue.jsx)(Be,{}),(0,Ue.jsxs)(ke,{children:[(0,Ue.jsx)(Te,{path:"/",element:(0,Ue.jsx)(Nr,{})}),(0,Ue.jsx)(Te,{path:"/movies",element:(0,Ue.jsx)(Mr,{})}),(0,Ue.jsx)(Te,{path:"/tv-shows",element:(0,Ue.jsx)(Fr,{})}),(0,Ue.jsx)(Te,{path:"/anime",element:(0,Ue.jsx)(Br,{})}),(0,Ue.jsx)(Te,{path:"/anime/watch/:id",element:(0,Ue.jsx)($h,{})}),(0,Ue.jsx)(Te,{path:"/upcoming",element:(0,Ue.jsx)(jr,{})}),(0,Ue.jsx)(Te,{path:"/movie/:id",element:(0,Ue.jsx)(Gr,{})}),(0,Ue.jsx)(Te,{path:"/tv/:id",element:(0,Ue.jsx)(Gr,{})}),(0,Ue.jsx)(Te,{path:"/watch/movie/:id",element:(0,Ue.jsx)(Kr,{})}),(0,Ue.jsx)(Te,{path:"/watch/tv/:id",element:(0,Ue.jsx)(Kr,{})}),(0,Ue.jsx)(Te,{path:"/login",element:(0,Ue.jsx)(Jh,{})}),(0,Ue.jsx)(Te,{path:"/register",element:(0,Ue.jsx)(Zh,{})}),(0,Ue.jsx)(Te,{path:"/profile",element:(0,Ue.jsx)(ef,{})}),(0,Ue.jsx)(Te,{path:"/quotes",element:(0,Ue.jsx)(tf,{})})]})]})})})};class af extends i.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error caught by boundary:",e,t)}render(){return this.state.hasError?(0,Ue.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:(0,Ue.jsxs)("div",{className:"max-w-md w-full bg-gray-800 rounded-lg shadow-xl p-8 text-center",children:[(0,Ue.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\u26a0"}),(0,Ue.jsx)("h1",{className:"text-2xl font-bold text-white mb-4",children:"Oops! Something went wrong"}),(0,Ue.jsx)("p",{className:"text-gray-400 mb-6",children:"We encountered an unexpected error. Please try refreshing the page."}),(0,Ue.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-3 rounded-lg transition-colors",children:"Refresh Page"}),!1]})}):this.props.children}}const of=af,lf=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,453)).then(t=>{let{getCLS:n,getFID:r,getFCP:s,getLCP:i,getTTFB:a}=t;n(e),r(e),s(e),i(e),a(e)})};o.createRoot(document.getElementById("root")).render((0,Ue.jsx)(i.StrictMode,{children:(0,Ue.jsx)(of,{children:(0,Ue.jsx)(sf,{})})})),lf()})();
//# sourceMappingURL=main.1949855f.js.map